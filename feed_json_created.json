{
    "version": "https://jsonfeed.org/version/1",
    "title": "Disenone's Wiki",
    "home_page_url": "https://wiki.disenone.site/",
    "feed_url": "https://wiki.disenone.site/feed_json_created.json",
    "description": "\u65e0\u6b62\u5883",
    "icon": "https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Feed-icon.svg/128px-Feed-icon.svg.png",
    "authors": [
        {
            "name": "Disenone"
        }
    ],
    "language": "en",
    "items": [
        {
            "id": "https://wiki.disenone.site/es/blog/",
            "url": "https://wiki.disenone.site/es/blog/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Blog",
            "content_html": "<h1 id=\"blog\">Blog</h1>",
            "image": null,
            "date_published": "2024-12-16T18:00:02.328815+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/en/blog/",
            "url": "https://wiki.disenone.site/en/blog/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Blog",
            "content_html": "<h1 id=\"blog\">Blog</h1>",
            "image": null,
            "date_published": "2024-12-16T17:59:47.286687+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/blog/",
            "url": "https://wiki.disenone.site/blog/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Blog",
            "content_html": "<h1 id=\"blog\">Blog</h1>",
            "image": null,
            "date_published": "2024-12-16T17:59:31.482300+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E5%9B%BE%E7%89%87-%E5%90%84%E7%A7%8D%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C/",
            "url": "https://wiki.disenone.site/ue-%E5%9B%BE%E7%89%87-%E5%90%84%E7%A7%8D%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u5b9e\u73b0\u5404\u79cd\u56fe\u7247 (UTexture2D) \u64cd\u4f5c \uff08\u8bfb\u53d6\u3001\u4fdd\u5b58\u3001\u590d\u5236\u3001\u526a\u8d34\u677f...\uff09",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u5b9e\u73b0\u8bfb\u53d6\u672c\u5730\u7cfb\u7edf\u56fe\u7247\" /></p>\n<h1 id=\"ue-utexture2d\">UE \u5b9e\u73b0\u5404\u79cd\u56fe\u7247 (UTexture2D) \u64cd\u4f5c \uff08\u8bfb\u53d6\u3001\u4fdd\u5b58\u3001\u590d\u5236\u3001\u526a\u8d34\u677f...\uff09</h1>\n<blockquote>\n<p>\u4ee5\u4e0b\u4ee3\u7801\u90fd\u662f\u4ee5 UE5.3 \u7248\u672c\u4e3a\u4f8b\u3002</p>\n</blockquote>\n<h2 id=\"_1\">\u6e90\u7801</h2>\n<p>\u66f4\u591a\u6e90\u7801\u7ec6\u8282\u53ef\u5728 UE \u5546\u57ce\u83b7\u53d6\u63d2\u4ef6\uff1a<a href=\"https://www.unrealengine.com/marketplace/zh-CN/product/aichatplus-ai-chat-integration-openai-azure-claude-gemini\">AIChatPlus</a></p>\n<h2 id=\"ue-utexture2d_1\">\u8bfb\u53d6\uff1aUE \u5b9e\u73b0\u8bfb\u53d6\u672c\u5730\u7cfb\u7edf\u56fe\u7247\u4e3a UTexture2D</h2>\n<h3 id=\"_2\">\u901a\u7528\u65b9\u6cd5</h3>\n<p>\u672c\u65b9\u6cd5\u5728 \u7f16\u8f91\u5668 \u548c GamePlay \u6a21\u5f0f\u4e0b\u90fd\u53ef\u884c\uff0c\u652f\u6301\u7684\u56fe\u7247\u6587\u4ef6\u683c\u5f0f\u6709 PNG, JPEG, BMP, ICO, EXR, ICNS, HDR, TIFF, DDS, TGA\uff0c\u57fa\u672c\u80fd\u8986\u76d6\u5927\u90e8\u5206\u7684\u5e38\u7528\u56fe\u7247\u7c7b\u578b\u3002</p>\n<p>\u4ee3\u7801\u4e5f\u5f88\u7b80\u6d01\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Engine/Texture2D.h&gt;</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;ImageUtils.h&gt;</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">LoadImage</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">InLoadPath</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"n\">FImage</span><span class=\"w\"> </span><span class=\"n\">ImageInfo</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">    </span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">LoadImage</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">InLoadPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ImageInfo</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">CreateTexture2DFromImage</span><span class=\"p\">(</span><span class=\"n\">ImageInfo</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u8fd4\u56de\u7684\u5373\u662f UTexture2D\u3002</p>\n<h3 id=\"_3\">\u7f16\u8f91\u5668\u4e13\u7528\u65b9\u6cd5</h3>\n<p>\u672c\u65b9\u6cd5\u53ef\u4ee5\u989d\u5916\u652f\u6301\u66f4\u591a\u7684\u56fe\u7247\u7c7b\u578b\uff1aUDIM \u7eb9\u7406\u8d34\u56fe\u3001IES \u6587\u4ef6\u3001PCX \u3001PSD\u3002</p>\n<p>\u4ee3\u7801\u5b9e\u73b0\u4e0a\u4f1a\u66f4\u590d\u6742\u4e00\u4e9b\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Engine/Texture2D.h&gt;</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Misc/FileHelper.h&gt;</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Misc/Paths.h&gt;</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;UObject/UObjectGlobals.h&gt;</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"cp\">#if WITH_EDITOR</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">LoadImage</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">InLoadPath</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">    </span><span class=\"n\">TArray64</span><span class=\"o\">&lt;</span><span class=\"n\">uint8</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">FFileHelper</span><span class=\"o\">::</span><span class=\"n\">LoadFileToArray</span><span class=\"p\">(</span><span class=\"n\">Buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">InLoadPath</span><span class=\"p\">))</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">TextureName</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">Extension</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPaths</span><span class=\"o\">::</span><span class=\"n\">GetExtension</span><span class=\"p\">(</span><span class=\"n\">InLoadPath</span><span class=\"p\">).</span><span class=\"n\">ToLower</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">BufferPtr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Buffer</span><span class=\"p\">.</span><span class=\"n\">GetData</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">TextureFact</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">NewObject</span><span class=\"o\">&lt;</span><span class=\"n\">UTextureFactory</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Cast</span><span class=\"o\">&lt;</span><span class=\"n\">UTexture2D</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">TextureFact</span><span class=\"o\">-&gt;</span><span class=\"n\">FactoryCreateBinary</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">        </span><span class=\"n\">UTexture2D</span><span class=\"o\">::</span><span class=\"n\">StaticClass</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">GetTransientPackage</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">TextureName</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RF_Transient</span><span class=\"p\">,</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">        </span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">Extension</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">BufferPtr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">BufferPtr</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Buffer</span><span class=\"p\">.</span><span class=\"n\">Num</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">GWarn</span><span class=\"p\">));</span>\n<a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a>\n<a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"cp\">#endif</span>\n</code></pre></div>\n<p>\u5b9e\u73b0\u662f\u4f7f\u7528\u4e86 UTextureFactory \u7684 FactoryCreateBinary \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u80fd\u591f\u8bfb\u53d6\u524d\u9762\u63d0\u5230\u7684\u989d\u5916\u6587\u4ef6\u7c7b\u578b\u3002</p>\n<h2 id=\"ue-utexture2d_2\">\u590d\u5236\uff1aUE \u5b9e\u73b0\u590d\u5236 UTexture2D</h2>\n<p>\u6709\u7684\u65f6\u5019\u9700\u8981\u590d\u5236\u4e00\u4e2a UTexture2D \u51fa\u6765\uff0c\u518d\u5bf9\u8fd9\u4e2a\u590d\u5236\u51fa\u6765\u7684\u56fe\u7247\u8fdb\u884c\u4fee\u6539\uff0c\u590d\u5236\u56fe\u7247\u9700\u8981\u4f7f\u7528\u5230\u5f15\u64ce\u81ea\u5e26\u7684\u51fd\u6570 <code>FImageCore::CopyImage</code>\uff0c\u53ea\u8981\u8bbe\u7f6e\u597d\u4e24\u4e2a\u56fe\u7247\u7684\u53c2\u6570\uff0c\u8c03\u7528\u8fd9\u4e2a\u63a5\u53e3\u5373\u53ef</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">CopyTexture2D</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">UObject</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Outer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FName</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EObjectFlags</span><span class=\"w\"> </span><span class=\"n\">Flags</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"c1\">// src texture info, src ImageView</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">FTextureMipDataLockGuard</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">SrcMipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_ONLY</span><span class=\"p\">);</span><span class=\"w\">        </span><span class=\"c1\">// Texture-&gt;GetPlatformData()-&gt;Mips[0].BulkData.Lock(InLockFlag)</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeX</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeY</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EPixelFormat</span><span class=\"w\"> </span><span class=\"n\">InFormat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPixelFormat</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">SrcMipImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">        </span><span class=\"n\">SrcMipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InFormat</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetGammaSpace</span><span class=\"p\">());</span>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"w\">    </span><span class=\"c1\">// create dst texture</span>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">    </span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">NewObject</span><span class=\"o\">&lt;</span><span class=\"n\">UTexture2D</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">Outer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Flags</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">SetPlatformData</span><span class=\"p\">(</span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">FTexturePlatformData</span><span class=\"p\">());</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">SetNumSlices</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">PixelFormat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InFormat</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">    </span><span class=\"c1\">// Allocate first mipmap.</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"w\">    </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">NumBlocksX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">InFormat</span><span class=\"p\">].</span><span class=\"n\">BlockSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">    </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">NumBlocksY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">InFormat</span><span class=\"p\">].</span><span class=\"n\">BlockSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"w\">    </span><span class=\"n\">FTexture2DMipMap</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Mip</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">FTexture2DMipMap</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">Mips</span><span class=\"p\">.</span><span class=\"n\">Add</span><span class=\"p\">(</span><span class=\"n\">Mip</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_WRITE</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Realloc</span><span class=\"p\">((</span><span class=\"n\">int64</span><span class=\"p\">)</span><span class=\"n\">NumBlocksX</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">NumBlocksY</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">InFormat</span><span class=\"p\">].</span><span class=\"n\">BlockBytes</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-30\" name=\"__codelineno-2-30\" href=\"#__codelineno-2-30\"></a><span class=\"w\">    </span><span class=\"n\">Mip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Unlock</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-31\" name=\"__codelineno-2-31\" href=\"#__codelineno-2-31\"></a>\n<a id=\"__codelineno-2-32\" name=\"__codelineno-2-32\" href=\"#__codelineno-2-32\"></a><span class=\"w\">    </span><span class=\"c1\">// dst texture ImageView</span>\n<a id=\"__codelineno-2-33\" name=\"__codelineno-2-33\" href=\"#__codelineno-2-33\"></a><span class=\"w\">    </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">DstMipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">static_cast</span><span class=\"o\">&lt;</span><span class=\"n\">uint8</span><span class=\"o\">*&gt;</span><span class=\"p\">(</span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">Mips</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_WRITE</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-34\" name=\"__codelineno-2-34\" href=\"#__codelineno-2-34\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">DstMipImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-35\" name=\"__codelineno-2-35\" href=\"#__codelineno-2-35\"></a><span class=\"w\">        </span><span class=\"n\">DstMipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InFormat</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetGammaSpace</span><span class=\"p\">());</span>\n<a id=\"__codelineno-2-36\" name=\"__codelineno-2-36\" href=\"#__codelineno-2-36\"></a>\n<a id=\"__codelineno-2-37\" name=\"__codelineno-2-37\" href=\"#__codelineno-2-37\"></a><span class=\"w\">    </span><span class=\"c1\">// run CopyImage</span>\n<a id=\"__codelineno-2-38\" name=\"__codelineno-2-38\" href=\"#__codelineno-2-38\"></a><span class=\"w\">    </span><span class=\"n\">FImageCore</span><span class=\"o\">::</span><span class=\"n\">CopyImage</span><span class=\"p\">(</span><span class=\"n\">SrcMipImage</span><span class=\"p\">,</span><span class=\"n\">DstMipImage</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-39\" name=\"__codelineno-2-39\" href=\"#__codelineno-2-39\"></a>\n<a id=\"__codelineno-2-40\" name=\"__codelineno-2-40\" href=\"#__codelineno-2-40\"></a><span class=\"cp\">#if WITH_EDITORONLY_DATA</span>\n<a id=\"__codelineno-2-41\" name=\"__codelineno-2-41\" href=\"#__codelineno-2-41\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">Source</span><span class=\"p\">.</span><span class=\"n\">Init</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-42\" name=\"__codelineno-2-42\" href=\"#__codelineno-2-42\"></a><span class=\"w\">        </span><span class=\"n\">InSizeX</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-43\" name=\"__codelineno-2-43\" href=\"#__codelineno-2-43\"></a><span class=\"w\">        </span><span class=\"n\">FImageCoreUtils</span><span class=\"o\">::</span><span class=\"n\">ConvertToTextureSourceFormat</span><span class=\"p\">(</span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InFormat</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"n\">DstMipData</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-44\" name=\"__codelineno-2-44\" href=\"#__codelineno-2-44\"></a><span class=\"cp\">#endif</span>\n<a id=\"__codelineno-2-45\" name=\"__codelineno-2-45\" href=\"#__codelineno-2-45\"></a>\n<a id=\"__codelineno-2-46\" name=\"__codelineno-2-46\" href=\"#__codelineno-2-46\"></a><span class=\"w\">    </span><span class=\"c1\">// cleanup</span>\n<a id=\"__codelineno-2-47\" name=\"__codelineno-2-47\" href=\"#__codelineno-2-47\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPlatformData</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">Mips</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Unlock</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-48\" name=\"__codelineno-2-48\" href=\"#__codelineno-2-48\"></a><span class=\"w\">    </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">UpdateResource</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-49\" name=\"__codelineno-2-49\" href=\"#__codelineno-2-49\"></a>\n<a id=\"__codelineno-2-50\" name=\"__codelineno-2-50\" href=\"#__codelineno-2-50\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-51\" name=\"__codelineno-2-51\" href=\"#__codelineno-2-51\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h2 id=\"ue-utexture2d_3\">\u4fdd\u5b58\uff1aUE \u5b9e\u73b0\u4fdd\u5b58 UTexture2D \u5230\u6587\u4ef6</h2>\n<p>\u6838\u5fc3\u662f\u4f7f\u7528\u5f15\u64ce\u51fd\u6570 <code>FImageUtils::SaveImageAutoFormat</code>\uff0c\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u5931\u8d25\u91cd\u8bd5\u7684\u60c5\u51b5</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">SaveImage</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">InSavePath</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">InImage</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">    </span><span class=\"n\">FImage</span><span class=\"w\"> </span><span class=\"n\">ImageInfo</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">GetTexture2DSourceImage</span><span class=\"p\">(</span><span class=\"n\">InImage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ImageInfo</span><span class=\"p\">))</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">        </span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">SaveImageAutoFormat</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">InSavePath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ImageInfo</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">        </span><span class=\"c1\">// if prev save failed</span>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"w\">        </span><span class=\"c1\">// use ConvertTextureToStandard to change InImage to Standard format, and try again</span>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">        </span><span class=\"c1\">// then revert InImage&#39;s origin format</span>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">        </span><span class=\"c1\">// this is what FTextureMipDataLockGuard does</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">        </span><span class=\"n\">FTextureMipDataLockGuard</span><span class=\"w\"> </span><span class=\"n\">InImageGuard</span><span class=\"p\">(</span><span class=\"n\">InImage</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">        </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">MipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InImageGuard</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_ONLY</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">        </span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">MipData</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">MipImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">            </span><span class=\"n\">MipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeX</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeY</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"w\">            </span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InImage</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPixelFormat</span><span class=\"p\">()),</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"o\">-&gt;</span><span class=\"n\">GetGammaSpace</span><span class=\"p\">());</span>\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a>\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">        </span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">SaveImageAutoFormat</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">InSavePath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">MipImage</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h2 id=\"ue-utexture2d-asset\">\u4fdd\u5b58\uff1aUE \u5b9e\u73b0\u4fdd\u5b58 UTexture2D \u5230 Asset</h2>\n<p>\u4fdd\u5b58\u5185\u5b58\u4e2d\u7684 UTexture2D \u5230 Asset \u4e2d\uff0c\u5e76\u53ef\u4ee5\u5728\u8d44\u6e90\u6d4f\u89c8\u5668 (Content Browser) \u4e2d\u67e5\u770b\u3002</p>\n<p>\u6838\u5fc3\u51fd\u6570\u9700\u8981\u7528\u5230\u4e0a\u9762\u5b9e\u73b0\u7684 <code>CopyTexture2D</code>\uff0c\u6211\u4eec\u9700\u8981\u5148\u590d\u5236\u51fa\u6765\u4e00\u4e2a\u65b0\u7684\u56fe\u7247\uff0c\u7136\u540e\u518d\u8c03\u7528 <code>UPackage::SavePackage</code> \u628a\u56fe\u7247\u6240\u5728\u7684 <code>Package</code> \u4fdd\u5b58\u6210 Asset\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">SaveTextureToAsset</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">InTexture</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">    </span><span class=\"c1\">// open save asset dialog, choose where/which to save</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">    </span><span class=\"n\">FSaveAssetDialogConfig</span><span class=\"w\"> </span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">    </span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">.</span><span class=\"n\">DefaultPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\">  </span><span class=\"n\">FEditorDirectories</span><span class=\"o\">::</span><span class=\"n\">Get</span><span class=\"p\">().</span><span class=\"n\">GetLastDirectory</span><span class=\"p\">(</span><span class=\"n\">ELastDirectory</span><span class=\"o\">::</span><span class=\"n\">NEW_ASSET</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">    </span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">.</span><span class=\"n\">AssetClassNames</span><span class=\"p\">.</span><span class=\"n\">Add</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">::</span><span class=\"n\">StaticClass</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">GetClassPathName</span><span class=\"p\">());</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">    </span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">.</span><span class=\"n\">ExistingAssetPolicy</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ESaveAssetDialogExistingAssetPolicy</span><span class=\"o\">::</span><span class=\"n\">AllowButWarn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">    </span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">.</span><span class=\"n\">DialogTitleOverride</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FAIChatPlusEditor_Constants</span><span class=\"o\">::</span><span class=\"n\">FCText</span><span class=\"o\">::</span><span class=\"n\">SaveAsAsset</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FContentBrowserModule</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">ContentBrowserModule</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FModuleManager</span><span class=\"o\">::</span><span class=\"n\">LoadModuleChecked</span><span class=\"o\">&lt;</span><span class=\"n\">FContentBrowserModule</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;ContentBrowser&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">SaveObjectPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ContentBrowserModule</span><span class=\"p\">.</span><span class=\"n\">Get</span><span class=\"p\">().</span><span class=\"n\">CreateModalSaveAssetDialog</span><span class=\"p\">(</span><span class=\"n\">SaveAssetDialogConfig</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a>\n<a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">SaveObjectPath</span><span class=\"p\">.</span><span class=\"n\">IsEmpty</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a>\n<a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">    </span><span class=\"c1\">// init save info</span>\n<a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">PackageName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPackageName</span><span class=\"o\">::</span><span class=\"n\">ObjectPathToPackageName</span><span class=\"p\">(</span><span class=\"n\">SaveObjectPath</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">PackageFileName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPackageName</span><span class=\"o\">::</span><span class=\"n\">LongPackageNameToFilename</span><span class=\"p\">(</span><span class=\"n\">PackageName</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FPackageName</span><span class=\"o\">::</span><span class=\"n\">GetAssetPackageExtension</span><span class=\"p\">());</span>\n<a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">PackagePath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPaths</span><span class=\"o\">::</span><span class=\"n\">GetPath</span><span class=\"p\">(</span><span class=\"n\">PackageFileName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">TextureName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPaths</span><span class=\"o\">::</span><span class=\"n\">GetBaseFilename</span><span class=\"p\">(</span><span class=\"n\">PackageName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a>\n<a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">    </span><span class=\"c1\">// create new UPackage to put the new texture in</span>\n<a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">    </span><span class=\"n\">UPackage</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">NewPackage</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">CreatePackage</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">PackageName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">    </span><span class=\"n\">NewPackage</span><span class=\"o\">-&gt;</span><span class=\"n\">FullyLoad</span><span class=\"p\">();</span>\n<a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a>\n<a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">    </span><span class=\"c1\">// copy texture</span>\n<a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a><span class=\"w\">    </span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">UAIChatPlus_Util</span><span class=\"o\">::</span><span class=\"n\">CopyTexture2D</span><span class=\"p\">(</span>\n<a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">        </span><span class=\"n\">InTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NewPackage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FName</span><span class=\"p\">(</span><span class=\"n\">TextureName</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">RF_Public</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">RF_Standalone</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">RF_Transactional</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a>\n<a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a><span class=\"w\">    </span><span class=\"c1\">// Generate the thumbnail</span>\n<a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">    </span><span class=\"c1\">// if not doing so, the texture will not have thumbnail in content browser</span>\n<a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">    </span><span class=\"n\">FObjectThumbnail</span><span class=\"w\"> </span><span class=\"n\">NewThumbnail</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a><span class=\"w\">    </span><span class=\"n\">ThumbnailTools</span><span class=\"o\">::</span><span class=\"n\">RenderThumbnail</span><span class=\"p\">(</span>\n<a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a><span class=\"w\">        </span><span class=\"n\">NewTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeX</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeY</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">        </span><span class=\"n\">ThumbnailTools</span><span class=\"o\">::</span><span class=\"n\">EThumbnailTextureFlushMode</span><span class=\"o\">::</span><span class=\"n\">NeverFlush</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">NewThumbnail</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">    </span><span class=\"n\">ThumbnailTools</span><span class=\"o\">::</span><span class=\"n\">CacheThumbnail</span><span class=\"p\">(</span><span class=\"n\">NewTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetFullName</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">NewThumbnail</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NewPackage</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a>\n<a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">    </span><span class=\"c1\">// setting up new package and new texture</span>\n<a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a><span class=\"w\">    </span><span class=\"n\">NewPackage</span><span class=\"o\">-&gt;</span><span class=\"n\">MarkPackageDirty</span><span class=\"p\">();</span>\n<a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a><span class=\"w\">    </span><span class=\"n\">FAssetRegistryModule</span><span class=\"o\">::</span><span class=\"n\">AssetCreated</span><span class=\"p\">(</span><span class=\"n\">NewTexture</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a><span class=\"w\">    </span><span class=\"n\">FEditorDirectories</span><span class=\"o\">::</span><span class=\"n\">Get</span><span class=\"p\">().</span><span class=\"n\">SetLastDirectory</span><span class=\"p\">(</span><span class=\"n\">ELastDirectory</span><span class=\"o\">::</span><span class=\"n\">NEW_ASSET</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FPaths</span><span class=\"o\">::</span><span class=\"n\">GetPath</span><span class=\"p\">(</span><span class=\"n\">PackageName</span><span class=\"p\">));</span>\n<a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a>\n<a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">    </span><span class=\"c1\">// save args</span>\n<a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">    </span><span class=\"n\">FSavePackageArgs</span><span class=\"w\"> </span><span class=\"n\">SaveArgs</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"w\">    </span><span class=\"n\">SaveArgs</span><span class=\"p\">.</span><span class=\"n\">TopLevelFlags</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RF_Public</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">RF_Standalone</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-49\" name=\"__codelineno-4-49\" href=\"#__codelineno-4-49\"></a><span class=\"w\">    </span><span class=\"n\">SaveArgs</span><span class=\"p\">.</span><span class=\"n\">bForceByteSwapping</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-50\" name=\"__codelineno-4-50\" href=\"#__codelineno-4-50\"></a><span class=\"w\">    </span><span class=\"n\">SaveArgs</span><span class=\"p\">.</span><span class=\"n\">bWarnOfLongFilename</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-51\" name=\"__codelineno-4-51\" href=\"#__codelineno-4-51\"></a>\n<a id=\"__codelineno-4-52\" name=\"__codelineno-4-52\" href=\"#__codelineno-4-52\"></a><span class=\"w\">    </span><span class=\"c1\">// save it</span>\n<a id=\"__codelineno-4-53\" name=\"__codelineno-4-53\" href=\"#__codelineno-4-53\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">UPackage</span><span class=\"o\">::</span><span class=\"n\">SavePackage</span><span class=\"p\">(</span><span class=\"n\">NewPackage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NewTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">PackageFileName</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SaveArgs</span><span class=\"p\">))</span>\n<a id=\"__codelineno-4-54\" name=\"__codelineno-4-54\" href=\"#__codelineno-4-54\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-55\" name=\"__codelineno-4-55\" href=\"#__codelineno-4-55\"></a><span class=\"w\">        </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlusEditor</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to save Asset: [%s]</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">PackageFileName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-56\" name=\"__codelineno-4-56\" href=\"#__codelineno-4-56\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-57\" name=\"__codelineno-4-57\" href=\"#__codelineno-4-57\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h2 id=\"ue-utexture2d-windows-clipboard\">\u526a\u8d34\u677f\uff1aUE \u5b9e\u73b0\u590d\u5236\u56fe\u7247 (UTexture2D) \u5230 Windows \u526a\u8d34\u677f (Clipboard)</h2>\n<h3 id=\"windows\">Windows \u76f8\u5173\u51fd\u6570</h3>\n<p>\u6211\u4eec\u4f1a\u7528\u5230\u4ee5\u4e0b Windows \u64cd\u4f5c\u526a\u8d34\u677f\u7684\u76f8\u5173\u51fd\u6570\uff1a</p>\n<ul>\n<li><a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-openclipboard\">OpenClipboard</a>\uff1a\u6253\u5f00\u526a\u8d34\u677f\uff0c\u83b7\u53d6\u526a\u8d34\u677f\u7684 Handler \u3002</li>\n<li><a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-emptyclipboard\">EmptyClipboard</a>\uff1a\u6e05\u7a7a\u526a\u8d34\u677f\uff0c\u5e76\u628a\u526a\u8d34\u677f\u7684\u6240\u6709\u6743\u5206\u914d\u7ed9\u5f53\u524d\u7684\u7a97\u53e3\u3002</li>\n<li><a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setclipboarddata\">SetClipboardData</a>\uff1a\u8bbe\u7f6e\u526a\u8d34\u677f\u7684\u6570\u636e\uff0c\u56fe\u7247\u7684\u6570\u636e\u662f\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u53d1\u9001\u7ed9\u526a\u8d34\u677f\u3002</li>\n<li><a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-closeclipboard\">CloseClipboard</a>\uff1a\u8bbe\u7f6e\u597d\u6570\u636e\u4e4b\u540e\uff0c\u5173\u95ed\u526a\u8d34\u677f\u3002</li>\n</ul>\n<h3 id=\"_4\">\u526a\u8d34\u677f\u7684\u56fe\u7247\u683c\u5f0f</h3>\n<p><a href=\"https://learn.microsoft.com/zh-cn/windows/win32/dataxchg/standard-clipboard-formats\">\u6807\u51c6\u526a\u8d34\u677f\u683c\u5f0f</a> \u91cc\u9762\u4ecb\u7ecd\u4e86\u53ef\u7528\u7684\u526a\u8d34\u677f\u683c\u5f0f\uff0c\u5176\u4e2d <code>CF_DIBV5</code> \u5373\u53ef\u4ee5\u7528\u6765\u8bbe\u7f6e\u56fe\u7247\u3002</p>\n<p>CF_DIBV5 \u8981\u6c42\u7684\u683c\u5f0f\u5177\u4f53\u5b9a\u4e49 <a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/wingdi/ns-wingdi-bitmapv5header\">BITMAPV5HEADER \u7ed3\u6784</a>\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u9009\u7528\u4ee5\u4e0b\u914d\u7f6e</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">BITMAPV5HEADER</span><span class=\"w\"> </span><span class=\"n\">Header</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5CSType</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">LCS_sRGB</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Compression</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">BI_BITFIELDS</span><span class=\"p\">;</span>\n</code></pre></div>\n<h3 id=\"utexture2d\">UTexture2D \u8bbe\u7f6e</h3>\n<p>\u6211\u4eec\u5728\u4e0a\u9762\u9009\u62e9\u4e86\u526a\u8d34\u677f\u56fe\u7247\u7684\u989c\u8272\u7a7a\u95f4\u662f <code>LCS_sRGB</code>\uff0c\u5373 sRGB \u989c\u8272\u7a7a\u95f4\uff0c\u90a3\u4e48 UTexture2D \u4e5f\u9700\u8981\u5148\u8bbe\u7f6e\u5230\u5bf9\u5e94\u7684\u683c\u5f0f\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"nf\">ConvertTextureToStandard</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">CompressionSettings</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">TC_VectorDisplacementmap</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">        </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">CompressionSettings</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">TC_VectorDisplacementmap</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">        </span><span class=\"n\">IsChanged</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">SRGB</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">        </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">SRGB</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">        </span><span class=\"n\">IsChanged</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IsChanged</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">        </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">UpdateResource</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>ConvertTextureToStandard \u5c31\u662f\u8d1f\u8d23\u628a UTexture2D \u8f6c\u6362\u6210\u6807\u51c6\u683c\u5f0f\uff1aTC_VectorDisplacementmap (RGBA8) \u548c SRGB \u989c\u8272\u7a7a\u95f4\u3002\u5bf9\u9f50\u4e86 UTexture2D \u548c Windows \u526a\u8d34\u677f\u7684\u56fe\u7247\u683c\u5f0f\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u56fe\u7247\u7684\u6570\u636e\u590d\u5236\u5230\u526a\u8d34\u677f\u4e0a\u3002</p>\n<h3 id=\"_5\">\u5177\u4f53\u4ee3\u7801</h3>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">CopyTexture2DToClipboard</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">InTexture</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">    </span><span class=\"n\">FTextureMipDataLockGuard</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">    </span><span class=\"c1\">// get InTexture info</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">    </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">SrcMipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_ONLY</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeX</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeY</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EPixelFormat</span><span class=\"w\"> </span><span class=\"n\">InFormat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPixelFormat</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">SrcMipImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">        </span><span class=\"n\">SrcMipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetGammaSpace</span><span class=\"p\">());</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a>\n<a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">    </span><span class=\"c1\">// set clipboard Texture info</span>\n<a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EPixelFormat</span><span class=\"w\"> </span><span class=\"n\">OutFormat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PF_B8G8R8A8</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">NumBlocksX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">OutFormat</span><span class=\"p\">].</span><span class=\"n\">BlockSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">NumBlocksY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">OutFormat</span><span class=\"p\">].</span><span class=\"n\">BlockSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int64</span><span class=\"w\"> </span><span class=\"n\">BufSize</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">static_cast</span><span class=\"o\">&lt;</span><span class=\"n\">int64</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">NumBlocksX</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">NumBlocksY</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">GPixelFormats</span><span class=\"p\">[</span><span class=\"n\">InFormat</span><span class=\"p\">].</span><span class=\"n\">BlockBytes</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a>\n<a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">    </span><span class=\"c1\">// set header info</span>\n<a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"w\">    </span><span class=\"n\">BITMAPV5HEADER</span><span class=\"w\"> </span><span class=\"n\">Header</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-22\" name=\"__codelineno-7-22\" href=\"#__codelineno-7-22\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Size</span><span class=\"w\">          </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">BITMAPV5HEADER</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-23\" name=\"__codelineno-7-23\" href=\"#__codelineno-7-23\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Width</span><span class=\"w\">         </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-24\" name=\"__codelineno-7-24\" href=\"#__codelineno-7-24\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Height</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">InSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-25\" name=\"__codelineno-7-25\" href=\"#__codelineno-7-25\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Planes</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-26\" name=\"__codelineno-7-26\" href=\"#__codelineno-7-26\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5BitCount</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-27\" name=\"__codelineno-7-27\" href=\"#__codelineno-7-27\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Compression</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">BI_BITFIELDS</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-28\" name=\"__codelineno-7-28\" href=\"#__codelineno-7-28\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5SizeImage</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">BufSize</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-29\" name=\"__codelineno-7-29\" href=\"#__codelineno-7-29\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5XPelsPerMeter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-30\" name=\"__codelineno-7-30\" href=\"#__codelineno-7-30\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5YPelsPerMeter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-31\" name=\"__codelineno-7-31\" href=\"#__codelineno-7-31\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5ClrUsed</span><span class=\"w\">       </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-32\" name=\"__codelineno-7-32\" href=\"#__codelineno-7-32\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5ClrImportant</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-33\" name=\"__codelineno-7-33\" href=\"#__codelineno-7-33\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5RedMask</span><span class=\"w\">       </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x00FF0000</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-34\" name=\"__codelineno-7-34\" href=\"#__codelineno-7-34\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5GreenMask</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x0000FF00</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-35\" name=\"__codelineno-7-35\" href=\"#__codelineno-7-35\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5BlueMask</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x000000FF</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-36\" name=\"__codelineno-7-36\" href=\"#__codelineno-7-36\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5AlphaMask</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0xFF000000</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-37\" name=\"__codelineno-7-37\" href=\"#__codelineno-7-37\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5CSType</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">LCS_sRGB</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-38\" name=\"__codelineno-7-38\" href=\"#__codelineno-7-38\"></a><span class=\"w\">    </span><span class=\"c1\">// Header.bV5Endpoints;    // ignored</span>\n<a id=\"__codelineno-7-39\" name=\"__codelineno-7-39\" href=\"#__codelineno-7-39\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5GammaRed</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-40\" name=\"__codelineno-7-40\" href=\"#__codelineno-7-40\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5GammaGreen</span><span class=\"w\">    </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-41\" name=\"__codelineno-7-41\" href=\"#__codelineno-7-41\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5GammaBlue</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-42\" name=\"__codelineno-7-42\" href=\"#__codelineno-7-42\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Intent</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-43\" name=\"__codelineno-7-43\" href=\"#__codelineno-7-43\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5ProfileData</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-44\" name=\"__codelineno-7-44\" href=\"#__codelineno-7-44\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5ProfileSize</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-45\" name=\"__codelineno-7-45\" href=\"#__codelineno-7-45\"></a><span class=\"w\">    </span><span class=\"n\">Header</span><span class=\"p\">.</span><span class=\"n\">bV5Reserved</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-46\" name=\"__codelineno-7-46\" href=\"#__codelineno-7-46\"></a>\n<a id=\"__codelineno-7-47\" name=\"__codelineno-7-47\" href=\"#__codelineno-7-47\"></a><span class=\"w\">    </span><span class=\"n\">HGLOBAL</span><span class=\"w\"> </span><span class=\"n\">WinBuf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GlobalAlloc</span><span class=\"p\">(</span><span class=\"n\">GMEM_MOVEABLE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">BITMAPV5HEADER</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">BufSize</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-48\" name=\"__codelineno-7-48\" href=\"#__codelineno-7-48\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">WinBuf</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-49\" name=\"__codelineno-7-49\" href=\"#__codelineno-7-49\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-50\" name=\"__codelineno-7-50\" href=\"#__codelineno-7-50\"></a>\n<a id=\"__codelineno-7-51\" name=\"__codelineno-7-51\" href=\"#__codelineno-7-51\"></a><span class=\"w\">    </span><span class=\"n\">HWND</span><span class=\"w\"> </span><span class=\"n\">WinHandler</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetActiveWindow</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-52\" name=\"__codelineno-7-52\" href=\"#__codelineno-7-52\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">OpenClipboard</span><span class=\"p\">(</span><span class=\"n\">WinHandler</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-53\" name=\"__codelineno-7-53\" href=\"#__codelineno-7-53\"></a><span class=\"w\">        </span><span class=\"n\">GlobalFree</span><span class=\"p\">(</span><span class=\"n\">WinBuf</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-54\" name=\"__codelineno-7-54\" href=\"#__codelineno-7-54\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-55\" name=\"__codelineno-7-55\" href=\"#__codelineno-7-55\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-56\" name=\"__codelineno-7-56\" href=\"#__codelineno-7-56\"></a><span class=\"w\">    </span><span class=\"n\">verify</span><span class=\"p\">(</span><span class=\"n\">EmptyClipboard</span><span class=\"p\">());</span>\n<a id=\"__codelineno-7-57\" name=\"__codelineno-7-57\" href=\"#__codelineno-7-57\"></a>\n<a id=\"__codelineno-7-58\" name=\"__codelineno-7-58\" href=\"#__codelineno-7-58\"></a><span class=\"w\">    </span><span class=\"c1\">// copy InTexture into BGRA8 sRGB Standard Texture</span>\n<a id=\"__codelineno-7-59\" name=\"__codelineno-7-59\" href=\"#__codelineno-7-59\"></a><span class=\"w\">    </span><span class=\"n\">FTexture2DMipMap</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">DstMip</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">FTexture2DMipMap</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-60\" name=\"__codelineno-7-60\" href=\"#__codelineno-7-60\"></a><span class=\"w\">    </span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeX</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-61\" name=\"__codelineno-7-61\" href=\"#__codelineno-7-61\"></a><span class=\"w\">    </span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeY</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-62\" name=\"__codelineno-7-62\" href=\"#__codelineno-7-62\"></a><span class=\"w\">    </span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">SizeZ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-63\" name=\"__codelineno-7-63\" href=\"#__codelineno-7-63\"></a><span class=\"w\">    </span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_WRITE</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-64\" name=\"__codelineno-7-64\" href=\"#__codelineno-7-64\"></a><span class=\"w\">    </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">DstMipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">static_cast</span><span class=\"o\">&lt;</span><span class=\"n\">uint8</span><span class=\"o\">*&gt;</span><span class=\"p\">(</span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Realloc</span><span class=\"p\">(</span><span class=\"n\">BufSize</span><span class=\"p\">));</span>\n<a id=\"__codelineno-7-65\" name=\"__codelineno-7-65\" href=\"#__codelineno-7-65\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">DstMipImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-7-66\" name=\"__codelineno-7-66\" href=\"#__codelineno-7-66\"></a><span class=\"w\">        </span><span class=\"n\">DstMipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeX</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InSizeY</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ERawImageFormat</span><span class=\"o\">::</span><span class=\"n\">BGRA8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EGammaSpace</span><span class=\"o\">::</span><span class=\"n\">sRGB</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-67\" name=\"__codelineno-7-67\" href=\"#__codelineno-7-67\"></a>\n<a id=\"__codelineno-7-68\" name=\"__codelineno-7-68\" href=\"#__codelineno-7-68\"></a><span class=\"w\">    </span><span class=\"n\">FImageCore</span><span class=\"o\">::</span><span class=\"n\">CopyImage</span><span class=\"p\">(</span><span class=\"n\">SrcMipImage</span><span class=\"p\">,</span><span class=\"n\">DstMipImage</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-69\" name=\"__codelineno-7-69\" href=\"#__codelineno-7-69\"></a><span class=\"w\">    </span><span class=\"n\">DstMip</span><span class=\"o\">-&gt;</span><span class=\"n\">BulkData</span><span class=\"p\">.</span><span class=\"n\">Unlock</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-70\" name=\"__codelineno-7-70\" href=\"#__codelineno-7-70\"></a>\n<a id=\"__codelineno-7-71\" name=\"__codelineno-7-71\" href=\"#__codelineno-7-71\"></a><span class=\"w\">    </span><span class=\"c1\">// copy Standard Texture data into Clipboard</span>\n<a id=\"__codelineno-7-72\" name=\"__codelineno-7-72\" href=\"#__codelineno-7-72\"></a><span class=\"w\">    </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">WinLockedBuf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GlobalLock</span><span class=\"p\">(</span><span class=\"n\">WinBuf</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-73\" name=\"__codelineno-7-73\" href=\"#__codelineno-7-73\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">WinLockedBuf</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-74\" name=\"__codelineno-7-74\" href=\"#__codelineno-7-74\"></a><span class=\"w\">        </span><span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">WinLockedBuf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">Header</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">BITMAPV5HEADER</span><span class=\"p\">));</span>\n<a id=\"__codelineno-7-75\" name=\"__codelineno-7-75\" href=\"#__codelineno-7-75\"></a><span class=\"w\">        </span><span class=\"n\">memcpy</span><span class=\"p\">((</span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">WinLockedBuf</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">BITMAPV5HEADER</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">DstMipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">BufSize</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-76\" name=\"__codelineno-7-76\" href=\"#__codelineno-7-76\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-77\" name=\"__codelineno-7-77\" href=\"#__codelineno-7-77\"></a><span class=\"w\">    </span><span class=\"n\">GlobalUnlock</span><span class=\"p\">(</span><span class=\"n\">WinLockedBuf</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-78\" name=\"__codelineno-7-78\" href=\"#__codelineno-7-78\"></a>\n<a id=\"__codelineno-7-79\" name=\"__codelineno-7-79\" href=\"#__codelineno-7-79\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">SetClipboardData</span><span class=\"p\">(</span><span class=\"n\">CF_DIBV5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">WinBuf</span><span class=\"p\">))</span>\n<a id=\"__codelineno-7-80\" name=\"__codelineno-7-80\" href=\"#__codelineno-7-80\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-81\" name=\"__codelineno-7-81\" href=\"#__codelineno-7-81\"></a><span class=\"w\">        </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Fatal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;SetClipboardData failed with error code %i&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">uint32</span><span class=\"p\">)</span><span class=\"n\">GetLastError</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-82\" name=\"__codelineno-7-82\" href=\"#__codelineno-7-82\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-83\" name=\"__codelineno-7-83\" href=\"#__codelineno-7-83\"></a>\n<a id=\"__codelineno-7-84\" name=\"__codelineno-7-84\" href=\"#__codelineno-7-84\"></a><span class=\"w\">    </span><span class=\"c1\">// finish, close clipboard</span>\n<a id=\"__codelineno-7-85\" name=\"__codelineno-7-85\" href=\"#__codelineno-7-85\"></a><span class=\"w\">    </span><span class=\"n\">verify</span><span class=\"p\">(</span><span class=\"n\">CloseClipboard</span><span class=\"p\">());</span>\n<a id=\"__codelineno-7-86\" name=\"__codelineno-7-86\" href=\"#__codelineno-7-86\"></a>\n<a id=\"__codelineno-7-87\" name=\"__codelineno-7-87\" href=\"#__codelineno-7-87\"></a><span class=\"w\">    </span><span class=\"k\">delete</span><span class=\"w\"> </span><span class=\"n\">DstMip</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-88\" name=\"__codelineno-7-88\" href=\"#__codelineno-7-88\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h3 id=\"utexture2d-base64\">UTexture2D \u8ddf Base64 \u4e4b\u95f4\u7684\u8f6c\u6362</h3>\n<p>\u8fd9\u4e2a\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u4e0a\u4ee3\u7801</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Misc/Base64.h&gt;</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;ImageUtils.h&gt;</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">B64ToImage</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">B64</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"n\">TArray</span><span class=\"o\">&lt;</span><span class=\"n\">uint8</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Data</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">    </span><span class=\"n\">FBase64</span><span class=\"o\">::</span><span class=\"n\">Decode</span><span class=\"p\">(</span><span class=\"n\">B64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Data</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">ImportBufferAsTexture2D</span><span class=\"p\">(</span><span class=\"n\">Data</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"nf\">ImageToB64</span><span class=\"p\">(</span><span class=\"n\">UTexture2D</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"w\"> </span><span class=\"n\">InQuality</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">    </span><span class=\"n\">FTextureMipDataLockGuard</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">    </span><span class=\"n\">uint8</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">MipData</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">InTextureGuard</span><span class=\"p\">.</span><span class=\"n\">Lock</span><span class=\"p\">(</span><span class=\"n\">LOCK_READ_ONLY</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">    </span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">MipData</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a>\n<a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FImageView</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">        </span><span class=\"n\">MipData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeX</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSizeY</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">        </span><span class=\"n\">GetRawImageFormat</span><span class=\"p\">(</span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetPixelFormat</span><span class=\"p\">()),</span><span class=\"w\"> </span><span class=\"n\">InTexture</span><span class=\"o\">-&gt;</span><span class=\"n\">GetGammaSpace</span><span class=\"p\">());</span>\n<a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a>\n<a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a><span class=\"w\">    </span><span class=\"n\">TArray64</span><span class=\"o\">&lt;</span><span class=\"n\">uint8</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a><span class=\"w\">    </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-24\" name=\"__codelineno-8-24\" href=\"#__codelineno-8-24\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">FImageUtils</span><span class=\"o\">::</span><span class=\"n\">CompressImage</span><span class=\"p\">(</span><span class=\"n\">Buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;png&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">InImage</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">InQuality</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-25\" name=\"__codelineno-8-25\" href=\"#__codelineno-8-25\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-26\" name=\"__codelineno-8-26\" href=\"#__codelineno-8-26\"></a><span class=\"w\">        </span><span class=\"n\">Ret</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FBase64</span><span class=\"o\">::</span><span class=\"n\">Encode</span><span class=\"p\">(</span><span class=\"n\">Buffer</span><span class=\"p\">.</span><span class=\"n\">GetData</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">Buffer</span><span class=\"p\">.</span><span class=\"n\">Num</span><span class=\"p\">());</span>\n<a id=\"__codelineno-8-27\" name=\"__codelineno-8-27\" href=\"#__codelineno-8-27\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-28\" name=\"__codelineno-8-28\" href=\"#__codelineno-8-28\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-29\" name=\"__codelineno-8-29\" href=\"#__codelineno-8-29\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2024-08-08T15:41:08+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E7%BC%96%E8%BE%91%E5%99%A8%E6%8F%92%E4%BB%B6-EditorPlus/",
            "url": "https://wiki.disenone.site/ue-%E7%BC%96%E8%BE%91%E5%99%A8%E6%8F%92%E4%BB%B6-EditorPlus/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u7f16\u8f91\u5668\u63d2\u4ef6 UE.EditorPlus \u8bf4\u660e\u6587\u6863",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u7f16\u8f91\u5668\u63d2\u4ef6 EditorPlus \u8bf4\u660e\u6587\u6863\" /></p>\n<h1 id=\"ue-ueeditorplus\">UE \u7f16\u8f91\u5668\u63d2\u4ef6 UE.EditorPlus \u8bf4\u660e\u6587\u6863</h1>\n<h2 id=\"_1\">\u4ecb\u7ecd\u89c6\u9891</h2>\n<p><img alt=\"type:video\" src=\"../assets/img/2024-ue-editorplus/market/video.mp4\" /></p>\n<h2 id=\"_2\">\u63d2\u4ef6\u6e90\u7801</h2>\n<p><a href=\"https://github.com/disenone/UE.EditorPlus\">UE.EditorPlus</a></p>\n<h2 id=\"_3\">\u5546\u57ce\u4e0b\u8f7d</h2>\n<p><a href=\"https://www.unrealengine.com/marketplace/zh-CN/product/editorplus\">EditorPlus</a></p>\n<h2 id=\"eueditorplus\">\u9879\u76ee\u6dfb\u52a0\u6e90\u7801\u63d2\u4ef6 EU.EditorPlus</h2>\n<p>\u53c2\u8003\u6587\u6863\uff1a</p>\n<ul>\n<li>\u4e2d\u6587\uff1a<a href=\"https://wiki.disenone.site/ue-%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E6%BA%90%E7%A0%81%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6/\">UE \u901a\u8fc7\u63d2\u4ef6\u6e90\u7801\u6dfb\u52a0\u63d2\u4ef6</a></li>\n<li>English: <a href=\"https://wiki.disenone.site/en/ue-%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E6%BA%90%E7%A0%81%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6/\">UE adds plugins through the plugin source code</a></li>\n</ul>\n<h2 id=\"_4\">\u63d2\u4ef6\u8bf4\u660e</h2>\n<p>UE.EditorPlus \u662f\u4e00\u4e2a UE \u7f16\u8f91\u5668\u63d2\u4ef6\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u65b9\u5f0f\u6765\u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355\uff0c\u5e76\u652f\u6301\u9ad8\u7ea7\u65b9\u5f0f\u6765\u6269\u5c55\uff0c\u540c\u65f6\u5305\u542b\u4e86\u4e00\u4e9b\u5b9e\u7528\u7684\u7f16\u8f91\u5668\u5de5\u5177\u3002\u672c\u63d2\u4ef6\u652f\u6301 UE5.3+\u3002</p>\n<h2 id=\"_5\">\u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355</h2>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/menu.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/toolbar.png\" /></p>\n<h3 id=\"_6\">\u8bf4\u660e</h3>\n<p>\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355\uff1a</p>\n<ul>\n<li>\u8def\u5f84\u65b9\u5f0f\uff1a<code>RegisterPathAction(\"/&lt;MenuBar&gt;Bar/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action\")</code></li>\n<li>\u5b9e\u4f8b\u5316\u65b9\u5f0f\uff1a<code>EP_NEW_MENU(FEditorPlusMenuBar)(\"Bar\")</code></li>\n<li>\u6df7\u5408\u65b9\u5f0f\uff1a<code>RegisterPath(\"/&lt;MenuBar&gt;Bar/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action\",EP_NEW_MENU(FEditorPlusCommand)(\"Action\")</code></li>\n</ul>\n<h3 id=\"_7\">\u8def\u5f84\u65b9\u5f0f</h3>\n<p>\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u6ce8\u518c\u4e00\u4e2a\u7f16\u8f91\u5668\u83dc\u5355\u6307\u4ee4\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/&lt;MenuBar&gt;Bar/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">    </span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">        </span><span class=\"p\">})</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u7f16\u8f91\u5668\u83dc\u5355\u680f Help \u540e\u9762\u589e\u52a0\u4e00\u4e2a\u83dc\u5355\u680f Bar\uff0cBar \u91cc\u9762\u589e\u52a0\u4e00\u4e2a\u5b50\u83dc\u5355 SubMenu\uff0c SubMenu \u91cc\u9762\u589e\u52a0\u4e00\u4e2a\u547d\u4ee4 Action\u3002</p>\n<p>\u5b8c\u6574\u7684\u8def\u5f84\u683c\u5f0f\u4f1a\u662f\u8fd9\u6837\u7684\uff1a<code>/&lt;Hook&gt;HookName/&lt;Type1&gt;Name1/&lt;Type2&gt;Name2</code>\uff0c\u7b2c\u4e00\u4e2a\u8def\u5f84\u5fc5\u987b\u662f <code>&lt;Hook&gt;</code>\uff0c\u76ee\u524d\u652f\u6301\u7684\u7c7b\u578b\u548c\u9650\u5236\uff1a</p>\n<ul>\n<li><code>&lt;Hook&gt;</code>\uff1a\u8868\u793a\u9700\u8981\u5728\u54ea\u4e2a Hook \u7684\u4f4d\u7f6e\u4e0a\u751f\u6210\u83dc\u5355\uff0c\u540e\u7eed\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;</code></li>\n<li><code>&lt;MenuBar&gt;</code>\uff1a\u83dc\u5355\u680f\uff0c\u540e\u9762\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;, &lt;MenuBar&gt;, &lt;ToolBar&gt;</code></li>\n<li><code>&lt;ToolBar&gt;</code>: \u5de5\u5177\u680f\uff0c\u540e\u9762\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;, &lt;MenuBar&gt;, &lt;ToolBar&gt;</code></li>\n<li><code>&lt;Section&gt;</code>\uff1a\u83dc\u5355\u5206\u8282\uff0c\u540e\u9762\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;, &lt;MenuBar&gt;, &lt;Section&gt;</code></li>\n<li><code>&lt;Separator&gt;</code>\uff1a\u83dc\u5355\u5206\u9694\u7b26\uff0c\u540e\u9762\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;, &lt;MenuBar&gt;</code></li>\n<li><code>&lt;SubMenu&gt;</code>\uff1a\u5b50\u83dc\u5355\uff0c\u540e\u9762\u8def\u5f84\u4e0d\u80fd\u6709 <code>&lt;Hook&gt;, &lt;MenuBar&gt;</code></li>\n<li><code>&lt;Command&gt;</code>\uff1a\u83dc\u5355\u547d\u4ee4\uff0c\u540e\u9762\u4e0d\u80fd\u6709\u4efb\u4f55\u8def\u5f84</li>\n<li><code>&lt;Widget&gt;</code>\uff1a\u66f4\u591a\u53ef\u6269\u5c55\u5b9a\u5236\u7684 Slate UI \u7ec4\u4ef6\uff0c\u540e\u9762\u4e0d\u80fd\u6709\u4efb\u4f55\u8def\u5f84</li>\n</ul>\n<p>\u66f4\u7b80\u6613\u7684\u8def\u5f84\u5f62\u5f0f\uff1a<code>/BarName/SubMenuName1/SubMenuName2/CommandName</code>\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u7c7b\u578b\uff0c\u9ed8\u8ba4\u8def\u5f84\u7684\u7b2c\u4e00\u4e2a\u662f <code>&lt;MenuBar&gt;</code>\uff0c\u4e2d\u95f4\u7684\u662f <code>&lt;SubMenu&gt;</code>\uff0c\u6700\u540e\u7684\u662f <code>&lt;Command&gt;</code>\u3002</p>\n<p>\u5982\u679c\u6ca1\u6709\u6307\u5b9a <code>&lt;Hook&gt;</code> \u5219\u81ea\u52a8\u6700\u524d\u9762\u52a0\u4e0a <code>&lt;Hook&gt;Help</code>\uff0c\u8868\u793a\u5728 Help \u83dc\u5355\u540e\u9762\u6dfb\u52a0\u83dc\u5355\u680f\u3002</p>\n<h3 id=\"_8\">\u5b9e\u4f8b\u5316\u65b9\u5f0f</h3>\n<p>\u8def\u5f84\u65b9\u5f0f\u662f\u81ea\u52a8\u628a\u6240\u6709\u8282\u70b9\u6839\u636e\u7c7b\u578b\u548c\u9ed8\u8ba4\u53c2\u6570\u5b9e\u4f8b\u5316\u51fa\u6765\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u63a7\u5236\u5b9e\u4f8b\u5316\uff0c\u53ef\u4ee5\u66f4\u7ec6\u81f4\u63a7\u5236\u6269\u5c55\u7684\u5185\u5bb9\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusMenuBar</span><span class=\"p\">)(</span><span class=\"s\">&quot;MyBar&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MyBar&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MyBar&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MyBar&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MyBarTips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MyBarTips&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"o\">-&gt;</span><span class=\"n\">RegisterPath</span><span class=\"p\">()</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"o\">-&gt;</span><span class=\"n\">Content</span><span class=\"p\">({</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusSubMenu</span><span class=\"p\">)(</span><span class=\"s\">&quot;MySubMenu&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">Content</span><span class=\"p\">({</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">        </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;MyAction&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">        </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">                </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">            </span><span class=\"p\">})),</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"p\">});</span>\n</code></pre></div>\n<p>\u5b9e\u4f8b\u5316 <code>MyBar</code> \u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u5165 Hook \u540d\u5b57\uff0c\u672c\u5730\u5316\u540d\u5b57\uff0c\u672c\u5730\u5316\u63d0\u793a\u53c2\u6570\uff08<code>\"MyBar\", LOCTEXT(\"MyBar\", \"MyBar\"), LOCTEXT(\"MyBarTips\", \"MyBarTips\")</code>\uff09\u3002\u4e0a\u9762\u4ee3\u7801\u5c31\u76f8\u5f53\u4e8e\u8def\u5f84\u65b9\u5f0f <code>/&lt;Hook&gt;Help/&lt;MenuBar&gt;MyBar/&lt;SubMenu&gt;MySubMenu/&lt;Command&gt;MyAction</code>\u3002</p>\n<h3 id=\"_9\">\u6df7\u5408\u65b9\u5f0f</h3>\n<p>\u5f53\u7136\u8fd8\u53ef\u4ee5\u4e24\u79cd\u65b9\u5f0f\u6df7\u5408\u4f7f\u7528\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/&lt;MenuBar&gt;Bar/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;Action&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">        </span><span class=\"p\">})),</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u5b9e\u4f8b\u5316\u4e2d\u95f4\u8def\u5f84\u7684\u8282\u70b9\uff0c\u6700\u540e\u7684\u8def\u5f84\u4f7f\u7528\u7528\u6237\u81ea\u5df1\u5b9e\u4f8b\u5316\u7684\u8282\u70b9\u3002</p>\n<h3 id=\"_10\">\u66f4\u591a\u7528\u4f8b</h3>\n<p>\u5934\u6587\u4ef6:</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;EditorPlusPath.h&gt;</span>\n</code></pre></div>\n<p>\u8def\u5f84\u65b9\u5f0f\u6307\u5b9a\u672c\u5730\u5316\u8bed\u8a00\uff0c<code>EP_FNAME_HOOK_AUTO</code> \u8868\u793a\u81ea\u52a8\u4f7f\u7528\u8def\u5f84\u540d\u5b57\u4f5c\u4e3a <code>Hook</code> \u540d\u5b57\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">        </span><span class=\"s\">&quot;/Bar/Action&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">        </span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">        </span><span class=\"p\">}),</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">        </span><span class=\"n\">EP_FNAME_HOOK_AUTO</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">        </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Action&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Action&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">        </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;ActionTips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;ActionTips&quot;</span><span class=\"p\">));</span>\n</code></pre></div>\n<p>\u901a\u8fc7\u8def\u5f84\u83b7\u53d6\u8282\u70b9\u5e76\u8bbe\u7f6e\u672c\u5730\u5316\u6587\u672c\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">));</span>\n</code></pre></div>\n<p>\u8def\u5f84\u672b\u7aef\u6dfb\u52a0\u4e00\u4e2a Slate UI \u63a7\u4ef6</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/&lt;MenuBar&gt;Bar/&lt;SubMenu&gt;SubMenu/&lt;Widget&gt;Widget&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusWidget</span><span class=\"p\">)(</span><span class=\"s\">&quot;Widget&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Widget&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Widget&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">        </span><span class=\"o\">-&gt;</span><span class=\"n\">BindWidget</span><span class=\"p\">(</span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SHorizontalBox</span><span class=\"p\">)));</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u5728 UE \u81ea\u5e26\u7684 Hook \u91cc\u9762\u6dfb\u52a0\u65b0\u7684\u8282\u70b9</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span><span class=\"s\">&quot;&lt;Hook&gt;EpicGamesHelp/&lt;Separator&gt;ExtendSeparator&quot;</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>\u591a\u6b21\u58f0\u660e\u76f8\u540c\u7684\u8def\u5f84\uff0c\u90fd\u88ab\u8bc6\u522b\u6210\u540c\u4e00\u4e2a\u8def\u5f84\uff0c\u56e0\u6b64\u53ef\u4ee5\u4e0d\u65ad\u6269\u5c55\u76f8\u540c\u7684\u8def\u5f84</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest/SubMenu1/SubMenu1/Path1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Action</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EP_FNAME_HOOK_AUTO</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Path1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Path1&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Path1Tips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Path1Tips&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest/SubMenu1/SubMenu1/Path2&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Action</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EP_FNAME_HOOK_AUTO</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Path2&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Path2&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Path2Tips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Path2Tips&quot;</span><span class=\"p\">));</span>\n</code></pre></div>\n<p>\u4e3a\u4e00\u4e2a\u8282\u70b9\u7ee7\u7eed\u6269\u5c55\u8def\u5f84</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterChildPath</span><span class=\"p\">(</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;&lt;SubMenu&gt;Sub/&lt;Separator&gt;Sep&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u5220\u9664\u4e00\u4e2a\u8def\u5f84</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">UnregisterPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest/SubMenu1/SubMenu1/Path1&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u6269\u5c55\u5de5\u5177\u680f\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/&lt;Hook&gt;ProjectSettings/&lt;ToolBar&gt;MenuTestToolBar&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"o\">-&gt;</span><span class=\"n\">Content</span><span class=\"p\">({</span>\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;ToolBarCommand1&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(...)</span>\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a><span class=\"p\">});</span>\n</code></pre></div></p>\n<h3 id=\"_11\">\u63a5\u53e3\u8bf4\u660e</h3>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusPath</span>\n<a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a><span class=\"k\">public</span><span class=\"o\">:</span>\n<a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a>\n<a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">Menu</span><span class=\"o\">=</span><span class=\"k\">nullptr</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyName</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyTips</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-12-8\" name=\"__codelineno-12-8\" href=\"#__codelineno-12-8\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FExecuteAction</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">ExecuteAction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FName</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Hook</span><span class=\"o\">=</span><span class=\"n\">EP_FNAME_HOOK_AUTO</span><span class=\"p\">,</span>\n<a id=\"__codelineno-12-9\" name=\"__codelineno-12-9\" href=\"#__codelineno-12-9\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyName</span><span class=\"o\">=</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyTips</span><span class=\"o\">=</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">());</span>\n<a id=\"__codelineno-12-10\" name=\"__codelineno-12-10\" href=\"#__codelineno-12-10\"></a>\n<a id=\"__codelineno-12-11\" name=\"__codelineno-12-11\" href=\"#__codelineno-12-11\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterChildPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-12-12\" name=\"__codelineno-12-12\" href=\"#__codelineno-12-12\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedRef</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">InParent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">Menu</span><span class=\"o\">=</span><span class=\"k\">nullptr</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-13\" name=\"__codelineno-12-13\" href=\"#__codelineno-12-13\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterChildPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-12-14\" name=\"__codelineno-12-14\" href=\"#__codelineno-12-14\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedRef</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">InParent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyName</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyTips</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-15\" name=\"__codelineno-12-15\" href=\"#__codelineno-12-15\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">RegisterChildPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-12-16\" name=\"__codelineno-12-16\" href=\"#__codelineno-12-16\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedRef</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">InParent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FExecuteAction</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">ExecuteAction</span><span class=\"p\">,</span>\n<a id=\"__codelineno-12-17\" name=\"__codelineno-12-17\" href=\"#__codelineno-12-17\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FName</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Hook</span><span class=\"o\">=</span><span class=\"n\">EP_FNAME_HOOK_AUTO</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyName</span><span class=\"o\">=</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">FriendlyTips</span><span class=\"o\">=</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">());</span>\n<a id=\"__codelineno-12-18\" name=\"__codelineno-12-18\" href=\"#__codelineno-12-18\"></a>\n<a id=\"__codelineno-12-19\" name=\"__codelineno-12-19\" href=\"#__codelineno-12-19\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"nf\">UnregisterPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-12-20\" name=\"__codelineno-12-20\" href=\"#__codelineno-12-20\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&amp;</span><span class=\"w\"> </span><span class=\"n\">Leaf</span><span class=\"o\">=</span><span class=\"k\">nullptr</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-21\" name=\"__codelineno-12-21\" href=\"#__codelineno-12-21\"></a>\n<a id=\"__codelineno-12-22\" name=\"__codelineno-12-22\" href=\"#__codelineno-12-22\"></a><span class=\"w\">    </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">TSharedPtr</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-23\" name=\"__codelineno-12-23\" href=\"#__codelineno-12-23\"></a><span class=\"p\">};</span>\n</code></pre></div>\n<ul>\n<li><code>RegisterPath</code>\uff1a\u751f\u6210\u8def\u5f84\u83dc\u5355</li>\n<li><code>RegisterPathAction</code>\uff1a\u751f\u6210\u8def\u5f84\u83dc\u5355\uff0c\u5e76\u81ea\u52a8\u4e3a\u672b\u7aef <code>&lt;Command&gt;</code> \u8282\u70b9\u7ed1\u5b9a\u64cd\u4f5c</li>\n<li><code>RegisterChildPath</code>\uff1a\u4e3a\u6307\u5b9a\u8282\u70b9\u7ee7\u7eed\u751f\u6210\u5b50\u8def\u5f84</li>\n<li><code>RegisterChildPathAction</code>\uff1a\u4e3a\u6307\u5b9a\u8282\u70b9\u7ee7\u7eed\u751f\u6210\u5b50\u8def\u5f84\uff0c\u5e76\u81ea\u52a8\u7ed1\u5b9a\u64cd\u4f5c</li>\n<li><code>UnregisterPath</code>\uff1a\u5220\u9664\u8def\u5f84\uff0c<code>Leaf</code> \u5728\u6709\u591a\u4e2a\u540c\u540d\u7684\u672b\u7aef\u8282\u70b9\u53ef\u4ee5\u6307\u5b9a\u4e25\u683c\u5339\u914d\u3002\u5220\u9664\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u56de\u6eaf\u4e2d\u95f4\u8282\u70b9\uff0c\u4e00\u65e6\u4e2d\u95f4\u8282\u70b9\u6ca1\u6709\u4efb\u4f55\u5b50\u8282\u70b9\u4e5f\u4f1a\u88ab\u5220\u9664</li>\n<li><code>GetNodeByPath</code>\uff1a\u6839\u636e\u8def\u5f84\u83b7\u53d6\u8282\u70b9</li>\n</ul>\n<p>\u8282\u70b9\u7c7b\u578b</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\" href=\"#__codelineno-13-1\"></a><span class=\"c1\">// base class of all node</span>\n<a id=\"__codelineno-13-2\" name=\"__codelineno-13-2\" href=\"#__codelineno-13-2\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TSharedFromThis</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-3\" name=\"__codelineno-13-3\" href=\"#__codelineno-13-3\"></a>\n<a id=\"__codelineno-13-4\" name=\"__codelineno-13-4\" href=\"#__codelineno-13-4\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusHook</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseRoot</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-5\" name=\"__codelineno-13-5\" href=\"#__codelineno-13-5\"></a>\n<a id=\"__codelineno-13-6\" name=\"__codelineno-13-6\" href=\"#__codelineno-13-6\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusMenuBar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseNode</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-7\" name=\"__codelineno-13-7\" href=\"#__codelineno-13-7\"></a>\n<a id=\"__codelineno-13-8\" name=\"__codelineno-13-8\" href=\"#__codelineno-13-8\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusToolBar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseNode</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-9\" name=\"__codelineno-13-9\" href=\"#__codelineno-13-9\"></a>\n<a id=\"__codelineno-13-10\" name=\"__codelineno-13-10\" href=\"#__codelineno-13-10\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusSection</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseNode</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-11\" name=\"__codelineno-13-11\" href=\"#__codelineno-13-11\"></a>\n<a id=\"__codelineno-13-12\" name=\"__codelineno-13-12\" href=\"#__codelineno-13-12\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusSeparator</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseNode</span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-13\" name=\"__codelineno-13-13\" href=\"#__codelineno-13-13\"></a>\n<a id=\"__codelineno-13-14\" name=\"__codelineno-13-14\" href=\"#__codelineno-13-14\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusSubMenu</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseNode</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-15\" name=\"__codelineno-13-15\" href=\"#__codelineno-13-15\"></a>\n<a id=\"__codelineno-13-16\" name=\"__codelineno-13-16\" href=\"#__codelineno-13-16\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusCommand</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseLeaf</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-13-17\" name=\"__codelineno-13-17\" href=\"#__codelineno-13-17\"></a>\n<a id=\"__codelineno-13-18\" name=\"__codelineno-13-18\" href=\"#__codelineno-13-18\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusWidget</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TEditorPlusMenuBaseLeaf</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n</code></pre></div>\n<p>\u66f4\u591a\u6837\u4f8b\u548c\u63a5\u53e3\u8bf4\u660e\u8bf7\u53c2\u8003\u6e90\u7801 <a href=\"https://github.com/disenone/UE.EditorPlus\">UE.EditorPlus</a>\uff0c\u6d4b\u8bd5\u7528\u4f8b <a href=\"https://github.com/disenone/UE.EditorPlus/blob/ue5.3/Source/EditorPlusTools/Private/MenuTest/MenuTest.cpp\">MenuTest.cpp</a></p>\n<h3 id=\"_12\">\u6a21\u5757\u5316\u7ba1\u7406</h3>\n<p>UE.EditorPlus \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6a21\u5757\u5316\u7ba1\u7406\u6269\u5c55\u83dc\u5355\u7684\u6846\u67b6\uff0c\u652f\u6301\u63d2\u4ef6\u52a0\u8f7d\u548c\u5378\u8f7d\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u52a0\u8f7d\u548c\u5378\u8f7d\u6269\u5c55\u7684\u83dc\u5355</p>\n<p>\u8ba9\u83dc\u5355\u7c7b\u7ee7\u627f <code>IEditorPlusToolInterface</code>\uff0c\u5e76\u8986\u5199 <code>OnStartup</code> \u548c <code>OnShutdown</code> \u51fd\u6570\u3002<code>OnStartup</code> \u8d1f\u8d23\u521b\u5efa\u83dc\u5355\uff0c<code>OnShutdown</code> \u8d1f\u8d23\u8c03\u7528\u8282\u70b9\u7684 <code>Destroy</code> \u51fd\u6570\u6e05\u7406\u83dc\u5355\u3002\u5355\u8282\u70b9\u7684\u5f15\u7528\u6570\u5f520\uff0c\u5219\u4f1a\u6267\u884c\u81ea\u52a8\u6e05\u7406\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-14-1\" name=\"__codelineno-14-1\" href=\"#__codelineno-14-1\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">FMenuTest</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">IEditorPlusToolInterface</span>\n<a id=\"__codelineno-14-2\" name=\"__codelineno-14-2\" href=\"#__codelineno-14-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-14-3\" name=\"__codelineno-14-3\" href=\"#__codelineno-14-3\"></a><span class=\"k\">public</span><span class=\"o\">:</span>\n<a id=\"__codelineno-14-4\" name=\"__codelineno-14-4\" href=\"#__codelineno-14-4\"></a><span class=\"w\">    </span><span class=\"k\">virtual</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">OnStartup</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"k\">override</span><span class=\"p\">;</span>\n<a id=\"__codelineno-14-5\" name=\"__codelineno-14-5\" href=\"#__codelineno-14-5\"></a><span class=\"w\">    </span><span class=\"k\">virtual</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">OnShutdown</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"k\">override</span><span class=\"p\">;</span>\n<a id=\"__codelineno-14-6\" name=\"__codelineno-14-6\" href=\"#__codelineno-14-6\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-14-7\" name=\"__codelineno-14-7\" href=\"#__codelineno-14-7\"></a>\n<a id=\"__codelineno-14-8\" name=\"__codelineno-14-8\" href=\"#__codelineno-14-8\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">FMenuTest</span><span class=\"o\">::</span><span class=\"n\">OnStartup</span><span class=\"p\">()</span>\n<a id=\"__codelineno-14-9\" name=\"__codelineno-14-9\" href=\"#__codelineno-14-9\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-14-10\" name=\"__codelineno-14-10\" href=\"#__codelineno-14-10\"></a><span class=\"w\">    </span><span class=\"n\">BuildPathMenu</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-11\" name=\"__codelineno-14-11\" href=\"#__codelineno-14-11\"></a><span class=\"w\">    </span><span class=\"n\">BuildCustomMenu</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-12\" name=\"__codelineno-14-12\" href=\"#__codelineno-14-12\"></a><span class=\"w\">    </span><span class=\"n\">BuildMixMenu</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-13\" name=\"__codelineno-14-13\" href=\"#__codelineno-14-13\"></a><span class=\"w\">    </span><span class=\"n\">BuildExtendMenu</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-14\" name=\"__codelineno-14-14\" href=\"#__codelineno-14-14\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-14-15\" name=\"__codelineno-14-15\" href=\"#__codelineno-14-15\"></a>\n<a id=\"__codelineno-14-16\" name=\"__codelineno-14-16\" href=\"#__codelineno-14-16\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">FMenuTest</span><span class=\"o\">::</span><span class=\"n\">OnShutdown</span><span class=\"p\">()</span>\n<a id=\"__codelineno-14-17\" name=\"__codelineno-14-17\" href=\"#__codelineno-14-17\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-14-18\" name=\"__codelineno-14-18\" href=\"#__codelineno-14-18\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">Menu</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Menus</span><span class=\"p\">)</span>\n<a id=\"__codelineno-14-19\" name=\"__codelineno-14-19\" href=\"#__codelineno-14-19\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-14-20\" name=\"__codelineno-14-20\" href=\"#__codelineno-14-20\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">Menu</span><span class=\"p\">.</span><span class=\"n\">IsValid</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"n\">Menu</span><span class=\"o\">-&gt;</span><span class=\"n\">Destroy</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-21\" name=\"__codelineno-14-21\" href=\"#__codelineno-14-21\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-14-22\" name=\"__codelineno-14-22\" href=\"#__codelineno-14-22\"></a><span class=\"w\">    </span><span class=\"n\">Menus</span><span class=\"p\">.</span><span class=\"n\">Empty</span><span class=\"p\">();</span>\n<a id=\"__codelineno-14-23\" name=\"__codelineno-14-23\" href=\"#__codelineno-14-23\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u83dc\u5355\u7ba1\u7406\u7c7b\u7ee7\u627f <code>IEditorPlusToolManagerInterface</code>\uff0c\u5e76\u8986\u5199 <code>AddTools</code> \u51fd\u6570\uff0c\u5728 <code>AddTools</code> \u91cc\u9762\u6dfb\u52a0\u83dc\u5355\u7c7b</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-15-1\" name=\"__codelineno-15-1\" href=\"#__codelineno-15-1\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">FEditorPlusToolsImpl</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">IEditorPlusToolManagerInterface</span>\n<a id=\"__codelineno-15-2\" name=\"__codelineno-15-2\" href=\"#__codelineno-15-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-15-3\" name=\"__codelineno-15-3\" href=\"#__codelineno-15-3\"></a><span class=\"k\">public</span><span class=\"o\">:</span>\n<a id=\"__codelineno-15-4\" name=\"__codelineno-15-4\" href=\"#__codelineno-15-4\"></a><span class=\"w\">    </span><span class=\"k\">virtual</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">AddTools</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"k\">override</span><span class=\"p\">;</span>\n<a id=\"__codelineno-15-5\" name=\"__codelineno-15-5\" href=\"#__codelineno-15-5\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-15-6\" name=\"__codelineno-15-6\" href=\"#__codelineno-15-6\"></a>\n<a id=\"__codelineno-15-7\" name=\"__codelineno-15-7\" href=\"#__codelineno-15-7\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusToolsImpl</span><span class=\"o\">::</span><span class=\"n\">AddTools</span><span class=\"p\">()</span>\n<a id=\"__codelineno-15-8\" name=\"__codelineno-15-8\" href=\"#__codelineno-15-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-15-9\" name=\"__codelineno-15-9\" href=\"#__codelineno-15-9\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">Tools</span><span class=\"p\">.</span><span class=\"n\">Num</span><span class=\"p\">())</span>\n<a id=\"__codelineno-15-10\" name=\"__codelineno-15-10\" href=\"#__codelineno-15-10\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-15-11\" name=\"__codelineno-15-11\" href=\"#__codelineno-15-11\"></a><span class=\"w\">        </span><span class=\"n\">Tools</span><span class=\"p\">.</span><span class=\"n\">Emplace</span><span class=\"p\">(</span><span class=\"n\">MakeShared</span><span class=\"o\">&lt;</span><span class=\"n\">FMenuTest</span><span class=\"o\">&gt;</span><span class=\"p\">());</span>\n<a id=\"__codelineno-15-12\" name=\"__codelineno-15-12\" href=\"#__codelineno-15-12\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-15-13\" name=\"__codelineno-15-13\" href=\"#__codelineno-15-13\"></a>\n<a id=\"__codelineno-15-14\" name=\"__codelineno-15-14\" href=\"#__codelineno-15-14\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u63d2\u4ef6\u52a0\u8f7d\u548c\u5378\u8f7d\u7684\u65f6\u5019\u5206\u522b\u8c03\u7528\u7ba1\u7406\u7c7b\u7684 <code>StartupTools</code> \u548c <code>ShutdownTools</code> \u51fd\u6570</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-16-1\" name=\"__codelineno-16-1\" href=\"#__codelineno-16-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusToolsModule::StartupModule</span><span class=\"p\">()</span>\n<a id=\"__codelineno-16-2\" name=\"__codelineno-16-2\" href=\"#__codelineno-16-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-16-3\" name=\"__codelineno-16-3\" href=\"#__codelineno-16-3\"></a><span class=\"w\">    </span><span class=\"n\">Impl</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusToolsImpl</span><span class=\"o\">::</span><span class=\"n\">Get</span><span class=\"p\">();</span>\n<a id=\"__codelineno-16-4\" name=\"__codelineno-16-4\" href=\"#__codelineno-16-4\"></a><span class=\"w\">    </span><span class=\"n\">Impl</span><span class=\"o\">-&gt;</span><span class=\"n\">StartupTools</span><span class=\"p\">();</span>\n<a id=\"__codelineno-16-5\" name=\"__codelineno-16-5\" href=\"#__codelineno-16-5\"></a>\n<a id=\"__codelineno-16-6\" name=\"__codelineno-16-6\" href=\"#__codelineno-16-6\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-16-7\" name=\"__codelineno-16-7\" href=\"#__codelineno-16-7\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusToolsModule::ShutdownModule</span><span class=\"p\">()</span>\n<a id=\"__codelineno-16-8\" name=\"__codelineno-16-8\" href=\"#__codelineno-16-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-16-9\" name=\"__codelineno-16-9\" href=\"#__codelineno-16-9\"></a><span class=\"w\">    </span><span class=\"n\">Impl</span><span class=\"o\">-&gt;</span><span class=\"n\">ShutdownTools</span><span class=\"p\">();</span>\n<a id=\"__codelineno-16-10\" name=\"__codelineno-16-10\" href=\"#__codelineno-16-10\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5b8c\u6210\u4ee5\u4e0a\u9002\u914d\uff0c\u5219\u53ef\u4ee5\u81ea\u52a8\u5728\u52a0\u8f7d\u548c\u5378\u8f7d\u63d2\u4ef6\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u52a0\u8f7d\u548c\u5378\u8f7d\u6269\u5c55\u7684\u83dc\u5355\u3002</p>\n<h2 id=\"_13\">\u7f16\u8f91\u5668\u5de5\u5177</h2>\n<p>UE.EditorPlus \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5b9e\u7528\u7684\u7f16\u8f91\u5668\u5de5\u5177</p>\n<h2 id=\"_14\">\u521b\u5efa\u7f16\u8f91\u5668\u7a97\u53e3</h2>\n<p>\u4f7f\u7528 EditorPlus\uff0c\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7f16\u8f91\u5668\u7a97\u53e3</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-17-1\" name=\"__codelineno-17-1\" href=\"#__codelineno-17-1\"></a><span class=\"c1\">// register spawn tab</span>\n<a id=\"__codelineno-17-2\" name=\"__codelineno-17-2\" href=\"#__codelineno-17-2\"></a><span class=\"n\">Tab</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MakeShared</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusTab</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;ClassBrowser&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;ClassBrowser&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;ClassBrowserTip&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Open the ClassBrowser&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-17-3\" name=\"__codelineno-17-3\" href=\"#__codelineno-17-3\"></a><span class=\"n\">Tab</span><span class=\"o\">-&gt;</span><span class=\"n\">Register</span><span class=\"o\">&lt;</span><span class=\"n\">SClassBrowserTab</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-17-4\" name=\"__codelineno-17-4\" href=\"#__codelineno-17-4\"></a>\n<a id=\"__codelineno-17-5\" name=\"__codelineno-17-5\" href=\"#__codelineno-17-5\"></a><span class=\"c1\">// register menu action to spawn tab</span>\n<a id=\"__codelineno-17-6\" name=\"__codelineno-17-6\" href=\"#__codelineno-17-6\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-17-7\" name=\"__codelineno-17-7\" href=\"#__codelineno-17-7\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/EditorPlusTools/ClassBrowser&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-17-8\" name=\"__codelineno-17-8\" href=\"#__codelineno-17-8\"></a><span class=\"w\">    </span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateSP</span><span class=\"p\">(</span><span class=\"n\">Tab</span><span class=\"p\">.</span><span class=\"n\">ToSharedRef</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">FEditorPlusTab</span><span class=\"o\">::</span><span class=\"n\">TryInvokeTab</span><span class=\"p\">),</span>\n<a id=\"__codelineno-17-9\" name=\"__codelineno-17-9\" href=\"#__codelineno-17-9\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p><code>SClassBrowserTab</code> \u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 UI \u63a7\u4ef6</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-18-1\" name=\"__codelineno-18-1\" href=\"#__codelineno-18-1\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">SClassBrowserTab</span><span class=\"w\"> </span><span class=\"k\">final</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">SCompoundWidget</span>\n<a id=\"__codelineno-18-2\" name=\"__codelineno-18-2\" href=\"#__codelineno-18-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-18-3\" name=\"__codelineno-18-3\" href=\"#__codelineno-18-3\"></a><span class=\"w\">    </span><span class=\"n\">SLATE_BEGIN_ARGS</span><span class=\"p\">(</span><span class=\"n\">SClassBrowserTab</span><span class=\"p\">)</span>\n<a id=\"__codelineno-18-4\" name=\"__codelineno-18-4\" href=\"#__codelineno-18-4\"></a><span class=\"w\">    </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-18-5\" name=\"__codelineno-18-5\" href=\"#__codelineno-18-5\"></a><span class=\"w\">    </span><span class=\"n\">SLATE_END_ARGS</span><span class=\"p\">()</span>\n<a id=\"__codelineno-18-6\" name=\"__codelineno-18-6\" href=\"#__codelineno-18-6\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-18-7\" name=\"__codelineno-18-7\" href=\"#__codelineno-18-7\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h3 id=\"classbrowser\">ClassBrowser</h3>\n<p>ClassBrowser \u662f\u4e00\u4e2a UE Class \u67e5\u770b\u5668\uff0c\u901a\u8fc7\u83dc\u5355 EditorPlusTools -&gt; ClassBrowser \u6765\u6253\u5f00</p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/classbrowser_menu.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/classbrowser.png\" /></p>\n<p>\u57fa\u4e8e UE \u7684\u53cd\u5c04\u6765\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u67e5\u770b UE \u5404\u79cd\u7c7b\u578b\u7684\u6210\u5458\u4fe1\u606f\uff0c\u8bf4\u660e\u63d0\u793a\u7b49\uff0c\u652f\u6301\u6a21\u7cca\u641c\u7d22\uff0c\u5e76\u80fd\u8df3\u8f6c\u6253\u5f00\u7236\u7c7b\u7684\u4fe1\u606f\u3002</p>\n<h3 id=\"menucollections\">MenuCollections</h3>\n<p>MenuCollections \u662f\u4e00\u4e2a\u83dc\u5355\u547d\u4ee4\u5feb\u901f\u67e5\u627e\u548c\u6536\u85cf\u5de5\u5177\uff0c\u80fd\u591f\u5e2e\u52a9\u4f60\u5feb\u901f\u627e\u5230\u9700\u8981\u6267\u884c\u7684\u83dc\u5355\u547d\u4ee4\uff0c\u5e76\u53ef\u4ee5\u6536\u85cf\u5e38\u7528\u547d\u4ee4\uff0c\u63d0\u5347\u6548\u7387\u3002</p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/menucollection_find.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/menucollection_star.png\" /></p>\n<h3 id=\"slateresourcebrowser\">SlateResourceBrowser</h3>\n<p>SlateResourceBrowser \u662f\u4e00\u4e2a\u53ef\u4ee5\u5feb\u901f\u67e5\u770b Slate UI \u8d44\u6e90\u7684\u5de5\u5177\uff0c\u80fd\u591f\u5e2e\u52a9\u4f60\u6d4f\u89c8\u548c\u67e5\u627e\u9700\u8981\u7684\u7f16\u8f91\u5668\u8d44\u6e90\uff0c\u65b9\u4fbf\u6269\u5c55\u7f16\u8f91\u5668\u3002</p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/slateresourcebrowser_color.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/slateresourcebrowser_icon.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/slateresourcebrowser_font.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-editorplus/slateresourcebrowser_widgetstyle.png\" /></p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2024-08-04T15:51:52+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E6%8F%92%E4%BB%B6-AIChatPlus/",
            "url": "https://wiki.disenone.site/ue-%E6%8F%92%E4%BB%B6-AIChatPlus/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u63d2\u4ef6 AIChatPlus \u8bf4\u660e\u6587\u6863",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u63d2\u4ef6 AIChatPlus \u8bf4\u660e\u6587\u6863\" /></p>\n<h1 id=\"ue-aichatplus\">UE \u63d2\u4ef6 AIChatPlus \u8bf4\u660e\u6587\u6863</h1>\n<h2 id=\"_1\">\u516c\u5171\u4ed3\u5e93</h2>\n<p><a href=\"https://github.com/disenone/UE.AIChatPlus.Public\">UE.AIChatPlus.Public</a></p>\n<h2 id=\"_2\">\u63d2\u4ef6\u83b7\u53d6</h2>\n<p><a href=\"https://www.unrealengine.com/marketplace/zh-CN/product/aichatplus-ai-chat-integration-openai-azure-claude-gemini\">AIChatPlus</a></p>\n<h2 id=\"_3\">\u63d2\u4ef6\u7b80\u4ecb</h2>\n<p>\u672c\u63d2\u4ef6\u652f\u6301 UE5.2+\u3002</p>\n<p>UE.AIChatPlus \u662f\u4e00\u4e2a UnrealEngine \u63d2\u4ef6\uff0c\u8be5\u63d2\u4ef6\u5b9e\u73b0\u4e86\u4e0e\u5404\u79cd GPT AI \u804a\u5929\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\uff0c\u76ee\u524d\u652f\u6301\u7684\u670d\u52a1\u6709 OpenAI (ChatGPT, DALL-E)\uff0cAzure OpenAI (ChatGPT, DALL-E), Claude, Google Gemini, Ollama, llama.cpp \u672c\u5730\u79bb\u7ebf\u3002\u672a\u6765\u8fd8\u4f1a\u7ee7\u7eed\u652f\u6301\u66f4\u591a\u670d\u52a1\u63d0\u4f9b\u5546\u3002\u5b83\u7684\u5b9e\u73b0\u57fa\u4e8e\u5f02\u6b65 REST \u8bf7\u6c42\uff0c\u6027\u80fd\u9ad8\u6548\uff0c\u65b9\u4fbf UE \u5f00\u53d1\u4eba\u5458\u63a5\u5165\u8fd9\u4e9b AI \u804a\u5929\u670d\u52a1\u3002</p>\n<p>\u540c\u65f6 UE.AIChatPlus \u8fd8\u5305\u542b\u4e86\u4e00\u4e2a\u7f16\u8f91\u5668\u5de5\u5177\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u7f16\u8f91\u5668\u4e2d\u4f7f\u7528\u8fd9\u4e9b AI \u804a\u5929\u670d\u52a1\uff0c\u751f\u6210\u6587\u672c\u548c\u56fe\u50cf\uff0c\u5206\u6790\u56fe\u50cf\u7b49\u3002</p>\n<h2 id=\"_4\">\u4f7f\u7528\u8bf4\u660e</h2>\n<h3 id=\"_5\">\u7f16\u8f91\u5668\u804a\u5929\u5de5\u5177</h3>\n<p>\u83dc\u5355\u680f Tools -&gt; AIChatPlus -&gt; AIChat \u53ef\u6253\u5f00\u63d2\u4ef6\u63d0\u4f9b\u7684\u7f16\u8f91\u5668\u804a\u5929\u5de5\u5177</p>\n<p><img alt=\"\" src=\"../assets/img/2024-ue-aichatplus/chat_tool3.png\" /></p>\n<p>\u5de5\u5177\u652f\u6301\u6587\u672c\u751f\u6210\u3001\u6587\u672c\u804a\u5929\u3001\u56fe\u50cf\u751f\u6210\uff0c\u56fe\u50cf\u5206\u6790\u3002</p>\n<p>\u5de5\u5177\u7684\u754c\u9762\u5927\u81f4\u4e3a\uff1a</p>\n<p><img alt=\"text chat\" src=\"../assets/img/2024-ue-aichatplus/chat_tool2.png\" /></p>\n<p><img alt=\"image chat\" src=\"../assets/img/2024-ue-aichatplus/chat_tool.png\" /></p>\n<h4 id=\"_6\">\u4e3b\u8981\u529f\u80fd</h4>\n<ul>\n<li>\u79bb\u7ebf\u5927\u6a21\u578b\uff1a\u6574\u5408\u4e86 llama.cpp \u5e93\uff0c\u652f\u6301\u672c\u5730\u79bb\u7ebf\u6267\u884c\u5927\u6a21\u578b</li>\n</ul>\n<ul>\n<li>\u6587\u672c\u804a\u5929\uff1a\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 <code>New Chat</code> \u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u6587\u672c\u804a\u5929\u4f1a\u8bdd\u3002</li>\n</ul>\n<ul>\n<li>\u56fe\u50cf\u751f\u6210\uff1a\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 <code>New Image Chat</code> \u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u56fe\u50cf\u751f\u6210\u4f1a\u8bdd\u3002</li>\n</ul>\n<ul>\n<li>\u56fe\u50cf\u5206\u6790\uff1a<code>New Chat</code> \u7684\u90e8\u5206\u804a\u5929\u670d\u52a1\u652f\u6301\u53d1\u9001\u56fe\u50cf\uff0c\u4f8b\u5982 Claude, Google Gemini\u3002\u70b9\u51fb\u8f93\u5165\u6846\u4e0a\u65b9\u7684 \ud83d\uddbc\ufe0f \u6216 \ud83c\udfa8 \u6309\u94ae\u5373\u53ef\u52a0\u8f7d\u9700\u8981\u53d1\u9001\u7684\u56fe\u50cf\u3002</li>\n</ul>\n<ul>\n<li>\u652f\u6301\u84dd\u56fe (Blueprint)\uff1a\u652f\u6301\u84dd\u56fe\u521b\u5efa API \u8bf7\u6c42\uff0c\u5b8c\u6210\u6587\u672c\u804a\u5929\uff0c\u56fe\u50cf\u751f\u6210\u7b49\u529f\u80fd\u3002</li>\n</ul>\n<ul>\n<li>\u8bbe\u7f6e\u5f53\u524d\u804a\u5929\u89d2\u8272\uff1a\u804a\u5929\u6846\u4e0a\u65b9\u7684\u4e0b\u62c9\u6846\u53ef\u4ee5\u8bbe\u7f6e\u5f53\u524d\u53d1\u9001\u6587\u672c\u7684\u89d2\u8272\uff0c\u53ef\u4ee5\u901a\u8fc7\u6a21\u62df\u4e0d\u540c\u7684\u89d2\u8272\u6765\u8c03\u8282 AI \u804a\u5929\u3002</li>\n</ul>\n<ul>\n<li>\u6e05\u7a7a\u4f1a\u8bdd\uff1a\u804a\u5929\u6846\u4e0a\u65b9\u7684 \u274c \u6309\u53ef\u4ee5\u6e05\u7a7a\u5f53\u524d\u4f1a\u8bdd\u7684\u5386\u53f2\u6d88\u606f\u3002</li>\n</ul>\n<ul>\n<li>\u5bf9\u8bdd\u6a21\u7248\uff1a\u5185\u7f6e\u51e0\u767e\u79cd\u5bf9\u8bdd\u8bbe\u7f6e\u6a21\u7248\uff0c\u65b9\u4fbf\u5904\u7406\u5e38\u7528\u7684\u95ee\u9898\u3002</li>\n</ul>\n<ul>\n<li>\u5168\u5c40\u8bbe\u7f6e\uff1a\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 <code>Setting</code> \u6309\u94ae\uff0c\u53ef\u4ee5\u6253\u5f00\u5168\u5c40\u8bbe\u7f6e\u7a97\u53e3\u3002\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4\u6587\u672c\u804a\u5929\uff0c\u56fe\u50cf\u751f\u6210\u7684 API \u670d\u52a1\uff0c\u5e76\u8bbe\u7f6e\u6bcf\u79cd API \u670d\u52a1\u7684\u5177\u4f53\u53c2\u6570\u3002\u8bbe\u7f6e\u4f1a\u81ea\u52a8\u4fdd\u5b58\u5728\u9879\u76ee\u7684\u8def\u5f84 <code>$(ProjectFolder)/Saved/AIChatPlusEditor</code> \u4e0b\u3002</li>\n</ul>\n<ul>\n<li>\u4f1a\u8bdd\u8bbe\u7f6e\uff1a\u70b9\u51fb\u804a\u5929\u6846\u4e0a\u65b9\u7684\u8bbe\u7f6e\u6309\u94ae\uff0c\u53ef\u4ee5\u6253\u5f00\u5f53\u524d\u4f1a\u8bdd\u7684\u8bbe\u7f6e\u7a97\u53e3\u3002\u652f\u6301\u4fee\u6539\u4f1a\u8bdd\u540d\u5b57\uff0c\u4fee\u6539\u4f1a\u8bdd\u4f7f\u7528\u7684 API \u670d\u52a1\uff0c\u652f\u6301\u72ec\u7acb\u8bbe\u7f6e\u6bcf\u4e2a\u4f1a\u8bdd\u4f7f\u7528 API \u7684\u5177\u4f53\u53c2\u6570\u3002\u4f1a\u8bdd\u8bbe\u7f6e\u81ea\u52a8\u4fdd\u5b58\u5728 <code>$(ProjectFolder)/Saved/AIChatPlusEditor/Sessions</code></li>\n</ul>\n<ul>\n<li>\u804a\u5929\u5185\u5bb9\u4fee\u6539\uff1a\u9f20\u6807\u60ac\u505c\u5728\u804a\u5929\u5185\u5bb9\u4e0a\uff0c\u4f1a\u51fa\u73b0\u5f53\u4e2a\u804a\u5929\u5185\u5bb9\u7684\u8bbe\u7f6e\u6309\u94ae\uff0c\u652f\u6301\u91cd\u65b0\u751f\u6210\u5185\u5bb9\u3001\u4fee\u6539\u5185\u5bb9\u3001\u590d\u5236\u5185\u5bb9\u3001\u5220\u9664\u5185\u5bb9\u3001\u5728\u4e0b\u65b9\u91cd\u65b0\u751f\u6210\u5185\u5bb9\uff08\u5bf9\u4e8e\u89d2\u8272\u662f\u7528\u6237\u7684\u5185\u5bb9\uff09</li>\n</ul>\n<ul>\n<li>\u56fe\u50cf\u6d4f\u89c8\uff1a\u5bf9\u4e8e\u56fe\u50cf\u751f\u6210\uff0c\u70b9\u51fb\u56fe\u50cf\u4f1a\u6253\u5f00\u56fe\u50cf\u67e5\u770b\u7a97\u53e3 (ImageViewer) \uff0c\u652f\u6301\u56fe\u7247\u53e6\u5b58\u4e3a PNG/UE Texture\uff0cTexture \u53ef\u4ee5\u76f4\u63a5\u5728\u5185\u5bb9\u6d4f\u89c8\u5668 (Content Browser) \u67e5\u770b\uff0c\u65b9\u4fbf\u56fe\u7247\u5728\u7f16\u8f91\u5668\u5185\u4f7f\u7528\u3002\u53e6\u5916\u8fd8\u652f\u6301\u5220\u9664\u56fe\u7247\u3001\u91cd\u65b0\u751f\u6210\u56fe\u7247\u3001\u7ee7\u7eed\u751f\u6210\u66f4\u591a\u56fe\u7247\u7b49\u529f\u80fd\u3002\u5bf9\u4e8e Windows \u4e0b\u7684\u7f16\u8f91\u5668\uff0c\u8fd8\u652f\u6301\u590d\u5236\u56fe\u7247\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u56fe\u7247\u590d\u5236\u5230\u526a\u8d34\u677f\uff0c\u65b9\u4fbf\u4f7f\u7528\u3002\u4f1a\u8bdd\u751f\u6210\u7684\u56fe\u7247\u4e5f\u4f1a\u81ea\u52a8\u4fdd\u5b58\u5728\u6bcf\u4e2a\u4f1a\u8bdd\u6587\u4ef6\u5939\u4e0b\u9762\uff0c\u901a\u5e38\u8def\u5f84\u662f <code>$(ProjectFolder)/Saved/AIChatPlusEditor/Sessions/${GUID}/images</code>\u3002</li>\n</ul>\n<p>\u84dd\u56fe\uff1a</p>\n<p><img alt=\"blueprint\" src=\"../assets/img/2024-ue-aichatplus/blueprint.png\" /></p>\n<p>\u5168\u5c40\u8bbe\u7f6e\uff1a</p>\n<p><img alt=\"global settings\" src=\"../assets/img/2024-ue-aichatplus/global_setting.png\" /></p>\n<p>\u4f1a\u8bdd\u8bbe\u7f6e\uff1a</p>\n<p><img alt=\"session settings\" src=\"../assets/img/2024-ue-aichatplus/session_setting.png\" /></p>\n<p>\u4fee\u6539\u804a\u5929\u5185\u5bb9\uff1a</p>\n<p><img alt=\"chat edit\" src=\"../assets/img/2024-ue-aichatplus/chat_edit.png\" /></p>\n<p>\u56fe\u50cf\u67e5\u770b\u5668\uff1a</p>\n<p><img alt=\"image viewer\" src=\"../assets/img/2024-ue-aichatplus/image_viewer.png\" /></p>\n<p>\u4f7f\u7528\u79bb\u7ebf\u5927\u6a21\u578b</p>\n<p><img alt=\"offline model\" src=\"../assets/img/2024-ue-aichatplus/offline_model.png\" /></p>\n<p>\u5bf9\u8bdd\u6a21\u7248</p>\n<p><img alt=\"system template\" src=\"../assets/img/2024-ue-aichatplus/system_template.png\" /></p>\n<h3 id=\"_7\">\u6838\u5fc3\u4ee3\u7801\u4ecb\u7ecd</h3>\n<p>\u76ee\u524d\u63d2\u4ef6\u5206\u6210\u4ee5\u4e0b\u51e0\u4e2a\u6a21\u5757\uff1a</p>\n<ul>\n<li>AIChatPlusCommon: \u8fd0\u884c\u65f6\u6a21\u5757 (Runtime)\uff0c\u8d1f\u8d23\u5904\u7406\u5404\u79cd AI API \u63a5\u53e3\u53d1\u9001\u8bf7\u6c42\u548c\u89e3\u6790\u56de\u590d\u5185\u5bb9\u3002</li>\n</ul>\n<ul>\n<li>AIChatPlusEditor: \u7f16\u8f91\u5668\u6a21\u5757 (Editor)\uff0c \u8d1f\u8d23\u5b9e\u73b0\u7f16\u8f91\u5668 AI \u804a\u5929\u5de5\u5177\u3002</li>\n</ul>\n<ul>\n<li>AIChatPlusCllama: \u8fd0\u884c\u65f6\u6a21\u5757 (Runtime)\uff0c\u8d1f\u8d23\u5c01\u88c5 llama.cpp \u7684\u63a5\u53e3\u548c\u53c2\u6570\uff0c\u5b9e\u73b0\u79bb\u7ebf\u6267\u884c\u5927\u6a21\u578b</li>\n</ul>\n<ul>\n<li>Thirdparty/LLAMACpp: \u8fd0\u884c\u65f6\u7b2c\u4e09\u65b9\u6a21\u5757 (Runtime)\uff0c\u6574\u5408\u4e86 llama.cpp \u7684\u52a8\u6001\u5e93\u548c\u5934\u6587\u4ef6\u3002</li>\n</ul>\n<p>\u5177\u4f53\u8d1f\u8d23\u53d1\u9001\u8bf7\u6c42\u7684 UClass \u662f FAIChatPlus_xxxChatRequest\uff0c\u6bcf\u79cd API \u670d\u52a1\u90fd\u5206\u522b\u6709\u72ec\u7acb\u7684 Request UClass\u3002\u8bf7\u6c42\u7684\u56de\u590d\u901a\u8fc7 UAIChatPlus_ChatHandlerBase / UAIChatPlus_ImageHandlerBase \u4e24\u79cd UClass \u6765\u83b7\u53d6\uff0c\u53ea\u9700\u8981\u6ce8\u518c\u76f8\u5e94\u7684\u56de\u8c03\u59d4\u6258\u3002</p>\n<p>\u53d1\u9001\u8bf7\u6c42\u4e4b\u524d\u9700\u8981\u5148\u8bbe\u7f6e\u597d API \u7684\u53c2\u6570\u548c\u53d1\u9001\u7684\u6d88\u606f\uff0c\u8fd9\u5757\u662f\u901a\u8fc7 FAIChatPlus_xxxChatRequestBody \u6765\u8bbe\u7f6e\u3002\u56de\u590d\u7684\u5177\u4f53\u5185\u5bb9\u4e5f\u89e3\u6790\u5230 FAIChatPlus_xxxChatResponseBody \u4e2d\uff0c\u6536\u5230\u56de\u8c03\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u63a5\u53e3\u83b7\u53d6 ResponseBody\u3002</p>\n<p>\u66f4\u591a\u6e90\u7801\u7ec6\u8282\u53ef\u5728 UE \u5546\u57ce\u83b7\u53d6\uff1a<a href=\"https://www.unrealengine.com/marketplace/zh-CN/product/aichatplus-ai-chat-integration-openai-azure-claude-gemini\">AIChatPlus</a></p>\n<h2 id=\"_8\">\u4f7f\u7528\u6307\u5357</h2>\n<h3 id=\"llamacpp\">\u7f16\u8f91\u5668\u5de5\u5177\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</h3>\n<p>\u4ee5\u4e0b\u8bf4\u660e\u5982\u4f55\u5728 AIChatPlus \u7f16\u8f91\u5668\u5de5\u5177\u4e2d\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</p>\n<ul>\n<li>\u9996\u5148\uff0c\u4ece HuggingFace \u7f51\u7ad9\u4e0b\u8f7d\u79bb\u7ebf\u6a21\u578b\uff1a<a href=\"https://huggingface.co/second-state/Qwen1.5-1.8B-Chat-GGUF/resolve/main/Qwen1.5-1.8B-Chat-Q8_0.gguf\">Qwen1.5-1.8B-Chat-Q8_0.gguf</a></li>\n</ul>\n<ul>\n<li>\u628a\u6a21\u578b\u653e\u5728\u67d0\u4e2a\u6587\u4ef6\u5939\u4e0b\u9762\uff0c\u8b6c\u5982\u653e\u5728\u6e38\u620f\u9879\u76ee\u7684\u76ee\u5f55 Content/LLAMA \u4e0b</li>\n</ul>\n<div class=\"language-shell highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>E:/UE/projects/FP_Test1/Content/LLAMA\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>&gt;<span class=\"w\"> </span>ls\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>qwen1.5-1_8b-chat-q8_0.gguf*\n</code></pre></div>\n<ul>\n<li>\u6253\u5f00 AIChatPlus \u7f16\u8f91\u5668\u5de5\u5177\uff1aTools -&gt; AIChatPlus -&gt; AIChat\uff0c\u65b0\u5efa\u804a\u5929\u4f1a\u8bdd\uff0c\u5e76\u6253\u5f00\u4f1a\u8bdd\u8bbe\u7f6e\u9875\u9762</li>\n</ul>\n<p><img alt=\"guide editor\" src=\"../assets/img/2024-ue-aichatplus/guide_editor_1.png\" /></p>\n<ul>\n<li>\u8bbe\u7f6e Api \u4e3a Cllama\uff0c\u5f00\u542f Custom Api Settings\uff0c \u5e76\u6dfb\u52a0\u6a21\u578b\u641c\u7d22\u8def\u5f84\uff0c\u5e76\u9009\u62e9\u6a21\u578b</li>\n</ul>\n<p><img alt=\"guide editor\" src=\"../assets/img/2024-ue-aichatplus/guide_editor_2.png\" /></p>\n<ul>\n<li>\u5f00\u59cb\u804a\u5929\uff01\uff01</li>\n</ul>\n<p><img alt=\"guide editor\" src=\"../assets/img/2024-ue-aichatplus/guide_editor_3.png\" /></p>\n<h3 id=\"llamacpp_1\">\u4ee3\u7801\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</h3>\n<p>\u4ee5\u4e0b\u8bf4\u660e\u5982\u4f55\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</p>\n<ul>\n<li>\u9996\u5148\uff0c\u540c\u6837\u9700\u8981\u4e0b\u8f7d\u6a21\u578b\u6587\u4ef6\u5230 Content/LLAMA \u4e0b</li>\n</ul>\n<ul>\n<li>\u4fee\u6539\u4ee3\u7801\u6dfb\u52a0\u4e00\u6761\u547d\u4ee4\uff0c\u5e76\u5728\u547d\u4ee4\u91cc\u9762\u7ed9\u79bb\u7ebf\u6a21\u578b\u53d1\u9001\u6d88\u606f</li>\n</ul>\n<div class=\"language-c++ highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&quot;Common/AIChatPlus_Log.h&quot;</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&quot;Common_Cllama/AIChatPlus_CllamaChatRequest.h&quot;</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">AddTestCommand</span><span class=\"p\">()</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"n\">IConsoleManager</span><span class=\"o\">::</span><span class=\"n\">Get</span><span class=\"p\">().</span><span class=\"n\">RegisterConsoleCommand</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">        </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;AIChatPlus.TestChat&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">        </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Test Chat.&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">        </span><span class=\"n\">FConsoleCommandDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">FModuleManager</span><span class=\"o\">::</span><span class=\"n\">GetModulePtr</span><span class=\"o\">&lt;</span><span class=\"n\">FAIChatPlusCommon</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;AIChatPlusCommon&quot;</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">            </span><span class=\"n\">TWeakObjectPtr</span><span class=\"o\">&lt;</span><span class=\"n\">UAIChatPlus_ChatHandlerBase</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">HandlerObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">UAIChatPlus_ChatHandlerBase</span><span class=\"o\">::</span><span class=\"n\">New</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">            </span><span class=\"c1\">// Cllama</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">            </span><span class=\"n\">FAIChatPlus_CllamaChatRequestOptions</span><span class=\"w\"> </span><span class=\"n\">Options</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">            </span><span class=\"n\">Options</span><span class=\"p\">.</span><span class=\"n\">ModelPath</span><span class=\"p\">.</span><span class=\"n\">FilePath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FPaths</span><span class=\"o\">::</span><span class=\"n\">ProjectContentDir</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"s\">&quot;LLAMA&quot;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"s\">&quot;qwen1.5-1_8b-chat-q8_0.gguf&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">            </span><span class=\"n\">Options</span><span class=\"p\">.</span><span class=\"n\">NumPredict</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">400</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">            </span><span class=\"n\">Options</span><span class=\"p\">.</span><span class=\"n\">bStream</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">            </span><span class=\"c1\">// Options.StopSequences.Emplace(TEXT(&quot;json&quot;));</span>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">            </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">RequestPtr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">UAIChatPlus_CllamaChatRequest</span><span class=\"o\">::</span><span class=\"n\">CreateWithOptionsAndMessages</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">                </span><span class=\"n\">Options</span><span class=\"p\">,</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">                </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">                    </span><span class=\"p\">{</span><span class=\"s\">&quot;You are a chat bot&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EAIChatPlus_ChatRole</span><span class=\"o\">::</span><span class=\"n\">System</span><span class=\"p\">},</span>\n<a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">                    </span><span class=\"p\">{</span><span class=\"s\">&quot;who are you&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EAIChatPlus_ChatRole</span><span class=\"o\">::</span><span class=\"n\">User</span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">                </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a>\n<a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">BindChatRequest</span><span class=\"p\">(</span><span class=\"n\">RequestPtr</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a><span class=\"w\">            </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FName</span><span class=\"w\"> </span><span class=\"n\">ApiName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">TEnumTraits</span><span class=\"o\">&lt;</span><span class=\"n\">EAIChatPlus_ChatApiProvider</span><span class=\"o\">&gt;::</span><span class=\"n\">ToName</span><span class=\"p\">(</span><span class=\"n\">RequestPtr</span><span class=\"o\">-&gt;</span><span class=\"n\">GetApiProvider</span><span class=\"p\">());</span>\n<a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a>\n<a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">OnMessage</span><span class=\"p\">.</span><span class=\"n\">AddLambda</span><span class=\"p\">([</span><span class=\"n\">ApiName</span><span class=\"p\">](</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">Message</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">                </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Display</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;TestChat[%s] Message: [%s]&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ApiName</span><span class=\"p\">.</span><span class=\"n\">ToString</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">Message</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a><span class=\"w\">            </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">OnStarted</span><span class=\"p\">.</span><span class=\"n\">AddLambda</span><span class=\"p\">([</span><span class=\"n\">ApiName</span><span class=\"p\">]()</span>\n<a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"w\">                </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Display</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;TestChat[%s] RequestStarted&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ApiName</span><span class=\"p\">.</span><span class=\"n\">ToString</span><span class=\"p\">());</span>\n<a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"w\">            </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">OnFailed</span><span class=\"p\">.</span><span class=\"n\">AddLambda</span><span class=\"p\">([</span><span class=\"n\">ApiName</span><span class=\"p\">](</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FAIChatPlus_ResponseErrorBase</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">InError</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">                </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;TestChat[%s] RequestFailed: %s &quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ApiName</span><span class=\"p\">.</span><span class=\"n\">ToString</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">InError</span><span class=\"p\">.</span><span class=\"n\">GetDescription</span><span class=\"p\">());</span>\n<a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">            </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">OnUpdated</span><span class=\"p\">.</span><span class=\"n\">AddLambda</span><span class=\"p\">([</span><span class=\"n\">ApiName</span><span class=\"p\">](</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FAIChatPlus_ResponseBodyBase</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">ResponseBody</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"w\">                </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Display</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;TestChat[%s] RequestUpdated&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ApiName</span><span class=\"p\">.</span><span class=\"n\">ToString</span><span class=\"p\">());</span>\n<a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a><span class=\"w\">            </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a><span class=\"w\">            </span><span class=\"n\">HandlerObject</span><span class=\"o\">-&gt;</span><span class=\"n\">OnFinished</span><span class=\"p\">.</span><span class=\"n\">AddLambda</span><span class=\"p\">([</span><span class=\"n\">ApiName</span><span class=\"p\">](</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FAIChatPlus_ResponseBodyBase</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">ResponseBody</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">                </span><span class=\"n\">UE_LOG</span><span class=\"p\">(</span><span class=\"n\">AIChatPlus_Internal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Display</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;TestChat[%s] RequestFinished&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ApiName</span><span class=\"p\">.</span><span class=\"n\">ToString</span><span class=\"p\">());</span>\n<a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a><span class=\"w\">            </span><span class=\"p\">});</span>\n<a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a>\n<a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">            </span><span class=\"n\">RequestPtr</span><span class=\"o\">-&gt;</span><span class=\"n\">SendRequest</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">        </span><span class=\"p\">}),</span>\n<a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a><span class=\"w\">        </span><span class=\"n\">ECVF_Default</span>\n<a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<ul>\n<li>\u91cd\u65b0\u7f16\u8bd1\u540e\uff0c\u5728\u7f16\u8f91\u5668 Cmd \u4e2d\u4f7f\u7528\u547d\u4ee4\uff0c\u4fbf\u53ef\u5728\u65e5\u5fd7 OutputLog \u770b\u5230\u5927\u6a21\u578b\u7684\u8f93\u51fa\u7ed3\u679c</li>\n</ul>\n<p><img alt=\"guide code\" src=\"../assets/img/2024-ue-aichatplus/guide_code_1.png\" /></p>\n<h3 id=\"llamacpp_2\">\u84dd\u56fe\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</h3>\n<p>\u4ee5\u4e0b\u8bf4\u660e\u5982\u4f55\u5728\u84dd\u56fe\u4e2d\u4f7f\u7528\u79bb\u7ebf\u6a21\u578b llama.cpp</p>\n<ul>\n<li>\u5728\u84dd\u56fe\u4e2d\u53f3\u952e\u521b\u5efa\u4e00\u4e2a\u8282\u70b9 <code>Send Cllama Chat Request</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_1.png\" /></p>\n<ul>\n<li>\u521b\u5efa Options \u8282\u70b9\uff0c\u5e76\u8bbe\u7f6e <code>Stream=true, ModelPath=\"E:\\UE\\projects\\FP_Test1\\Content\\LLAMA\\qwen1.5-1_8b-chat-q8_0.gguf\"</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_2.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_3.png\" /></p>\n<ul>\n<li>\u521b\u5efa Messages\uff0c\u5206\u522b\u6dfb\u52a0\u4e00\u6761 System Message \u548c User Message</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_4.png\" /></p>\n<ul>\n<li>\u521b\u5efa Delegate \u63a5\u53d7\u6a21\u578b\u8f93\u51fa\u7684\u4fe1\u606f\uff0c\u5e76\u6253\u5370\u5728\u5c4f\u5e55\u4e0a</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_5.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_6.png\" /></p>\n<ul>\n<li>\u5b8c\u6574\u7684\u84dd\u56fe\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684\uff0c\u8fd0\u884c\u84dd\u56fe\uff0c\u5373\u53ef\u770b\u5230\u6e38\u620f\u5c4f\u5e55\u5728\u6253\u5370\u5927\u6a21\u578b\u8fd4\u56de\u7684\u6d88\u606f</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_7.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_8.png\" /></p>\n<h3 id=\"openai\">\u84dd\u56fe\u4f7f\u7528 OpenAI \u6a21\u578b</h3>\n<ul>\n<li>\u5728\u84dd\u56fe\u4e2d\u53f3\u952e\u521b\u5efa\u4e00\u4e2a\u8282\u70b9 <code>Send OpenAI Chat Request In World</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_blueprint_1.png\" /></p>\n<ul>\n<li>\u521b\u5efa Options \u8282\u70b9\uff0c\u5e76\u8bbe\u7f6e <code>Stream=true, Api Key=\"you api key from OpenAI\"</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_blueprint_2.png\" /></p>\n<ul>\n<li>\u521b\u5efa Messages\uff0c\u5206\u522b\u6dfb\u52a0\u4e00\u6761 System Message \u548c User Message</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_4.png\" /></p>\n<ul>\n<li>\u521b\u5efa Delegate \u63a5\u53d7\u6a21\u578b\u8f93\u51fa\u7684\u4fe1\u606f\uff0c\u5e76\u6253\u5370\u5728\u5c4f\u5e55\u4e0a</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_5.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_blueprint_6.png\" /></p>\n<ul>\n<li>\u5b8c\u6574\u7684\u84dd\u56fe\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684\uff0c\u8fd0\u884c\u84dd\u56fe\uff0c\u5373\u53ef\u770b\u5230\u6e38\u620f\u5c4f\u5e55\u5728\u6253\u5370\u5927\u6a21\u578b\u8fd4\u56de\u7684\u6d88\u606f</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_blueprint_3.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_blueprint_4.png\" /></p>\n<h3 id=\"claude\">\u84dd\u56fe\u4f7f\u7528 Claude \u5206\u6790\u56fe\u7247</h3>\n<ul>\n<li>\u5728\u84dd\u56fe\u4e2d\u53f3\u952e\u521b\u5efa\u4e00\u4e2a\u8282\u70b9 <code>Send Claude Chat Request</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_claude_blueprint_1.png\" /></p>\n<ul>\n<li>\u521b\u5efa Options \u8282\u70b9\uff0c\u5e76\u8bbe\u7f6e <code>Stream=true, Api Key=\"you api key from Clude\", Max Output Tokens=1024</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_claude_blueprint_2.png\" /></p>\n<ul>\n<li>\u521b\u5efa Messages\uff0c\u4ece\u6587\u4ef6\u521b\u5efa Texture2D\uff0c\u5e76\u4ece Texture2D \u521b\u5efa AIChatPlusTexture\uff0c\u628a AIChatPlusTexture \u6dfb\u52a0\u5230 Message \u4e2d</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_claude_blueprint_3.png\" /></p>\n<ul>\n<li>\u8ddf\u4e0a\u8ff0\u6559\u7a0b\u4e00\u6837\uff0c\u521b\u5efa Event \u5e76\u628a\u4fe1\u606f\u6253\u5370\u5230\u6e38\u620f\u5c4f\u5e55\u4e0a</li>\n</ul>\n<ul>\n<li>\u5b8c\u6574\u7684\u84dd\u56fe\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684\uff0c\u8fd0\u884c\u84dd\u56fe\uff0c\u5373\u53ef\u770b\u5230\u6e38\u620f\u5c4f\u5e55\u5728\u6253\u5370\u5927\u6a21\u578b\u8fd4\u56de\u7684\u6d88\u606f</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_claude_blueprint_4.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_claude_blueprint_5.png\" /></p>\n<h3 id=\"openai_1\">\u84dd\u56fe\u4f7f\u7528 OpenAI \u521b\u5efa\u56fe\u7247</h3>\n<ul>\n<li>\u5728\u84dd\u56fe\u4e2d\u53f3\u952e\u521b\u5efa\u4e00\u4e2a\u8282\u70b9 <code>Send OpenAI Image Request</code>\uff0c\u5e76\u8bbe\u7f6e <code>In Prompt=\"a beautiful butterfly\"</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_image_blueprint_1.png\" /></p>\n<ul>\n<li>\u521b\u5efa Options \u8282\u70b9\uff0c\u5e76\u8bbe\u7f6e <code>Api Key=\"you api key from OpenAI\"</code></li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_image_blueprint_2.png\" /></p>\n<ul>\n<li>\u7ed1\u5b9a On Images \u4e8b\u4ef6\uff0c\u5e76\u628a\u56fe\u7247\u4fdd\u5b58\u5230\u672c\u5730\u786c\u76d8\u4e0a</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_image_blueprint_3.png\" /></p>\n<ul>\n<li>\u5b8c\u6574\u7684\u84dd\u56fe\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684\uff0c\u8fd0\u884c\u84dd\u56fe\uff0c\u5373\u53ef\u770b\u5230\u56fe\u7247\u4fdd\u5b58\u5728\u6307\u5b9a\u7684\u4f4d\u7f6e\u4e0a</li>\n</ul>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_image_blueprint_4.png\" /></p>\n<p><img alt=\"guide bludprint\" src=\"../assets/img/2024-ue-aichatplus/guide_openai_image_blueprint_5.png\" /></p>\n<h2 id=\"_9\">\u66f4\u65b0\u65e5\u5fd7</h2>\n<h3 id=\"v134-20241205\">v1.3.4 - 2024.12.05</h3>\n<h4 id=\"_10\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>OpenAI \u652f\u6301 vision api</li>\n</ul>\n<h4 id=\"_11\">\u95ee\u9898\u4fee\u590d</h4>\n<ul>\n<li>\u4fee\u590d OpenAI stream=false \u65f6\u7684\u9519\u8bef</li>\n</ul>\n<h3 id=\"v133-20241125\">v1.3.3 - 2024.11.25</h3>\n<h4 id=\"_12\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u652f\u6301 UE-5.5</li>\n</ul>\n<h4 id=\"_13\">\u95ee\u9898\u4fee\u590d</h4>\n<ul>\n<li>\u4fee\u590d\u90e8\u5206\u84dd\u56fe\u4e0d\u751f\u6548\u95ee\u9898</li>\n</ul>\n<h3 id=\"v132-20241010\">v1.3.2 - 2024.10.10</h3>\n<h4 id=\"_14\">\u95ee\u9898\u4fee\u590d</h4>\n<ul>\n<li>\u4fee\u590d \u624b\u52a8\u505c\u6b62 request \u7684\u65f6\u5019 cllama \u5d29\u6e83</li>\n</ul>\n<ul>\n<li>\u4fee\u590d\u5546\u57ce\u4e0b\u8f7d\u7248\u672c win \u6253\u5305\u627e\u4e0d\u5230 ggml.dll llama.dll \u6587\u4ef6\u7684\u95ee\u9898</li>\n</ul>\n<ul>\n<li>\u521b\u5efa\u8bf7\u6c42\u65f6\u68c0\u67e5\u662f\u5426\u5728 GameThread \u4e2d\uff0cCreateRequest check in game thread</li>\n</ul>\n<h3 id=\"v131-2024930\">v1.3.1 - 2024.9.30</h3>\n<h4 id=\"_15\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u589e\u52a0\u4e00\u4e2a SystemTemplateViewer\uff0c\u53ef\u4ee5\u67e5\u770b\u548c\u4f7f\u7528\u51e0\u767e\u4e2a system \u8bbe\u7f6e\u6a21\u7248</li>\n</ul>\n<h4 id=\"_16\">\u95ee\u9898\u4fee\u590d</h4>\n<ul>\n<li>\u4fee\u590d\u4ece\u5546\u57ce\u4e0b\u8f7d\u7684\u63d2\u4ef6\uff0cllama.cpp \u627e\u4e0d\u5230\u94fe\u63a5\u5e93</li>\n</ul>\n<ul>\n<li>\u4fee\u590d LLAMACpp \u8def\u5f84\u8fc7\u957f\u95ee\u9898</li>\n</ul>\n<ul>\n<li>\u4fee\u590d windows \u6253\u5305\u540e\u7684\u94fe\u63a5 llama.dll \u9519\u8bef</li>\n</ul>\n<ul>\n<li>\u4fee\u590d ios/android \u8bfb\u53d6\u6587\u4ef6\u8def\u5f84\u95ee\u9898</li>\n</ul>\n<ul>\n<li>\u4fee\u590d Cllame \u8bbe\u7f6e\u540d\u5b57\u9519\u8bef</li>\n</ul>\n<h3 id=\"v130-2024923\">v1.3.0 - 2024.9.23</h3>\n<h4 id=\"_17\">\u91cd\u5927\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u6574\u5408\u4e86 llama.cpp\uff0c\u652f\u6301\u672c\u5730\u79bb\u7ebf\u6267\u884c\u5927\u6a21\u578b</li>\n</ul>\n<h3 id=\"v120-20240820\">v1.2.0 - 2024.08.20</h3>\n<h4 id=\"_18\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u652f\u6301 OpenAI Image Edit/Image Variation</li>\n</ul>\n<ul>\n<li>\u652f\u6301 Ollama API\uff0c\u652f\u6301\u81ea\u52a8\u83b7\u53d6 Ollama \u652f\u6301\u7684\u6a21\u578b\u5217\u8868</li>\n</ul>\n<h3 id=\"v110-20240807\">v1.1.0 - 2024.08.07</h3>\n<h4 id=\"_19\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u652f\u6301\u84dd\u56fe</li>\n</ul>\n<h3 id=\"v100-20240805\">v1.0.0 - 2024.08.05</h3>\n<h4 id=\"_20\">\u65b0\u529f\u80fd</h4>\n<ul>\n<li>\u57fa\u7840\u5b8c\u6574\u529f\u80fd</li>\n</ul>\n<ul>\n<li>\u652f\u6301 OpenAI\uff0c Azure\uff0cClaude\uff0cGemini</li>\n</ul>\n<ul>\n<li>\u81ea\u5e26\u529f\u80fd\u5b8c\u5584\u7f16\u8f91\u5668\u804a\u5929\u5de5\u5177</li>\n</ul>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2024-08-04T15:49:54+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/py-Python%E6%9D%82%E8%B0%882-Python312-%E7%83%AD%E6%9B%B4%E6%96%B0/",
            "url": "https://wiki.disenone.site/py-Python%E6%9D%82%E8%B0%882-Python312-%E7%83%AD%E6%9B%B4%E6%96%B0/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Python \u6742\u8c08 2 - Python3.12 \u70ed\u66f4\u65b0",
            "content_html": "<p><meta property=\"og:title\" content=\"Python \u6742\u8c08 2 - Python3.12 \u70ed\u66f4\u65b0\" /></p>\n<h1 id=\"python-2-python312\">Python \u6742\u8c08 2 - Python3.12 \u70ed\u66f4\u65b0</h1>\n<blockquote>\n<p>\u8bb0\u5f55\u5982\u4f55\u5728 Python3.12 \u4e2d\u5b9e\u73b0\u70ed\u66f4\u65b0</p>\n</blockquote>\n<h2 id=\"_1\">\u70ed\u66f4\u65b0</h2>\n<p>\u70ed\u66f4\u65b0\uff08Hot Reload\uff09\u53ef\u4ee5\u7406\u89e3\u5728\u4e0d\u9700\u8981\u91cd\u542f\u7a0b\u5e8f\u7684\u60c5\u51b5\u4e0b\u5bf9\u5176\u8fdb\u884c\u66f4\u65b0\u7684\u6280\u672f\u3002\u8fd9\u9879\u6280\u672f\u5728\u6e38\u620f\u884c\u4e1a\u6709\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u5f00\u53d1\u8005\u5bf9\u6e38\u620f\u95ee\u9898\u8fdb\u884c\u4fee\u590d\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u4e0d\u5bf9\u73a9\u5bb6\u9020\u6210\u5f71\u54cd\uff0c\u5f80\u5f80\u9700\u8981\u91c7\u7528\u4e00\u4e9b\u9759\u9ed8\u66f4\u65b0\u7684\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u70ed\u66f4\u65b0\u3002</p>\n<h2 id=\"python\">Python \u70ed\u66f4\u65b0</h2>\n<p>Python \u672c\u8eab\u662f\u52a8\u6001\u8bed\u8a00\uff0c\u4e00\u5207\u7686\u662f\u5bf9\u8c61\uff0c\u662f\u6709\u80fd\u529b\u505a\u5230\u70ed\u66f4\u65b0\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u7c97\u7565\u628a Python \u4e2d\u7684\u9700\u8981\u70ed\u66f4\u7684\u5bf9\u8c61\u5206\u6210\u4e24\u79cd\uff1a\u6570\u636e \u548c \u51fd\u6570\u3002</p>\n<p>\u6570\u636e\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u6e38\u620f\u4e2d\u7684\u6570\u503c\u6216\u8005\u8bbe\u5b9a\uff0c\u8b6c\u5982\u73a9\u5bb6\u7684\u7b49\u7ea7\uff0c\u88c5\u5907\u7b49\u7b49\u4e00\u4e9b\u6570\u636e\uff0c\u90e8\u5206\u6570\u636e\u662f\u4e0d\u5e94\u8be5\u70ed\u66f4\u7684\uff08\u8b6c\u5982\u73a9\u5bb6\u5f53\u524d\u7b49\u7ea7\uff0c\u73a9\u5bb6\u8eab\u4e0a\u62e5\u6709\u54ea\u4e9b\u88c5\u5907\uff0c\u8fd9\u4e9b\u6570\u636e\u7684\u4fee\u6539\u4e0d\u5e94\u8be5\u901a\u8fc7\u70ed\u66f4\u6765\u5b9e\u73b0\uff09\uff0c\u90e8\u5206\u6570\u636e\u662f\u6211\u4eec\u60f3\u8981\u70ed\u66f4\u7684\uff08\u8b6c\u5982\u88c5\u5907\u7684\u57fa\u7840\u6570\u503c\u8bbe\u5b9a\uff0c\u6280\u80fd\u7684\u57fa\u7840\u6570\u503c\u8bbe\u5b9a\uff0cUI \u4e0a\u7684\u6587\u5b57\u7b49\u7b49\uff09\u3002</p>\n<p>\u51fd\u6570\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u6e38\u620f\u903b\u8f91\uff0c\u8fd9\u57fa\u672c\u90fd\u662f\u6211\u4eec\u60f3\u8981\u70ed\u66f4\u7684\uff0c\u903b\u8f91\u9519\u8bef\u57fa\u672c\u90fd\u9700\u8981\u901a\u8fc7\u70ed\u66f4\u65b0\u51fd\u6570\u6765\u5b9e\u73b0\u3002</p>\n<p>\u4e0b\u9762\u6211\u4eec\u6765\u5177\u4f53\u770b\u770b\u6709\u4ec0\u4e48\u65b9\u6cd5\u53ef\u4ee5\u5bf9 Python3.12 \u6267\u884c\u70ed\u66f4\u65b0\u3002</p>\n<h2 id=\"hotfix\">Hotfix</h2>\n<p>\u7b2c\u4e00\u79cd\u65b9\u6cd5\u6211\u4eec\u53eb\u505a Hotfix\uff0c\u901a\u8fc7\u8ba9\u7a0b\u5e8f\uff08\u5ba2\u6237\u7aef\u7a0b\u5e8f / \u670d\u52a1\u7aef\u7a0b\u5e8f\u90fd\u53ef\u4ee5\uff09\u6267\u884c\u4e00\u6bb5\u7279\u5b9a\u7684 Python \u4ee3\u7801\uff0c\u5b9e\u73b0\u5bf9\u6570\u636e\u548c\u51fd\u6570\u7684\u70ed\u66f4\u65b0\u3002\u4e00\u6bb5\u7b80\u5355\u7684 Hotfix \u4ee3\u7801\u53ef\u80fd\u662f\u8fd9\u6837\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># hotfix code</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"c1\"># hotfix data</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"kn\">import</span> <span class=\"nn\">weapon_data</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"n\">weapon_data</span><span class=\"o\">.</span><span class=\"n\">gun</span><span class=\"o\">.</span><span class=\"n\">damage</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"c1\"># hotfix func</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"kn\">import</span> <span class=\"nn\">player</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"k\">def</span> <span class=\"nf\">new_fire_func</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">):</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a>    <span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">health</span> <span class=\"o\">-=</span> <span class=\"n\">weapon_data</span><span class=\"o\">.</span><span class=\"n\">gun</span><span class=\"o\">.</span><span class=\"n\">damage</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>    <span class=\"c1\"># ...</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"n\">player</span><span class=\"o\">.</span><span class=\"n\">Player</span><span class=\"o\">.</span><span class=\"n\">fire_func</span> <span class=\"o\">=</span> <span class=\"n\">new_fire_func</span>\n</code></pre></div>\n<p>\u4ee5\u4e0a\u4ee3\u7801\u7b80\u5355\u5c55\u793a Hotfix \u7684\u5199\u6cd5\uff0c\u6570\u636e / \u51fd\u6570\u4fee\u6539\u4e4b\u540e\uff0c\u7a0b\u5e8f\u540e\u7eed\u8bbf\u95ee\u7684\u65f6\u5019\u5c31\u4f1a\u8bfb\u5230\u65b0\u7684\u6570\u636e / \u51fd\u6570\u6765\u6267\u884c\u3002</p>\n<p>\u5982\u679c\u4f60\u6bd4\u8f83\u7ec6\u81f4\uff0c\u4f60\u53ef\u80fd\u4f1a\u6709\u4e00\u4e2a\u7591\u95ee\uff1a\u90a3\u5982\u679c\u5176\u4ed6\u4ee3\u7801\u91cc\u9762\u5f15\u7528\u4f4f\u4e86\u8fd9\u4e9b\u9700\u8981\u4fee\u6539\u6570\u636e\u548c\u51fd\u6570\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u4e8b\u60c5\uff1f</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\"># attack.py module</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"n\">player_fire</span> <span class=\"o\">=</span> <span class=\"n\">player</span><span class=\"o\">.</span><span class=\"n\">Player</span><span class=\"o\">.</span><span class=\"n\">fire_func</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"k\">def</span> <span class=\"nf\">player_attack_by_gun</span><span class=\"p\">(</span><span class=\"n\">player</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">):</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a>    <span class=\"n\">player_fire</span><span class=\"p\">(</span><span class=\"n\">player</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a>    <span class=\"c1\"># ...</span>\n</code></pre></div>\n<p>\u7b54\u6848\u662f\uff0c\u524d\u9762\u7684 Hotfix \u5bf9\u8fd9\u79cd\u60c5\u51b5\u662f\u4e0d\u751f\u6548\u7684\uff0c<code>fire_func</code> \u8fd9\u4e2a\u51fd\u6570\u76f8\u5f53\u4e8e\u5728\u5176\u4ed6\u6a21\u5757\u591a\u4e86\u4e00\u4efd\u526f\u672c\uff0c\u8be5\u6a21\u5757\u4e2d\u8c03\u7528\u7684\u662f\u51fd\u6570\u7684\u526f\u672c\uff0c\u6211\u4eec\u4fee\u6539\u51fd\u6570\u672c\u4f53\u5bf9\u526f\u672c\u4e0d\u751f\u6548\u3002</p>\n<p>\u6240\u4ee5\u9700\u8981\u6ce8\u610f\uff0c\u4e00\u822c\u4ee3\u7801\u4e2d\u5c3d\u91cf\u51cf\u5c11\u6a21\u5757\u7ea7\u522b\u7684\u6570\u636e\u5f15\u7528\u548c\u51fd\u6570\u5f15\u7528\uff0c\u907f\u514d\u51fa\u73b0\u8fd9\u79cd Hotfix \u4e0d\u751f\u6548\u7684\u60c5\u51b5\uff0c\u5982\u679c\u4ee3\u7801\u5df2\u7ecf\u662f\u8fd9\u6837\u5199\u7684\uff0cHotfix \u9700\u8981\u591a\u505a\u4e00\u4e9b\u5de5\u4f5c\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\"># hotfix code</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"c1\"># ...</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"kn\">import</span> <span class=\"nn\">attack</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"n\">attack</span><span class=\"o\">.</span><span class=\"n\">player_fire</span> <span class=\"o\">=</span> <span class=\"n\">player</span><span class=\"o\">.</span><span class=\"n\">Player</span><span class=\"o\">.</span><span class=\"n\">fire_func</span>\n</code></pre></div>\n<p>\u5728\u5bf9\u6570\u636e / \u51fd\u6570\u672c\u4f53 Hotfix \u4fee\u6539\u4e4b\u540e\uff0c\u518d\u989d\u5916\u5bf9\u5f15\u7528\u7684\u5730\u65b9\u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u4e9b\u989d\u5916\u7684\u4fee\u6539\u5f88\u5bb9\u6613\u88ab\u9057\u6f0f\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u5efa\u8bae\uff0c\u4ece\u4ee3\u7801\u89c4\u8303\u4e0a\u6765\u5c3d\u91cf\u907f\u514d\u591a\u5904\u5f15\u7528\u7684\u5199\u6cd5\u3002</p>\n<p>\u7efc\u4e0a\uff0cHotfix \u80fd\u6ee1\u8db3\u70ed\u66f4\u7684\u57fa\u672c\u9700\u6c42\uff0c\u540c\u65f6\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a</p>\n<ul>\n<li>\u5982\u679c\u6570\u636e/\u51fd\u6570\u88ab\u5176\u4ed6\u6a21\u5757\u660e\u786e\u5f15\u7528\u4f4f\uff0c\u9700\u8981\u989d\u5916\u5bf9\u8fd9\u4e9b\u6a21\u5757\u7684\u5f15\u7528 Hotfix</li>\n<li>\u5982\u679c\u6709\u5927\u91cf\u7684\u6570\u636e/\u51fd\u6570\u9700\u8981 Hotfix\uff0c\u90a3\u4e48 Hotfix \u7684\u4ee3\u7801\u4f1a\u53d8\u5f97\u5f88\u5e9e\u5927\uff0c\u7ef4\u62a4\u96be\u5ea6\u4e0a\u5347\uff0c\u4e5f\u66f4\u5bb9\u6613\u51fa\u9519</li>\n</ul>\n<h2 id=\"reload\">Reload</h2>\n<p>\u672c\u7ae0\u8282\u6e90\u7801\u53ef\u4ece\u8fd9\u91cc\u83b7\u5f97\uff1a<a href=\"https://github.com/disenone/python_reloader\">python_reloader</a></p>\n<p>\u6211\u4eec\u66f4\u60f3\u8981\u7684\u662f\u81ea\u52a8\u70ed\u66f4\u65b0\uff0c\u4e0d\u9700\u8981\u989d\u5916\u5199 Hotfix\uff0c\u53ea\u9700\u8981\u66f4\u65b0\u4ee3\u7801\u6587\u4ef6\uff0c\u8ba9\u7a0b\u5e8f\u6267\u884c\u4e00\u4e2a Reload \u51fd\u6570\u5219\u4f1a\u81ea\u52a8\u66ff\u6362\u65b0\u7684\u51fd\u6570\u548c\u65b0\u7684\u6570\u636e\u3002\u6211\u4eec\u628a\u8fd9\u4e2a\u81ea\u52a8\u70ed\u66f4\u65b0\u7684\u529f\u80fd\u53eb\u505a Reload\u3002</p>\n<p>Python3.12 \u63d0\u4f9b\u4e86 importlib.reload \u51fd\u6570\uff0c\u53ef\u4ee5\u91cd\u65b0\u52a0\u8f7d\u6a21\u5757\uff0c\u4f46\u662f\u5374\u662f\u5168\u91cf\u52a0\u8f7d\uff0c\u5e76\u4e14\u8fd4\u56de\u65b0\u7684\u6a21\u5757\u5bf9\u8c61\uff0c\u5bf9\u4e8e\u5176\u4ed6\u6a21\u5757\u4e2d\u7684\u5f15\u7528\uff0c\u5e76\u4e0d\u80fd\u81ea\u52a8\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u5176\u4ed6\u6a21\u5757\u5982\u679c import \u4e86 reload \u7684\u6a21\u5757\uff0c\u90a3\u4e48\u8bbf\u95ee\u7684\u4f9d\u7136\u662f\u65e7\u7684\u6a21\u5757\u5bf9\u8c61\u3002\u8fd9\u4e2a\u529f\u80fd\u6bd4\u6211\u4eec\u7684 Hotfix \u597d\u4e0d\u4e86\u591a\u5c11\uff0c\u66f4\u4f55\u51b5\u662f\u5168\u91cf reload \u6a21\u5757\uff0c\u4e0d\u80fd\u7531\u6211\u4eec\u63a7\u5236\u54ea\u4e9b\u6570\u636e\u5e94\u8be5\u4fdd\u7559\u3002\u6211\u4eec\u60f3\u8981\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a Reload \u529f\u80fd\uff0c\u6ee1\u8db3\u8fd9\u4e9b\u8981\u6c42\uff1a</p>\n<ul>\n<li>\u81ea\u52a8\u66ff\u6362\u51fd\u6570\uff0c\u540c\u65f6\u65e7\u51fd\u6570\u7684\u5f15\u7528\u4f9d\u7136\u6709\u6548\uff0c\u5e76\u4f1a\u6267\u884c\u65b0\u51fd\u6570\u7684\u5185\u5bb9</li>\n<li>\u81ea\u52a8\u66ff\u6362\u6570\u636e\uff0c\u540c\u65f6\u53ef\u63a7\u5236\u90e8\u5206\u66ff\u6362</li>\n<li>\u4fdd\u7559\u65e7\u6a21\u5757\u7684\u5f15\u7528\uff0c\u901a\u8fc7\u65e7\u6a21\u5757\u5c31\u80fd\u8bbf\u95ee\u5230\u65b0\u7684\u5185\u5bb9</li>\n<li>\u9700\u8981 Reload \u7684\u6a21\u5757\u53ef\u63a7</li>\n</ul>\n<p>\u8981\u5b8c\u6210\u8fd9\u4e9b\u8981\u6c42\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9 Python \u91cc\u9762 meta_path \u7684\u673a\u5236\uff0c\u8be6\u7ec6\u7684\u4ecb\u7ecd\u53ef\u4ee5\u770b\u5b98\u65b9\u6587\u6863 <a href=\"https://docs.python.org/zh-cn/3/reference/import.html?highlight=meta_path#the-meta-path\">the-meta-path</a>\u3002</p>\n<p>sys.meta_path \u91cc\u9762\u53ef\u4ee5\u5b9a\u4e49\u6211\u4eec\u7684\u5143\u8def\u5f84\u67e5\u627e\u5668\u5bf9\u8c61\uff0c\u8b6c\u5982\u6211\u4eec\u628a\u7528\u4e8e Reload \u7684\u67e5\u627e\u5668\u53eb\u505a reload_finder\uff0creload_finder \u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u51fd\u6570 find_spec \u5e76\u8fd4\u56de spec \u5bf9\u8c61\u3002Python \u62ff\u5230 spec \u5bf9\u8c61\u540e\uff0c\u4f1a\u4f9d\u6b21\u6267\u884c spec.loader.create_module \u548c spec.loader.exec_module \u5b8c\u6210\u6a21\u5757\u7684\u5bfc\u5165\u3002</p>\n<p>\u5982\u679c\u6211\u4eec\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u65b0\u7684\u6a21\u5757\u4ee3\u7801\uff0c\u5e76\u628a\u65b0\u7684\u6a21\u5757\u91cc\u9762\u7684\u51fd\u6570\u548c\u9700\u8981\u7684\u6570\u636e\u590d\u5236\u5230\u65e7\u6a21\u5757\u4e2d\uff0c\u5219\u53ef\u4ee5\u8fbe\u5230 Reload \u7684\u76ee\u7684\uff1a</p>\n<div class=\"language-python highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-3-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-41\">41</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\"></a><span class=\"k\">class</span> <span class=\"nc\">MetaFinder</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\"></a>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">reloader</span><span class=\"p\">):</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_reloader</span> <span class=\"o\">=</span> <span class=\"n\">reloader</span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\"></a>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\"></a>    <span class=\"k\">def</span> <span class=\"nf\">find_spec</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fullname</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\"></a>        <span class=\"c1\"># find source file</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\"></a>        <span class=\"n\">finder</span> <span class=\"o\">=</span> <span class=\"n\">importlib</span><span class=\"o\">.</span><span class=\"n\">machinery</span><span class=\"o\">.</span><span class=\"n\">PathFinder</span><span class=\"p\">()</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\"></a>        <span class=\"n\">spec</span> <span class=\"o\">=</span> <span class=\"n\">finder</span><span class=\"o\">.</span><span class=\"n\">find_spec</span><span class=\"p\">(</span><span class=\"n\">fullname</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\"></a>        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">spec</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\"></a>            <span class=\"k\">return</span>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\"></a>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\"></a>        <span class=\"n\">old_module</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_reloader</span><span class=\"o\">.</span><span class=\"n\">GetOldModule</span><span class=\"p\">(</span><span class=\"n\">fullname</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\"></a>        <span class=\"k\">if</span> <span class=\"n\">old_module</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\"></a>            <span class=\"c1\"># run new code in old module dict</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\"></a>            <span class=\"n\">code</span> <span class=\"o\">=</span> <span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">loader</span><span class=\"o\">.</span><span class=\"n\">get_code</span><span class=\"p\">(</span><span class=\"n\">fullname</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\"></a>            <span class=\"n\">exec</span><span class=\"p\">(</span><span class=\"n\">code</span><span class=\"p\">,</span> <span class=\"n\">old_module</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\"></a>            <span class=\"n\">module</span> <span class=\"o\">=</span> <span class=\"n\">old_module</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\"></a>        <span class=\"k\">else</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\"></a>            <span class=\"c1\"># if old module not exists, just create a new one</span>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\"></a>            <span class=\"n\">module</span> <span class=\"o\">=</span> <span class=\"n\">import_util</span><span class=\"o\">.</span><span class=\"n\">module_from_spec</span><span class=\"p\">(</span><span class=\"n\">spec</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\"></a>            <span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">loader</span><span class=\"o\">.</span><span class=\"n\">exec_module</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\"></a>\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\"></a>        <span class=\"k\">try</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\"></a>            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_reloader</span><span class=\"o\">.</span><span class=\"n\">ReloadModule</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\"></a>        <span class=\"k\">except</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\"></a>            <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">excepthook</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exc_info</span><span class=\"p\">())</span>\n<a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\"></a>\n<a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\"></a>        <span class=\"k\">return</span> <span class=\"n\">import_util</span><span class=\"o\">.</span><span class=\"n\">spec_from_loader</span><span class=\"p\">(</span><span class=\"n\">fullname</span><span class=\"p\">,</span> <span class=\"n\">MetaLoader</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">))</span>\n<a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\"></a>\n<a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\"></a>\n<a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\"></a><span class=\"k\">class</span> <span class=\"nc\">MetaLoader</span><span class=\"p\">:</span>\n<a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\"></a>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"p\">):</span>\n<a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_module</span> <span class=\"o\">=</span> <span class=\"n\">module</span>\n<a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\"></a>\n<a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\"></a>    <span class=\"k\">def</span> <span class=\"nf\">create_module</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">spec</span><span class=\"p\">):</span>\n<a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\"></a>        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_module</span>\n<a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\"></a>\n<a id=\"__codelineno-3-38\" name=\"__codelineno-3-38\"></a>    <span class=\"k\">def</span> <span class=\"nf\">exec_module</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"p\">):</span>\n<a id=\"__codelineno-3-39\" name=\"__codelineno-3-39\"></a>        <span class=\"c1\"># restore __spec__</span>\n<a id=\"__codelineno-3-40\" name=\"__codelineno-3-40\"></a>        <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">__spec__</span> <span class=\"o\">=</span> <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s1\">&#39;__backup_spec__&#39;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-41\" name=\"__codelineno-3-41\"></a>        <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">__loader__</span> <span class=\"o\">=</span> <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s1\">&#39;__backup_loader__&#39;</span><span class=\"p\">)</span>\n</code></pre></div></td></tr></table></div>\n<p>\u5982\u4e0a\uff0c<code>find_spec</code> \u52a0\u8f7d\u6700\u65b0\u7684\u6a21\u5757\u6e90\u7801\uff0c\u5e76\u5728\u65e7\u6a21\u5757\u7684 <code>__dict__</code> \u91cc\u9762\u6267\u884c\u65b0\u6a21\u5757\u7684\u4ee3\u7801\uff0c\u4e4b\u540e\u6211\u4eec\u8c03\u7528 <code>ReloadModule</code> \u6765\u5904\u7406\u7c7b / \u51fd\u6570 / \u6570\u636e\u7684\u5f15\u7528\u548c\u66ff\u6362\u3002<code>MetaLoader</code> \u7684\u76ee\u7684\u662f\u9002\u914d meta_path \u673a\u5236\uff0c\u7ed9 Python \u865a\u62df\u673a\u8fd4\u56de\u6211\u4eec\u5904\u7406\u8fc7\u7684\u6a21\u5757\u5bf9\u8c61\u3002</p>\n<p>\u5904\u7406\u5b8c\u52a0\u8f7d\u7684\u6d41\u7a0b\uff0c\u518d\u6765\u770b <code>ReloadModule</code> \u7684\u5927\u81f4\u5b9e\u73b0</p>\n<div class=\"language-python highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-4-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-48\">48</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\"></a><span class=\"c1\"># ...</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\"></a><span class=\"k\">def</span> <span class=\"nf\">ReloadModule</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\"></a>    <span class=\"n\">old_module_info</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_old_module_infos</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\"></a>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">old_module_info</span><span class=\"p\">:</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\"></a>        <span class=\"k\">return</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\"></a>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\"></a>    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ReloadDict</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">old_module_info</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\"></a>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\"></a><span class=\"k\">def</span> <span class=\"nf\">ReloadDict</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">old_dict</span><span class=\"p\">,</span> <span class=\"n\">new_dict</span><span class=\"p\">,</span> <span class=\"n\">_reload_all_data</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">_del_func</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\"></a>    <span class=\"n\">dels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\"></a>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\"></a>    <span class=\"k\">for</span> <span class=\"n\">attr_name</span><span class=\"p\">,</span> <span class=\"n\">old_attr</span> <span class=\"ow\">in</span> <span class=\"n\">old_dict</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\"></a>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\"></a>        <span class=\"k\">if</span> <span class=\"n\">attr_name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">IGNORE_ATTRS</span><span class=\"p\">:</span>\n<a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\"></a>            <span class=\"k\">continue</span>\n<a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\"></a>\n<a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\"></a>        <span class=\"k\">if</span> <span class=\"n\">attr_name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">new_dict</span><span class=\"p\">:</span>\n<a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\"></a>            <span class=\"k\">if</span> <span class=\"n\">_del_func</span> <span class=\"ow\">and</span> <span class=\"p\">(</span><span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">isfunction</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">ismethod</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)):</span>\n<a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\"></a>                <span class=\"n\">dels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">attr_name</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\"></a>            <span class=\"k\">continue</span>\n<a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\"></a>\n<a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\"></a>        <span class=\"n\">new_attr</span> <span class=\"o\">=</span> <span class=\"n\">new_dict</span><span class=\"p\">[</span><span class=\"n\">attr_name</span><span class=\"p\">]</span>\n<a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\"></a>\n<a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\"></a>        <span class=\"k\">if</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">isclass</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\"></a>            <span class=\"n\">new_dict</span><span class=\"p\">[</span><span class=\"n\">attr_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ReloadClass</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">old_attr</span><span class=\"p\">,</span> <span class=\"n\">new_attr</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\"></a>\n<a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\"></a>        <span class=\"k\">elif</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">isfunction</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\"></a>            <span class=\"n\">new_dict</span><span class=\"p\">[</span><span class=\"n\">attr_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ReloadFunction</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">old_attr</span><span class=\"p\">,</span> <span class=\"n\">new_attr</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\"></a>\n<a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\"></a>        <span class=\"k\">elif</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">ismethod</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">,</span> <span class=\"nb\">classmethod</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">,</span> <span class=\"nb\">staticmethod</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\"></a>            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ReloadFunction</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">old_attr</span><span class=\"o\">.</span><span class=\"vm\">__func__</span><span class=\"p\">,</span> <span class=\"n\">new_attr</span><span class=\"o\">.</span><span class=\"vm\">__func__</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\"></a>            <span class=\"n\">new_dict</span><span class=\"p\">[</span><span class=\"n\">attr_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">old_attr</span>\n<a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\"></a>\n<a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\"></a>        <span class=\"k\">elif</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">isbuiltin</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)</span> \\\n<a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\"></a>                <span class=\"ow\">or</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">ismodule</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)</span> \\\n<a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\"></a>                <span class=\"ow\">or</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">ismethoddescriptor</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">)</span> \\\n<a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\"></a>                <span class=\"ow\">or</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">old_attr</span><span class=\"p\">,</span> <span class=\"nb\">property</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\"></a>            <span class=\"c1\"># keep new</span>\n<a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\"></a>            <span class=\"k\">pass</span>\n<a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\"></a>\n<a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\"></a>        <span class=\"k\">elif</span> <span class=\"ow\">not</span> <span class=\"n\">_reload_all_data</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">NeedUpdateData</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">new_dict</span><span class=\"p\">,</span> <span class=\"n\">attr_name</span><span class=\"p\">):</span>\n<a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\"></a>            <span class=\"c1\"># keep old data</span>\n<a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\"></a>            <span class=\"n\">new_dict</span><span class=\"p\">[</span><span class=\"n\">attr_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">old_attr</span>\n<a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\"></a>\n<a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\"></a>    <span class=\"k\">if</span> <span class=\"n\">dels</span><span class=\"p\">:</span>\n<a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\"></a>        <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">dels</span><span class=\"p\">:</span>\n<a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\"></a>            <span class=\"n\">old_dict</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\"></a><span class=\"c1\"># ...</span>\n</code></pre></div></td></tr></table></div>\n<p><code>ReloadDict</code> \u91cc\u9762\u4f1a\u533a\u5206\u5904\u7406\u4e0d\u540c\u7c7b\u578b\u7684\u5bf9\u8c61</p>\n<ul>\n<li>\u5982\u679c\u662f class\uff0c\u5219\u8c03\u7528 <code>ReloadClass</code>\uff0c\u4f1a\u8fd4\u56de\u65e7\u6a21\u5757\u7684\u5f15\u7528\uff0c\u5e76\u66f4\u65b0 class \u7684\u6210\u5458</li>\n<li>\u5982\u679c\u662f function / method \uff0c\u5219\u8c03\u7528 <code>ReloadFunction</code>\uff0c\u4f1a\u8fd4\u56de\u65e7\u6a21\u5757\u7684\u5f15\u7528\uff0c\u5e76\u66f4\u65b0\u51fd\u6570\u7684\u5185\u90e8\u6570\u636e</li>\n<li>\u5982\u679c\u662f\u6570\u636e\uff0c\u5e76\u4e14\u9700\u8981\u4fdd\u7559\uff0c\u5219\u4f1a\u56de\u6eda <code>new_dict[attr_name] = old_attr</code></li>\n<li>\u5176\u4f59\u7684\u90fd\u4fdd\u6301\u65b0\u7684\u5f15\u7528</li>\n<li>\u5220\u9664\u65b0\u6a21\u5757\u4e0d\u5b58\u5728\u7684\u51fd\u6570</li>\n</ul>\n<p><code>ReloadClass</code>\uff0c<code>ReloadFunction</code> \u7684\u5177\u4f53\u4ee3\u7801\u8fd9\u91cc\u4e0d\u518d\u5c55\u5f00\u5206\u6790\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u76f4\u63a5\u770b<a href=\"https://github.com/disenone/python_reloader\">\u6e90\u7801</a>\u3002</p>\n<p>\u6574\u4e2a Reload \u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u6982\u62ec\u4e3a\uff1a\u65e7\u74f6\u88c5\u65b0\u9152\u3002\u4e3a\u4e86\u4fdd\u6301\u6a21\u5757/\u6a21\u5757\u7684\u51fd\u6570/\u6a21\u5757\u7684\u7c7b/\u6a21\u5757\u7684\u6570\u636e\u6709\u6548\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u7559\u539f\u6765\u7684\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5f15\u7528\uff08\u8eaf\u58f3\uff09\uff0c\u8f6c\u800c\u53bb\u66f4\u65b0\u5b83\u4eec\u5185\u90e8\u7684\u5177\u4f53\u6570\u636e\uff0c\u8b6c\u5982\u5bf9\u4e8e\u51fd\u6570\uff0c\u66f4\u65b0 <code>__code__</code>\uff0c<code>__dict__</code> \u7b49\u6570\u636e\uff0c\u51fd\u6570\u6267\u884c\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8f6c\u800c\u6267\u884c\u65b0\u7684\u4ee3\u7801\u3002</p>\n<h2 id=\"_2\">\u603b\u7ed3</h2>\n<p>\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Python3 \u7684\u4e24\u79cd\u70ed\u66f4\u65b0\u65b9\u5f0f\uff0c\u6bcf\u79cd\u90fd\u6709\u76f8\u5e94\u7684\u5e94\u7528\u573a\u666f\uff0c\u5e0c\u671b\u80fd\u5bf9\u4f60\u6709\u5e2e\u52a9\u3002\u6709\u4efb\u4f55\u7591\u95ee\u6b22\u8fce\u968f\u65f6\u4ea4\u6d41\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2024-01-12T06:37:04+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E8%AE%BE%E7%BD%AE%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%A4%9A%E8%AF%AD%E8%A8%80/",
            "url": "https://wiki.disenone.site/ue-%E8%AE%BE%E7%BD%AE%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%A4%9A%E8%AF%AD%E8%A8%80/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u8bbe\u7f6e\u672c\u5730\u5316\u591a\u8bed\u8a00",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u8bbe\u7f6e\u672c\u5730\u5316\u591a\u8bed\u8a00\" /></p>\n<h1 id=\"ue\">UE \u8bbe\u7f6e\u672c\u5730\u5316\u591a\u8bed\u8a00</h1>\n<blockquote>\n<p>\u8bb0\u5f55\u5982\u4f55\u5728 UE \u4e2d\u5b9e\u73b0\u672c\u5730\u5316\u591a\u8bed\u8a00</p>\n</blockquote>\n<p>\u5982\u679c\u4e0d\u719f\u6089 UE \u6269\u5c55\u83dc\u5355\uff0c\u5efa\u8bae\u5148\u7b80\u5355\u770b\u4e0b\uff1a<a href=\"../ue-%E6%89%A9%E5%B1%95%E7%BC%96%E8%BE%91%E5%99%A8%E8%8F%9C%E5%8D%95/\">UE \u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355</a>\uff0c<a href=\"../ue-%E4%BD%BF%E7%94%A8%E8%B7%AF%E5%BE%84%E5%BD%A2%E5%BC%8F%E6%89%A9%E5%B1%95%E8%8F%9C%E5%8D%95/\">ue-\u4f7f\u7528\u8def\u5f84\u5f62\u5f0f\u6269\u5c55\u83dc\u5355</a></p>\n<p>\u672c\u6587\u4ee3\u7801\u57fa\u4e8e\u63d2\u4ef6\uff1a<a href=\"https://github.com/disenone/UE.EditorPlus\">UE.EditorPlus</a></p>\n<h2 id=\"_1\">\u529f\u80fd\u4ecb\u7ecd</h2>\n<p>UE \u81ea\u5e26\u5de5\u5177\u53ef\u4ee5\u5b9e\u73b0\u672c\u5730\u5316\u591a\u8bed\u8a00\uff0c\u8b6c\u5982\u6211\u4eec\u53ef\u4ee5\u4e3a\u7f16\u8f91\u5668\u83dc\u5355\u5b9e\u73b0\u672c\u5730\u5316\uff1a</p>\n<p>\u4e2d\u6587\u83dc\u5355\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/chinese.png\" /></p>\n<p>\u82f1\u6587\u83dc\u5355\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/english.png\" /></p>\n<h2 id=\"_2\">\u4ee3\u7801\u58f0\u660e</h2>\n<p>\u4e3a\u4e86\u5b9e\u73b0\u83dc\u5355\u672c\u5730\u5316\uff0c\u6211\u4eec\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u660e\u786e\u58f0\u660e\u9700\u8981 UE \u5904\u7406\u7684\u5b57\u7b26\u4e32\uff0c\u4f7f\u7528 UE \u5b9a\u4e49\u597d\u7684\u5b8f <code>LOCTEXT</code> \u548c <code>NSLOCTEXT</code>\uff1a</p>\n<ul>\n<li>\u6587\u4ef6\u5168\u5c40\u5b9a\u4e49\u65b9\u5f0f\uff0c\u5148\u5f00\u59cb\u5b9a\u4e49\u4e00\u4e2a\u53eb\u505a <code>LOCTEXT_NAMESPACE</code> \u7684\u5b8f\uff0c\u5185\u5bb9\u662f\u5f53\u524d\u591a\u8bed\u8a00\u6587\u672c\u6240\u5728\u7684\u540d\u5b57\u7a7a\u95f4\uff0c\u4e4b\u540e\u6587\u4ef6\u4e2d\u7684\u6587\u672c\u5c31\u53ef\u4ee5\u7528 <code>LOCTEXT</code> \u6765\u5b9a\u4e49\uff0c\u6587\u4ef6\u6700\u540e\u53d6\u6d88\u5b8f <code>LOCTEXT_NAMESPACE</code>\uff1a</li>\n</ul>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\">// #define LOCTEXT(InKey, InTextLiteral)</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"cp\">#define LOCTEXT_NAMESPACE &quot;EditorPlusTools&quot;</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Key&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Content&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"cp\">#undef LOCTEXT_NAMESPACE</span>\n</code></pre></div>\n<ul>\n<li>\u5c40\u90e8\u5b9a\u4e49\u65b9\u5f0f\uff0c\u4f7f\u7528 <code>NSLOCTEXT</code>\uff0c\u5b9a\u4e49\u6587\u672c\u7684\u65f6\u5019\u5e26\u4e0a\u540d\u5b57\u7a7a\u95f4\u53c2\u6570\uff1a</li>\n</ul>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\">// #define NSLOCTEXT(InNamespace, InKey, InTextLiteral)</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"n\">NSLOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;EditorPlusTools&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Key&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Content&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>UE \u5de5\u5177\u901a\u8fc7\u67e5\u627e\u5b8f <code>LOCTEXT</code> \u548c <code>NSLOCTEXT</code> \u7684\u51fa\u73b0\u6765\u6536\u96c6\u51fa\u6240\u6709\u9700\u8981\u7ffb\u8bd1\u7684\u6587\u672c\u3002</p>\n<h2 id=\"_3\">\u4f7f\u7528\u5de5\u5177\u7ffb\u8bd1\u6587\u672c</h2>\n<p>\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b\u4ee3\u7801\u5b9a\u4e49\u6587\u672c\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"cp\">#define LOCTEXT_NAMESPACE &quot;EditorPlusTools&quot;</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"c1\">// register path node loctext</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest&quot;</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">))</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest/&lt;SubMenu&gt;SubMenu1&quot;</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;SubMenu1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;SubMenu1&quot;</span><span class=\"p\">))</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;SubMenu1Tips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;SubMenu1Tips&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/MenuTest/&lt;SubMenu&gt;SubMenu1/&lt;SubMenu&gt;SubMenu1&quot;</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;SubMenu1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;SubMenu1&quot;</span><span class=\"p\">))</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;SubMenu1Tips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;SubMenu1Tips&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/&lt;Hook&gt;Help/&lt;MenuBar&gt;MenuTest/&lt;SubMenu&gt;SubMenu1/&lt;Section&gt;Section1&quot;</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Section1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Section1&quot;</span><span class=\"p\">))</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;Section1Tips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Section1Tips&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"cp\">#undef LOCTEXT_NAMESPACE</span>\n</code></pre></div>\n<p>\u9996\u5148\u5f00\u542f\u7ffb\u8bd1\u5de5\u5177\uff0c\u6253\u5f00\u7f16\u8f91\u5668\u8bbe\u7f6e <code>\u7f16\u8f91 - \u7f16\u8f91\u5668\u504f\u597d\u8bbe\u7f6e</code>\uff0c\u52fe\u9009 <code>\u901a\u7528 - \u8bd5\u9a8c\u6027\u529f\u80fd - Tools - \u7ffb\u8bd1\u9009\u53d6\u5668</code>\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/editor_enable_tool.png\" /></p>\n<p>\u7136\u540e\u6253\u5f00\u7ffb\u8bd1\u5de5\u5177 <code>\u5de5\u5177 - \u672c\u5730\u5316\u63a7\u5236\u677f</code>\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/editor_open_tool.png\" /></p>\n<p>\u65b0\u5efa\u4e00\u4e2a\u76ee\u6807\uff08\u5728\u9ed8\u8ba4\u7684 Game \u4e0b\u9762\u4e5f\u884c\uff0c\u65b0\u5efa\u4e00\u4e2a\u662f\u4e3a\u4e86\u65b9\u4fbf\u7ba1\u7406\u548c\u79fb\u52a8\u8fd9\u4e9b\u7ffb\u8bd1\u6587\u672c\uff09</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_new_target.png\" /></p>\n<p>\u914d\u7f6e\u76ee\u6807\u7684\u53c2\u6570\uff0c\u6211\u8fd9\u91cc\u540d\u5b57\u6539\u4e3a <code>EditorPlusTools</code>\uff0c\u52a0\u8f7d\u653f\u7b56\u662f <code>\u7f16\u8f91\u5668</code>\uff0c\u4ece\u6587\u672c\u6536\u96c6\uff0c\u5e76\u52a0\u4e0a\u63d2\u4ef6\u76ee\u5f55\uff0c\u76ee\u6807\u4f9d\u8d56\u6027\u662f <code>Engine, Editor</code>\uff0c\u5176\u4ed6\u914d\u7f6e\u4fdd\u6301\u4e0d\u53d8\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_target_config.png\" /></p>\n<p>\u6dfb\u52a0\u8bed\u7cfb\uff0c\u4fdd\u8bc1\u6709\u4e2d\u6587\uff08\u7b80\u4f53\uff09\u548c\u82f1\u6587\u4e24\u4e2a\u8bed\u7cfb\uff0c\u786e\u8ba4\u9f20\u6807\u653e\u5728\u8bed\u8a00\u540d\u5b57\u4e0a\u5206\u522b\u663e\u793a <code>zh-Hans</code> \u548c <code>en</code>\uff0c\u5e76\u9009\u4e2d\u82f1\u8bed\uff08\u56e0\u4e3a\u6211\u4eec\u4ee3\u7801\u91cc\u9762\u662f\u7528\u82f1\u6587\u5b9a\u4e49\u7684\u6587\u672c\uff0c\u6211\u4eec\u8fd9\u91cc\u9700\u8981\u6536\u96c6\u8fd9\u4e9b\u82f1\u8bed\u6587\u672c\uff09\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_target_lang.png\" /></p>\n<p>\u70b9\u51fb\u6536\u96c6\u6587\u672c\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_target_collect.png\" /></p>\n<p>\u4f1a\u5f39\u51fa\u6536\u96c6\u8fdb\u5ea6\u6846\uff0c\u7b49\u5f85\u6536\u96c6\u6210\u529f\uff0c\u4f1a\u663e\u793a\u7eff\u8272\u5bf9\u94a9\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_target_collected.png\" /></p>\n<p>\u5173\u6389\u6536\u96c6\u8fdb\u5ea6\u6846\uff0c\u56de\u5230\u7ffb\u8bd1\u5de5\u5177\u53ef\u4ee5\u770b\u5230\u82f1\u6587\u4e00\u884c\u6709\u663e\u793a\u6536\u96c6\u5230\u7684\u6570\u91cf\uff0c\u672c\u8eab\u82f1\u6587\u7684\u6211\u4eec\u4e0d\u9700\u8981\u7ffb\u8bd1\uff0c\u70b9\u5f00\u4e2d\u6587\u4e00\u884c\u7684\u7ffb\u8bd1\u6309\u94ae\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_go_trans.png\" /></p>\n<p>\u6253\u5f00\u540e\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u672a\u7ffb\u8bd1\u4e00\u680f\u6709\u5185\u5bb9\uff0c\u5728\u82f1\u6587\u6587\u672c\u7684\u53f3\u8fb9\u4e00\u680f\u8f93\u5165\u7ffb\u8bd1\u540e\u7684\u5185\u5bb9\uff0c\u7ffb\u8bd1\u5185\u5bb9\u90fd\u5b8c\u6210\u4e4b\u540e\uff0c\u4fdd\u5b58\u9000\u51fa\u7a97\u53e3\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_trans.png\" /></p>\n<p>\u70b9\u51fb\u7edf\u8ba1\u5b57\u6570\uff0c\u7ed3\u675f\u540e\u80fd\u770b\u5230\u4e2d\u6587\u4e00\u680f\u663e\u793a\u4e86\u7ffb\u8bd1\u7684\u6570\u91cf\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_count.png\" /></p>\n<p>\u6700\u540e\u7f16\u8bd1\u6587\u672c\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_build.png\" /></p>\n<p>\u7ffb\u8bd1\u7684\u6570\u636e\u4f1a\u653e\u5728 <code>Content\\Localization\\EditorPlusTools</code> \u91cc\u9762\uff0c\u6bcf\u79cd\u8bed\u8a00\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u5728 zh-Hans \u91cc\u9762\u80fd\u770b\u5230\u4e24\u4e2a\u6587\u4ef6\uff0c<code>.archive</code> \u662f\u6536\u96c6\u548c\u7ffb\u8bd1\u7684\u6587\u672c\uff0c<code>.locres</code> \u5219\u662f\u7f16\u8bd1\u4e4b\u540e\u7684\u6570\u636e\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_ret.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_ret2.png\" /></p>\n<h2 id=\"_4\">\u7ffb\u8bd1\u597d\u7684\u6587\u672c\u653e\u5165\u63d2\u4ef6\u76ee\u5f55\u4e2d</h2>\n<p>\u6211\u4eec\u4e0a\u9762\u7ed9\u63d2\u4ef6\u751f\u6210\u7684\u7ffb\u8bd1\u6587\u672c\u653e\u5728\u4e86\u9879\u76ee\u76ee\u5f55\u4e0b\u9762\uff0c\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e9b\u6587\u672c\u79fb\u52a8\u5230\u63d2\u4ef6\u91cc\u9762\uff0c\u65b9\u4fbf\u968f\u7740\u63d2\u4ef6\u4e00\u8d77\u53d1\u5e03\u3002</p>\n<p>\u628a <code>Content\\Localization\\EditorPlusTools</code> \u76ee\u5f55\u79fb\u52a8\u5230\u63d2\u4ef6\u76ee\u5f55 Content \u4e0b\u9762\uff0c\u6211\u8fd9\u91cc\u662f <code>Plugins\\UE.EditorPlus\\Content\\Localization\\EditorPlusTools</code>\u3002</p>\n<p>\u4fee\u6539\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6 <code>DefaultEditor.ini</code>\uff0c\u52a0\u4e0a\u65b0\u8def\u5f84\uff1a</p>\n<div class=\"language-ini highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"k\">[Internationalization]</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"na\">+LocalizationPaths</span><span class=\"o\">=</span><span class=\"s\">%GAMEDIR%Plugins/UE.EditorPlus/Content/Localization/EditorPlusTools</span>\n</code></pre></div>\n<p>\u8fd9\u6837\uff0c\u5176\u4ed6\u9879\u76ee\u62ff\u5230\u63d2\u4ef6\u540e\uff0c\u53ea\u8981\u4fee\u6539 <code>DefaultEditor.ini</code> \u5219\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7ffb\u8bd1\u6587\u672c\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u914d\u7f6e\u7ffb\u8bd1\u3002</p>\n<h2 id=\"_5\">\u6ce8\u610f\u4e8b\u9879</h2>\n<p>\u5728\u751f\u6210\u7ffb\u8bd1\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9047\u5230\u8fc7\u4e00\u4e9b\u95ee\u9898\uff0c\u4ee5\u4e0b\u603b\u7ed3\u51fa\u6765\u6ce8\u610f\u7684\u4e8b\u9879\uff1a</p>\n<ul>\n<li>\u4ee3\u7801\u91cc\u9762\u5b9a\u4e49\u6587\u672c\u5fc5\u987b\u8981\u7528\u5b8f <code>LOCTEXT</code> \u548c <code>NSLOCTEXT</code>\uff0c\u6587\u672c\u9700\u8981\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u8fd9\u6837 UE \u624d\u662f\u6536\u96c6\u51fa\u6765\u3002</li>\n<li>\u7ffb\u8bd1\u76ee\u6807\u540d\u5b57\u4e0d\u80fd\u5e26\u6709\u7b26\u53f7 <code>.</code>\uff0c<code>Content\\Localiztion\\</code> \u4e0b\u7684\u76ee\u5f55\u540d\u5b57\u4e0d\u80fd\u5e26\u6709 <code>.</code>\uff0cUE \u53ea\u4f1a\u622a\u53d6 <code>.</code> \u524d\u9762\u7684\u540d\u5b57\u3002\u4f1a\u5bfc\u81f4 UE \u5728\u8bfb\u53d6\u7ffb\u8bd1\u6587\u672c\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u540d\u5b57\u9519\u8bef\uff0c\u8bfb\u53d6\u5931\u8d25\u3002</li>\n<li>\u5bf9\u4e8e\u7f16\u8f91\u5668\u63d2\u4ef6\uff0c\u9700\u8981\u5224\u65ad\u5982\u679c\u662f\u547d\u4ee4\u884c\u6a21\u5f0f <code>IsRunningCommandlet()</code> \u5219\u4e0d\u751f\u6210\u83dc\u5355\u548c SlateUI \uff0c\u56e0\u4e3a\u547d\u4ee4\u884c\u6a21\u5f0f\u4e0b\u6ca1\u6709 Slate \u6a21\u5757\uff0c\u4f1a\u5bfc\u81f4\u6536\u96c6\u6587\u672c\u7684\u65f6\u5019\u62a5\u9519 <code>Assertion failed: CurrentApplication.IsValid()</code>\u3002\u5982\u679c\u4f60\u4e5f\u9047\u5230\u7c7b\u4f3c\u7684\u62a5\u9519\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u52a0\u4e0a\u8fd9\u4e2a\u5224\u65ad\u3002\u5177\u4f53\u62a5\u9519\u4fe1\u606f\uff1a<blockquote>\n<p>Assertion failed: CurrentApplication.IsValid() [File:E:\\UE\\ue5.3_git\\Engine\\Source\\Runtime\\Slate\\Public\\Framework\\Application\\SlateApplication.h] [Line: 255] </p>\n</blockquote>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-localization/tool_error.png\" /></p>\n</li>\n</ul>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-12-28T18:06:38+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E4%BD%BF%E7%94%A8%E8%B7%AF%E5%BE%84%E5%BD%A2%E5%BC%8F%E6%89%A9%E5%B1%95%E8%8F%9C%E5%8D%95/",
            "url": "https://wiki.disenone.site/ue-%E4%BD%BF%E7%94%A8%E8%B7%AF%E5%BE%84%E5%BD%A2%E5%BC%8F%E6%89%A9%E5%B1%95%E8%8F%9C%E5%8D%95/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u4f7f\u7528\u8def\u5f84\u5f62\u5f0f\u6269\u5c55\u83dc\u5355",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u4f7f\u7528\u8def\u5f84\u5f62\u5f0f\u6269\u5c55\u83dc\u5355\" /></p>\n<blockquote>\n<p>\u8bb0\u5f55\u5982\u4f55\u5728 UE \u4e2d\u5b9e\u73b0\u8def\u5f84\u5f62\u5f0f\u6269\u5c55\u83dc\u5355</p>\n</blockquote>\n<p>\u5982\u679c\u4e0d\u719f\u6089 UE \u6269\u5c55\u83dc\u5355\uff0c\u5efa\u8bae\u5148\u7b80\u5355\u770b\u4e0b\uff1a<a href=\"../ue-%E6%89%A9%E5%B1%95%E7%BC%96%E8%BE%91%E5%99%A8%E8%8F%9C%E5%8D%95/\">UE \u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355</a></p>\n<p>\u672c\u6587\u4ee3\u7801\u57fa\u4e8e\u63d2\u4ef6\uff1a<a href=\"https://github.com/disenone/UE.EditorPlus\">UE.EditorPlus</a></p>\n<h2 id=\"_1\">\u8282\u70b9\u7ba1\u7406</h2>\n<p>\u628a\u83dc\u5355\u6309\u7167\u6811\u7684\u7ed3\u6784\u6765\u7ba1\u7406\uff0c\u7236\u8282\u70b9\u53ef\u4ee5\u5305\u542b\u5b69\u5b50\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">EDITORPLUS_API</span><span class=\"w\"> </span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">TSharedFromThis</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"k\">protected</span><span class=\"o\">:</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">    </span><span class=\"c1\">// sub menus</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">    </span><span class=\"n\">TArray</span><span class=\"o\">&lt;</span><span class=\"n\">TSharedRef</span><span class=\"o\">&lt;</span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">Children</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5728\u521b\u5efa\u7236\u8282\u70b9\u7684\u540c\u65f6\u521b\u5efa\u5b50\u8282\u70b9\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusMenuBase::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">Menu</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Children</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">        </span><span class=\"n\">Menu</span><span class=\"o\">-&gt;</span><span class=\"n\">Register</span><span class=\"p\">(</span><span class=\"n\">MenuBuilder</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5f53\u7136\u6bcf\u4e2a\u8282\u70b9\u7684\u5177\u4f53\u521b\u5efa\u884c\u4e3a\u4f1a\u6709\u70b9\u4e0d\u540c\uff0c\u8986\u5199\u865a\u51fd\u6570\u6765\u5b9e\u73b0\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\">// Menubar</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusMenuBar::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBarBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">.</span><span class=\"n\">AddPullDownMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">        </span><span class=\"n\">GetFriendlyName</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">        </span><span class=\"n\">GetFriendlyTips</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">        </span><span class=\"c1\">// Delegate to call Register</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">        </span><span class=\"n\">FEditorPlusMenuManager</span><span class=\"o\">::</span><span class=\"n\">GetDelegate</span><span class=\"o\">&lt;</span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">GetUniqueId</span><span class=\"p\">()),</span><span class=\"w\">       </span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">        </span><span class=\"n\">Hook</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"c1\">// Section</span>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusSection::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">BeginSection</span><span class=\"p\">(</span><span class=\"n\">Hook</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">GetFriendlyName</span><span class=\"p\">());</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">    </span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">::</span><span class=\"n\">Register</span><span class=\"p\">(</span><span class=\"n\">MenuBuilder</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">EndSection</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"c1\">// Separator</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusSeparator::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"w\">    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuSeparator</span><span class=\"p\">(</span><span class=\"n\">Hook</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"w\">    </span><span class=\"n\">FEditorPlusMenuBase</span><span class=\"o\">::</span><span class=\"n\">Register</span><span class=\"p\">(</span><span class=\"n\">MenuBuilder</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a><span class=\"c1\">// SubMenu</span>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusSubMenu::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-30\" name=\"__codelineno-2-30\" href=\"#__codelineno-2-30\"></a><span class=\"w\">    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddSubMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-31\" name=\"__codelineno-2-31\" href=\"#__codelineno-2-31\"></a><span class=\"w\">        </span><span class=\"n\">GetFriendlyName</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-2-32\" name=\"__codelineno-2-32\" href=\"#__codelineno-2-32\"></a><span class=\"w\">        </span><span class=\"n\">GetFriendlyTips</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-2-33\" name=\"__codelineno-2-33\" href=\"#__codelineno-2-33\"></a><span class=\"w\">        </span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateSP</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">FEditorPlusSubMenu</span><span class=\"o\">::</span><span class=\"n\">MakeSubMenu</span><span class=\"p\">),</span>\n<a id=\"__codelineno-2-34\" name=\"__codelineno-2-34\" href=\"#__codelineno-2-34\"></a><span class=\"w\">        </span><span class=\"nb\">false</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-35\" name=\"__codelineno-2-35\" href=\"#__codelineno-2-35\"></a><span class=\"w\">        </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span>\n<a id=\"__codelineno-2-36\" name=\"__codelineno-2-36\" href=\"#__codelineno-2-36\"></a><span class=\"w\">        </span><span class=\"nb\">true</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-37\" name=\"__codelineno-2-37\" href=\"#__codelineno-2-37\"></a><span class=\"w\">        </span><span class=\"n\">Hook</span>\n<a id=\"__codelineno-2-38\" name=\"__codelineno-2-38\" href=\"#__codelineno-2-38\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-39\" name=\"__codelineno-2-39\" href=\"#__codelineno-2-39\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-40\" name=\"__codelineno-2-40\" href=\"#__codelineno-2-40\"></a>\n<a id=\"__codelineno-2-41\" name=\"__codelineno-2-41\" href=\"#__codelineno-2-41\"></a><span class=\"c1\">// Command</span>\n<a id=\"__codelineno-2-42\" name=\"__codelineno-2-42\" href=\"#__codelineno-2-42\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">FEditorPlusCommand::Register</span><span class=\"p\">(</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-43\" name=\"__codelineno-2-43\" href=\"#__codelineno-2-43\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-44\" name=\"__codelineno-2-44\" href=\"#__codelineno-2-44\"></a><span class=\"w\">    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-45\" name=\"__codelineno-2-45\" href=\"#__codelineno-2-45\"></a><span class=\"w\">        </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">Label</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">Tips</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">Icon</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-46\" name=\"__codelineno-2-46\" href=\"#__codelineno-2-46\"></a><span class=\"w\">        </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">ExecuteAction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">Hook</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommandInfo</span><span class=\"o\">-&gt;</span><span class=\"n\">Type</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-47\" name=\"__codelineno-2-47\" href=\"#__codelineno-2-47\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-48\" name=\"__codelineno-2-48\" href=\"#__codelineno-2-48\"></a>\n<a id=\"__codelineno-2-49\" name=\"__codelineno-2-49\" href=\"#__codelineno-2-49\"></a><span class=\"c1\">// ......</span>\n</code></pre></div>\n<h2 id=\"_2\">\u901a\u8fc7\u8def\u5f84\u751f\u6210\u8282\u70b9</h2>\n<p>\u6309\u7167\u6811\u5f62\u7ed3\u6784\u7ec4\u7ec7\u597d\u83dc\u5355\uff0c\u8def\u5f84\u683c\u5f0f\u5c31\u53ef\u4ee5\u5b9a\u4e49\u4e00\u6761\u83dc\u5355\u7684\u6811\u5f62\u7ed3\u6784\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"s\">&quot;/&lt;Hook&gt;Help/&lt;MenuBar&gt;BarTest/&lt;SubMenu&gt;SubTest/&lt;Command&gt;Action&quot;</span>\n</code></pre></div>\n<p>\u4ee5\u4e0a\u8def\u5f84\u5373\u53ef\u4ee5\u5b9a\u4e49\u4e00\u7cfb\u5217\u83dc\u5355\u7684\u521b\u5efa\uff1a</p>\n<ul>\n<li><code>&lt;Hook&gt;Help</code>\uff1a\u4f4d\u7f6e\u5728 Hook \u540d\u5b57\u4e3a Help \u7684\u83dc\u5355\u540e</li>\n<li><code>&lt;MenuBar&gt;BarTest</code>\uff1a\u521b\u5efa\u7c7b\u578b MenuBar \u7684\u83dc\u5355\uff0c\u540d\u5b57\u4e3a BarTest</li>\n<li><code>&lt;SubMenu&gt;SubTest</code>\uff1a\u521b\u5efa\u5b50\u8282\u70b9\uff0c\u7c7b\u578b SubMenu, \u540d\u5b57 SubTest</li>\n<li><code>&lt;Command&gt;Action</code>\uff1a\u6700\u540e\u521b\u5efa\u4e00\u4e2a\u547d\u4ee4</li>\n</ul>\n<p>\u63a5\u53e3\u8c03\u7528\u5f62\u5f0f\u53ef\u4ee5\u5f88\u7b80\u6d01\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FString</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;/&lt;Hook&gt;Help/&lt;MenuBar&gt;BarTest/&lt;SubMenu&gt;SubTest/&lt;Command&gt;Action&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPathAction</span><span class=\"p\">(</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">    </span><span class=\"n\">Path</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">    </span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">        </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<h2 id=\"_3\">\u81ea\u5b9a\u4e49\u5f62\u5f0f\u751f\u6210\u8282\u70b9</h2>\n<p>\u6211\u4eec\u4f9d\u7136\u4fdd\u7559\u4e86\u7b28\u91cd\u7684\u65b9\u5f0f\u6765\u521b\u5efa\u83dc\u5355\uff0c\u7b28\u91cd\u7684\u65b9\u5f0f\u53ef\u4ee5\u5141\u8bb8\u6709\u66f4\u8be6\u7ec6\u7684\u8bbe\u7f6e\uff0c\u4ee3\u7801\u7684\u7ec4\u7ec7\u5f62\u5f0f\u8ddf UE \u7684 SlateUI \u5199\u6cd5\u6709\u4e9b\u50cf\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusMenuBar</span><span class=\"p\">)(</span><span class=\"s\">&quot;BarTest&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"o\">-&gt;</span><span class=\"n\">RegisterPath</span><span class=\"p\">()</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"o\">-&gt;</span><span class=\"n\">Content</span><span class=\"p\">({</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusSubMenu</span><span class=\"p\">)(</span><span class=\"s\">&quot;SubTest&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">Content</span><span class=\"p\">({</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\">        </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;Action&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">        </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">                </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">            </span><span class=\"p\">})),</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"p\">});</span>\n</code></pre></div>\n<h2 id=\"_4\">\u6df7\u5408\u5f62\u5f0f</h2>\n<p>\u5f53\u7136\uff0c\u672c\u8eab\u8def\u5f84\u5f62\u5f0f\u548c\u81ea\u5b9a\u4e49\u751f\u6210\u7684\u83dc\u5355\uff0c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u5b83\u4eec\u4e4b\u95f4\u53ef\u4ee5\u6df7\u7528\uff0c\u6709\u5f88\u5927\u7684\u7075\u6d3b\u6027\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/&lt;MenuBar&gt;BarTest/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;Action1&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">        </span><span class=\"p\">})),</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"p\">);</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">RegisterPath</span><span class=\"p\">(</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">    </span><span class=\"s\">&quot;/&lt;MenuBar&gt;BarTest/&lt;SubMenu&gt;SubMenu/&lt;Command&gt;Action2&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">    </span><span class=\"n\">EP_NEW_MENU</span><span class=\"p\">(</span><span class=\"n\">FEditorPlusCommand</span><span class=\"p\">)(</span><span class=\"s\">&quot;Action2&quot;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">    </span><span class=\"o\">-&gt;</span><span class=\"n\">BindAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">        </span><span class=\"p\">})),</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u591a\u4e2a\u5730\u65b9\u5b9a\u4e49\u7684\u83dc\u5355\uff0c\u4f1a\u5408\u5e76\u5230\u540c\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\u4e2d\uff0c\u540d\u5b57\u76f8\u540c\u7684\u8282\u70b9\u4f1a\u8ba4\u4e3a\u662f\u540c\u4e00\u4e2a\u8282\u70b9\u3002\u6362\u8a00\u4e4b\uff0c\u8def\u5f84\u662f\u552f\u4e00\u7684\uff0c\u540c\u4e00\u4e2a\u8def\u5f84\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u83dc\u5355\u8282\u70b9\u3002\n\u4e8e\u662f\u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u8282\u70b9\u627e\u51fa\u6765\uff0c\u91cd\u65b0\u505a\u4e00\u4e9b\u8bbe\u7f6e\u548c\u4fee\u6539\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\">// set Name and Tips</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"n\">FEditorPlusPath</span><span class=\"o\">::</span><span class=\"n\">GetNodeByPath</span><span class=\"p\">(</span><span class=\"s\">&quot;/&lt;MenuBar&gt;BarTest&quot;</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyName</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">))</span><span class=\"o\">-&gt;</span><span class=\"n\">SetFriendlyTips</span><span class=\"p\">(</span><span class=\"n\">LOCTEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;MenuTestTips&quot;</span><span class=\"p\">));</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-12-28T09:35:18+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E6%89%A9%E5%B1%95%E7%BC%96%E8%BE%91%E5%99%A8%E8%8F%9C%E5%8D%95/",
            "url": "https://wiki.disenone.site/ue-%E6%89%A9%E5%B1%95%E7%BC%96%E8%BE%91%E5%99%A8%E8%8F%9C%E5%8D%95/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355\" /></p>\n<h1 id=\"ue\">UE \u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355</h1>\n<blockquote>\n<p>\u8bb0\u5f55 UE \u5982\u4f55\u6269\u5c55\u7f16\u8f91\u5668\u83dc\u5355</p>\n</blockquote>\n<h2 id=\"hook\">Hook</h2>\n<p>Hook \u53ef\u4ee5\u7406\u89e3\u4e3a\u6269\u5c55\u83dc\u5355\u7684\u951a\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u65b0\u52a0\u7684\u83dc\u5355\u547d\u4ee4\u5728 Hook \u7684\u524d\u9762\u6216\u8005\u540e\u9762\uff0cUE \u81ea\u5e26\u7684\u7f16\u8f91\u5668\u83dc\u5355\u547d\u4ee4\u57fa\u672c\u90fd\u5e26\u6709 Hook\uff0cUE5 \u4e0b\u6253\u5f00 <code>\u7f16\u8f91 - \u7f16\u8f91\u5668\u504f\u597d\u8bbe\u7f6e - \u901a\u7528 - \u5176\u4ed6 - \u663e\u793a UI \u6269\u5c55\u70b9</code> \u6765\u663e\u793a\u6240\u6709\u83dc\u5355\u7684 Hook\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/show_hook.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/show_hook2.png\" /></p>\n<h2 id=\"_1\">\u6a21\u5757\u4f9d\u8d56</h2>\n<p>\u9700\u8981\u5728\u9879\u76ee .Build.cs \u6587\u4ef6\u91cc\u9762\u52a0\u4e0a\u4f9d\u8d56\u7684\u6a21\u5757 LevelEditor, Slate, SlateCore, EditorStyle, EditorWidgets, UnrealEd, ToolMenus\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"n\">PrivateDependencyModuleNames</span><span class=\"p\">.</span><span class=\"n\">AddRange</span><span class=\"p\">(</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"kt\">string</span><span class=\"p\">[]</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">        </span><span class=\"s\">&quot;Core&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">        </span><span class=\"s\">&quot;Engine&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">        </span><span class=\"s\">&quot;CoreUObject&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">        </span><span class=\"s\">&quot;LevelEditor&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">        </span><span class=\"s\">&quot;Slate&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">        </span><span class=\"s\">&quot;SlateCore&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">        </span><span class=\"s\">&quot;EditorStyle&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">        </span><span class=\"s\">&quot;EditorWidgets&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">        </span><span class=\"s\">&quot;UnrealEd&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">        </span><span class=\"s\">&quot;ToolMenus&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n</code></pre></div>\n<h2 id=\"_2\">\u6dfb\u52a0\u83dc\u5355\u680f</h2>\n<p>\u76f4\u63a5\u4e0a\u4ee3\u7801</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">MenuExtender</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MakeShared</span><span class=\"o\">&lt;</span><span class=\"n\">FExtender</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"n\">MenuExtender</span><span class=\"o\">-&gt;</span><span class=\"n\">AddMenuBarExtension</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"s\">&quot;Help&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EExtensionHook</span><span class=\"o\">::</span><span class=\"n\">After</span><span class=\"p\">,</span><span class=\"w\">      </span><span class=\"c1\">// Create After Help</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"k\">nullptr</span><span class=\"p\">,</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"n\">FMenuBarExtensionDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBarBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">        </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">.</span><span class=\"n\">AddPullDownMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">            </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">),</span><span class=\"w\">       </span><span class=\"c1\">// Name</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">            </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">),</span><span class=\"w\">       </span><span class=\"c1\">// Tips</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">            </span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">                </span><span class=\"c1\">// create sub menus</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">            </span><span class=\"p\">}),</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">            </span><span class=\"n\">TEXT</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuText&quot;</span><span class=\"p\">));</span><span class=\"w\">      </span><span class=\"c1\">// New Hook</span>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"p\">);</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"n\">FModuleManager</span><span class=\"o\">::</span><span class=\"n\">LoadModuleChecked</span><span class=\"o\">&lt;</span><span class=\"n\">FLevelEditorModule</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;LevelEditor&quot;</span><span class=\"p\">).</span><span class=\"n\">GetMenuExtensibilityManager</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">AddExtender</span><span class=\"p\">(</span><span class=\"n\">MenuExtender</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u6267\u884c\u4ee5\u4e0a\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u5728 \u5e2e\u52a9 \u540e\u9762\u52a0\u4e0a\u4e86\u4e00\u4e2a\u83dc\u5355\u680f MenuTest:</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/bar.png\" /></p>\n<h2 id=\"_3\">\u6dfb\u52a0\u547d\u4ee4</h2>\n<p>\u4f7f\u7528\u63a5\u53e3 <code>MenuBuilder.AddMenuEntry</code>\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\">// Inside MenuTest Lambda</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">        </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"p\">})));</span>\n</code></pre></div>\n<p>\u628a\u4ee5\u4e0a\u4ee3\u7801\u653e\u5230 CreateLambda \u91cc\u9762\uff0c\u5373\u53ef\u751f\u6210\u83dc\u5355\u547d\u4ee4\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/action.png\" /></p>\n<h2 id=\"_4\">\u83dc\u5355\u5206\u8282</h2>\n<p>\u4f7f\u7528 <code>MenuBuilder.BeginSection</code> \u548c <code>MenuBuilder.EndSection</code>\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">BeginSection</span><span class=\"p\">(</span><span class=\"n\">NAME_None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSection&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"c1\">// code to create action</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">EndSection</span><span class=\"p\">();</span>\n</code></pre></div>\n<h2 id=\"_5\">\u5206\u9694\u7b26</h2>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuSeparator</span><span class=\"p\">();</span>\n</code></pre></div>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/section%26sperator.png\" /></p>\n<h2 id=\"_6\">\u5b50\u83dc\u5355</h2>\n<p>\u5b50\u83dc\u5355\u7c7b\u4f3c\u83dc\u5355\u680f\uff0c\u9700\u8981\u5728 Lambda \u91cc\u9762\u5b9a\u4e49\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddSubMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"w\">    </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSub&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"w\">    </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSub&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"w\">    </span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\">        </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">            </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">            </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">                </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">            </span><span class=\"p\">})));</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\">    </span><span class=\"p\">}));</span>\n</code></pre></div>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/submenu.png\" /></p>\n<h1 id=\"slateui\">SlateUI \u63a7\u4ef6</h1>\n<p>\u8fd8\u53ef\u4ee5\u6dfb\u52a0 UI \u63a7\u4ef6\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddWidget</span><span class=\"p\">(</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"w\">    </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SHorizontalBox</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">        </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">SHorizontalBox</span><span class=\"o\">::</span><span class=\"n\">Slot</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">AutoWidth</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">        </span><span class=\"p\">[</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">            </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SEditableTextBox</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">MinDesiredWidth</span><span class=\"p\">(</span><span class=\"mi\">50</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestWidget&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">        </span><span class=\"p\">]</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">        </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">SHorizontalBox</span><span class=\"o\">::</span><span class=\"n\">Slot</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">AutoWidth</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">Padding</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">        </span><span class=\"p\">[</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">        </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SButton</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;ExtendWidget&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">OnClicked</span><span class=\"p\">(</span><span class=\"n\">FOnClicked</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">FReply</span><span class=\"o\">::</span><span class=\"n\">Handled</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"w\">        </span><span class=\"p\">}))</span>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"w\">        </span><span class=\"p\">],</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"w\">    </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/widget.png\" /></p>\n<p>Slate UI \u76f8\u5173\u7684\u5185\u5bb9\u8fd9\u91cc\u4e0d\u8be6\u7ec6\u5c55\u5f00\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u53bb\u53e6\u5916\u627e\u6587\u7ae0\u770b\u3002</p>\n<h1 id=\"hook_1\">Hook \u589e\u52a0\u83dc\u5355</h1>\n<p>\u8b6c\u5982\u5728 <code>\u5de5\u5177 - \u7f16\u7a0b</code> \u91cc\u9762\u589e\u52a0\u4e00\u4e2a\u547d\u4ee4\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"n\">MenuExtender</span><span class=\"o\">-&gt;</span><span class=\"n\">AddMenuExtension</span><span class=\"p\">(</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"w\">    </span><span class=\"s\">&quot;Programming&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EExtensionHook</span><span class=\"o\">::</span><span class=\"n\">After</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"k\">nullptr</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">    </span><span class=\"n\">FMenuExtensionDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">        </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">        </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">        </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">        </span><span class=\"p\">})));</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"p\">);</span>\n</code></pre></div>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/other_hook.png\" /></p>\n<p>\u540c\u7406\u53ef\u4ee5\u6dfb\u52a0\u5176\u4ed6\u83dc\u5355\u7c7b\u578b\u3002</p>\n<h1 id=\"_7\">\u5b8c\u6574\u4ee3\u7801</h1>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">BuildTestMenu</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">MenuExtender</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MakeShared</span><span class=\"o\">&lt;</span><span class=\"n\">FExtender</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">    </span><span class=\"n\">MenuExtender</span><span class=\"o\">-&gt;</span><span class=\"n\">AddMenuBarExtension</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">        </span><span class=\"s\">&quot;Help&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EExtensionHook</span><span class=\"o\">::</span><span class=\"n\">After</span><span class=\"p\">,</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">        </span><span class=\"k\">nullptr</span><span class=\"p\">,</span>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">        </span><span class=\"n\">FMenuBarExtensionDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBarBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"w\">            </span><span class=\"n\">MenuBarBuilder</span><span class=\"p\">.</span><span class=\"n\">AddPullDownMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">                </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"w\">                </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">                </span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">                </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">BeginSection</span><span class=\"p\">(</span><span class=\"n\">NAME_None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSection&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuSeparator</span><span class=\"p\">();</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"w\">                        </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">                        </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">                        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a><span class=\"w\">                            </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a><span class=\"w\">                        </span><span class=\"p\">})));</span>\n<a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a>\n<a id=\"__codelineno-8-24\" name=\"__codelineno-8-24\" href=\"#__codelineno-8-24\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddSubMenu</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-25\" name=\"__codelineno-8-25\" href=\"#__codelineno-8-25\"></a><span class=\"w\">                        </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubb&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-26\" name=\"__codelineno-8-26\" href=\"#__codelineno-8-26\"></a><span class=\"w\">                        </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubb&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-27\" name=\"__codelineno-8-27\" href=\"#__codelineno-8-27\"></a><span class=\"w\">                        </span><span class=\"n\">FNewMenuDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-28\" name=\"__codelineno-8-28\" href=\"#__codelineno-8-28\"></a><span class=\"w\">                        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-29\" name=\"__codelineno-8-29\" href=\"#__codelineno-8-29\"></a><span class=\"w\">                            </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-30\" name=\"__codelineno-8-30\" href=\"#__codelineno-8-30\"></a><span class=\"w\">                                </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestSubAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-31\" name=\"__codelineno-8-31\" href=\"#__codelineno-8-31\"></a><span class=\"w\">                                </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-8-32\" name=\"__codelineno-8-32\" href=\"#__codelineno-8-32\"></a><span class=\"w\">                                </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-33\" name=\"__codelineno-8-33\" href=\"#__codelineno-8-33\"></a><span class=\"w\">                                    </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-8-34\" name=\"__codelineno-8-34\" href=\"#__codelineno-8-34\"></a><span class=\"w\">                                </span><span class=\"p\">})));</span>\n<a id=\"__codelineno-8-35\" name=\"__codelineno-8-35\" href=\"#__codelineno-8-35\"></a><span class=\"w\">                        </span><span class=\"p\">}));</span>\n<a id=\"__codelineno-8-36\" name=\"__codelineno-8-36\" href=\"#__codelineno-8-36\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">EndSection</span><span class=\"p\">();</span>\n<a id=\"__codelineno-8-37\" name=\"__codelineno-8-37\" href=\"#__codelineno-8-37\"></a>\n<a id=\"__codelineno-8-38\" name=\"__codelineno-8-38\" href=\"#__codelineno-8-38\"></a><span class=\"w\">                    </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddWidget</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-39\" name=\"__codelineno-8-39\" href=\"#__codelineno-8-39\"></a><span class=\"w\">                    </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SHorizontalBox</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-40\" name=\"__codelineno-8-40\" href=\"#__codelineno-8-40\"></a><span class=\"w\">                         </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">SHorizontalBox</span><span class=\"o\">::</span><span class=\"n\">Slot</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-41\" name=\"__codelineno-8-41\" href=\"#__codelineno-8-41\"></a><span class=\"w\">                         </span><span class=\"p\">.</span><span class=\"n\">AutoWidth</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-42\" name=\"__codelineno-8-42\" href=\"#__codelineno-8-42\"></a><span class=\"w\">                         </span><span class=\"p\">[</span>\n<a id=\"__codelineno-8-43\" name=\"__codelineno-8-43\" href=\"#__codelineno-8-43\"></a><span class=\"w\">                             </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SEditableTextBox</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-44\" name=\"__codelineno-8-44\" href=\"#__codelineno-8-44\"></a><span class=\"w\">                             </span><span class=\"p\">.</span><span class=\"n\">MinDesiredWidth</span><span class=\"p\">(</span><span class=\"mi\">50</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-45\" name=\"__codelineno-8-45\" href=\"#__codelineno-8-45\"></a><span class=\"w\">                             </span><span class=\"p\">.</span><span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestWidget&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-46\" name=\"__codelineno-8-46\" href=\"#__codelineno-8-46\"></a><span class=\"w\">                         </span><span class=\"p\">]</span>\n<a id=\"__codelineno-8-47\" name=\"__codelineno-8-47\" href=\"#__codelineno-8-47\"></a><span class=\"w\">                         </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">SHorizontalBox</span><span class=\"o\">::</span><span class=\"n\">Slot</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-48\" name=\"__codelineno-8-48\" href=\"#__codelineno-8-48\"></a><span class=\"w\">                         </span><span class=\"p\">.</span><span class=\"n\">AutoWidth</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-49\" name=\"__codelineno-8-49\" href=\"#__codelineno-8-49\"></a><span class=\"w\">                         </span><span class=\"p\">.</span><span class=\"n\">Padding</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-50\" name=\"__codelineno-8-50\" href=\"#__codelineno-8-50\"></a><span class=\"w\">                         </span><span class=\"p\">[</span>\n<a id=\"__codelineno-8-51\" name=\"__codelineno-8-51\" href=\"#__codelineno-8-51\"></a><span class=\"w\">                            </span><span class=\"n\">SNew</span><span class=\"p\">(</span><span class=\"n\">SButton</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-52\" name=\"__codelineno-8-52\" href=\"#__codelineno-8-52\"></a><span class=\"w\">                            </span><span class=\"p\">.</span><span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;ExtendWidget&quot;</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-53\" name=\"__codelineno-8-53\" href=\"#__codelineno-8-53\"></a><span class=\"w\">                            </span><span class=\"p\">.</span><span class=\"n\">OnClicked</span><span class=\"p\">(</span><span class=\"n\">FOnClicked</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-8-54\" name=\"__codelineno-8-54\" href=\"#__codelineno-8-54\"></a><span class=\"w\">                            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-55\" name=\"__codelineno-8-55\" href=\"#__codelineno-8-55\"></a><span class=\"w\">                                </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-8-56\" name=\"__codelineno-8-56\" href=\"#__codelineno-8-56\"></a><span class=\"w\">                                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">FReply</span><span class=\"o\">::</span><span class=\"n\">Handled</span><span class=\"p\">();</span>\n<a id=\"__codelineno-8-57\" name=\"__codelineno-8-57\" href=\"#__codelineno-8-57\"></a><span class=\"w\">                            </span><span class=\"p\">}))</span>\n<a id=\"__codelineno-8-58\" name=\"__codelineno-8-58\" href=\"#__codelineno-8-58\"></a><span class=\"w\">                         </span><span class=\"p\">],</span>\n<a id=\"__codelineno-8-59\" name=\"__codelineno-8-59\" href=\"#__codelineno-8-59\"></a><span class=\"w\">                     </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">GetEmpty</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-60\" name=\"__codelineno-8-60\" href=\"#__codelineno-8-60\"></a><span class=\"w\">                    </span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-61\" name=\"__codelineno-8-61\" href=\"#__codelineno-8-61\"></a><span class=\"w\">                </span><span class=\"p\">}),</span>\n<a id=\"__codelineno-8-62\" name=\"__codelineno-8-62\" href=\"#__codelineno-8-62\"></a><span class=\"w\">                </span><span class=\"s\">&quot;MenuTest&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-63\" name=\"__codelineno-8-63\" href=\"#__codelineno-8-63\"></a><span class=\"w\">        </span><span class=\"p\">})</span>\n<a id=\"__codelineno-8-64\" name=\"__codelineno-8-64\" href=\"#__codelineno-8-64\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-65\" name=\"__codelineno-8-65\" href=\"#__codelineno-8-65\"></a>\n<a id=\"__codelineno-8-66\" name=\"__codelineno-8-66\" href=\"#__codelineno-8-66\"></a><span class=\"w\">    </span><span class=\"n\">MenuExtender</span><span class=\"o\">-&gt;</span><span class=\"n\">AddMenuExtension</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-67\" name=\"__codelineno-8-67\" href=\"#__codelineno-8-67\"></a><span class=\"w\">        </span><span class=\"s\">&quot;Programming&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EExtensionHook</span><span class=\"o\">::</span><span class=\"n\">After</span><span class=\"p\">,</span>\n<a id=\"__codelineno-8-68\" name=\"__codelineno-8-68\" href=\"#__codelineno-8-68\"></a><span class=\"w\">        </span><span class=\"k\">nullptr</span><span class=\"p\">,</span>\n<a id=\"__codelineno-8-69\" name=\"__codelineno-8-69\" href=\"#__codelineno-8-69\"></a><span class=\"w\">        </span><span class=\"n\">FMenuExtensionDelegate</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([](</span><span class=\"n\">FMenuBuilder</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">MenuBuilder</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-70\" name=\"__codelineno-8-70\" href=\"#__codelineno-8-70\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-71\" name=\"__codelineno-8-71\" href=\"#__codelineno-8-71\"></a><span class=\"w\">            </span><span class=\"n\">MenuBuilder</span><span class=\"p\">.</span><span class=\"n\">AddMenuEntry</span><span class=\"p\">(</span>\n<a id=\"__codelineno-8-72\" name=\"__codelineno-8-72\" href=\"#__codelineno-8-72\"></a><span class=\"w\">            </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">FText</span><span class=\"o\">::</span><span class=\"n\">FromName</span><span class=\"p\">(</span><span class=\"s\">&quot;MenuTestAction&quot;</span><span class=\"p\">),</span>\n<a id=\"__codelineno-8-73\" name=\"__codelineno-8-73\" href=\"#__codelineno-8-73\"></a><span class=\"w\">            </span><span class=\"n\">FSlateIcon</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">FUIAction</span><span class=\"p\">(</span><span class=\"n\">FExecuteAction</span><span class=\"o\">::</span><span class=\"n\">CreateLambda</span><span class=\"p\">([]()</span>\n<a id=\"__codelineno-8-74\" name=\"__codelineno-8-74\" href=\"#__codelineno-8-74\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-75\" name=\"__codelineno-8-75\" href=\"#__codelineno-8-75\"></a><span class=\"w\">                </span><span class=\"c1\">// do action</span>\n<a id=\"__codelineno-8-76\" name=\"__codelineno-8-76\" href=\"#__codelineno-8-76\"></a><span class=\"w\">            </span><span class=\"p\">})));</span>\n<a id=\"__codelineno-8-77\" name=\"__codelineno-8-77\" href=\"#__codelineno-8-77\"></a><span class=\"w\">        </span><span class=\"p\">})</span>\n<a id=\"__codelineno-8-78\" name=\"__codelineno-8-78\" href=\"#__codelineno-8-78\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-79\" name=\"__codelineno-8-79\" href=\"#__codelineno-8-79\"></a>\n<a id=\"__codelineno-8-80\" name=\"__codelineno-8-80\" href=\"#__codelineno-8-80\"></a><span class=\"w\">    </span><span class=\"n\">FModuleManager</span><span class=\"o\">::</span><span class=\"n\">LoadModuleChecked</span><span class=\"o\">&lt;</span><span class=\"n\">FLevelEditorModule</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;LevelEditor&quot;</span><span class=\"p\">).</span><span class=\"n\">GetMenuExtensibilityManager</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">AddExtender</span><span class=\"p\">(</span><span class=\"n\">MenuExtender</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-81\" name=\"__codelineno-8-81\" href=\"#__codelineno-8-81\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-extend_menu/overall.png\" /></p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-12-25T17:20:26+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/contact-and-subscribe/",
            "url": "https://wiki.disenone.site/contact-and-subscribe/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Contact and Subscribe",
            "content_html": "<h1 id=\"contact-and-subscribe\">Contact and Subscribe</h1>\n<!-- no translate -->\n\n<p><a href=\"https://github.com/disenone\"><img alt=\"badge\" src=\"https://img.shields.io/badge/GitHub-282c34?&amp;style=for-the-badge\" /></a>\n<a href=\"mailto:disenonec@gmail.com\"><img alt=\"badge\" src=\"https://img.shields.io/badge/Email-f48222?&amp;style=for-the-badge\" /></a></p>\n<p><a href=\"https://wiki.disenone.site/sitemap.xml\"><img alt=\"badge\" loading=\"lazy\" src=\"https://img.shields.io/badge/Sitemap-green?&amp;style=flat-square\" /></a>\n<a href=\"https://wiki.disenone.site/feed_rss_created.xml\"><img alt=\"badge\" loading=\"lazy\" src=\"https://img.shields.io/badge/RSS-post%20created-pcf?&amp;style=flat-square\" /></a>\n<a href=\"https://wiki.disenone.site/feed_rss_updated.xml\"><img alt=\"badge\" loading=\"lazy\" src=\"https://img.shields.io/badge/RSS-post%20updated-yellowgreen?&amp;style=flat-square\" /></a></p>",
            "image": null,
            "date_published": "2023-12-02T05:09:54+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E4%BD%BF%E7%94%A8FASTBuild%E7%BC%96%E8%AF%91UE4%E5%92%8CUE5/",
            "url": "https://wiki.disenone.site/ue-%E4%BD%BF%E7%94%A8FASTBuild%E7%BC%96%E8%AF%91UE4%E5%92%8CUE5/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "\u4f7f\u7528 FASTBuild \u7f16\u8bd1 UE4 \u548c UE5",
            "content_html": "<p><meta property=\"og:title\" content=\"\u4f7f\u7528 FASTBuild \u7f16\u8bd1 UE4 \u548c UE5\" /></p>\n<blockquote>\n<p>\u672c\u6587\u65b9\u6cd5\u7ecf\u6d4b\u8bd5\u652f\u6301 UE4.27 - UE5.3\uff0c\u5176\u4ed6\u7248\u672c\u672a\u6d4b\u8bd5\u8fc7\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u3002</p>\n</blockquote>\n<h2 id=\"_1\">\u524d\u8a00</h2>\n<p><a href=\"https://www.fastbuild.org/docs/home.html\">FASTBuild</a> \u662f\u4e00\u4e2a\u514d\u8d39\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u7f16\u8bd1\u5de5\u5177\uff0cUE \u672c\u8eab\u7f16\u8bd1\u6bd4\u8f83\u8017\u65f6\uff0c\u5982\u679c\u53ef\u4ee5\u7528\u4e0a FASTBuild\uff0c\u80fd\u591f\u5927\u5927\u51cf\u5c11\u8017\u65f6\u3002</p>\n<p>UE \u4ece 4.x \u5f00\u59cb\u80fd\u591f\u652f\u6301 FASTBuild\uff0c\u5b98\u65b9\u6e90\u7801\u81ea\u5e26\u4e86\u9b54\u6539\u8fc7\u7684 FASTBuild \u5de5\u5177\uff0c\u57fa\u4e8e FASTBuild 0.99 \u7248\u672c\uff0c\u4f4d\u7f6e\u5728 <code>Engine\\Extras\\ThirdPartyNotUE\\FASTBuild</code>\uff0cUE5.3 \u540c\u6837\u4f7f\u7528\u7684\u662f\u8fd9\u4e2a\u7248\u672c\u3002\u8fd9\u4e2a\u5df2\u7ecf\u662f\u6bd4\u8f83\u4e45\u4ee5\u524d\u7684\u7248\u672c\u4e86\uff0c\u622a\u6b62\u672c\u6587\u521b\u5efa\u65f6\u95f4\uff0cFASTBuild \u5b98\u65b9\u6700\u65b0\u7248\u672c\u662f 1.11\uff0c\u6709\u4e86\u66f4\u591a\u65b0\u7684\u529f\u80fd\u652f\u6301\u548c bug \u4fee\u590d\u3002\u672c\u6587\u7740\u91cd\u8bb0\u5f55\u5982\u4f55\u4f7f\u7528 1.11 \u7248\u672c\u540c\u65f6\u652f\u6301 UE4 \u548c UE5\u3002</p>\n<h2 id=\"_2\">\u7b80\u6613\u914d\u7f6e</h2>\n<p>\u8981\u8fbe\u5230\u76ee\u7684\uff0c\u6211\u4eec\u9700\u8981\u5bf9 FASTBuild 1.11 \u548c UE \u6e90\u7801\u505a\u4e00\u4e9b\u4fee\u6539\u3002\u5728\u8fd9\u91cc\uff0c\u5176\u5b9e\u6211\u5df2\u7ecf\u90fd\u4fee\u6539\u5b8c\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528\u6211\u4fee\u6539\u5b8c\u7684\u7248\u672c\u6765\u4f7f\u7528\u3002</p>\n<p>FASTBuild \u4e0b\u8f7d\u6211\u63d0\u4ea4\u7684 <a href=\"https://github.com/disenone/fastbuild/releases\">\u6700\u65b0\u7248\u672c</a> \u91cc\u9762\u7684\u6267\u884c\u6587\u4ef6 FBuild.exe, FBuildCoordinator.exe, FBuildWorker.exe\u3002\u4e3a\u4e86\u6e05\u6670\u8868\u8fbe\uff0c\u4e0b\u9762\u628a\u4f7f\u7528 FBuild.exe \u6765\u8fdb\u884c\u7f16\u7a0b\u7684\u673a\u5668\u53eb\u505a<code>\u672c\u673a</code>\uff0c\u5176\u4ed6\u63d0\u4f9b CPU \u53c2\u4e0e\u7f16\u8f91\u7684\u8fdc\u7a0b\u673a\u5668\u53eb\u505a<code>\u8fdc\u7a0b\u673a</code>\u3002</p>\n<h3 id=\"_3\">\u672c\u673a\u914d\u7f6e</h3>\n<p>\u628a FBuild.exe \u6240\u5728\u76ee\u5f55\u52a0\u5165\u7cfb\u7edf\u73af\u5883\u53d8\u91cf Path \u4e2d\uff0c\u4fdd\u8bc1 cmd \u91cc\u9762\u80fd\u76f4\u63a5\u6267\u884c FBuild.exe\u3002</p>\n<p>\u914d\u7f6e Cache \u5171\u4eab\u76ee\u5f55\uff08\u5982\u679c\u4e0d\u9700\u8981\u751f\u6210 Cache \u7684\u8bdd\uff0c\u53ef\u4ee5\u4e0d\u914d\u7f6e\uff09\uff1a\u628a\u4e00\u4e2a\u7a7a\u76ee\u5f55\u8bbe\u7f6e\u6210\u5171\u4eab\u8def\u5f84\uff0c\u5e76\u786e\u8ba4\u8fdc\u7a0b\u673a\u53ef\u4ee5\u8bbf\u95ee\u3002</p>\n<p>\u6253\u5f00\u672c\u673a UE4 / UE5 \u7684\u6e90\u7801\u9879\u76ee\uff0c\u4fee\u6539\u7f16\u8bd1\u914d\u7f6e\u6587\u4ef6 Engine\\Saved\\UnrealBuildTool\\BuildConfiguration.xml \u5982\u4e0b\uff1a</p>\n<div class=\"language-xml highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"nt\">&lt;Configuration</span><span class=\"w\"> </span><span class=\"na\">xmlns=</span><span class=\"s\">&quot;https://www.unrealengine.com/BuildConfiguration&quot;</span><span class=\"nt\">&gt;</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;BuildConfiguration&gt;</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bAllowFASTBuild&gt;</span>true<span class=\"nt\">&lt;/bAllowFASTBuild&gt;</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;/BuildConfiguration&gt;</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;FASTBuild&gt;</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bEnableDistribution&gt;</span>true<span class=\"nt\">&lt;/bEnableDistribution&gt;</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bEnableCaching&gt;</span>true<span class=\"nt\">&lt;/bEnableCaching&gt;</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildCachePath&gt;</span>\\\\127.0.0.1\\Cache\\<span class=\"nt\">&lt;/FBuildCachePath&gt;</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildCoordinator&gt;</span>127.0.0.1<span class=\"nt\">&lt;/FBuildCoordinator&gt;</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;/FASTBuild&gt;</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"nt\">&lt;/Configuration&gt;</span>\n</code></pre></div>\n<p>\u672c\u673a\u8fd0\u884c\u4e4b\u524d\u4e0b\u8f7d\u7684 FBuildCoordinator.exe\u3002</p>\n<h3 id=\"_4\">\u8fdc\u7a0b\u673a\u914d\u7f6e</h3>\n<p>\u540c\u6837\u914d\u7f6e Cache\uff0c\u53ea\u662f ip \u9700\u8981\u6307\u5b9a\u5230\u672c\u673a ip\uff0c\u8fd9\u91cc\u5047\u5b9a\u4e3a 192.168.1.100</p>\n<ul>\n<li>FASTBUILD_CACHE_PATH: \\192.168.1.100\\Cache</li>\n<li>FASTBUILD_CACHE_MODE: rw</li>\n</ul>\n<p>\u540c\u6837\u914d\u7f6e Coordinator ip</p>\n<ul>\n<li>FASTBUILD_COORDINATOR: 192.168.1.100</li>\n</ul>\n<p>\u914d\u7f6e\u5b8c\u5982\u4e0b\u56fe</p>\n<p><img alt=\"\" src=\"../assets/img/2023-ue-fastbuild/remote_vars.png\" /></p>\n<p>\u8fdc\u7a0b\u673a\u4e0a\u8fd0\u884c FBuildWorker.exe\uff0c\u5982\u679c\u914d\u7f6e\u6210\u529f\uff0c\u53ef\u4ee5\u770b\u5230\u672c\u673a\u7684 FBuildCoordinator.exe \u4e0a\u4f1a\u6253\u5370\u65e5\u5fd7\uff08\u8fd9\u91cc 192.168.1.101 \u662f\u8fdc\u7a0b\u673a\u7684 ip\uff09\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>FBuildCoordinator - v1.11-UE\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>[2023-12-01-20:06:38] Listening on port 31392\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a>[2023-12-01-20:06:38] current [0] workers: []\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>[2023-12-01-20:06:42] New worker available: 192.168.1.101\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a>[2023-12-01-20:06:42] current [1] workers: [192.168.1.101]\n</code></pre></div>\n<h3 id=\"ue\">\u6d4b\u8bd5 UE \u7f16\u8bd1</h3>\n<p>\u7528 VisualStudio \u6253\u5f00 UE \u6e90\u7801\u5de5\u7a0b sln\uff0c\u9009\u4e00\u4e2a C++ \u7684\u9879\u76ee\uff0c\u70b9\u51fb Rebuild\u3002\u5982\u679c\u914d\u7f6e\u6b63\u5e38\uff0c\u53ef\u4ee5\u770b\u5230\u7c7b\u4f3c\u5982\u4e0b\u7684\u65e5\u5fd7</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>11&gt;FBuild Command Line Arguments: &#39;-monitor -summary -dist -cache -ide -j12 -clean -config &quot;E:\\UE\\ue5.3_git\\Engine\\Intermediate\\Build\\fbuild.bff&quot; -nostoponerror\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>11&gt;FBuild Executable: &#39;d:\\libs\\FASTBuild\\bin\\FBuild.exe\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>11&gt;FBuild Coordinator: &#39;127.0.0.1\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>11&gt;FBuild BrokeragePath: &#39;\\\\127.0.0.1\\Brokerage\\\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>11&gt;FBuild CachePath: &#39;\\\\127.0.0.1\\Cache\\\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>11&gt;BFF file &#39;E:\\UE\\ue5.3_git\\Engine\\Intermediate\\Build\\fbuild.bff&#39; has changed (reparsing will occur).\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a>11&gt;Using Coordinator: 127.0.0.1\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a>11&gt;Requesting worker list from Corrdinator\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a>11&gt;Get Worker List from Coordinator.\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a>11&gt;2 workers in payload: [192.168.1.101]\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a>11&gt;Worker list received: 1 workers\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a>11&gt;Distributed Compilation : 1 Workers in pool &#39;127.0.0.1&#39;\n</code></pre></div>\n<p>FASTBuild \u80fd\u627e\u5230\u8fdc\u7a0b\u673a\u7684 ip\uff0c\u5e76\u5f00\u59cb\u7ed9\u8fdc\u7a0b\u673a\u53d1\u9001\u7f16\u8bd1\u3002\u5728\u8fdc\u7a0b\u673a\u7684 FBuildWorker \u4e0a\u4e5f\u80fd\u770b\u5230\u5f53\u524d\u6709\u7f16\u8bd1\u4efb\u52a1\u5728\u6267\u884c\u3002</p>\n<h2 id=\"_5\">\u8fdb\u9636\u914d\u7f6e</h2>\n<h3 id=\"ue_1\">\u652f\u6301\u66f4\u4e45\u7248\u672c\u7684 UE</h3>\n<p>\u5982\u679c\u4f60\u53d1\u73b0\u81ea\u5df1\u7684 UE \u6ca1\u6709 FASTBuild \u5de5\u5177\uff08Engine\\Extras\\ThirdPartyNotUE\\FASTBuild\uff09\uff0c\u5e76\u4e14\u9879\u76ee UnrealBuildTool \u91cc\u9762\u6ca1\u6709 FASTBuild.cs \u6587\u4ef6\uff0c\u90a3\u4e48\u5f88\u5927\u6982\u7387\u662f\u4f60\u7684 UE \u7248\u672c\u8fd8\u4e0d\u652f\u6301 FASTBuild\u3002</p>\n<p>\u90a3\u4e48\u4f60\u9700\u8981\u53c2\u8003 UE4.27 \u7684\u6e90\u7801\uff0c\u4e5f\u521b\u5efa\u4e00\u4e2a\u7c7b\u4f3c\u7684 FASTBuild.cs\uff0c\u5e76\u8865\u4e0a\u5176\u4ed6\u76f8\u5173\u4ee3\u7801\u7684\u4fee\u6539\uff0c\u8fd9\u91cc\u4e0d\u8be6\u8ff0\u3002</p>\n<h3 id=\"fastbuild\">\u7f16\u8bd1\u81ea\u5df1\u7684 FASTBuild</h3>\n<p>\u5982\u679c\u4f60\u5bf9 FASTBuild \u672c\u8eab\u4e5f\u611f\u5174\u8da3\uff0c\u6216\u8005\u60f3\u8981\u505a\u4e00\u4e9b\u4fee\u6539\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u7528 FASTBuild \u6765\u7f16\u8bd1 FASTBuild\u3002</p>\n<ul>\n<li>\u4e0b\u8f7d\u6211\u7684 <a href=\"https://github.com/disenone/fastbuild/releases\">\u6700\u65b0\u6e90\u7801</a>\uff0c\u5e76\u89e3\u538b</li>\n<li>\u4fee\u6539 External\\SDK\\VisualStudio\\VS2019.bff\uff0c\u628a .VS2019_BasePath \u548c .VS2019_Version \u4fee\u6539\u6210\u4f60\u672c\u673a\u5bf9\u5e94\u7684\u5185\u5bb9\uff0cVersion \u53ef\u4ee5\u5728 .VS2019_BasePath\\Tools\\MSVC \u76ee\u5f55\u4e0b\u9762\u770b\uff0c\u4f8b\u5982\n    <div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>.VS2019_BasePath        = &#39;C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Professional\\VC&#39;    // &lt;-- Set path here\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>.VS2019_Version         = &#39;14.29.30133&#39; // &lt;-- Set version here\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>.VS2019_MSC_VER         = &#39;1929&#39; // &lt;-- Set MSC_VER here\n</code></pre></div></li>\n</ul>\n<ul>\n<li>\u4fee\u6539 External\\SDK\\Windows\\Windows10SDK.bff \u7684 .Windows10_SDKBasePath \u548c .Windows10_SDKVersion\uff0c\u7248\u672c\u53ef\u4ee5\u5728 .Windows10_SDKBasePath/bin \u91cc\u9762\u770b\uff1a\n    <div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a>.Windows10_SDKBasePath        = &#39;C:\\Program Files (x86)\\Windows Kits/10&#39;    // &lt;-- Set path here\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>.Windows10_SDKVersion         = &#39;10.0.19041.0&#39; // &lt;-- Set version here\n</code></pre></div></li>\n</ul>\n<ul>\n<li>\u4fee\u6539 External\\SDK\\Clang\\Windows\\Clang11.bff \u7684 .Clang11_BasePath \u548c .Clang11_Version\uff0c\u8def\u5f84\u5728 .VS2019_BasePath\\Tools\\Tools/LLVM/x64\n    <div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a>.Clang11_BasePath = &#39;C:/Program Files (x86)/Microsoft Visual Studio/2019/Professional/VC/Tools/LLVM/x64&#39;    // &lt;-- Set path here\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>.Clang11_Version  = &#39;12.x.x&#39;\n</code></pre></div></li>\n</ul>\n<ul>\n<li>\u8fdb\u5165 Code \u76ee\u5f55\uff0c\u5728 cmd \u6267\u884c <code>FBuild.exe All-x64-Release</code>\uff0c\u5982\u679c\u914d\u7f6e\u6b63\u5e38\uff0c\u53ef\u4ee5\u770b\u5230\u7f16\u8bd1\u6210\u529f\uff0c\u5728 tmp\\x64-Release\\Tools\\FBuild\\FBuild \u80fd\u770b\u5230 FBuild.exe\u3002</li>\n</ul>\n<ul>\n<li><code>FBuild.exe All-x64-Release -dist -coordinator=127.0.0.1</code> \u53ef\u4ee5\u5f00\u542f\u5206\u5e03\u5f0f\u7f16\u8bd1\u3002</li>\n</ul>\n<h3 id=\"fbuild\">FBuild \u66f4\u591a\u9009\u9879</h3>\n<p>\u6211\u63d0\u4f9b\u7684 FBuild \u672c\u8eab\u652f\u6301\u4ee5\u4e0b\u5e38\u7528\u7684\u9009\u9879\uff1a</p>\n<ul>\n<li>coordinator: \u6307\u5b9a Coordinator ip \u5730\u5740\uff08\u53ef\u4ee5\u8986\u76d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff09</li>\n<li>brokerage: \u6307\u5b9a Brokerage \u5730\u5740\uff08\u53ef\u4ee5\u8986\u76d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff09</li>\n<li>nocache\uff1a\u5f3a\u5236\u4e0d\u4f7f\u7528 cache</li>\n<li>dist\uff1a\u5f00\u542f\u5206\u5e03\u5f0f\u7f16\u8bd1</li>\n<li>forceremote\uff1a\u5f3a\u5236\u5728\u8fdc\u7a0b\u673a\u7f16\u8bd1</li>\n<li>summary: \u7f16\u8f91\u7ed3\u675f\u540e\u8f93\u51fa\u7edf\u8ba1\u62a5\u544a</li>\n</ul>\n<p>\u7b49\u7b49\uff0c\u66f4\u591a\u9009\u9879\u53ef\u4ee5\u8fd0\u884c <code>FBuild.exe -help</code> \u6765\u770b\u3002</p>\n<p>FBuildWorker \u5e38\u7528\u7684\u9009\u9879\u6709\uff1a</p>\n<ul>\n<li>coordinator: \u6307\u5b9a Coordinator ip \u5730\u5740\uff08\u53ef\u4ee5\u8986\u76d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff09</li>\n<li>brokerage: \u6307\u5b9a Brokerage \u5730\u5740\uff08\u53ef\u4ee5\u8986\u76d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff09</li>\n<li>nocache\uff1a\u5f3a\u5236\u4e0d\u4f7f\u7528 cache</li>\n<li>cpus: \u6307\u5b9a\u5206\u914d\u591a\u5c11\u4e2a\u6838\u53c2\u4e0e\u7f16\u8bd1</li>\n</ul>\n<p>\u66f4\u591a\u9009\u9879\u53ef\u4ee5\u8fd0\u884c <code>FBuildWorder.exe -help</code> \u6765\u770b\u3002</p>\n<h3 id=\"ue-fastbuildcs\">\u4fee\u6539 UE \u81ea\u5e26\u7684 FASTBuild.cs</h3>\n<p>UE \u81ea\u5e26\u7684 FASTBuild.cs \u5e76\u6ca1\u6709\u5f88\u597d\u7684\u5904\u7406\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff0c\u8ddf BuildConfiguration.xml \u6307\u5b9a\u7684\u53c2\u6570\u7684\u5173\u7cfb\uff0c\u5f88\u591a\u53c2\u6570\u662f\u4f18\u5148\u8bfb\u53d6\u4e86\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff0c\u8fd9\u663e\u7136\u8ddf BuildConfiguration.xml \u7684\u4f7f\u7528\u903b\u8f91\u662f\u76f8\u53cd\u7684\u3002</p>\n<p>\u4e3a\u6b64\uff0c\u53ef\u4ee5\u628a\u76f8\u5173\u7684\u4ee3\u7801\u6539\u6210\u8fd9\u6837\uff0c\u8fd9\u91cc\u4ee5 UE5.3 \u4e3a\u4f8b\uff1a</p>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"nf\">ExecuteBffFile</span><span class=\"p\">(</span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">BffFilePath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ILogger</span><span class=\"w\"> </span><span class=\"n\">Logger</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">CacheArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">bEnableCaching</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">        </span><span class=\"k\">switch</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">CacheMode</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"n\">FASTBuildCacheMode</span><span class=\"p\">.</span><span class=\"n\">ReadOnly</span><span class=\"p\">:</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">                </span><span class=\"n\">CacheArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;-cacheread&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"n\">FASTBuildCacheMode</span><span class=\"p\">.</span><span class=\"n\">WriteOnly</span><span class=\"p\">:</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">                </span><span class=\"n\">CacheArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;-cachewrite&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"n\">FASTBuildCacheMode</span><span class=\"p\">.</span><span class=\"n\">ReadWrite</span><span class=\"p\">:</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">                </span><span class=\"n\">CacheArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;-cache&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"w\">        </span><span class=\"n\">CacheArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;-nocache&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a>\n<a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">DistArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">bEnableDistribution</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"s\">&quot;-dist&quot;</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">ForceRemoteArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">bForceRemote</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"s\">&quot;-forceremote&quot;</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">NoStopOnErrorArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">bStopOnError</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;-nostoponerror&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">IDEArgument</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IsApple</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&quot;-ide&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">MaxProcesses</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;-j&quot;</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">ParallelExecutor</span><span class=\"p\">)</span><span class=\"n\">LocalExecutor</span><span class=\"p\">).</span><span class=\"n\">NumParallelProcesses</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-30\" name=\"__codelineno-6-30\" href=\"#__codelineno-6-30\"></a>\n<a id=\"__codelineno-6-31\" name=\"__codelineno-6-31\" href=\"#__codelineno-6-31\"></a><span class=\"w\">    </span><span class=\"c1\">// Interesting flags for FASTBuild:</span>\n<a id=\"__codelineno-6-32\" name=\"__codelineno-6-32\" href=\"#__codelineno-6-32\"></a><span class=\"w\">    </span><span class=\"c1\">// -nostoponerror, -verbose, -monitor (if FASTBuild Monitor Visual Studio Extension is installed!)</span>\n<a id=\"__codelineno-6-33\" name=\"__codelineno-6-33\" href=\"#__codelineno-6-33\"></a><span class=\"w\">    </span><span class=\"c1\">// Yassine: The -clean is to bypass the FASTBuild internal</span>\n<a id=\"__codelineno-6-34\" name=\"__codelineno-6-34\" href=\"#__codelineno-6-34\"></a><span class=\"w\">    </span><span class=\"c1\">// dependencies checks (cached in the fdb) as it could create some conflicts with UBT.</span>\n<a id=\"__codelineno-6-35\" name=\"__codelineno-6-35\" href=\"#__codelineno-6-35\"></a><span class=\"w\">    </span><span class=\"c1\">// Basically we want FB to stupidly compile what UBT tells it to.</span>\n<a id=\"__codelineno-6-36\" name=\"__codelineno-6-36\" href=\"#__codelineno-6-36\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">FBCommandLine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">$&quot;-monitor -summary {DistArgument} {CacheArgument} {IDEArgument} {MaxProcesses} -clean -config \\&quot;{BffFilePath}\\&quot; {NoStopOnErrorArgument} {ForceRemoteArgument}&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-37\" name=\"__codelineno-6-37\" href=\"#__codelineno-6-37\"></a>\n<a id=\"__codelineno-6-38\" name=\"__codelineno-6-38\" href=\"#__codelineno-6-38\"></a><span class=\"w\">    </span><span class=\"n\">Logger</span><span class=\"p\">.</span><span class=\"n\">LogInformation</span><span class=\"p\">(</span><span class=\"s\">&quot;FBuild Command Line Arguments: &#39;{FBCommandLine}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FBCommandLine</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-39\" name=\"__codelineno-6-39\" href=\"#__codelineno-6-39\"></a>\n<a id=\"__codelineno-6-40\" name=\"__codelineno-6-40\" href=\"#__codelineno-6-40\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">FBExecutable</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetExecutablePath</span><span class=\"p\">()</span><span class=\"o\">!</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-41\" name=\"__codelineno-6-41\" href=\"#__codelineno-6-41\"></a><span class=\"w\">    </span><span class=\"n\">Logger</span><span class=\"p\">.</span><span class=\"n\">LogInformation</span><span class=\"p\">(</span><span class=\"s\">&quot;FBuild Executable: &#39;{FBExecutable}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FBExecutable</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-42\" name=\"__codelineno-6-42\" href=\"#__codelineno-6-42\"></a>\n<a id=\"__codelineno-6-43\" name=\"__codelineno-6-43\" href=\"#__codelineno-6-43\"></a><span class=\"w\">    </span><span class=\"kt\">string</span><span class=\"w\"> </span><span class=\"n\">WorkingDirectory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">.</span><span class=\"n\">GetFullPath</span><span class=\"p\">(</span><span class=\"n\">Path</span><span class=\"p\">.</span><span class=\"n\">Combine</span><span class=\"p\">(</span><span class=\"n\">Unreal</span><span class=\"p\">.</span><span class=\"n\">EngineDirectory</span><span class=\"p\">.</span><span class=\"n\">MakeRelativeTo</span><span class=\"p\">(</span><span class=\"n\">DirectoryReference</span><span class=\"p\">.</span><span class=\"n\">GetCurrentDirectory</span><span class=\"p\">()),</span><span class=\"w\"> </span><span class=\"s\">&quot;Source&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-6-44\" name=\"__codelineno-6-44\" href=\"#__codelineno-6-44\"></a>\n<a id=\"__codelineno-6-45\" name=\"__codelineno-6-45\" href=\"#__codelineno-6-45\"></a><span class=\"w\">    </span><span class=\"n\">ProcessStartInfo</span><span class=\"w\"> </span><span class=\"n\">FBStartInfo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ProcessStartInfo</span><span class=\"p\">(</span><span class=\"n\">FBExecutable</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">FBCommandLine</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-46\" name=\"__codelineno-6-46\" href=\"#__codelineno-6-46\"></a><span class=\"w\">    </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">UseShellExecute</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-47\" name=\"__codelineno-6-47\" href=\"#__codelineno-6-47\"></a><span class=\"w\">    </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">WorkingDirectory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">WorkingDirectory</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-48\" name=\"__codelineno-6-48\" href=\"#__codelineno-6-48\"></a><span class=\"w\">    </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">RedirectStandardError</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-49\" name=\"__codelineno-6-49\" href=\"#__codelineno-6-49\"></a><span class=\"w\">    </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">RedirectStandardOutput</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-50\" name=\"__codelineno-6-50\" href=\"#__codelineno-6-50\"></a>\n<a id=\"__codelineno-6-51\" name=\"__codelineno-6-51\" href=\"#__codelineno-6-51\"></a><span class=\"w\">    </span><span class=\"kt\">string?</span><span class=\"w\"> </span><span class=\"n\">Coordinator</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetCoordinator</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-52\" name=\"__codelineno-6-52\" href=\"#__codelineno-6-52\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">String</span><span class=\"p\">.</span><span class=\"n\">IsNullOrEmpty</span><span class=\"p\">(</span><span class=\"n\">Coordinator</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-53\" name=\"__codelineno-6-53\" href=\"#__codelineno-6-53\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-54\" name=\"__codelineno-6-54\" href=\"#__codelineno-6-54\"></a><span class=\"w\">        </span><span class=\"n\">Logger</span><span class=\"p\">.</span><span class=\"n\">LogInformation</span><span class=\"p\">(</span><span class=\"s\">&quot;FBuild Coordinator: &#39;{Coordinator}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Coordinator</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-55\" name=\"__codelineno-6-55\" href=\"#__codelineno-6-55\"></a><span class=\"w\">        </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">EnvironmentVariables</span><span class=\"p\">[</span><span class=\"s\">&quot;FASTBUILD_COORDINATOR&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Coordinator</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-56\" name=\"__codelineno-6-56\" href=\"#__codelineno-6-56\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-57\" name=\"__codelineno-6-57\" href=\"#__codelineno-6-57\"></a>\n<a id=\"__codelineno-6-58\" name=\"__codelineno-6-58\" href=\"#__codelineno-6-58\"></a><span class=\"w\">    </span><span class=\"kt\">string?</span><span class=\"w\"> </span><span class=\"n\">BrokeragePath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetBrokeragePath</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-59\" name=\"__codelineno-6-59\" href=\"#__codelineno-6-59\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">String</span><span class=\"p\">.</span><span class=\"n\">IsNullOrEmpty</span><span class=\"p\">(</span><span class=\"n\">BrokeragePath</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-60\" name=\"__codelineno-6-60\" href=\"#__codelineno-6-60\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-61\" name=\"__codelineno-6-61\" href=\"#__codelineno-6-61\"></a><span class=\"w\">        </span><span class=\"n\">Logger</span><span class=\"p\">.</span><span class=\"n\">LogInformation</span><span class=\"p\">(</span><span class=\"s\">&quot;FBuild BrokeragePath: &#39;{BrokeragePath}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">BrokeragePath</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-62\" name=\"__codelineno-6-62\" href=\"#__codelineno-6-62\"></a><span class=\"w\">        </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">EnvironmentVariables</span><span class=\"p\">[</span><span class=\"s\">&quot;FASTBUILD_BROKERAGE_PATH&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">BrokeragePath</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-63\" name=\"__codelineno-6-63\" href=\"#__codelineno-6-63\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-64\" name=\"__codelineno-6-64\" href=\"#__codelineno-6-64\"></a>\n<a id=\"__codelineno-6-65\" name=\"__codelineno-6-65\" href=\"#__codelineno-6-65\"></a><span class=\"w\">    </span><span class=\"kt\">string?</span><span class=\"w\"> </span><span class=\"n\">CachePath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetCachePath</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-66\" name=\"__codelineno-6-66\" href=\"#__codelineno-6-66\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">String</span><span class=\"p\">.</span><span class=\"n\">IsNullOrEmpty</span><span class=\"p\">(</span><span class=\"n\">CachePath</span><span class=\"p\">))</span>\n<a id=\"__codelineno-6-67\" name=\"__codelineno-6-67\" href=\"#__codelineno-6-67\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-68\" name=\"__codelineno-6-68\" href=\"#__codelineno-6-68\"></a><span class=\"w\">        </span><span class=\"n\">Logger</span><span class=\"p\">.</span><span class=\"n\">LogInformation</span><span class=\"p\">(</span><span class=\"s\">&quot;FBuild CachePath: &#39;{CachePath}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CachePath</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-69\" name=\"__codelineno-6-69\" href=\"#__codelineno-6-69\"></a><span class=\"w\">        </span><span class=\"n\">FBStartInfo</span><span class=\"p\">.</span><span class=\"n\">EnvironmentVariables</span><span class=\"p\">[</span><span class=\"s\">&quot;FASTBUILD_CACHE_PATH&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">CachePath</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-70\" name=\"__codelineno-6-70\" href=\"#__codelineno-6-70\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-71\" name=\"__codelineno-6-71\" href=\"#__codelineno-6-71\"></a><span class=\"p\">...</span>\n</code></pre></div>\n<h3 id=\"buildconfigurationxml\">BuildConfiguration.xml \u8fdb\u9636\u914d\u7f6e</h3>\n<div class=\"language-xml highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"nt\">&lt;Configuration</span><span class=\"w\"> </span><span class=\"na\">xmlns=</span><span class=\"s\">&quot;https://www.unrealengine.com/BuildConfiguration&quot;</span><span class=\"nt\">&gt;</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;ProjectFileGenerator&gt;</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9avs\u7248\u672c --&gt;</span>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;Format&gt;</span>VisualStudio2022<span class=\"nt\">&lt;/Format&gt;</span>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;/ProjectFileGenerator&gt;</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;BuildConfiguration&gt;</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u5f00\u542f FASTBuild --&gt;</span>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bAllowFASTBuild&gt;</span>true<span class=\"nt\">&lt;/bAllowFASTBuild&gt;</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9a\u672c\u673a\u53c2\u4e0e\u7f16\u8bd1\u7684 cpu \u6838\u6570 --&gt;</span>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;MaxParallelActions&gt;</span>12<span class=\"nt\">&lt;/MaxParallelActions&gt;</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u5173\u95ed Incredibuild --&gt;</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bAllowXGE&gt;</span>false<span class=\"nt\">&lt;/bAllowXGE&gt;</span>\n<a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;/BuildConfiguration&gt;</span>\n<a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;FASTBuild&gt;</span>\n<a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9a FBuild \u8def\u5f84 --&gt;</span>\n<a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildExecutablePath&gt;</span>d:\\libs\\FASTBuild\\bin\\FBuild.exe<span class=\"nt\">&lt;/FBuildExecutablePath&gt;</span>\n<a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u5f00\u542f\u5206\u5e03\u5f0f\u7f16\u8bd1 --&gt;</span>\n<a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bEnableDistribution&gt;</span>true<span class=\"nt\">&lt;/bEnableDistribution&gt;</span>\n<a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9a brokerage \u8def\u5f84 --&gt;</span>\n<a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildBrokeragePath&gt;</span>\\\\127.0.0.1\\Brokerage\\<span class=\"nt\">&lt;/FBuildBrokeragePath&gt;</span>\n<a id=\"__codelineno-7-22\" name=\"__codelineno-7-22\" href=\"#__codelineno-7-22\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9a cache \u8def\u5f84 --&gt;</span>\n<a id=\"__codelineno-7-23\" name=\"__codelineno-7-23\" href=\"#__codelineno-7-23\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildCachePath&gt;</span>\\\\127.0.0.1\\Cache\\<span class=\"nt\">&lt;/FBuildCachePath&gt;</span>\n<a id=\"__codelineno-7-24\" name=\"__codelineno-7-24\" href=\"#__codelineno-7-24\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u5f00\u542f cache --&gt;</span>\n<a id=\"__codelineno-7-25\" name=\"__codelineno-7-25\" href=\"#__codelineno-7-25\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;bEnableCaching&gt;</span>true<span class=\"nt\">&lt;/bEnableCaching&gt;</span>\n<a id=\"__codelineno-7-26\" name=\"__codelineno-7-26\" href=\"#__codelineno-7-26\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- cache \u7684\u8bfb\u5199\u6743\u9650 Read/Write/ReadWrite --&gt;</span>\n<a id=\"__codelineno-7-27\" name=\"__codelineno-7-27\" href=\"#__codelineno-7-27\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;CacheMode&gt;</span>ReadWrite<span class=\"nt\">&lt;/CacheMode&gt;</span>\n<a id=\"__codelineno-7-28\" name=\"__codelineno-7-28\" href=\"#__codelineno-7-28\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u6307\u5b9a coordinator ip --&gt;</span>\n<a id=\"__codelineno-7-29\" name=\"__codelineno-7-29\" href=\"#__codelineno-7-29\"></a><span class=\"w\">        </span><span class=\"nt\">&lt;FBuildCoordinator&gt;</span>127.0.0.1<span class=\"nt\">&lt;/FBuildCoordinator&gt;</span>\n<a id=\"__codelineno-7-30\" name=\"__codelineno-7-30\" href=\"#__codelineno-7-30\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- \u5f3a\u5236\u8fdc\u7a0b\u7f16\u8bd1 --&gt;</span>\n<a id=\"__codelineno-7-31\" name=\"__codelineno-7-31\" href=\"#__codelineno-7-31\"></a><span class=\"w\">        </span><span class=\"cm\">&lt;!-- &lt;bForceRemote&gt;true&lt;/bForceRemote&gt; --&gt;</span>\n<a id=\"__codelineno-7-32\" name=\"__codelineno-7-32\" href=\"#__codelineno-7-32\"></a><span class=\"w\">    </span><span class=\"nt\">&lt;/FASTBuild&gt;</span>\n<a id=\"__codelineno-7-33\" name=\"__codelineno-7-33\" href=\"#__codelineno-7-33\"></a><span class=\"nt\">&lt;/Configuration&gt;</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-12-01T00:00:00+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/ue-%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E6%BA%90%E7%A0%81%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6/",
            "url": "https://wiki.disenone.site/ue-%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E6%BA%90%E7%A0%81%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "UE \u901a\u8fc7\u63d2\u4ef6\u6e90\u7801\u6dfb\u52a0\u63d2\u4ef6",
            "content_html": "<p><meta property=\"og:title\" content=\"UE \u901a\u8fc7\u63d2\u4ef6\u6e90\u7801\u6dfb\u52a0\u63d2\u4ef6\" /></p>\n<h1 id=\"ue\">UE \u901a\u8fc7\u63d2\u4ef6\u6e90\u7801\u6dfb\u52a0\u63d2\u4ef6</h1>\n<h1 id=\"_1\">\u6dfb\u52a0\u63d2\u4ef6</h1>\n<blockquote>\n<p>\u7b80\u5355\u8bb0\u5f55\u4e00\u4e0b\u5982\u4f55\u5728\u62e5\u6709\u63d2\u4ef6\u6e90\u7801\u7684\u60c5\u51b5\u4e0b\u6dfb\u52a0\u63d2\u4ef6.</p>\n</blockquote>\n<p>\u4ee5\u63d2\u4ef6 <a href=\"https://github.com/disenone/UE.EditorPlus\">UE.EditorPlus</a> \u4e3a\u4f8b</p>\n<ul>\n<li>\u628a\u6e90\u7801\u653e\u5230 Plugins \u76ee\u5f55\u4e0b</li>\n<li>\uff08\u8fd9\u4e00\u6b65\u53ef\u4ee5\u4e0d\u6267\u884c\uff09\u4fee\u6539\u9879\u76ee .uproject \u6587\u4ef6\uff0cPlugins \u5b57\u6bb5\u4e0b\u589e\u52a0\uff1a\n    <div class=\"language-json highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"w\">    </span><span class=\"nt\">&quot;Plugins&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">        </span><span class=\"nt\">&quot;Name&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;EditorPlus&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">        </span><span class=\"nt\">&quot;Enabled&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">        </span><span class=\"nt\">&quot;TargetAllowList&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">            </span><span class=\"s2\">&quot;Editor&quot;</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">        </span><span class=\"p\">]</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</code></pre></div></li>\n<li>\u53f3\u952e uproject \u6587\u4ef6\uff0c\u6267\u884c \"Generate Visual Studio Project Files\"\uff0c\u66f4\u65b0 sln \u9879\u76ee\u6587\u4ef6</li>\n<li>\u6253\u5f00 sln \u6587\u4ef6\uff0c\u7f16\u8bd1\u9879\u76ee</li>\n</ul>\n<h1 id=\"_2\">\u8bbe\u7f6e\u591a\u8bed\u8a00</h1>\n<p>\u4fee\u6539\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6 <code>DefaultEditor.ini</code>\uff0c\u52a0\u4e0a\u65b0\u8def\u5f84\uff1a</p>\n<div class=\"language-ini highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">[Internationalization]</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"na\">+LocalizationPaths</span><span class=\"o\">=</span><span class=\"s\">%GAMEDIR%Plugins/UE.EditorPlus/Content/Localization/EditorPlusTools</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-12-01T00:00:00+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/",
            "url": "https://wiki.disenone.site/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Home",
            "content_html": "<!-- no translate -->\n\n<h1 id=\"disenones-wiki\">Disenone's Wiki</h1>\n<p><a href=\"https://github.com/disenone/wiki_blog/actions\"><img alt=\"badge\" loading=\"lazy\" src=\"https://github.com/disenone/wiki_blog/actions/workflows/Build.yml/badge.svg?label=Build&amp;style=flat-square\" /></a>\n<a href=\"https://github.com/disenone/wiki_blog/commits/main\"><img alt=\"badge\" loading=\"lazy\" src=\"https://img.shields.io/github/last-commit/disenone/wiki_blog?color=FCD734&amp;label=Last%20commit&amp;style=flat-square\" /></a>\n<a href=\"contact-and-subscribe\"><img alt=\"badge\" loading=\"lazy\" src=\"https://img.shields.io/badge/Contact%20%26%20Subscribe-me-34ABE0?&amp;style=flat-square\" /></a></p>\n<blockquote>\n<p>\u65e0\u6b62\u5883</p>\n</blockquote>\n<p>Hi there~ \u6b22\u8fce\u6765\u5230\u6211\u7684\u77e5\u8bc6\u5e93\u3002</p>\n<p>\u4e3a\u4e86\u907f\u514d\u9057\u5fd8\u3001\u4fbf\u4e8e\u5206\u4eab\uff0c\u6211\u5728\u8fd9\u91cc\u6536\u5f55\u77e5\u8bc6\u3002\n\u8bf7\u968f\u610f\u6d4f\u89c8\uff5e</p>\n<p><a class=\"md-button\" href=\"cpp-C\u548cCpp\u7684\u547d\u4ee4\u884c\u53c2\u6570\u5904\u7406\u603b\u7ed3\">\u7f16\u7a0b\u6280\u672f</a>\n<a class=\"md-button\" href=\"game-\u6e38\u620fAOI\u7b97\u6cd5\u89e3\u6790\u548c\u6027\u80fd\u5b9e\u6d4b\">\u6e38\u620f\u5f00\u53d1</a></p>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/cpp-C%E5%92%8CCpp%E5%AE%8F%E7%BC%96%E7%A8%8B%E8%A7%A3%E6%9E%90/",
            "url": "https://wiki.disenone.site/cpp-C%E5%92%8CCpp%E5%AE%8F%E7%BC%96%E7%A8%8B%E8%A7%A3%E6%9E%90/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "C/C++ \u5b8f\u7f16\u7a0b\u89e3\u6790",
            "content_html": "<p><meta property=\"og:title\" content=\"C/C++ \u5b8f\u7f16\u7a0b\u89e3\u6790\" /></p>\n<p>\u672c\u6587\u7684\u76ee\u7684\u662f\u8981\u8bb2\u6e05\u695a C/C++ \u7684\u5b8f\u7f16\u7a0b\u7684\u89c4\u5219\u548c\u5b9e\u73b0\u65b9\u6cd5\uff0c\u8ba9\u4f60\u4e0d\u518d\u60e7\u6015\u770b\u5230\u4ee3\u7801\u91cc\u9762\u7684\u5b8f\u3002\u6211\u4f1a\u9996\u5148\u8bf4\u8bf4 C++ \u6807\u51c6 14 \u91cc\u9762\u63d0\u5230\u7684\u5173\u4e8e\u5b8f\u5c55\u5f00\u7684\u89c4\u5219\uff0c\u7136\u540e\u901a\u8fc7\u4fee\u6539 Clang \u7684\u6e90\u7801\u6765\u89c2\u5bdf\u5b8f\u5c55\u5f00\uff0c\u6700\u540e\u57fa\u4e8e\u8fd9\u4e9b\u77e5\u8bc6\u6765\u804a\u804a\u5b8f\u7f16\u7a0b\u7684\u5b9e\u73b0\u3002</p>\n<p>\u672c\u6587\u7684\u4ee3\u7801\u5168\u90e8\u90fd\u5728\u8fd9\u91cc\uff1a<a href=\"../assets/img/2021-3-31-cpp-preprocess/macros.cpp\">\u4e0b\u8f7d</a>\uff0c<a href=\"https://godbolt.org/z/coWvc5Pse\">\u5728\u7ebf\u6f14\u793a</a>\u3002</p>\n<h2 id=\"_1\">\u5f15\u5b50</h2>\n<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u547d\u4ee4 <code>gcc -P -E a.cpp -o a.cpp.i</code> \u6765\u8ba9\u7f16\u8bd1\u5668\u5bf9\u6587\u4ef6 <code>a.cpp</code> \u53ea\u6267\u884c\u9884\u5904\u7406\u5e76\u4fdd\u5b58\u7ed3\u679c\u5230 <code>a.cpp.i</code> \u4e2d\u3002</p>\n<p>\u9996\u5148\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e9b\u4f8b\u5b50:</p>\n<h4 id=\"reentrancy\">\u9012\u5f52\u91cd\u5165\uff08Reentrancy\uff09</h4>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"cp\">#define ITER(arg0, arg1) ITER(arg1, arg0)</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"n\">ITER</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; ITER(2, 1)</span>\n</code></pre></div>\n<p>\u5b8f <code>ITER</code> \u4ea4\u6362\u4e86 <code>arg0</code>, <code>arg1</code> \u7684\u4f4d\u7f6e\u3002\u5b8f\u5c55\u5f00\u4e4b\u540e\uff0c\u5f97\u5230\u7684\u662f <code>ITER(2, 1)</code>\u3002</p>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c<code>arg0</code> <code>arg1</code> \u7684\u4f4d\u7f6e\u6210\u529f\u4ea4\u6362\uff0c\u5728\u8fd9\u91cc\u5b8f\u6210\u529f\u5c55\u5f00\u4e86\u4e00\u6b21\uff0c\u4f46\u4e5f\u53ea\u5c55\u5f00\u4e86\u4e00\u6b21\uff0c\u4e0d\u518d\u9012\u5f52\u91cd\u5165\u3002\u6362\u8a00\u4e4b\uff0c\u5b8f\u7684\u5c55\u5f00\u8fc7\u7a0b\u4e2d\uff0c\u662f\u4e0d\u53ef\u81ea\u8eab\u9012\u5f52\u91cd\u5165\u7684\uff0c\u5982\u679c\u5728\u9012\u5f52\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u76f8\u540c\u7684\u5b8f\u5728\u4e4b\u524d\u7684\u9012\u5f52\u4e2d\u5df2\u7ecf\u5c55\u5f00\u8fc7\uff0c\u5219\u4e0d\u518d\u5c55\u5f00\uff0c\u8fd9\u662f\u5b8f\u5c55\u5f00\u7684\u5176\u4e2d\u4e00\u6761\u91cd\u8981\u7684\u89c4\u5219\u3002\u7981\u6b62\u9012\u5f52\u91cd\u5165\u7684\u539f\u56e0\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4e3a\u4e86\u907f\u514d\u65e0\u9650\u9012\u5f52\u3002</p>\n<h4 id=\"_2\">\u5b57\u7b26\u4e32\u62fc\u63a5</h4>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">World</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; HelloWorld</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">World</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt;\u3000HelloCONCAT(World, !)</span>\n</code></pre></div>\n<p>\u5b8f <code>CONCAT</code> \u76ee\u7684\u662f\u62fc\u63a5 <code>arg0</code> <code>arg1</code>\u3002\u5b8f\u5c55\u5f00\u4e4b\u540e\uff0c<code>CONCAT(Hello, World)</code> \u80fd\u591f\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c <code>HelloWorld</code>\u3002\u4f46\u662f <code>CONCAT(Hello, CONCAT(World, !))</code> \u5374\u53ea\u5c55\u5f00\u4e86\u5916\u5c42\u7684\u5b8f\uff0c\u5185\u5c42\u7684 <code>CONCAT(World, !)</code> \u5e76\u6ca1\u6709\u5c55\u5f00\u800c\u662f\u76f4\u63a5\u8ddf <code>Hello</code> \u62fc\u63a5\u5728\u4e00\u8d77\u4e86\uff0c\u8fd9\u8ddf\u6211\u4eec\u9884\u60f3\u7684\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u771f\u6b63\u60f3\u8981\u7684\u7ed3\u679c\u662f <code>HelloWorld!</code>\u3002\u8fd9\u5c31\u662f\u5b8f\u5c55\u5f00\u7684\u53e6\u5916\u4e00\u6761\u91cd\u8981\u7684\u89c4\u5219\uff1a\u8ddf\u5728 <code>##</code> \u64cd\u4f5c\u7b26\u540e\u9762\u7684\u5b8f\u53c2\u6570\uff0c\u4e0d\u4f1a\u6267\u884c\u5c55\u5f00\uff0c\u800c\u662f\u4f1a\u76f4\u63a5\u8ddf\u524d\u9762\u7684\u5185\u5bb9\u5148\u62fc\u63a5\u5728\u4e00\u8d77\u3002</p>\n<p>\u901a\u8fc7\u4e0a\u9762\u4e24\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u5b8f\u5c55\u5f00\u7684\u89c4\u5219\u6709\u4e00\u4e9b\u662f\u53cd\u76f4\u89c9\u7684\uff0c\u5982\u679c\u4e0d\u6e05\u695a\u5177\u4f53\u7684\u89c4\u5219\uff0c\u6709\u53ef\u80fd\u5199\u51fa\u6765\u7684\u5b8f\u8ddf\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u4e0d\u4e00\u81f4\u3002</p>\n<h2 id=\"_3\">\u5b8f\u5c55\u5f00\u89c4\u5219</h2>\n<p>\u901a\u8fc7\u5f15\u5b50\u7684\u4e24\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u4e86\u5b8f\u5c55\u5f00\u662f\u6709\u4e00\u5957\u6807\u51c6\u7684\u89c4\u5219\u7684\uff0c\u8fd9\u5957\u89c4\u5219\u5b9a\u4e49\u5728 C/C++ \u6807\u51c6\u91cc\u9762\uff0c\u5185\u5bb9\u4e0d\u591a\uff0c\u5efa\u8bae\u5148\u4ed4\u7ec6\u8bfb\u51e0\u904d\uff0c\u6211\u8fd9\u91cc\u987a\u5e26\u7ed9\u4e0b\u6807\u51c6 n4296 \u7248\u672c\u7684\u94fe\u63a5\uff0c\u5b8f\u5c55\u5f00\u5728 16.3 \u8282\uff1a<a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4296.pdf\">\u4f20\u9001\u95e8</a>\u3002\u4e0b\u9762\u6211\u6311\u51fa n4296 \u7248\u672c\u4e2d\u51e0\u6761\u91cd\u8981\u7684\u89c4\u5219\uff0c\u8fd9\u4e9b\u89c4\u5219\u4f1a\u51b3\u5b9a\u5982\u4f55\u6b63\u786e\u7f16\u5199\u5b8f\uff08\u8fd8\u662f\u5efa\u8bae\u62bd\u65f6\u95f4\u628a\u6807\u51c6\u91cc\u9762\u7684\u5b8f\u5c55\u5f00\u7ec6\u8bfb\u4e0b\uff09\u3002</p>\n<h4 id=\"_4\">\u53c2\u6570\u5206\u9694</h4>\n<p>\u5b8f\u7684\u53c2\u6570\u8981\u6c42\u662f\u7528\u9017\u53f7\u5206\u9694\uff0c\u800c\u4e14\u53c2\u6570\u7684\u4e2a\u6570\u9700\u8981\u8ddf\u5b8f\u5b9a\u4e49\u7684\u4e2a\u6570\u4e00\u81f4\uff0c\u4f20\u9012\u7ed9\u5b8f\u7684\u53c2\u6570\u4e2d\uff0c\u989d\u5916\u7528\u62ec\u53f7\u5305\u4f4f\u7684\u5185\u5bb9\u89c6\u4e3a\u4e00\u4e2a\u53c2\u6570\uff0c\u53c2\u6570\u5141\u8bb8\u4e3a\u7a7a\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"cp\">#define ADD_COMMA(arg1, arg2) arg1, arg2</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"n\">ADD_COMMA</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; a, b</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"n\">ADD_COMMA</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// \u62a5\u9519 &quot;macro &quot;MACRO&quot; requires 2 arguments, but only 1 given&quot;</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"n\">ADD_COMMA</span><span class=\"p\">((</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">)</span><span class=\"w\">        </span><span class=\"c1\">// -&gt; (a, b), c</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"n\">ADD_COMMA</span><span class=\"p\">(,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; , b</span>\n</code></pre></div>\n<p><code>ADD_COMMA((a, b), c)</code> \u4e2d <code>(a, b)</code> \u89c6\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002<code>ADD_COMMA(, b)</code> \u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7a7a\uff0c\u4e8e\u662f\u5c55\u5f00\u4e3a <code>, b</code>\u3002</p>\n<h4 id=\"_5\">\u5b8f\u53c2\u6570\u5c55\u5f00</h4>\n<p>\u5728\u5bf9\u5b8f\u8fdb\u884c\u5c55\u5f00\u7684\u65f6\u5019\uff0c\u5982\u679c\u5b8f\u7684\u53c2\u6570\u4e5f\u662f\u53ef\u4ee5\u5c55\u5f00\u7684\u5b8f\uff0c\u4f1a\u5148\u628a\u53c2\u6570\u5b8c\u5168\u5c55\u5f00\uff0c\u518d\u5c55\u5f00\u5b8f\uff0c\u4f8b\u5982</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">ADD_COMMA</span><span class=\"p\">(</span><span class=\"n\">ADD_COMMA</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ADD_COMMA</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 1, 2, 3, 4</span>\n</code></pre></div>\n<p>\u4e00\u822c\u60c5\u51b5\u4e0b\u7684\u5b8f\u5c55\u5f00\uff0c\u90fd\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5148\u5bf9\u53c2\u6570\u6c42\u503c\uff0c\u518d\u5bf9\u5b8f\u6c42\u503c\uff0c\u9664\u975e\u9047\u5230\u4e86 <code>#</code> \u548c <code>##</code> \u64cd\u4f5c\u7b26\u3002</p>\n<h4 id=\"_6\"><code>#</code> \u64cd\u4f5c\u7b26</h4>\n<p><code>#</code> \u64cd\u4f5c\u7b26\u540e\u9762\u8ddf\u7684\u5b8f\u53c2\u6570\uff0c\u4e0d\u4f1a\u8fdb\u884c\u5c55\u5f00\uff0c\u4f1a\u76f4\u63a5\u5b57\u7b26\u4e32\u5316\uff0c\u4f8b\u5982\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"cp\">#define STRINGIZE(arg0) # arg0</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"n\">STRINGIZE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; &quot;a&quot;</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"n\">STRINGIZE</span><span class=\"p\">(</span><span class=\"n\">STRINGIZE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; &quot;STRINGIZE(a)&quot;</span>\n</code></pre></div>\n<p>\u6839\u636e\u8fd9\u6761\u89c4\u5219 <code>STRINGIZE(STRINGIZE(a))</code> \u53ea\u80fd\u5c55\u5f00\u4e3a <code>\"STRINGIZE(a)\"</code>\u3002</p>\n<h4 id=\"_7\"><code>##</code> \u64cd\u4f5c\u7b26</h4>\n<p><code>##</code> \u64cd\u4f5c\u7b26\u524d\u540e\u7684\u5b8f\u53c2\u6570\uff0c\u90fd\u4e0d\u4f1a\u8fdb\u884c\u5c55\u5f00\uff0c\u4f1a\u5148\u76f4\u63a5\u62fc\u63a5\u8d77\u6765\uff0c\u4f8b\u5982\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">World</span><span class=\"p\">)</span><span class=\"w\">                        </span><span class=\"c1\">// -&gt; HelloWorld</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">World</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"p\">))</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; HelloCONCAT(World, !)</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">World</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ONCAT</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"p\">))</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; CONCAT(Hello, World) CONCAT(!)</span>\n</code></pre></div>\n<p><code>CONCAT(CONCAT(Hello, World) C, ONCAT(!))</code> \u53ea\u80fd\u662f\u5148\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u5f97\u5230 <code>CONCAT(Hello, World) CONCAT(!)</code>\u3002</p>\n<h4 id=\"_8\">\u91cd\u590d\u626b\u63cf</h4>\n<p>\u9884\u5904\u7406\u5668\u6267\u884c\u5b8c\u4e00\u6b21\u5b8f\u5c55\u5f00\u4e4b\u540e\uff0c\u4f1a\u91cd\u65b0\u626b\u63cf\u5f97\u5230\u7684\u5185\u5bb9\uff0c\u7ee7\u7eed\u5c55\u5f00\uff0c\u76f4\u5230\u6ca1\u6709\u53ef\u4ee5\u5c55\u5f00\u7684\u5185\u5bb9\u4e3a\u6b62\u3002</p>\n<p>\u4e00\u6b21\u5b8f\u5c55\u5f00\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5148\u628a\u53c2\u6570\u5b8c\u5168\u5c55\u5f00\uff08\u9664\u975e\u9047\u5230 <code>#</code> \u548c <code>##</code>\uff09\uff0c\u518d\u6839\u636e\u5b8f\u7684\u5b9a\u4e49\uff0c\u628a\u5b8f\u548c\u5b8c\u5168\u5c55\u5f00\u540e\u7684\u53c2\u6570\u6309\u7167\u5b9a\u4e49\u8fdb\u884c\u66ff\u6362\uff0c\u518d\u5904\u7406\u5b9a\u4e49\u4e2d\u7684\u6240\u6709 <code>#</code> \u548c <code>##</code> \u64cd\u4f5c\u7b26\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"cp\">#define STRINGIZE(arg0) # arg0</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">STRING</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IZE</span><span class=\"p\">(</span><span class=\"n\">Hello</span><span class=\"p\">))</span><span class=\"w\">        </span><span class=\"c1\">// -&gt; STRINGIZE(Hello) -&gt; &quot;Hello&quot;</span>\n</code></pre></div>\n<p><code>CONCAT(STRING, IZE(Hello))</code> \u7b2c\u4e00\u6b21\u626b\u63cf\u5c55\u5f00\u5f97\u5230 <code>STRINGIZE(Hello)</code>\uff0c\u7136\u540e\u6267\u884c\u7b2c\u4e8c\u6b21\u626b\u63cf\uff0c\u53d1\u73b0 <code>STRINGIZE</code> \u53ef\u4ee5\u7ee7\u7eed\u5c55\u5f00\uff0c\u6700\u540e\u5f97\u5230 <code>\"Hello\"</code>\u3002</p>\n<h4 id=\"_9\">\u7981\u6b62\u9012\u5f52\u91cd\u5165</h4>\n<p>\u5728\u91cd\u590d\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7981\u6b62\u9012\u5f52\u5c55\u5f00\u76f8\u540c\u7684\u5b8f\u3002\u53ef\u4ee5\u628a\u5b8f\u5c55\u5f00\u7406\u89e3\u4e3a\u6811\u5f62\u7684\u7ed3\u6784\uff0c\u6839\u8282\u70b9\u5c31\u662f\u4e00\u5f00\u59cb\u8981\u5c55\u5f00\u7684\u5b8f\uff0c\u6bcf\u4e2a\u5b8f\u5c55\u5f00\u4e4b\u540e\u7684\u5185\u5bb9\u4f5c\u4e3a\u8be5\u5b8f\u7684\u5b50\u8282\u70b9\u8fde\u63a5\u5230\u6811\u4e0a\uff0c\u90a3\u4e48\u7981\u6b62\u9012\u5f52\u5c31\u662f\u5728\u5c55\u5f00\u5b50\u8282\u70b9\u7684\u5b8f\u65f6\uff0c\u5982\u679c\u8be5\u5b8f\u8ddf\u4efb\u610f\u7956\u5148\u8282\u70b9\u7684\u5b8f\u76f8\u540c\uff0c\u5219\u7981\u6b62\u5c55\u5f00\u3002\u6765\u770b\u4e00\u4e9b\u4f8b\u5b50\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"cp\">#define CONCAT_SPACE(arg0, arg1) arg0 arg1</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"cp\">#define IDENTITY(arg0) IDENTITY_IMPL(arg0)</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"cp\">#define IDENTITY_IMPL(arg0) arg0</span>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">CON</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">))</span><span class=\"w\">                  </span><span class=\"c1\">// -&gt; CONCAT(a, b)</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"n\">IDENTITY_IMPL</span><span class=\"p\">(</span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">CON</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)))</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; CONCAT(a, b)</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"n\">IDENTITY</span><span class=\"p\">(</span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">CON</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)))</span><span class=\"w\">        </span><span class=\"c1\">// -&gt; IDENTITY_IMPL(CONCAT(a, b)) -&gt; CONCAT(a, b)</span>\n</code></pre></div>\n<p><code>CONCAT(CON, CAT(a, b))</code>\uff1a\u7531\u4e8e <code>CONCAT</code> \u662f\u7528 <code>##</code> \u62fc\u63a5\u4e24\u4e2a\u53c2\u6570\uff0c\u6839\u636e <code>##</code> \u7684\u89c4\u5219\uff0c\u4e0d\u4f1a\u5c55\u5f00\u53c2\u6570\uff0c\u76f4\u63a5\u62fc\u63a5\u3002\u6240\u4ee5\u7b2c\u4e00\u6b21\u5c55\u5f00\u5f97\u5230\u4e86 <code>CONCAT(a, b)</code>\uff0c\u7531\u4e8e <code>CONCAT</code> \u5df2\u7ecf\u5c55\u5f00\u8fc7\u4e86\u4e0d\u4f1a\u518d\u9012\u5f52\u5c55\u5f00\uff0c\u6240\u4ee5\u505c\u6b62\u3002</p>\n<p><code>IDENTITY_IMPL(CONCAT(CON, CAT(a, b)))</code>\uff1a<code>IDENTITY_IMPL</code> \u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9\u53c2\u6570 <code>arg0</code> \u6c42\u503c\uff0c\u8fd9\u91cc\u7684\u53c2\u6570 <code>arg0</code> \u6c42\u503c\u5f97\u5230\u4e86 <code>CONCAT(a, b)</code>\uff0c\u5e76\u7531\u4e8e\u9012\u5f52\u88ab\u6807\u8bb0\u4e3a\u4e86\u7981\u6b62\u91cd\u5165\uff0c\u4e4b\u540e <code>IDENTITY_IMPL</code> \u5c55\u5f00\u5b8c\u6210\uff0c\u8fdb\u884c\u7b2c\u4e8c\u6b21\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u662f\u7981\u6b62\u91cd\u5165\u7684 <code>CONCAT(a, b)</code>\uff0c\u4e8e\u662f\u505c\u6b62\u5c55\u5f00\u3002\u5728\u8fd9\u91cc <code>CONCAT(a, b)</code> \u662f\u7531\u53c2\u6570 <code>arg0</code> \u5c55\u5f00\u800c\u5f97\u5230\u7684\uff0c\u4f46\u5728\u540e\u7eed\u5c55\u5f00\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u4fdd\u6301\u7981\u6b62\u91cd\u5165\u7684\u6807\u8bb0\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u7236\u8282\u70b9\u662f\u53c2\u6570 <code>arg0</code>\uff0c\u4e00\u76f4\u4fdd\u6301\u7740\u7981\u6b62\u91cd\u5165\u7684\u6807\u8bb0\u3002</p>\n<p><code>IDENTITY(CONCAT(CON, CAT(a, b)))</code>\uff1a\u8fd9\u4e2a\u4f8b\u5b50\u4e3b\u8981\u662f\u4e3a\u4e86\u52a0\u5f3a\u5bf9\u7236\u5b50\u8282\u70b9\u7684\u7406\u89e3\uff0c\u53c2\u6570\u81ea\u5df1\u5c55\u5f00\u7684\u65f6\u5019\uff0c\u662f\u81ea\u8eab\u4f5c\u4e3a\u7236\u8282\u70b9\uff0c\u5c55\u5f00\u7684\u5185\u5bb9\u4f5c\u4e3a\u5b50\u8282\u70b9\u53bb\u5224\u65ad\u9012\u5f52\uff0c\u5c55\u5f00\u540e\u7684\u53c2\u6570\u4f20\u5230\u5b8f\u5b9a\u4e49\u4e4b\u540e\uff0c\u7981\u6b62\u91cd\u5165\u7684\u6807\u8bb0\u4f1a\u7ee7\u7eed\u4fdd\u7559\uff08\u5982\u679c\u4f20\u5230\u5b8f\u5b9a\u4e49\u4e4b\u540e\u6ca1\u6709\u6539\u53d8\u53c2\u6570\u5c55\u5f00\u540e\u7684\u5b8f\uff09\u3002\u53ef\u4ee5\u628a\u53c2\u6570\u7684\u5c55\u5f00\u8fc7\u7a0b\u770b\u6210\u662f\u53e6\u5916\u4e00\u68f5\u6811\uff0c\u53c2\u6570\u7684\u5c55\u5f00\u7ed3\u679c\u5c31\u662f\u6811\u7684\u6700\u5e95\u5c42\u5b50\u8282\u70b9\uff0c\u8fd9\u4e2a\u5b50\u8282\u70b9\u4f20\u7ed9\u5b8f\u6765\u6267\u884c\u5c55\u5f00\u7684\u540c\u65f6\uff0c\u4f9d\u7136\u662f\u4fdd\u7559\u7740\u7981\u6b62\u91cd\u5165\u7684\u7279\u6027\u3002</p>\n<p>\u4f8b\u5982\u8fd9\u91cc\uff0c\u5728\u7b2c\u4e00\u6b21\u5b8c\u5168\u5c55\u5f00\u4e4b\u540e\u5f97\u5230 <code>IDENTITY_IMPL(CONCAT(a, b))</code>\uff0c<code>CONCAT(a, b)</code> \u88ab\u6807\u8bb0\u4e3a\u7981\u6b62\u91cd\u5165\uff0c \u5373\u4f7f <code>IDENTITY_IMPL</code> \u662f\u5bf9\u53c2\u6570\u6c42\u503c\u7684\uff0c\u4f46\u53c2\u6570\u5df2\u7ecf\u7981\u6b62\u5c55\u5f00\uff0c\u6240\u4ee5\u53c2\u6570\u5c31\u539f\u5c01\u4e0d\u52a8\u7684\u4f20\u5230\u5b9a\u4e49\u91cc\uff0c\u6700\u540e\u6211\u4eec\u8fd8\u662f\u5f97\u5230 <code>CONCAT(a, b)</code>\u3002</p>\n<p>\u4ee5\u4e0a\u6211\u53ea\u662f\u5217\u51fa\u4e86\u4e00\u4e9b\u6211\u8ba4\u4e3a\u6bd4\u8f83\u91cd\u8981\u7684\uff0c\u6216\u8005\u89c9\u5f97\u4e0d\u592a\u597d\u7406\u89e3\u7684\u89c4\u5219\uff0c\u8be6\u7ec6\u7684\u5b8f\u5c55\u5f00\u89c4\u5219\uff0c\u8fd8\u662f\u5efa\u8bae\u82b1\u70b9\u65f6\u95f4\u76f4\u63a5\u53bb\u770b\u6807\u51c6\u6587\u6863\u3002</p>\n<h2 id=\"clang\">\u901a\u8fc7 Clang \u89c2\u5bdf\u5c55\u5f00\u8fc7\u7a0b</h2>\n<p>\u6211\u4eec\u53ef\u4ee5\u7ed9 Clang \u6e90\u7801\u52a0\u4e0a\u4e00\u4e9b\u6253\u5370\u4fe1\u606f\u6765\u89c2\u5bdf\u5b8f\u5c55\u5f00\u7684\u8fc7\u7a0b\uff0c\u6211\u65e0\u610f\u6df1\u5165\u89e3\u91ca Clang \u7684\u6e90\u7801\uff0c\u5728\u8fd9\u91cc\u7ed9\u4e00\u4efd\u4fee\u6539\u8fc7\u7684\u6587\u4ef6 diff\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u7f16\u8bd1 Clang \u6765\u7814\u7a76\u3002\u8fd9\u91cc\u6211\u662f\u7528\u7684 llvm \u7248\u672c 11.1.0 \uff08<a href=\"https://github.com/llvm/llvm-project/archive/refs/tags/llvmorg-11.1.0.tar.gz\">\u4f20\u9001\u95e8</a>\uff09\uff0c\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\uff08<a href=\"../assets/img/2021-3-31-cpp-preprocess/clang-modify.zip\">\u4f20\u9001\u95e8</a>\uff09\u3002\u4e0b\u9762\u7b80\u5355\u901a\u8fc7\u4f8b\u5b50\u6765\u9a8c\u8bc1\u6211\u4eec\u4e4b\u524d\u4ecb\u7ecd\u7684\u5b8f\u5c55\u5f00\u89c4\u5219\uff1a</p>\n<h4 id=\"1\">\u4f8b\u5b501</h4>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ONCAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">))</span><span class=\"w\">      </span><span class=\"c1\">// CONCAT(a, b)</span>\n</code></pre></div>\n<p>\u4f7f\u7528\u4fee\u6539\u8fc7\u7684 Clang \u6765\u9884\u5904\u7406\u4ee5\u4e0a\u4ee3\u7801\uff1a <code>clang -P -E a.cpp -o a.cpp.i</code>\uff0c\u5f97\u5230\u4e0b\u9762\u7684\u6253\u5370\u4fe1\u606f\uff1a</p>\n<div class=\"language-text highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-9-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-9-26\">26</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\"></a>HandleIdentifier:\n<a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\"></a>MacroInfo 0x559e57496900\n<a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\"></a>Macro is ok to expand\n<a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\"></a>\n<a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\"></a>EnterMacro: 0\n<a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\"></a>\n<a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-9-9\" name=\"__codelineno-9-9\"></a>MacroInfo 0x559e57496900 used\n<a id=\"__codelineno-9-10\" name=\"__codelineno-9-10\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-9-11\" name=\"__codelineno-9-11\"></a>Token: 0\n<a id=\"__codelineno-9-12\" name=\"__codelineno-9-12\"></a>identifier: arg0\n<a id=\"__codelineno-9-13\" name=\"__codelineno-9-13\"></a>Args: [identifier: C]\n<a id=\"__codelineno-9-14\" name=\"__codelineno-9-14\"></a>Token: 1\n<a id=\"__codelineno-9-15\" name=\"__codelineno-9-15\"></a>hashhash:\n<a id=\"__codelineno-9-16\" name=\"__codelineno-9-16\"></a>Token: 2\n<a id=\"__codelineno-9-17\" name=\"__codelineno-9-17\"></a>identifier: arg1\n<a id=\"__codelineno-9-18\" name=\"__codelineno-9-18\"></a>Args: [identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-9-19\" name=\"__codelineno-9-19\"></a>Leave ExpandFunctionArguments: [identifier: C][hashhash: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-9-20\" name=\"__codelineno-9-20\"></a>\n<a id=\"__codelineno-9-21\" name=\"__codelineno-9-21\"></a>LeaveMacro: 0\n<a id=\"__codelineno-9-22\" name=\"__codelineno-9-22\"></a>\n<a id=\"__codelineno-9-23\" name=\"__codelineno-9-23\"></a>HandleIdentifier:\n<a id=\"__codelineno-9-24\" name=\"__codelineno-9-24\"></a>MacroInfo 0x559e57496900 disabled used\n<a id=\"__codelineno-9-25\" name=\"__codelineno-9-25\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-9-26\" name=\"__codelineno-9-26\"></a>Macro is not ok to expand\n</code></pre></div></td></tr></table></div>\n<p>\u7b2c <a href=\"#__codelineno-9-1\">1</a> \u884c <code>HandleIdentifier</code> \u9047\u5230\u5b8f\u7684\u65f6\u5019\u4f1a\u6253\u5370\uff0c\u63a5\u7740\u6253\u5370\u5b8f\u7684\u4fe1\u606f\uff08\u7b2c <a href=\"#__codelineno-9-2\">2-4</a> \u884c\uff09\uff0c\u5b8f\u6ca1\u6709\u7981\u7528\uff0c\u6240\u4ee5\u53ef\u4ee5\u6309\u7167\u5b9a\u4e49\u6765\u5c55\u5f00 <code>Macro is ok to expand</code>\uff0c\u4e4b\u540e\u8fdb\u5165\u5b8f <code>EnterMacro</code>\u3002</p>\n<p>\u771f\u6b63\u6267\u884c\u5b8f\u5c55\u5f00\u7684\u51fd\u6570\u662f <code>ExpandFunctionArguments</code>\uff0c\u4e4b\u540e\u518d\u6b21\u6253\u5370\u5f85\u5c55\u5f00\u7684\u5b8f\u4fe1\u606f\uff0c\u6ce8\u610f\u5230\u6b64\u65f6\u5b8f\u5df2\u7ecf\u88ab\u6807\u8bb0\u4e3a <code>used</code> \uff08\u7b2c <a href=\"#__codelineno-9-9\">9</a> \u884c\uff09\u3002\u4e4b\u540e\u6839\u636e\u5b8f\u7684\u5b9a\u4e49\uff0c\u8fdb\u884c\u9010\u4e2a <code>Token</code> \u7684\u5c55\u5f00 \uff08<code>Token</code> \u662f <code>Clang</code> \u9884\u5904\u7406\u91cc\u9762\u7684\u6982\u5ff5\uff0c\u8fd9\u91cc\u4e0d\u6df1\u5165\u8bf4\u660e\uff09\u3002</p>\n<p>\u7b2c 0 \u4e2a <code>Token</code> \u662f\u5f62\u53c2 <code>arg0</code>, \u5bf9\u5e94\u7684\u5b9e\u53c2\u662f <code>C</code>\uff0c\u5224\u65ad\u4e0d\u9700\u8981\u5c55\u5f00\uff0c\u4e8e\u662f\u76f4\u63a5\u590d\u5236\u5230\u7ed3\u679c\u4e0a\uff08\u7b2c <a href=\"#__codelineno-9-11\">11-13</a> \u884c\uff09\u3002</p>\n<p>\u7b2c 1 \u4e2a <code>Token</code> \u662f <code>hashhash</code>\uff0c\u4e5f\u5c31\u662f <code>##</code> \u64cd\u4f5c\u7b26\uff0c\u7ee7\u7eed\u590d\u5236\u5230\u7ed3\u679c\u4e0a\uff08\u7b2c <a href=\"#__codelineno-9-14\">14-15</a> \u884c\uff09\u3002</p>\n<p>\u7b2c 2 \u4e2a <code>Token</code> \u662f\u5f62\u53c2 <code>arg1</code>\uff0c\u5bf9\u5e94\u7684\u5b9e\u53c2\u662f <code>ONCAT(a, b)</code>\uff0c\u9884\u5904\u7406\u5668\u4e5f\u4f1a\u628a\u5b9e\u53c2\u5904\u7406\u6210\u4e00\u4e2a\u4e2a\u7684 <code>Token</code>\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u5230\u6253\u5370\u7684\u7ed3\u679c\u7528\u4e2d\u62ec\u53f7\u5305\u4f4f\u4e86\u5b9e\u53c2\u7684\u6bcf\u4e2a <code>Token</code>\uff08\u7b2c 18 \u884c\uff09\uff0c\u7531\u4e8e <code>##</code> \u7684\u539f\u56e0\u8fd9\u4e2a\u5b9e\u53c2\u4f9d\u7136\u4e0d\u9700\u8981\u5c55\u5f00\uff0c\u6240\u4ee5\u8fd8\u662f\u76f4\u63a5\u590d\u5236\u5230\u7ed3\u679c\u4e0a\uff08\u7b2c <a href=\"#__codelineno-9-16\">16-18</a> \u884c\uff09\u3002</p>\n<p>\u6700\u540e <code>Leave ExpandFunctionArguments</code> \u6253\u5370\u672c\u6b21\u626b\u63cf\u5c55\u5f00\u5f97\u5230\u7684\u7ed3\u679c\uff08\u7b2c <a href=\"#__codelineno-9-19\">19</a> \u884c\uff09\uff0c\u628a\u7ed3\u679c\u7684 <code>Token</code> \u90fd\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f <code>C ## ONCAT(a, b)</code>\uff0c\u4e4b\u540e\u9884\u5904\u7406\u5668\u5c31\u6267\u884c <code>##</code> \u64cd\u4f5c\u7b26\u6765\u751f\u6210\u65b0\u7684\u5185\u5bb9\u3002</p>\n<p><code>##</code> \u6267\u884c\u4e4b\u540e\u5f97\u5230 <code>CONCAT(a, b)</code>\uff0c\u9047\u5230\u5b8f <code>CONCAT</code>\uff0c\u9884\u5904\u7406\u8fd8\u662f\u5148\u8fdb\u5165 <code>HandleIdentifier</code>\uff0c\u6253\u5370\u5b8f\u7684\u4fe1\u606f\uff0c\u53d1\u73b0\u8be5\u5b8f\u72b6\u6001\u662f <code>disable used</code>\uff0c\u662f\u5df2\u7ecf\u5c55\u5f00\u8fc7\u7684\uff0c\u7981\u6b62\u518d\u91cd\u5165\u4e86\uff0c\u663e\u793a <code>Macro is not ok to expand</code>\uff0c\u9884\u5904\u7406\u5668\u4e0d\u518d\u5c55\u5f00\uff0c\u6700\u7ec8\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f <code>CONCAT(a, b)</code>\u3002</p>\n<h4 id=\"2\">\u4f8b\u5b502</h4>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"cp\">#define IDENTITY(arg0) arg0</span>\n<a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a>\n<a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"n\">IDENTITY</span><span class=\"p\">(</span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ONCAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)))</span>\n</code></pre></div>\n<details>\n<summary> <font> Clang \u6253\u5370\u4fe1\u606f\uff08\u70b9\u51fb\u5c55\u5f00\uff09\uff1a</font> </summary>\n<div class=\"language-text highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-11-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-48\">48</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-49\">49</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-50\">50</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-51\">51</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-52\">52</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-53\">53</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-54\">54</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\"></a>HandleIdentifier:\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\"></a>MacroInfo 0x562a148f5a60\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\"></a>    #define &lt;macro&gt;[2853:IDENTITY](arg0) arg0\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\"></a>Macro is ok to expand\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\"></a>\n<a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\"></a>HandleIdentifier:\n<a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\"></a>MacroInfo 0x562a148f5930\n<a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\"></a>\n<a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\"></a>EnterMacro: 0\n<a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\"></a>\n<a id=\"__codelineno-11-12\" name=\"__codelineno-11-12\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-11-13\" name=\"__codelineno-11-13\"></a>MacroInfo 0x562a148f5a60 used\n<a id=\"__codelineno-11-14\" name=\"__codelineno-11-14\"></a>    #define &lt;macro&gt;[2853:IDENTITY](arg0) arg0\n<a id=\"__codelineno-11-15\" name=\"__codelineno-11-15\"></a>Token: 0\n<a id=\"__codelineno-11-16\" name=\"__codelineno-11-16\"></a>identifier: arg0\n<a id=\"__codelineno-11-17\" name=\"__codelineno-11-17\"></a>Args: [identifier: CONCAT][l_paren: ][identifier: C][comma: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][r_paren: ]\n<a id=\"__codelineno-11-18\" name=\"__codelineno-11-18\"></a>getPreExpArgument: [identifier: CONCAT][l_paren: ][identifier: C][comma: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][r_paren: ][eof: ]\n<a id=\"__codelineno-11-19\" name=\"__codelineno-11-19\"></a>\n<a id=\"__codelineno-11-20\" name=\"__codelineno-11-20\"></a>HandleIdentifier:\n<a id=\"__codelineno-11-21\" name=\"__codelineno-11-21\"></a>MacroInfo 0x562a148f5930\n<a id=\"__codelineno-11-22\" name=\"__codelineno-11-22\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-11-23\" name=\"__codelineno-11-23\"></a>Macro is ok to expand\n<a id=\"__codelineno-11-24\" name=\"__codelineno-11-24\"></a>\n<a id=\"__codelineno-11-25\" name=\"__codelineno-11-25\"></a>EnterMacro: 1\n<a id=\"__codelineno-11-26\" name=\"__codelineno-11-26\"></a>\n<a id=\"__codelineno-11-27\" name=\"__codelineno-11-27\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-11-28\" name=\"__codelineno-11-28\"></a>MacroInfo 0x562a148f5930 used\n<a id=\"__codelineno-11-29\" name=\"__codelineno-11-29\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-11-30\" name=\"__codelineno-11-30\"></a>Token: 0\n<a id=\"__codelineno-11-31\" name=\"__codelineno-11-31\"></a>identifier: arg0\n<a id=\"__codelineno-11-32\" name=\"__codelineno-11-32\"></a>Args: [identifier: C]\n<a id=\"__codelineno-11-33\" name=\"__codelineno-11-33\"></a>Token: 1\n<a id=\"__codelineno-11-34\" name=\"__codelineno-11-34\"></a>hashhash:\n<a id=\"__codelineno-11-35\" name=\"__codelineno-11-35\"></a>Token: 2\n<a id=\"__codelineno-11-36\" name=\"__codelineno-11-36\"></a>identifier: arg1\n<a id=\"__codelineno-11-37\" name=\"__codelineno-11-37\"></a>Args: [identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-11-38\" name=\"__codelineno-11-38\"></a>Leave ExpandFunctionArguments: [identifier: C][hashhash: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-11-39\" name=\"__codelineno-11-39\"></a>\n<a id=\"__codelineno-11-40\" name=\"__codelineno-11-40\"></a>LeaveMacro: 1\n<a id=\"__codelineno-11-41\" name=\"__codelineno-11-41\"></a>\n<a id=\"__codelineno-11-42\" name=\"__codelineno-11-42\"></a>HandleIdentifier:\n<a id=\"__codelineno-11-43\" name=\"__codelineno-11-43\"></a>MacroInfo 0x562a148f5930 disabled used\n<a id=\"__codelineno-11-44\" name=\"__codelineno-11-44\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-11-45\" name=\"__codelineno-11-45\"></a>Macro is not ok to expand\n<a id=\"__codelineno-11-46\" name=\"__codelineno-11-46\"></a>ResultArgToks: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-11-47\" name=\"__codelineno-11-47\"></a>Leave ExpandFunctionArguments: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-11-48\" name=\"__codelineno-11-48\"></a>\n<a id=\"__codelineno-11-49\" name=\"__codelineno-11-49\"></a>LeaveMacro: 0\n<a id=\"__codelineno-11-50\" name=\"__codelineno-11-50\"></a>\n<a id=\"__codelineno-11-51\" name=\"__codelineno-11-51\"></a>HandleIdentifier:\n<a id=\"__codelineno-11-52\" name=\"__codelineno-11-52\"></a>MacroInfo 0x562a148f5930 used\n<a id=\"__codelineno-11-53\" name=\"__codelineno-11-53\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-11-54\" name=\"__codelineno-11-54\"></a>Macro is not ok to expand\n</code></pre></div></td></tr></table></div>\n\n</details>\n\n<p>\u7b2c <a href=\"#__codelineno-11-12\">12</a> \u884c\u5f00\u59cb\u5c55\u5f00 <code>IDENTITY</code>\uff0c\u53d1\u73b0\u53c2\u6570 <code>Token 0</code> \u662f <code>CONCAT(...)</code>\uff0c\u4e5f\u662f\u4e00\u4e2a\u5b8f\uff0c\u4e8e\u662f\u5148\u5bf9\u8be5\u53c2\u6570\u8fdb\u884c\u6c42\u503c\u3002</p>\n<p>\u7b2c <a href=\"#__codelineno-11-27\">27</a> \u884c\u5f00\u59cb\u5c55\u5f00\u53c2\u6570\u5b8f <code>CONCAT(...)</code>\uff0c\u8ddf\u4f8b\u5b50 1 \u4e00\u6837\uff0c\u591a\u6b21\u626b\u63cf\u5c55\u5f00\u5b8c\u6210\u540e\u5f97\u5230 <code>CONCAT(a, b)</code> \uff08\u7b2c <a href=\"#__codelineno-11-46\">46</a> \u884c\uff09\u3002</p>\n<p>\u7b2c <a href=\"#__codelineno-11-47\">47</a> \u7ed3\u675f\u5bf9 <code>IDENTITY</code> \u7684\u5c55\u5f00\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u662f <code>CONCAT(a, b)</code>\u3002</p>\n<p>\u7b2c <a href=\"#__codelineno-11-51\">51</a> \u884c\u91cd\u65b0\u626b\u63cf <code>CONCAT(a, b)</code>\uff0c\u53d1\u73b0\u867d\u7136\u662f\u5b8f\uff0c\u4f46\u5728\u4e4b\u524d\u7684\u53c2\u6570\u5c55\u5f00\u8fc7\u7a0b\u4e2d\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u6210\u4e86 <code>used</code>\uff0c\u4e0d\u518d\u9012\u5f52\u5c55\u5f00\uff0c\u76f4\u63a5\u4f5c\u4e3a\u6700\u7ec8\u7ed3\u679c\u3002</p>\n<h4 id=\"3\">\u4f8b\u5b50 3</h4>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a><span class=\"cp\">#define CONCAT(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a><span class=\"cp\">#define IDENTITY_IMPL(arg0) arg0</span>\n<a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a><span class=\"cp\">#define IDENTITY(arg0) IDENTITY_IMPL(arg0)</span>\n<a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a>\n<a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a><span class=\"n\">IDENTITY</span><span class=\"p\">(</span><span class=\"n\">CONCAT</span><span class=\"p\">(</span><span class=\"n\">C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ONCAT</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)))</span>\n</code></pre></div>\n<details>\n<summary> <font>Clang \u6253\u5370\u4fe1\u606f\uff08\u70b9\u51fb\u5c55\u5f00\uff09\uff1a</font> </summary>\n<div class=\"language-text highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-13-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-48\">48</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-49\">49</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-50\">50</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-51\">51</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-52\">52</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-53\">53</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-54\">54</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-55\">55</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-56\">56</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-57\">57</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-58\">58</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-59\">59</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-60\">60</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-61\">61</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-62\">62</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-63\">63</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-64\">64</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-65\">65</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-66\">66</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-67\">67</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-68\">68</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-69\">69</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-70\">70</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-71\">71</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-72\">72</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-73\">73</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-74\">74</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-75\">75</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-76\">76</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-77\">77</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-78\">78</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-79\">79</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-80\">80</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-81\">81</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-82\">82</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-83\">83</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-84\">84</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-85\">85</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-86\">86</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-87\">87</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-88\">88</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-89\">89</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-90\">90</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-91\">91</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-13-92\">92</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-13-1\" name=\"__codelineno-13-1\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-2\" name=\"__codelineno-13-2\"></a>MacroInfo 0x55e824457a80\n<a id=\"__codelineno-13-3\" name=\"__codelineno-13-3\"></a>    #define &lt;macro&gt;[2853:IDENTITY_IMPL](arg0) arg0\n<a id=\"__codelineno-13-4\" name=\"__codelineno-13-4\"></a>\n<a id=\"__codelineno-13-5\" name=\"__codelineno-13-5\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-6\" name=\"__codelineno-13-6\"></a>MacroInfo 0x55e824457ba0\n<a id=\"__codelineno-13-7\" name=\"__codelineno-13-7\"></a>    #define &lt;macro&gt;[2886:IDENTITY](arg0) IDENTITY_IMPL(arg0)\n<a id=\"__codelineno-13-8\" name=\"__codelineno-13-8\"></a>Macro is ok to expand\n<a id=\"__codelineno-13-9\" name=\"__codelineno-13-9\"></a>\n<a id=\"__codelineno-13-10\" name=\"__codelineno-13-10\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-11\" name=\"__codelineno-13-11\"></a>MacroInfo 0x55e824457950\n<a id=\"__codelineno-13-12\" name=\"__codelineno-13-12\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-13\" name=\"__codelineno-13-13\"></a>\n<a id=\"__codelineno-13-14\" name=\"__codelineno-13-14\"></a>EnterMacro: 0\n<a id=\"__codelineno-13-15\" name=\"__codelineno-13-15\"></a>\n<a id=\"__codelineno-13-16\" name=\"__codelineno-13-16\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-13-17\" name=\"__codelineno-13-17\"></a>MacroInfo 0x55e824457ba0 used\n<a id=\"__codelineno-13-18\" name=\"__codelineno-13-18\"></a>    #define &lt;macro&gt;[2886:IDENTITY](arg0) IDENTITY_IMPL(arg0)\n<a id=\"__codelineno-13-19\" name=\"__codelineno-13-19\"></a>Token: 0\n<a id=\"__codelineno-13-20\" name=\"__codelineno-13-20\"></a>identifier: IDENTITY_IMPL\n<a id=\"__codelineno-13-21\" name=\"__codelineno-13-21\"></a>Token: 1\n<a id=\"__codelineno-13-22\" name=\"__codelineno-13-22\"></a>l_paren:\n<a id=\"__codelineno-13-23\" name=\"__codelineno-13-23\"></a>Token: 2\n<a id=\"__codelineno-13-24\" name=\"__codelineno-13-24\"></a>identifier: arg0\n<a id=\"__codelineno-13-25\" name=\"__codelineno-13-25\"></a>Args: [identifier: CONCAT][l_paren: ][identifier: C][comma: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][r_paren: ]\n<a id=\"__codelineno-13-26\" name=\"__codelineno-13-26\"></a>getPreExpArgument: [identifier: CONCAT][l_paren: ][identifier: C][comma: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][r_paren: ][eof: ]\n<a id=\"__codelineno-13-27\" name=\"__codelineno-13-27\"></a>\n<a id=\"__codelineno-13-28\" name=\"__codelineno-13-28\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-29\" name=\"__codelineno-13-29\"></a>MacroInfo 0x55e824457950\n<a id=\"__codelineno-13-30\" name=\"__codelineno-13-30\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-31\" name=\"__codelineno-13-31\"></a>Macro is ok to expand\n<a id=\"__codelineno-13-32\" name=\"__codelineno-13-32\"></a>\n<a id=\"__codelineno-13-33\" name=\"__codelineno-13-33\"></a>EnterMacro: 1\n<a id=\"__codelineno-13-34\" name=\"__codelineno-13-34\"></a>\n<a id=\"__codelineno-13-35\" name=\"__codelineno-13-35\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-13-36\" name=\"__codelineno-13-36\"></a>MacroInfo 0x55e824457950 used\n<a id=\"__codelineno-13-37\" name=\"__codelineno-13-37\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-38\" name=\"__codelineno-13-38\"></a>Token: 0\n<a id=\"__codelineno-13-39\" name=\"__codelineno-13-39\"></a>identifier: arg0\n<a id=\"__codelineno-13-40\" name=\"__codelineno-13-40\"></a>Args: [identifier: C]\n<a id=\"__codelineno-13-41\" name=\"__codelineno-13-41\"></a>Token: 1\n<a id=\"__codelineno-13-42\" name=\"__codelineno-13-42\"></a>hashhash:\n<a id=\"__codelineno-13-43\" name=\"__codelineno-13-43\"></a>Token: 2\n<a id=\"__codelineno-13-44\" name=\"__codelineno-13-44\"></a>identifier: arg1\n<a id=\"__codelineno-13-45\" name=\"__codelineno-13-45\"></a>Args: [identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-46\" name=\"__codelineno-13-46\"></a>Leave ExpandFunctionArguments: [identifier: C][hashhash: ][identifier: ONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-47\" name=\"__codelineno-13-47\"></a>\n<a id=\"__codelineno-13-48\" name=\"__codelineno-13-48\"></a>LeaveMacro: 1\n<a id=\"__codelineno-13-49\" name=\"__codelineno-13-49\"></a>\n<a id=\"__codelineno-13-50\" name=\"__codelineno-13-50\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-51\" name=\"__codelineno-13-51\"></a>MacroInfo 0x55e824457950 disabled used\n<a id=\"__codelineno-13-52\" name=\"__codelineno-13-52\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-53\" name=\"__codelineno-13-53\"></a>Macro is not ok to expand\n<a id=\"__codelineno-13-54\" name=\"__codelineno-13-54\"></a>ResultArgToks: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-55\" name=\"__codelineno-13-55\"></a>Token: 3\n<a id=\"__codelineno-13-56\" name=\"__codelineno-13-56\"></a>r_paren:\n<a id=\"__codelineno-13-57\" name=\"__codelineno-13-57\"></a>Leave ExpandFunctionArguments: [identifier: IDENTITY_IMPL][l_paren: ][identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][r_paren: ]\n<a id=\"__codelineno-13-58\" name=\"__codelineno-13-58\"></a>\n<a id=\"__codelineno-13-59\" name=\"__codelineno-13-59\"></a>LeaveMacro: 0\n<a id=\"__codelineno-13-60\" name=\"__codelineno-13-60\"></a>\n<a id=\"__codelineno-13-61\" name=\"__codelineno-13-61\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-62\" name=\"__codelineno-13-62\"></a>MacroInfo 0x55e824457a80\n<a id=\"__codelineno-13-63\" name=\"__codelineno-13-63\"></a>    #define &lt;macro&gt;[2853:IDENTITY_IMPL](arg0) arg0\n<a id=\"__codelineno-13-64\" name=\"__codelineno-13-64\"></a>Macro is ok to expand\n<a id=\"__codelineno-13-65\" name=\"__codelineno-13-65\"></a>\n<a id=\"__codelineno-13-66\" name=\"__codelineno-13-66\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-67\" name=\"__codelineno-13-67\"></a>MacroInfo 0x55e824457950 used\n<a id=\"__codelineno-13-68\" name=\"__codelineno-13-68\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-69\" name=\"__codelineno-13-69\"></a>\n<a id=\"__codelineno-13-70\" name=\"__codelineno-13-70\"></a>EnterMacro: 2\n<a id=\"__codelineno-13-71\" name=\"__codelineno-13-71\"></a>\n<a id=\"__codelineno-13-72\" name=\"__codelineno-13-72\"></a>Enter ExpandFunctionArguments:\n<a id=\"__codelineno-13-73\" name=\"__codelineno-13-73\"></a>MacroInfo 0x55e824457a80 used\n<a id=\"__codelineno-13-74\" name=\"__codelineno-13-74\"></a>    #define &lt;macro&gt;[2853:IDENTITY_IMPL](arg0) arg0\n<a id=\"__codelineno-13-75\" name=\"__codelineno-13-75\"></a>Token: 0\n<a id=\"__codelineno-13-76\" name=\"__codelineno-13-76\"></a>identifier: arg0\n<a id=\"__codelineno-13-77\" name=\"__codelineno-13-77\"></a>Args: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-78\" name=\"__codelineno-13-78\"></a>getPreExpArgument: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ][eof: ]\n<a id=\"__codelineno-13-79\" name=\"__codelineno-13-79\"></a>\n<a id=\"__codelineno-13-80\" name=\"__codelineno-13-80\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-81\" name=\"__codelineno-13-81\"></a>MacroInfo 0x55e824457950 used\n<a id=\"__codelineno-13-82\" name=\"__codelineno-13-82\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-83\" name=\"__codelineno-13-83\"></a>Macro is not ok to expand\n<a id=\"__codelineno-13-84\" name=\"__codelineno-13-84\"></a>ResultArgToks: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-85\" name=\"__codelineno-13-85\"></a>Leave ExpandFunctionArguments: [identifier: CONCAT][l_paren: ][identifier: a][comma: ][identifier: b][r_paren: ]\n<a id=\"__codelineno-13-86\" name=\"__codelineno-13-86\"></a>\n<a id=\"__codelineno-13-87\" name=\"__codelineno-13-87\"></a>LeaveMacro: 2\n<a id=\"__codelineno-13-88\" name=\"__codelineno-13-88\"></a>\n<a id=\"__codelineno-13-89\" name=\"__codelineno-13-89\"></a>HandleIdentifier:\n<a id=\"__codelineno-13-90\" name=\"__codelineno-13-90\"></a>MacroInfo 0x55e824457950 used\n<a id=\"__codelineno-13-91\" name=\"__codelineno-13-91\"></a>    #define &lt;macro&gt;[2813:CONCAT](arg0, arg1) arg0 ## arg1\n<a id=\"__codelineno-13-92\" name=\"__codelineno-13-92\"></a>Macro is not ok to expand\n</code></pre></div></td></tr></table></div>\n\n</details>\n\n<ul>\n<li>\u7b2c <a href=\"#__codelineno-13-16\">16</a> \u884c\u5f00\u59cb\u5c55\u5f00 <code>IDENTITY</code>\uff0c\u540c\u7406\u9884\u5904\u7406\u5668\u770b\u5230 <code>Token 2</code> \uff08\u4e5f\u5373\u662f <code>arg0</code>\uff09\u662f\u5b8f\uff0c\u4e8e\u662f\u5148\u5c55\u5f00 <code>CONCAT(C, ONCAT(a, b))</code>\u3002</li>\n</ul>\n<ul>\n<li>\u5c55\u5f00 <code>arg0</code> \u540e\u5f97\u5230 <code>CONCAT(a, b)</code> \uff08\u7b2c <a href=\"#__codelineno-13-23\">23-54</a> \u884c\uff09</li>\n</ul>\n<ul>\n<li><code>IDENTITY</code> \u6700\u7ec8\u5c55\u5f00\u4e3a <code>IDENTITY_IMPL(CONCAT(a, b))</code>\uff08\u7b2c <a href=\"#__codelineno-13-57\">57</a> \u884c\uff09</li>\n</ul>\n<ul>\n<li>\u91cd\u65b0\u626b\u63cf\uff0c\u7ee7\u7eed\u5c55\u5f00 <code>IDENTITY_IMPL</code>\uff08\u7b2c <a href=\"#__codelineno-13-61\">61-72</a> \u884c\uff09\uff0c\u53d1\u73b0\u6b64\u65f6\u7684 <code>Token 0</code> \u662f\u5b8f <code>CONCAT(a, b)</code>\uff0c\u4f46\u5904\u4e8e <code>used</code> \u72b6\u6001\uff0c\u4e2d\u6b62\u5c55\u5f00\u5e76\u8fd4\u56de\uff08\u7b2c 75-84\u884c\uff09\uff0c\u6700\u7ec8\u5f97\u5230\u7684\u7ed3\u679c\u8fd8\u662f <code>CONCAT(a, b)</code>\uff08\u7b2c <a href=\"#__codelineno-13-85\">85</a> \u884c\uff09\u3002</li>\n</ul>\n<ul>\n<li>\u91cd\u65b0\u626b\u63cf\u7ed3\u679c\uff0c\u53d1\u73b0\u5b8f <code>CONCAT(a, b)</code> \u7684\u72b6\u6001\u662f <code>used</code>\uff0c\u505c\u6b62\u5c55\u5f00\u5e76\u5f97\u5230\u6700\u7ec8\u7684\u7ed3\u679c\u3002</li>\n</ul>\n<p>\u901a\u8fc7\u4ee5\u4e0a\u4e09\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u7684\u7406\u89e3\u9884\u5904\u7406\u5668\u5c55\u5f00\u5b8f\u7684\u8fc7\u7a0b\uff0c\u8fd9\u91cc\u4e0d\u518d\u5bf9\u9884\u5904\u7406\u5668\u8fdb\u884c\u66f4\u6df1\u5165\u7684\u63a2\u8ba8\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u5bf9\u7167\u6211\u63d0\u4f9b\u7684\u4fee\u6539\u6587\u4ef6\u6765\u7814\u7a76\u3002</p>\n<h2 id=\"_10\">\u5b8f\u7f16\u7a0b\u5b9e\u73b0</h2>\n<p>\u4e0b\u9762\u6211\u4eec\u5f00\u59cb\u8fdb\u5165\u5230\u4e86\u4e3b\u9898\uff08\u524d\u9762\u90a3\u4e00\u5927\u6bb5\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\u5b8f\u5c55\u5f00\u89c4\u5219\uff09\uff0c\u5b8f\u7f16\u7a0b\u5b9e\u73b0\u3002</p>\n<h4 id=\"_11\">\u57fa\u672c\u7b26\u53f7</h4>\n<p>\u9996\u5148\u53ef\u4ee5\u5148\u5b9a\u4e49\u5b8f\u7684\u7279\u6b8a\u7b26\u53f7\uff0c\u505a\u6c42\u503c\u548c\u62fc\u63a5\u7684\u65f6\u5019\u4f1a\u7528\u5230</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-14-1\" name=\"__codelineno-14-1\" href=\"#__codelineno-14-1\"></a><span class=\"cp\">#define PP_LPAREN() (</span>\n<a id=\"__codelineno-14-2\" name=\"__codelineno-14-2\" href=\"#__codelineno-14-2\"></a><span class=\"cp\">#define PP_RPAREN() )</span>\n<a id=\"__codelineno-14-3\" name=\"__codelineno-14-3\" href=\"#__codelineno-14-3\"></a><span class=\"cp\">#define PP_COMMA() ,</span>\n<a id=\"__codelineno-14-4\" name=\"__codelineno-14-4\" href=\"#__codelineno-14-4\"></a><span class=\"cp\">#define PP_EMPTY()</span>\n<a id=\"__codelineno-14-5\" name=\"__codelineno-14-5\" href=\"#__codelineno-14-5\"></a><span class=\"cp\">#define PP_HASHHASH # ## #      </span><span class=\"c1\">// \u8868\u793a ## \u5b57\u7b26\u4e32\uff0c\u4f46\u53ea\u662f\u4f5c\u4e3a\u5b57\u7b26\u4e32\uff0c\u4e0d\u4f1a\u5f53\u4f5c ## \u64cd\u4f5c\u7b26\u6765\u5904\u7406</span>\n</code></pre></div>\n<h4 id=\"_12\">\u6c42\u503c</h4>\n<p>\u5229\u7528\u53c2\u6570\u4f18\u5148\u5c55\u5f00\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u5199\u51fa\u4e00\u4e2a\u6c42\u503c\u5b8f\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-15-1\" name=\"__codelineno-15-1\" href=\"#__codelineno-15-1\"></a><span class=\"cp\">#define PP_IDENTITY(arg0) arg0</span>\n<a id=\"__codelineno-15-2\" name=\"__codelineno-15-2\" href=\"#__codelineno-15-2\"></a>\n<a id=\"__codelineno-15-3\" name=\"__codelineno-15-3\" href=\"#__codelineno-15-3\"></a><span class=\"n\">PP_COMMA</span><span class=\"w\"> </span><span class=\"n\">PP_LPAREN</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">PP_RPAREN</span><span class=\"p\">()</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; PP_COMMA ( )</span>\n<a id=\"__codelineno-15-4\" name=\"__codelineno-15-4\" href=\"#__codelineno-15-4\"></a><span class=\"n\">PP_IDENTITY</span><span class=\"p\">(</span><span class=\"n\">PP_COMMA</span><span class=\"w\"> </span><span class=\"n\">PP_LPAREN</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">PP_RPAREN</span><span class=\"p\">())</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; PP_COMMA() -&gt; ,</span>\n</code></pre></div>\n<p>\u5982\u679c\u53ea\u662f\u5199 <code>PP_COMMA PP_LPAREN() PP_RPAREN()</code>\uff0c\u9884\u5904\u7406\u5668\u53ea\u4f1a\u5206\u522b\u5904\u7406\u6bcf\u4e2a\u5b8f\uff0c\u5bf9\u5c55\u5f00\u7684\u7ed3\u679c\u4e0d\u4f1a\u518d\u5408\u5e76\u5904\u7406\u3002\u52a0\u4e0a <code>PP_IDENTITY</code> \u4e4b\u540e\uff0c\u9884\u5904\u7406\u5668\u53ef\u4ee5\u5bf9\u5c55\u5f00\u5f97\u5230\u7684 <code>PP_COMMA()</code> \u518d\u8fdb\u884c\u6c42\u503c\uff0c\u5f97\u5230 <code>,</code>\u3002</p>\n<h4 id=\"_13\">\u62fc\u63a5</h4>\n<p>\u7531\u4e8e <code>##</code> \u62fc\u63a5\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u4f1a\u5c55\u5f00\u5de6\u53f3\u4e24\u8fb9\u7684\u53c2\u6570\uff0c\u4e3a\u4e86\u8ba9\u53c2\u6570\u53ef\u4ee5\u5148\u6c42\u503c\u518d\u62fc\u63a5\uff0c\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-16-1\" name=\"__codelineno-16-1\" href=\"#__codelineno-16-1\"></a><span class=\"cp\">#define PP_CONCAT(arg0, arg1) PP_CONCAT_IMPL(arg0, arg1)</span>\n<a id=\"__codelineno-16-2\" name=\"__codelineno-16-2\" href=\"#__codelineno-16-2\"></a><span class=\"cp\">#define PP_CONCAT_IMPL(arg0, arg1) arg0 ## arg1</span>\n<a id=\"__codelineno-16-3\" name=\"__codelineno-16-3\" href=\"#__codelineno-16-3\"></a>\n<a id=\"__codelineno-16-4\" name=\"__codelineno-16-4\" href=\"#__codelineno-16-4\"></a><span class=\"n\">PP_CONCAT</span><span class=\"p\">(</span><span class=\"n\">PP_IDENTITY</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">PP_IDENTITY</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\">         </span><span class=\"c1\">// -&gt; 12</span>\n<a id=\"__codelineno-16-5\" name=\"__codelineno-16-5\" href=\"#__codelineno-16-5\"></a><span class=\"n\">PP_CONCAT_IMPL</span><span class=\"p\">(</span><span class=\"n\">PP_IDENTITY</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">PP_IDENTITY</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; PP_IDENTITY(1)PP_IDENTITY(2) -&gt; \u62a5\u9519</span>\n</code></pre></div>\n<p>\u8fd9\u91cc <code>PP_CONCAT</code> \u7528\u5230\u7684\u65b9\u6cd5\u53eb\u505a\u5ef6\u8fdf\u62fc\u63a5\uff0c\u5728\u5c55\u5f00\u4e3a <code>PP_CONCAT_IMPL</code> \u7684\u65f6\u5019\uff0c<code>arg0</code> \u548c <code>arg1</code> \u90fd\u4f1a\u5148\u5c55\u5f00\u6c42\u503c\uff0c\u4e4b\u540e\u518d\u7531 <code>PP_CONCAT_IMPL</code> \u6267\u884c\u771f\u6b63\u7684\u62fc\u63a5\u64cd\u4f5c\u3002</p>\n<h4 id=\"_14\">\u903b\u8f91\u8fd0\u7b97</h4>\n<p>\u501f\u52a9 <code>PP_CONCAT</code> \u53ef\u4ee5\u5b9e\u73b0\u903b\u8f91\u8fd0\u7b97\u3002\u9996\u5148\u5b9a\u4e49 <code>BOOL</code> \u503c\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-17-1\" name=\"__codelineno-17-1\" href=\"#__codelineno-17-1\"></a><span class=\"cp\">#define PP_BOOL(arg0) PP_CONCAT(PP_BOOL_, arg0)</span>\n<a id=\"__codelineno-17-2\" name=\"__codelineno-17-2\" href=\"#__codelineno-17-2\"></a><span class=\"cp\">#define PP_BOOL_0 0</span>\n<a id=\"__codelineno-17-3\" name=\"__codelineno-17-3\" href=\"#__codelineno-17-3\"></a><span class=\"cp\">#define PP_BOOL_1 1</span>\n<a id=\"__codelineno-17-4\" name=\"__codelineno-17-4\" href=\"#__codelineno-17-4\"></a><span class=\"cp\">#define PP_BOOL_2 1</span>\n<a id=\"__codelineno-17-5\" name=\"__codelineno-17-5\" href=\"#__codelineno-17-5\"></a><span class=\"cp\">#define PP_BOOL_3 1</span>\n<a id=\"__codelineno-17-6\" name=\"__codelineno-17-6\" href=\"#__codelineno-17-6\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-17-7\" name=\"__codelineno-17-7\" href=\"#__codelineno-17-7\"></a><span class=\"cp\">#define PP_BOOL_256 1</span>\n<a id=\"__codelineno-17-8\" name=\"__codelineno-17-8\" href=\"#__codelineno-17-8\"></a>\n<a id=\"__codelineno-17-9\" name=\"__codelineno-17-9\" href=\"#__codelineno-17-9\"></a><span class=\"n\">PP_BOOL</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; PP_BOOL_3 -&gt; 1</span>\n</code></pre></div>\n<p>\u7528<code>PP_CONCAT</code> \u5148\u628a <code>PP_BOOL_</code> \u548c <code>arg0</code> \u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u518d\u5bf9\u62fc\u63a5\u7ed3\u679c\u8fdb\u884c\u6c42\u503c\u3002\u8fd9\u91cc\u7684 <code>arg0</code> \u8981\u6c42\u662f\u6c42\u503c\u4e4b\u540e\u5f97\u5230 <code>[0, 256]</code> \u8303\u56f4\u7684\u6570\u5b57\uff0c\u62fc\u63a5\u5728 <code>PP_BOOL_</code> \u540e\u9762\u6c42\u503c\uff0c\u5c31\u80fd\u5f97\u5230\u5e03\u5c14\u503c\u3002\u4e0e\u6216\u975e\u8fd0\u7b97\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-18-1\" name=\"__codelineno-18-1\" href=\"#__codelineno-18-1\"></a><span class=\"cp\">#define PP_NOT(arg0) PP_CONCAT(PP_NOT_, PP_BOOL(arg0))</span>\n<a id=\"__codelineno-18-2\" name=\"__codelineno-18-2\" href=\"#__codelineno-18-2\"></a><span class=\"cp\">#define PP_NOT_0 1</span>\n<a id=\"__codelineno-18-3\" name=\"__codelineno-18-3\" href=\"#__codelineno-18-3\"></a><span class=\"cp\">#define PP_NOT_1 0</span>\n<a id=\"__codelineno-18-4\" name=\"__codelineno-18-4\" href=\"#__codelineno-18-4\"></a>\n<a id=\"__codelineno-18-5\" name=\"__codelineno-18-5\" href=\"#__codelineno-18-5\"></a><span class=\"cp\">#define PP_AND(arg0, arg1) PP_CONCAT(PP_AND_, PP_CONCAT(PP_BOOL(arg0), PP_BOOL(arg1)))</span>\n<a id=\"__codelineno-18-6\" name=\"__codelineno-18-6\" href=\"#__codelineno-18-6\"></a><span class=\"cp\">#define PP_AND_00 0</span>\n<a id=\"__codelineno-18-7\" name=\"__codelineno-18-7\" href=\"#__codelineno-18-7\"></a><span class=\"cp\">#define PP_AND_01 0</span>\n<a id=\"__codelineno-18-8\" name=\"__codelineno-18-8\" href=\"#__codelineno-18-8\"></a><span class=\"cp\">#define PP_AND_10 0</span>\n<a id=\"__codelineno-18-9\" name=\"__codelineno-18-9\" href=\"#__codelineno-18-9\"></a><span class=\"cp\">#define PP_AND_11 1</span>\n<a id=\"__codelineno-18-10\" name=\"__codelineno-18-10\" href=\"#__codelineno-18-10\"></a>\n<a id=\"__codelineno-18-11\" name=\"__codelineno-18-11\" href=\"#__codelineno-18-11\"></a><span class=\"cp\">#define PP_OR(arg0, arg1) PP_CONCAT(PP_OR_, PP_CONCAT(PP_BOOL(arg0), PP_BOOL(arg1)))</span>\n<a id=\"__codelineno-18-12\" name=\"__codelineno-18-12\" href=\"#__codelineno-18-12\"></a><span class=\"cp\">#define PP_OR_00 0</span>\n<a id=\"__codelineno-18-13\" name=\"__codelineno-18-13\" href=\"#__codelineno-18-13\"></a><span class=\"cp\">#define PP_OR_01 1</span>\n<a id=\"__codelineno-18-14\" name=\"__codelineno-18-14\" href=\"#__codelineno-18-14\"></a><span class=\"cp\">#define PP_OR_10 1</span>\n<a id=\"__codelineno-18-15\" name=\"__codelineno-18-15\" href=\"#__codelineno-18-15\"></a><span class=\"cp\">#define PP_OR_11 1</span>\n<a id=\"__codelineno-18-16\" name=\"__codelineno-18-16\" href=\"#__codelineno-18-16\"></a>\n<a id=\"__codelineno-18-17\" name=\"__codelineno-18-17\" href=\"#__codelineno-18-17\"></a><span class=\"n\">PP_NOT</span><span class=\"p\">(</span><span class=\"n\">PP_BOOL</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; PP_CONCAT(PP_NOT_, 1) -&gt; PP_NOT_1 -&gt; 0</span>\n<a id=\"__codelineno-18-18\" name=\"__codelineno-18-18\" href=\"#__codelineno-18-18\"></a><span class=\"n\">PP_AND</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">            </span><span class=\"c1\">// -&gt; PP_CONCAT(PP_AND_, 11) -&gt; PP_AND_11 -&gt; 1</span>\n<a id=\"__codelineno-18-19\" name=\"__codelineno-18-19\" href=\"#__codelineno-18-19\"></a><span class=\"n\">PP_AND</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\">            </span><span class=\"c1\">// -&gt; PP_CONCAT(PP_AND_, 10) -&gt; PP_AND_10 -&gt; 0</span>\n<a id=\"__codelineno-18-20\" name=\"__codelineno-18-20\" href=\"#__codelineno-18-20\"></a><span class=\"n\">PP_OR</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; PP_CONCAT(PP_OR_, 10) -&gt; PP_OR_10, -&gt; 1</span>\n</code></pre></div>\n<p>\u5148\u7528 <code>PP_BOOL</code> \u5bf9\u53c2\u6570\u6c42\u503c\uff0c\u4e4b\u540e\u518d\u6839\u636e <code>0 1</code> \u7684\u7ec4\u5408\u6765\u62fc\u63a5\u903b\u8f91\u8fd0\u7b97\u7684\u7ed3\u679c\u3002\u5982\u679c\u4e0d\u7528 <code>PP_BOOL</code> \u6765\u6c42\u503c\uff0c\u90a3\u4e48\u53c2\u6570\u5c31\u53ea\u80fd\u652f\u6301 <code>0 1</code> \u4e24\u79cd\u6570\u503c\uff0c\u9002\u7528\u6027\u5927\u5927\u964d\u4f4e\u3002\u540c\u7406\u4e5f\u53ef\u4ee5\u5199\u51fa\u5f02\u6216\uff0c\u6216\u975e\u7b49\u64cd\u4f5c\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u5c1d\u8bd5\u3002</p>\n<h4 id=\"_15\">\u6761\u4ef6\u9009\u62e9</h4>\n<p>\u5229\u7528 <code>PP_BOOL</code> \u548c <code>PP_CONCAT</code>\uff0c\u8fd8\u53ef\u4ee5\u5199\u51fa\u6761\u4ef6\u9009\u62e9\u8bed\u53e5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-19-1\" name=\"__codelineno-19-1\" href=\"#__codelineno-19-1\"></a><span class=\"cp\">#define PP_IF(if, then, else) PP_CONCAT(PP_IF_, PP_BOOL(if))(then, else)</span>\n<a id=\"__codelineno-19-2\" name=\"__codelineno-19-2\" href=\"#__codelineno-19-2\"></a><span class=\"cp\">#define PP_IF_1(then, else) then</span>\n<a id=\"__codelineno-19-3\" name=\"__codelineno-19-3\" href=\"#__codelineno-19-3\"></a><span class=\"cp\">#define PP_IF_0(then, else) else</span>\n<a id=\"__codelineno-19-4\" name=\"__codelineno-19-4\" href=\"#__codelineno-19-4\"></a>\n<a id=\"__codelineno-19-5\" name=\"__codelineno-19-5\" href=\"#__codelineno-19-5\"></a><span class=\"n\">PP_IF</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; PP_IF_1(2, 3) -&gt; 2</span>\n<a id=\"__codelineno-19-6\" name=\"__codelineno-19-6\" href=\"#__codelineno-19-6\"></a><span class=\"n\">PP_IF</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; PP_IF_0(2, 3) -&gt; 3</span>\n</code></pre></div>\n<p><code>if</code> \u6c42\u503c\u5982\u679c\u662f <code>1</code>\uff0c\u7528 <code>PP_CONCAT</code> \u62fc\u63a5\u6210 <code>PP_IF_1</code>\uff0c\u6700\u540e\u5c55\u5f00\u4e3a <code>then</code> \u7684\u503c\uff1b\u540c\u7406\u82e5 <code>if</code> \u6c42\u503c\u4e3a <code>0</code>\uff0c\u5f97\u5230 <code>PP_IF_0</code>\u3002</p>\n<h4 id=\"_16\">\u9012\u589e\u9012\u51cf</h4>\n<p>\u6574\u6570\u9012\u589e\u9012\u51cf\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-20-1\" name=\"__codelineno-20-1\" href=\"#__codelineno-20-1\"></a><span class=\"cp\">#define PP_INC(arg0) PP_CONCAT(PP_INC_, arg0)</span>\n<a id=\"__codelineno-20-2\" name=\"__codelineno-20-2\" href=\"#__codelineno-20-2\"></a><span class=\"cp\">#define PP_INC_0 1</span>\n<a id=\"__codelineno-20-3\" name=\"__codelineno-20-3\" href=\"#__codelineno-20-3\"></a><span class=\"cp\">#define PP_INC_1 2</span>\n<a id=\"__codelineno-20-4\" name=\"__codelineno-20-4\" href=\"#__codelineno-20-4\"></a><span class=\"cp\">#define PP_INC_2 3</span>\n<a id=\"__codelineno-20-5\" name=\"__codelineno-20-5\" href=\"#__codelineno-20-5\"></a><span class=\"cp\">#define PP_INC_3 4</span>\n<a id=\"__codelineno-20-6\" name=\"__codelineno-20-6\" href=\"#__codelineno-20-6\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-20-7\" name=\"__codelineno-20-7\" href=\"#__codelineno-20-7\"></a><span class=\"cp\">#define PP_INC_255 256</span>\n<a id=\"__codelineno-20-8\" name=\"__codelineno-20-8\" href=\"#__codelineno-20-8\"></a><span class=\"cp\">#define PP_INC_256 256</span>\n<a id=\"__codelineno-20-9\" name=\"__codelineno-20-9\" href=\"#__codelineno-20-9\"></a>\n<a id=\"__codelineno-20-10\" name=\"__codelineno-20-10\" href=\"#__codelineno-20-10\"></a><span class=\"cp\">#define PP_DEC(arg0) PP_CONCAT(PP_DEC_, arg0)</span>\n<a id=\"__codelineno-20-11\" name=\"__codelineno-20-11\" href=\"#__codelineno-20-11\"></a><span class=\"cp\">#define PP_DEC_0 0</span>\n<a id=\"__codelineno-20-12\" name=\"__codelineno-20-12\" href=\"#__codelineno-20-12\"></a><span class=\"cp\">#define PP_DEC_1 0</span>\n<a id=\"__codelineno-20-13\" name=\"__codelineno-20-13\" href=\"#__codelineno-20-13\"></a><span class=\"cp\">#define PP_DEC_2 1</span>\n<a id=\"__codelineno-20-14\" name=\"__codelineno-20-14\" href=\"#__codelineno-20-14\"></a><span class=\"cp\">#define PP_DEC_3 2</span>\n<a id=\"__codelineno-20-15\" name=\"__codelineno-20-15\" href=\"#__codelineno-20-15\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-20-16\" name=\"__codelineno-20-16\" href=\"#__codelineno-20-16\"></a><span class=\"cp\">#define PP_DEC_255 254</span>\n<a id=\"__codelineno-20-17\" name=\"__codelineno-20-17\" href=\"#__codelineno-20-17\"></a><span class=\"cp\">#define PP_DEC_256 255</span>\n<a id=\"__codelineno-20-18\" name=\"__codelineno-20-18\" href=\"#__codelineno-20-18\"></a>\n<a id=\"__codelineno-20-19\" name=\"__codelineno-20-19\" href=\"#__codelineno-20-19\"></a><span class=\"n\">PP_INC</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">                   </span><span class=\"c1\">// -&gt; PP_INC_2 -&gt; 3</span>\n<a id=\"__codelineno-20-20\" name=\"__codelineno-20-20\" href=\"#__codelineno-20-20\"></a><span class=\"n\">PP_DEC</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">                   </span><span class=\"c1\">// -&gt; PP_DEC_3 -&gt; 2</span>\n</code></pre></div>\n<p>\u8ddf <code>PP_BOOL</code> \u7c7b\u4f3c\uff0c\u6574\u6570\u7684\u9012\u589e\u9012\u51cf\u4e5f\u662f\u6709\u8303\u56f4\u9650\u5236\u7684\uff0c\u8fd9\u91cc\u8303\u56f4\u8bbe\u7f6e\u4e3a <code>[0, 256]</code>\uff0c\u9012\u589e\u5230 <code>256</code> \u4e4b\u540e\uff0c\u5b89\u5168\u8d77\u89c1\uff0c<code>PP_INC_256</code> \u4f1a\u8fd4\u56de\u81ea\u8eab <code>256</code> \u4f5c\u4e3a\u8fb9\u754c\uff0c\u540c\u7406 <code>PP_DEC_0</code> \u4e5f\u662f\u8fd4\u56de <code>0</code>\u3002</p>\n<h4 id=\"_17\">\u53d8\u957f\u53c2\u6570</h4>\n<p>\u5b8f\u53ef\u4ee5\u63a5\u53d7\u53d8\u957f\u53c2\u6570\uff0c\u683c\u5f0f\u662f\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-21-1\" name=\"__codelineno-21-1\" href=\"#__codelineno-21-1\"></a><span class=\"cp\">#define LOG(format, ...) printf(&quot;log: &quot; format, __VA_ARGS__)</span>\n<a id=\"__codelineno-21-2\" name=\"__codelineno-21-2\" href=\"#__codelineno-21-2\"></a>\n<a id=\"__codelineno-21-3\" name=\"__codelineno-21-3\" href=\"#__codelineno-21-3\"></a><span class=\"n\">LOG</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello %s</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;World&quot;</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello %s\\n&quot;, &quot;World&quot;);</span>\n<a id=\"__codelineno-21-4\" name=\"__codelineno-21-4\" href=\"#__codelineno-21-4\"></a><span class=\"n\">LOG</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello World&quot;</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello World&quot;, ); \u591a\u4e86\u4e2a\u9017\u53f7\uff0c\u7f16\u8bd1\u62a5\u9519</span>\n</code></pre></div>\n<p>\u7531\u4e8e\u53d8\u957f\u53c2\u6570\u6709\u53ef\u80fd\u4e3a\u7a7a\uff0c\u7a7a\u7684\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u5931\u8d25\uff0c\u56e0\u6b64 C++ 20 \u5f15\u5165\u4e86 <code>__VA_OPT__</code>\uff0c\u5982\u679c\u53d8\u957f\u53c2\u6570\u662f\u7a7a\uff0c\u5219\u8fd4\u56de\u7a7a\uff0c\u5426\u5219\u8fd4\u56de\u539f\u53c2\u6570\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-22-1\" name=\"__codelineno-22-1\" href=\"#__codelineno-22-1\"></a><span class=\"cp\">#define LOG2(format, ...) printf(&quot;log: &quot; format __VA_OPT__(,) __VA_ARGS__)</span>\n<a id=\"__codelineno-22-2\" name=\"__codelineno-22-2\" href=\"#__codelineno-22-2\"></a>\n<a id=\"__codelineno-22-3\" name=\"__codelineno-22-3\" href=\"#__codelineno-22-3\"></a><span class=\"n\">LOG2</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello %s</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;World&quot;</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello %s\\n&quot;, &quot;World&quot;);</span>\n<a id=\"__codelineno-22-4\" name=\"__codelineno-22-4\" href=\"#__codelineno-22-4\"></a><span class=\"n\">LOG2</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello World&quot;</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello World&quot; ); \u6ca1\u6709\u9017\u53f7\uff0c\u6b63\u5e38\u7f16\u8bd1</span>\n</code></pre></div>\n<p>\u4f46\u53ef\u60dc\u53ea\u6709 C++ 20 \u4ee5\u4e0a\u6807\u51c6\u624d\u6709\u8fd9\u4e2a\u5b8f\uff0c\u4e0b\u6587\u4e2d\u6211\u4eec\u5c06\u4f1a\u7ed9\u51fa <code>__VA_OPT__</code> \u7684\u5b9e\u73b0\u65b9\u6cd5\u3002</p>\n<h4 id=\"_18\">\u60f0\u6027\u6c42\u503c</h4>\n<p>\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-23-1\" name=\"__codelineno-23-1\" href=\"#__codelineno-23-1\"></a><span class=\"n\">PP_IF</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_COMMA</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">PP_LPAREN</span><span class=\"p\">())</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; PP_IF_1(,,)) -&gt; \u62a5\u9519 unterminated argument list invoking macro &quot;PP_IF_1&quot;</span>\n</code></pre></div>\n<p>\u6211\u4eec\u77e5\u9053\uff0c\u5b8f\u5c55\u5f00\u7684\u65f6\u5019\u4f1a\u5bf9\u5148\u53c2\u6570\u8fdb\u884c\u6c42\u503c\u3002<code>PP_COMMA()</code> \u548c <code>PP_LPAREN()</code> \u6c42\u503c\u4e4b\u540e\u518d\u4f20\u7ed9 <code>PP_IF_1</code>\uff0c\u5f97\u5230 <code>PP_IF_1(,,))</code>\uff0c\u5bfc\u81f4\u9884\u5904\u7406\u51fa\u9519\u3002\u6b64\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u4e00\u79cd\u53eb\u505a\u60f0\u6027\u6c42\u503c\u65b9\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-24-1\" name=\"__codelineno-24-1\" href=\"#__codelineno-24-1\"></a><span class=\"n\">PP_IF</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_COMMA</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_LPAREN</span><span class=\"p\">)()</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; PP_IF_1(PP_COMMA, PP_LPAREN)() -&gt; PP_COMMA() -&gt; ,</span>\n</code></pre></div>\n<p>\u6539\u6210\u8fd9\u79cd\u5199\u6cd5\uff0c\u53ea\u4f20\u5b8f\u7684\u540d\u5b57\uff0c\u8ba9 <code>PP_IF</code> \u9009\u51fa\u9700\u8981\u7684\u5b8f\u540d\u5b57\u4e4b\u540e\uff0c\u518d\u8ddf\u62ec\u53f7 <code>()</code> \u62fc\u63a5\u5728\u4e00\u8d77\u7ec4\u6210\u5b8c\u6210\u7684\u5b8f\uff0c\u6700\u540e\u518d\u5c55\u5f00\u3002\u60f0\u6027\u6c42\u503c\u5728\u5b8f\u7f16\u7a0b\u91cc\u9762\u4e5f\u662f\u5f88\u5e38\u89c1\u7684\u3002</p>\n<h4 id=\"_19\">\u4ee5\u62ec\u53f7\u5f00\u59cb</h4>\n<p>\u5224\u65ad\u53d8\u957f\u53c2\u6570\u662f\u5426\u4ee5\u62ec\u53f7\u5f00\u59cb\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-25-1\" name=\"__codelineno-25-1\" href=\"#__codelineno-25-1\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS(...) \\</span>\n<a id=\"__codelineno-25-2\" name=\"__codelineno-25-2\" href=\"#__codelineno-25-2\"></a><span class=\"cp\">    PP_IS_BEGIN_PARENS_PROCESS( \\</span>\n<a id=\"__codelineno-25-3\" name=\"__codelineno-25-3\" href=\"#__codelineno-25-3\"></a><span class=\"cp\">        PP_IS_BEGIN_PARENS_CONCAT( \\</span>\n<a id=\"__codelineno-25-4\" name=\"__codelineno-25-4\" href=\"#__codelineno-25-4\"></a><span class=\"cp\">            PP_IS_BEGIN_PARENS_PRE_, PP_IS_BEGIN_PARENS_EAT __VA_ARGS__ \\</span>\n<a id=\"__codelineno-25-5\" name=\"__codelineno-25-5\" href=\"#__codelineno-25-5\"></a><span class=\"cp\">        ) \\</span>\n<a id=\"__codelineno-25-6\" name=\"__codelineno-25-6\" href=\"#__codelineno-25-6\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-25-7\" name=\"__codelineno-25-7\" href=\"#__codelineno-25-7\"></a>\n<a id=\"__codelineno-25-8\" name=\"__codelineno-25-8\" href=\"#__codelineno-25-8\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_PROCESS(...) PP_IS_BEGIN_PARENS_PROCESS_0(__VA_ARGS__)</span>\n<a id=\"__codelineno-25-9\" name=\"__codelineno-25-9\" href=\"#__codelineno-25-9\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_PROCESS_0(arg0, ...) arg0</span>\n<a id=\"__codelineno-25-10\" name=\"__codelineno-25-10\" href=\"#__codelineno-25-10\"></a>\n<a id=\"__codelineno-25-11\" name=\"__codelineno-25-11\" href=\"#__codelineno-25-11\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_CONCAT(arg0, ...) PP_IS_BEGIN_PARENS_CONCAT_IMPL(arg0, __VA_ARGS__)</span>\n<a id=\"__codelineno-25-12\" name=\"__codelineno-25-12\" href=\"#__codelineno-25-12\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_CONCAT_IMPL(arg0, ...) arg0 ## __VA_ARGS__</span>\n<a id=\"__codelineno-25-13\" name=\"__codelineno-25-13\" href=\"#__codelineno-25-13\"></a>\n<a id=\"__codelineno-25-14\" name=\"__codelineno-25-14\" href=\"#__codelineno-25-14\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_PRE_1 1,</span>\n<a id=\"__codelineno-25-15\" name=\"__codelineno-25-15\" href=\"#__codelineno-25-15\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_PRE_PP_IS_BEGIN_PARENS_EAT 0,</span>\n<a id=\"__codelineno-25-16\" name=\"__codelineno-25-16\" href=\"#__codelineno-25-16\"></a><span class=\"cp\">#define PP_IS_BEGIN_PARENS_EAT(...) 1</span>\n<a id=\"__codelineno-25-17\" name=\"__codelineno-25-17\" href=\"#__codelineno-25-17\"></a>\n<a id=\"__codelineno-25-18\" name=\"__codelineno-25-18\" href=\"#__codelineno-25-18\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(())</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-25-19\" name=\"__codelineno-25-19\" href=\"#__codelineno-25-19\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">((()))</span><span class=\"w\">            </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-25-20\" name=\"__codelineno-25-20\" href=\"#__codelineno-25-20\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">)</span><span class=\"w\">         </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-25-21\" name=\"__codelineno-25-21\" href=\"#__codelineno-25-21\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">())</span><span class=\"w\">           </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-25-22\" name=\"__codelineno-25-22\" href=\"#__codelineno-25-22\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">())</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-25-23\" name=\"__codelineno-25-23\" href=\"#__codelineno-25-23\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(()</span><span class=\"n\">aa</span><span class=\"p\">(</span><span class=\"n\">bb</span><span class=\"p\">()</span><span class=\"n\">cc</span><span class=\"p\">))</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-25-24\" name=\"__codelineno-25-24\" href=\"#__codelineno-25-24\"></a><span class=\"n\">PP_IS_BEGIN_PARENS</span><span class=\"p\">(</span><span class=\"n\">aa</span><span class=\"p\">(</span><span class=\"n\">bb</span><span class=\"p\">()</span><span class=\"n\">cc</span><span class=\"p\">))</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p><code>PP_IS_BEGIN_PARENS</code> \u53ef\u4ee5\u7528\u6765\u5224\u65ad\u4f20\u5165\u7684\u53c2\u6570\u662f\u5426\u4ee5\u62ec\u53f7\u5f00\u59cb\uff0c\u5728\u9700\u8981\u5904\u7406\u62ec\u53f7\u53c2\u6570\u7684\u65f6\u5019\u4f1a\u9700\u8981\u7528\u5230\uff08\u8b6c\u5982\u540e\u9762\u8bf4\u5230\u7684 <code>__VA_OPT__</code> \u5b9e\u73b0\uff09\u3002\u770b\u4e0a\u53bb\u6709\u70b9\u590d\u6742\uff0c\u6838\u5fc3\u601d\u60f3\u5c31\u662f\u6784\u5efa\u51fa\u4e00\u4e2a\u5b8f\uff0c\u82e5\u53d8\u957f\u53c2\u6570\u4ee5\u62ec\u53f7\u5f00\u59cb\uff0c\u5219\u53ef\u4ee5\u8ddf\u62ec\u53f7\u8fde\u5728\u4e00\u8d77\u6c42\u503c\u5f97\u5230\u4e00\u79cd\u7ed3\u679c\uff0c\u5426\u5219\u5c31\u53e6\u5916\u6c42\u503c\u5f97\u5230\u53e6\u4e00\u79cd\u7ed3\u679c\u3002\u6211\u4eec\u6765\u6162\u6162\u770b\uff1a</p>\n<p><code>PP_IS_BEGIN_PARENS_PROCESS</code> \u548c <code>PP_IS_BEGIN_PARENS_PROCESS_0</code> \u7ec4\u6210\u7684\u5b8f\u529f\u80fd\u662f\u5148\u5bf9\u4f20\u5165\u7684\u4e0d\u5b9a\u53c2\u6570\u6c42\u503c\uff0c\u7136\u540e\u53d6\u7b2c 0 \u4e2a\u53c2\u6570\u3002</p>\n<p><code>PP_IS_BEGIN_PARENS_CONCAT(PP_IS_BEGIN_PARENS_PRE_, PP_IS_BEGIN_PARENS_EAT __VA_ARGS__)</code> \u662f\u5148\u5bf9 <code>PP_IS_BEGIN_PARENS_EAT __VA_ARGS__</code> \u6c42\u503c\uff0c\u5728\u628a\u6c42\u503c\u7ed3\u679c\u8ddf <code>PP_IS_BEGIN_PARENS_PRE_</code> \u62fc\u63a5\u5728\u4e00\u8d77\u3002</p>\n<p><code>PP_IS_BEGIN_PARENS_EAT(...)</code> \u5b8f\u4f1a\u541e\u6389\u6240\u6709\u53c2\u6570\uff0c\u8fd4\u56de1\uff0c\u5982\u679c\u4e0a\u4e00\u6b65 <code>PP_IS_BEGIN_PARENS_EAT __VA_ARGS__</code> \u4e2d\uff0c<code>__VA_ARGS__</code> \u662f\u4ee5\u62ec\u53f7\u5f00\u59cb\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u5339\u914d\u5230\u5bf9 <code>PP_IS_BEGIN_PARENS_EAT(...)</code> \u7684\u6c42\u503c\uff0c\u7136\u540e\u8fd4\u56de <code>1</code>\uff1b\u76f8\u53cd\uff0c\u5982\u679c\u4e0d\u662f\u4ee5\u62ec\u53f7\u5f00\u59cb\uff0c\u5219\u6ca1\u6709\u5339\u914d\u4e0a\uff0c<code>PP_IS_BEGIN_PARENS_EAT __VA_ARGS__</code> \u4f1a\u4fdd\u7559\u4e0d\u53d8\u3002</p>\n<p>\u82e5 <code>PP_IS_BEGIN_PARENS_EAT __VA_ARGS__</code> \u6c42\u503c\u5f97\u5230 <code>1</code>\uff0c<code>PP_IS_BEGIN_PARENS_CONCAT(PP_IS_BEGIN_PARENS_PRE_, 1) -&gt; PP_IS_BEGIN_PARENS_PRE_1 -&gt; 1,</code>\uff0c\u6ce8\u610f <code>1</code> \u540e\u9762\u662f\u6709\u4e2a\u9017\u53f7\u7684\uff0c\u628a <code>1,</code> \u4f20\u7ed9 <code>PP_IS_BEGIN_PARENS_PROCESS_0</code>\uff0c\u53d6\u7b2c 0 \u4e2a\u53c2\u6570\uff0c\u6700\u540e\u5f97\u5230 <code>1</code>\uff0c\u8868\u793a\u53c2\u6570\u662f\u4ee5\u62ec\u53f7\u5f00\u59cb\u3002</p>\n<p>\u82e5 <code>PP_IS_BEGIN_PARENS_EAT __VA_ARGS__</code> \u6c42\u503c\u5f97\u5230\u4e0d\u662f <code>1</code>\uff0c\u800c\u662f\u4fdd\u6301\u4e0d\u53d8\uff0c\u5219 <code>PP_IS_BEGIN_PARENS_CONCAT(PP_IS_BEGIN_PARENS_PRE_, PP_IS_BEGIN_PARENS_EAT __VA_ARGS__) -&gt; PP_IS_BEGIN_PARENS_PRE_PP_IS_BEGIN_PARENS_EAT __VA_ARGS__ -&gt; 0, __VA_ARGS__</code>\uff0c\u4f20\u7ed9 <code>PP_IS_BEGIN_PARENS_PROCESS_0</code> \u5f97\u5230\u7684\u662f <code>0</code>\uff0c\u8868\u793a\u53c2\u6570\u4e0d\u662f\u4ee5\u62ec\u53f7\u5f00\u59cb\u3002</p>\n<h4 id=\"_20\">\u53d8\u957f\u53c2\u6570\u7a7a</h4>\n<p>\u5224\u65ad\u53d8\u957f\u53c2\u6570\u662f\u5426\u4e3a\u7a7a\u4e5f\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u5b8f\uff0c\u5728\u5b9e\u73b0 <code>__VA_OPT__</code> \u7684\u65f6\u5019\u9700\u8981\u7528\u5230\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u5229\u7528 <code>PP_IS_BEGIN_PARENS</code>\uff0c\u53ef\u4ee5\u5148\u5199\u51fa\u4e0d\u5b8c\u6574\u7684\u7248\u672c\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-26-1\" name=\"__codelineno-26-1\" href=\"#__codelineno-26-1\"></a><span class=\"cp\">#define PP_IS_EMPTY_PROCESS(...) \\</span>\n<a id=\"__codelineno-26-2\" name=\"__codelineno-26-2\" href=\"#__codelineno-26-2\"></a><span class=\"cp\">    PP_IS_BEGIN_PARENS(PP_IS_EMPTY_PROCESS_EAT __VA_ARGS__ ())</span>\n<a id=\"__codelineno-26-3\" name=\"__codelineno-26-3\" href=\"#__codelineno-26-3\"></a><span class=\"cp\">#define PP_IS_EMPTY_PROCESS_EAT(...) ()</span>\n<a id=\"__codelineno-26-4\" name=\"__codelineno-26-4\" href=\"#__codelineno-26-4\"></a>\n<a id=\"__codelineno-26-5\" name=\"__codelineno-26-5\" href=\"#__codelineno-26-5\"></a><span class=\"n\">PP_IS_EMPTY_PROCESS</span><span class=\"p\">()</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-26-6\" name=\"__codelineno-26-6\" href=\"#__codelineno-26-6\"></a><span class=\"n\">PP_IS_EMPTY_PROCESS</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-26-7\" name=\"__codelineno-26-7\" href=\"#__codelineno-26-7\"></a><span class=\"n\">PP_IS_EMPTY_PROCESS</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-26-8\" name=\"__codelineno-26-8\" href=\"#__codelineno-26-8\"></a><span class=\"n\">PP_IS_EMPTY_PROCESS</span><span class=\"p\">(())</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 1</span>\n</code></pre></div>\n<p><code>PP_IS_EMPTY_PROCESS</code> \u7684\u4f5c\u7528\u662f\u5224\u65ad <code>PP_IS_EMPTY_PROCESS_EAT __VA_ARGS__ ()</code> \u662f\u5426\u4ee5\u62ec\u53f7\u5f00\u59cb\u3002</p>\n<p>\u5982\u679c <code>__VA_ARGS__</code> \u662f\u7a7a\uff0c<code>PP_IS_EMPTY_PROCESS_EAT __VA_ARGS__ () -&gt; PP_IS_EMPTY_PROCESS_EAT() -&gt; ()</code>\uff0c\u5f97\u5230\u7684\u662f\u4e00\u5bf9\u62ec\u53f7 <code>()</code>\uff0c\u518d\u4f20\u7ed9 <code>PP_IS_BEGIN_PARENS</code> \u8fd4\u56de <code>1</code>\uff0c\u8868\u793a\u53c2\u6570\u662f\u7a7a\u3002</p>\n<p>\u5426\u5219\uff0c<code>PP_IS_EMPTY_PROCESS_EAT __VA_ARGS__ ()</code> \u4fdd\u6301\u4e0d\u53d8\u5730\u4f20\u7ed9 <code>PP_IS_BEGIN_PARENS</code>\uff0c\u8fd4\u56de 0\uff0c\u8868\u793a\u975e\u7a7a\u3002</p>\n<p>\u7559\u610f\u7b2c 4 \u4e2a\u4f8b\u5b50 <code>PP_IS_EMPTY_PROCESS(()) -&gt; 1</code>\uff0c<code>PP_IS_EMPTY_PROCESS</code> \u4e0d\u80fd\u6b63\u786e\u5904\u7406\u4ee5\u62ec\u53f7\u5f00\u59cb\u7684\u53d8\u957f\u53c2\u6570\uff0c\u56e0\u4e3a\u8fd9\u65f6\u53d8\u957f\u53c2\u6570\u5e26\u6765\u7684\u62ec\u53f7\u4f1a\u5339\u914d <code>PP_IS_EMPTY_PROCESS_EAT</code> \u5bfc\u81f4\u6c42\u503c\u5f97\u5230 <code>()</code>\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u533a\u522b\u5bf9\u5f85\u53c2\u6570\u662f\u5426\u4ee5\u62ec\u53f7\u5f00\u59cb\u7684\u60c5\u51b5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-27-1\" name=\"__codelineno-27-1\" href=\"#__codelineno-27-1\"></a><span class=\"cp\">#define PP_IS_EMPTY(...) \\</span>\n<a id=\"__codelineno-27-2\" name=\"__codelineno-27-2\" href=\"#__codelineno-27-2\"></a><span class=\"cp\">    PP_IS_EMPTY_IF(PP_IS_BEGIN_PARENS(__VA_ARGS__)) \\</span>\n<a id=\"__codelineno-27-3\" name=\"__codelineno-27-3\" href=\"#__codelineno-27-3\"></a><span class=\"cp\">        (PP_IS_EMPTY_ZERO, PP_IS_EMPTY_PROCESS)(__VA_ARGS__)</span>\n<a id=\"__codelineno-27-4\" name=\"__codelineno-27-4\" href=\"#__codelineno-27-4\"></a>\n<a id=\"__codelineno-27-5\" name=\"__codelineno-27-5\" href=\"#__codelineno-27-5\"></a><span class=\"cp\">#define PP_IS_EMPTY_IF(if) PP_CONCAT(PP_IS_EMPTY_IF_, if)</span>\n<a id=\"__codelineno-27-6\" name=\"__codelineno-27-6\" href=\"#__codelineno-27-6\"></a><span class=\"cp\">#define PP_IS_EMPTY_IF_1(then, else) then</span>\n<a id=\"__codelineno-27-7\" name=\"__codelineno-27-7\" href=\"#__codelineno-27-7\"></a><span class=\"cp\">#define PP_IS_EMPTY_IF_0(then, else) else</span>\n<a id=\"__codelineno-27-8\" name=\"__codelineno-27-8\" href=\"#__codelineno-27-8\"></a>\n<a id=\"__codelineno-27-9\" name=\"__codelineno-27-9\" href=\"#__codelineno-27-9\"></a><span class=\"cp\">#define PP_IS_EMPTY_ZERO(...) 0</span>\n<a id=\"__codelineno-27-10\" name=\"__codelineno-27-10\" href=\"#__codelineno-27-10\"></a>\n<a id=\"__codelineno-27-11\" name=\"__codelineno-27-11\" href=\"#__codelineno-27-11\"></a><span class=\"n\">PP_IS_EMPTY</span><span class=\"p\">()</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-27-12\" name=\"__codelineno-27-12\" href=\"#__codelineno-27-12\"></a><span class=\"n\">PP_IS_EMPTY</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-27-13\" name=\"__codelineno-27-13\" href=\"#__codelineno-27-13\"></a><span class=\"n\">PP_IS_EMPTY</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-27-14\" name=\"__codelineno-27-14\" href=\"#__codelineno-27-14\"></a><span class=\"n\">PP_IS_EMPTY</span><span class=\"p\">(())</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p><code>PP_IS_EMPTY_IF</code> \u6839\u636e <code>if</code> \u6761\u4ef6\u6765\u8fd4\u56de\u7b2c 0 \u6216\u8005 \u7b2c 1 \u4e2a\u53c2\u6570\u3002</p>\n<p>\u5982\u679c\u4f20\u5165\u7684\u53d8\u957f\u53c2\u6570\u4ee5\u62ec\u53f7\u5f00\u59cb\uff0c<code>PP_IS_EMPTY_IF</code> \u8fd4\u56de <code>PP_IS_EMPTY_ZERO</code>\uff0c\u6700\u540e\u8fd4\u56de <code>0</code>\uff0c\u8868\u793a\u53d8\u957f\u53c2\u6570\u975e\u7a7a\u3002</p>\n<p>\u53cd\u4e4b <code>PP_IS_EMPTY_IF</code> \u8fd4\u56de <code>PP_IS_EMPTY_PROCESS</code>\uff0c\u6700\u540e\u7531 <code>PP_IS_EMPTY_PROCESS</code> \u6765\u5224\u65ad\u53d8\u957f\u53c2\u6570\u662f\u5426\u975e\u7a7a\u3002</p>\n<h4 id=\"_21\">\u4e0b\u6807\u8bbf\u95ee</h4>\n<p>\u83b7\u53d6\u53d8\u957f\u53c2\u6570\u6307\u5b9a\u4f4d\u7f6e\u7684\u5143\u7d20\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-28-1\" name=\"__codelineno-28-1\" href=\"#__codelineno-28-1\"></a><span class=\"cp\">#define PP_ARGS_ELEM(I, ...) PP_CONCAT(PP_ARGS_ELEM_, I)(__VA_ARGS__)</span>\n<a id=\"__codelineno-28-2\" name=\"__codelineno-28-2\" href=\"#__codelineno-28-2\"></a><span class=\"cp\">#define PP_ARGS_ELEM_0(a0, ...) a0</span>\n<a id=\"__codelineno-28-3\" name=\"__codelineno-28-3\" href=\"#__codelineno-28-3\"></a><span class=\"cp\">#define PP_ARGS_ELEM_1(a0, a1, ...) a1</span>\n<a id=\"__codelineno-28-4\" name=\"__codelineno-28-4\" href=\"#__codelineno-28-4\"></a><span class=\"cp\">#define PP_ARGS_ELEM_2(a0, a1, a2, ...) a2</span>\n<a id=\"__codelineno-28-5\" name=\"__codelineno-28-5\" href=\"#__codelineno-28-5\"></a><span class=\"cp\">#define PP_ARGS_ELEM_3(a0, a1, a2, a3, ...) a3</span>\n<a id=\"__codelineno-28-6\" name=\"__codelineno-28-6\" href=\"#__codelineno-28-6\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-28-7\" name=\"__codelineno-28-7\" href=\"#__codelineno-28-7\"></a><span class=\"cp\">#define PP_ARGS_ELEM_7(a0, a1, a2, a3, a4, a5, a6, a7, ...) a7</span>\n<a id=\"__codelineno-28-8\" name=\"__codelineno-28-8\" href=\"#__codelineno-28-8\"></a><span class=\"cp\">#define PP_ARGS_ELEM_8(a0, a1, a2, a3, a4, a5, a6, a7, a8, ...) a8</span>\n<a id=\"__codelineno-28-9\" name=\"__codelineno-28-9\" href=\"#__codelineno-28-9\"></a>\n<a id=\"__codelineno-28-10\" name=\"__codelineno-28-10\" href=\"#__codelineno-28-10\"></a><span class=\"n\">PP_ARGS_ELEM</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;World&quot;</span><span class=\"p\">)</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; PP_ARGS_ELEM_0(&quot;Hello&quot;, &quot;World&quot;) -&gt; &quot;Hello&quot;</span>\n<a id=\"__codelineno-28-11\" name=\"__codelineno-28-11\" href=\"#__codelineno-28-11\"></a><span class=\"n\">PP_ARGS_ELEM</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;Hello&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;World&quot;</span><span class=\"p\">)</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; PP_ARGS_ELEM_1(&quot;Hello&quot;, &quot;World&quot;) -&gt; &quot;World&quot;</span>\n</code></pre></div>\n<p><code>PP_ARGS_ELEM</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5143\u7d20\u4e0b\u6807 <code>I</code>\uff0c\u540e\u9762\u662f\u53d8\u957f\u53c2\u6570\u3002\u5229\u7528 <code>PP_CONCAT</code> \u62fc\u63a5 <code>PP_ARGS_ELEM_</code> \u548c <code>I</code>\uff0c\u5373\u53ef\u4ee5\u5f97\u5230\u8fd4\u56de\u76f8\u5e94\u4f4d\u7f6e\u5143\u7d20\u7684\u5b8f <code>PP_ARGS_ELEM_0..8</code>\uff0c\u518d\u628a\u53d8\u957f\u53c2\u6570\u4f20\u7ed9\u8be5\u5b8f\uff0c\u5c55\u5f00\u8fd4\u56de\u4e0b\u6807\u5bf9\u5e94\u4f4d\u7f6e\u7684\u5143\u7d20\u3002</p>\n<h4 id=\"pp_is_empty2\">PP_IS_EMPTY2</h4>\n<p>\u5229\u7528 <code>PP_ARGS_ELEM</code> \u4e5f\u53ef\u4ee5\u5b9e\u73b0\u53e6\u4e00\u7248\u672c\u7684 <code>PP_IS_EMPTY</code>\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-29-1\" name=\"__codelineno-29-1\" href=\"#__codelineno-29-1\"></a><span class=\"cp\">#define PP_IS_EMPTY2(...) \\</span>\n<a id=\"__codelineno-29-2\" name=\"__codelineno-29-2\" href=\"#__codelineno-29-2\"></a><span class=\"cp\">    PP_AND( \\</span>\n<a id=\"__codelineno-29-3\" name=\"__codelineno-29-3\" href=\"#__codelineno-29-3\"></a><span class=\"cp\">        PP_AND( \\</span>\n<a id=\"__codelineno-29-4\" name=\"__codelineno-29-4\" href=\"#__codelineno-29-4\"></a><span class=\"cp\">            PP_NOT(PP_HAS_COMMA(__VA_ARGS__)), \\</span>\n<a id=\"__codelineno-29-5\" name=\"__codelineno-29-5\" href=\"#__codelineno-29-5\"></a><span class=\"cp\">            PP_NOT(PP_HAS_COMMA(__VA_ARGS__())) \\</span>\n<a id=\"__codelineno-29-6\" name=\"__codelineno-29-6\" href=\"#__codelineno-29-6\"></a><span class=\"cp\">        ), \\</span>\n<a id=\"__codelineno-29-7\" name=\"__codelineno-29-7\" href=\"#__codelineno-29-7\"></a><span class=\"cp\">        PP_AND( \\</span>\n<a id=\"__codelineno-29-8\" name=\"__codelineno-29-8\" href=\"#__codelineno-29-8\"></a><span class=\"cp\">            PP_NOT(PP_HAS_COMMA(PP_COMMA_ARGS __VA_ARGS__)), \\</span>\n<a id=\"__codelineno-29-9\" name=\"__codelineno-29-9\" href=\"#__codelineno-29-9\"></a><span class=\"cp\">            PP_HAS_COMMA(PP_COMMA_ARGS __VA_ARGS__ ()) \\</span>\n<a id=\"__codelineno-29-10\" name=\"__codelineno-29-10\" href=\"#__codelineno-29-10\"></a><span class=\"cp\">        ) \\</span>\n<a id=\"__codelineno-29-11\" name=\"__codelineno-29-11\" href=\"#__codelineno-29-11\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-29-12\" name=\"__codelineno-29-12\" href=\"#__codelineno-29-12\"></a>\n<a id=\"__codelineno-29-13\" name=\"__codelineno-29-13\" href=\"#__codelineno-29-13\"></a><span class=\"cp\">#define PP_HAS_COMMA(...) PP_ARGS_ELEM(8, __VA_ARGS__, 1, 1, 1, 1, 1, 1, 1, 0)</span>\n<a id=\"__codelineno-29-14\" name=\"__codelineno-29-14\" href=\"#__codelineno-29-14\"></a><span class=\"cp\">#define PP_COMMA_ARGS(...) ,</span>\n<a id=\"__codelineno-29-15\" name=\"__codelineno-29-15\" href=\"#__codelineno-29-15\"></a>\n<a id=\"__codelineno-29-16\" name=\"__codelineno-29-16\" href=\"#__codelineno-29-16\"></a><span class=\"n\">PP_IS_EMPTY2</span><span class=\"p\">()</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-29-17\" name=\"__codelineno-29-17\" href=\"#__codelineno-29-17\"></a><span class=\"n\">PP_IS_EMPTY2</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-29-18\" name=\"__codelineno-29-18\" href=\"#__codelineno-29-18\"></a><span class=\"n\">PP_IS_EMPTY2</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-29-19\" name=\"__codelineno-29-19\" href=\"#__codelineno-29-19\"></a><span class=\"n\">PP_IS_EMPTY2</span><span class=\"p\">(())</span><span class=\"w\">            </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-29-20\" name=\"__codelineno-29-20\" href=\"#__codelineno-29-20\"></a><span class=\"n\">PP_IS_EMPTY2</span><span class=\"p\">(</span><span class=\"n\">PP_COMMA</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p>\u501f\u7528 <code>PP_ARGS_ELEM</code> \u5b9e\u73b0\u5224\u65ad\u53c2\u6570\u662f\u5426\u542b\u6709\u9017\u53f7 <code>PP_HAS_COMMA</code>\u3002<code>PP_COMMA_ARGS</code> \u4f1a\u541e\u6389\u4f20\u5165\u7684\u4efb\u610f\u53c2\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u9017\u53f7\u3002</p>\n<p>\u5224\u65ad\u53d8\u957f\u53c2\u6570\u662f\u5426\u4e3a\u7a7a\u7684\u57fa\u7840\u903b\u8f91\u662f <code>PP_COMMA_ARGS __VA_ARGS__ ()</code> \u8fd4\u56de\u4e00\u4e2a\u9017\u53f7\uff0c\u4e5f\u5c31\u662f <code>__VA_ARGS__</code> \u4e3a\u7a7a\uff0c<code>PP_COMMA_ARGS</code> \u548c <code>()</code> \u62fc\u63a5\u5728\u4e00\u8d77\u6c42\u503c\uff0c\u5177\u4f53\u7684\u5199\u6cd5\u5c31\u662f <code>PP_HAS_COMMA(PP_COMMA_ARGS __VA_ARGS__ ())</code>\u3002</p>\n<p>\u4f46\u662f\u4f1a\u6709\u4f8b\u5916\u7684\u60c5\u51b5\uff1a</p>\n<ul>\n<li><code>__VA_ARGS__</code> \u672c\u8eab\u6709\u53ef\u80fd\u4f1a\u5e26\u6765\u9017\u53f7\uff1b</li>\n<li><code>__VA_ARGS__ ()</code> \u62fc\u63a5\u5728\u4e00\u8d77\u53d1\u751f\u6c42\u503c\u5e26\u6765\u9017\u53f7\uff1b</li>\n<li><code>PP_COMMA_ARGS __VA_ARGS__</code> \u62fc\u63a5\u5728\u4e00\u8d77\u53d1\u751f\u6c42\u503c\u5e26\u6765\u9017\u53f7\uff1b</li>\n</ul>\n<p>\u9488\u5bf9\u4e0a\u9762\u8bf4\u5230\u7684\u4e09\u79cd\u4f8b\u5916\u60c5\u51b5\uff0c\u9700\u8981\u505a\u6392\u9664\uff0c\u6240\u4ee5\u6700\u540e\u7684\u5199\u6cd5\u7b49\u4ef7\u4e8e\u5bf9\u4ee5\u4e0b 4 \u4e2a\u6761\u4ef6\u6267\u884c\u4e0e\u903b\u8f91\uff1a</p>\n<ul>\n<li><code>PP_NOT(PP_HAS_COMMA(__VA_ARGS__))</code> &amp;&amp;</li>\n<li><code>PP_NOT(PP_HAS_COMMA(__VA_ARGS__()))</code> &amp;&amp;</li>\n<li><code>PP_NOT(PP_HAS_COMMA(PP_COMMA_ARGS __VA_ARGS__))</code> &amp;&amp;</li>\n<li><code>PP_HAS_COMMA(PP_COMMA_ARGS __VA_ARGS__ ())</code></li>\n</ul>\n<h4 id=\"__va_opt__\"><code>__VA_OPT__</code></h4>\n<p>\u5229\u7528 <code>PP_IS_EMPTY</code> \u7ec8\u4e8e\u53ef\u4ee5\u6765\u5b9e\u73b0\u7c7b\u4f3c <code>__VA_OPT__</code> \u7684\u5b8f\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-30-1\" name=\"__codelineno-30-1\" href=\"#__codelineno-30-1\"></a><span class=\"cp\">#define PP_REMOVE_PARENS(tuple) PP_REMOVE_PARENS_IMPL tuple</span>\n<a id=\"__codelineno-30-2\" name=\"__codelineno-30-2\" href=\"#__codelineno-30-2\"></a><span class=\"cp\">#define PP_REMOVE_PARENS_IMPL(...) __VA_ARGS__</span>\n<a id=\"__codelineno-30-3\" name=\"__codelineno-30-3\" href=\"#__codelineno-30-3\"></a>\n<a id=\"__codelineno-30-4\" name=\"__codelineno-30-4\" href=\"#__codelineno-30-4\"></a><span class=\"cp\">#define PP_ARGS_OPT(data_tuple, empty_tuple, ...) \\</span>\n<a id=\"__codelineno-30-5\" name=\"__codelineno-30-5\" href=\"#__codelineno-30-5\"></a><span class=\"cp\">    PP_ARGS_OPT_IMPL(PP_IF(PP_IS_EMPTY(__VA_ARGS__), empty_tuple, data_tuple))</span>\n<a id=\"__codelineno-30-6\" name=\"__codelineno-30-6\" href=\"#__codelineno-30-6\"></a><span class=\"cp\">#define PP_ARGS_OPT_IMPL(tuple) PP_REMOVE_PARENS(tuple)</span>\n<a id=\"__codelineno-30-7\" name=\"__codelineno-30-7\" href=\"#__codelineno-30-7\"></a>\n<a id=\"__codelineno-30-8\" name=\"__codelineno-30-8\" href=\"#__codelineno-30-8\"></a><span class=\"n\">PP_ARGS_OPT</span><span class=\"p\">((</span><span class=\"n\">data</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">empty</span><span class=\"p\">))</span><span class=\"w\">        </span><span class=\"c1\">// -&gt; empty</span>\n<a id=\"__codelineno-30-9\" name=\"__codelineno-30-9\" href=\"#__codelineno-30-9\"></a><span class=\"n\">PP_ARGS_OPT</span><span class=\"p\">((</span><span class=\"n\">data</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">empty</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; data</span>\n<a id=\"__codelineno-30-10\" name=\"__codelineno-30-10\" href=\"#__codelineno-30-10\"></a><span class=\"n\">PP_ARGS_OPT</span><span class=\"p\">((,),</span><span class=\"w\"> </span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; ,</span>\n</code></pre></div>\n<p><code>PP_ARGS_OPT</code> \u63a5\u53d7\u4e24\u4e2a\u56fa\u5b9a\u53c2\u6570\u548c\u53d8\u957f\u53c2\u6570\uff0c\u53d8\u957f\u53c2\u6570\u975e\u7a7a\u65f6\u8fd4\u56de <code>data</code>\uff0c\u5426\u5219\u8fd4\u56de <code>empty</code>\u3002\u4e3a\u4e86\u8ba9 <code>data</code> \u548c <code>empty</code> \u652f\u6301\u9017\u53f7\uff0c\u8981\u6c42\u4e24\u8005\u90fd\u8981\u7528\u62ec\u53f7\u5305\u4f4f\u5b9e\u9645\u7684\u53c2\u6570\uff0c\u6700\u540e\u7528 <code>PP_REMOVE_PARENS</code> \u6765\u79fb\u9664\u5916\u5c42\u7684\u62ec\u53f7\u3002</p>\n<p>\u6709\u4e86 <code>PP_ARGS_OPT</code> \u53ef\u4ee5\u5b9e\u73b0 <code>LOG3</code> \u6765\u6a21\u62df <code>LOG2</code> \u5b9e\u73b0\u7684\u529f\u80fd\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-31-1\" name=\"__codelineno-31-1\" href=\"#__codelineno-31-1\"></a><span class=\"cp\">#define LOG3(format, ...) \\</span>\n<a id=\"__codelineno-31-2\" name=\"__codelineno-31-2\" href=\"#__codelineno-31-2\"></a><span class=\"cp\">    printf(&quot;log: &quot; format PP_ARGS_OPT((,), (), __VA_ARGS__) __VA_ARGS__)</span>\n<a id=\"__codelineno-31-3\" name=\"__codelineno-31-3\" href=\"#__codelineno-31-3\"></a>\n<a id=\"__codelineno-31-4\" name=\"__codelineno-31-4\" href=\"#__codelineno-31-4\"></a><span class=\"n\">LOG3</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello&quot;</span><span class=\"p\">);</span><span class=\"w\">                  </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello&quot; );</span>\n<a id=\"__codelineno-31-5\" name=\"__codelineno-31-5\" href=\"#__codelineno-31-5\"></a><span class=\"n\">LOG3</span><span class=\"p\">(</span><span class=\"s\">&quot;Hello %s&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;World&quot;</span><span class=\"p\">);</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; printf(&quot;log: &quot; &quot;Hello %s&quot; , &quot;World&quot;);</span>\n</code></pre></div>\n<p><code>data_tuple</code> \u662f <code>(,)</code>\uff0c\u5982\u679c\u53d8\u957f\u53c2\u6570\u975e\u7a7a\uff0c\u5219\u4f1a\u8fd4\u56de <code>data_tuple</code> \u91cc\u9762\u7684\u6240\u6709\u5143\u7d20\uff0c\u5728\u8fd9\u91cc\u5c31\u662f\u9017\u53f7 <code>,</code>\u3002</p>\n<h4 id=\"_22\">\u6c42\u53c2\u6570\u4e2a\u6570</h4>\n<p>\u83b7\u53d6\u53d8\u957f\u53c2\u6570\u7684\u4e2a\u6570\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-32-1\" name=\"__codelineno-32-1\" href=\"#__codelineno-32-1\"></a><span class=\"cp\">#define PP_ARGS_SIZE_IMCOMPLETE(...) \\</span>\n<a id=\"__codelineno-32-2\" name=\"__codelineno-32-2\" href=\"#__codelineno-32-2\"></a><span class=\"cp\">    PP_ARGS_ELEM(8, __VA_ARGS__, 8, 7, 6, 5, 4, 3, 2, 1, 0)</span>\n<a id=\"__codelineno-32-3\" name=\"__codelineno-32-3\" href=\"#__codelineno-32-3\"></a>\n<a id=\"__codelineno-32-4\" name=\"__codelineno-32-4\" href=\"#__codelineno-32-4\"></a><span class=\"n\">PP_ARGS_SIZE_IMCOMPLETE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-32-5\" name=\"__codelineno-32-5\" href=\"#__codelineno-32-5\"></a><span class=\"n\">PP_ARGS_SIZE_IMCOMPLETE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; 2</span>\n<a id=\"__codelineno-32-6\" name=\"__codelineno-32-6\" href=\"#__codelineno-32-6\"></a><span class=\"n\">PP_ARGS_SIZE_IMCOMPLETE</span><span class=\"p\">(</span><span class=\"n\">PP_COMMA</span><span class=\"p\">())</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; 2</span>\n<a id=\"__codelineno-32-7\" name=\"__codelineno-32-7\" href=\"#__codelineno-32-7\"></a><span class=\"n\">PP_ARGS_SIZE_IMCOMPLETE</span><span class=\"p\">()</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 1</span>\n</code></pre></div>\n<p>\u8ba1\u7b97\u53d8\u957f\u53c2\u6570\u7684\u4e2a\u6570\uff0c\u662f\u901a\u8fc7\u6570\u53c2\u6570\u7684\u4f4d\u7f6e\u6765\u83b7\u5f97\u7684\u3002<code>__VA_ARGS__</code> \u4f1a\u5bfc\u81f4\u540e\u7eed\u7684\u53c2\u6570\u5168\u4f53\u5f80\u53f3\u79fb\u52a8\uff0c\u7528\u5b8f <code>PP_ARGS_ELEM</code> \u6765\u83b7\u53d6\u7b2c 8 \u4e2a\u4f4d\u7f6e\u7684\u53c2\u6570\uff0c\u5982\u679c <code>__VA_ARGS__</code> \u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5219\u7b2c 8 \u4e2a\u53c2\u6570\u7b49\u4e8e <code>1</code>\uff1b\u540c\u7406\u5982\u679c <code>__VA_ARGS__</code> \u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u5219\u7b2c 8 \u4e2a\u53c2\u6570\u5c31\u53d8\u4e3a <code>2</code>\uff0c\u521a\u597d\u7b49\u4e8e\u53d8\u957f\u53c2\u6570\u7684\u4e2a\u6570\u3002</p>\n<p>\u8fd9\u91cc\u7ed9\u7684\u4f8b\u5b50\u53ea\u6700\u9ad8\u652f\u6301\u4e2a\u6570 8 \u7684\u53d8\u957f\u53c2\u6570\uff0c\u8fd9\u662f\u4f9d\u8d56\u4e8e <code>PP_ARGS_ELEM</code> \u6240\u80fd\u652f\u6301\u7684\u6700\u5927\u957f\u5ea6\u3002</p>\n<p>\u4f46\u662f\u8fd9\u4e2a\u5b8f\u8fd8\u4e0d\u5b8c\u6574\uff0c\u5728\u53d8\u957f\u53c2\u6570\u4e3a\u7a7a\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u5b8f\u4f1a\u9519\u8bef\u8fd4\u56de <code>1</code>\u3002\u5982\u679c\u9700\u8981\u5904\u7406\u7a7a\u7684\u53d8\u957f\u53c2\u6570\uff0c\u5219\u9700\u8981\u7528\u5230\u6211\u4eec\u524d\u9762\u8bf4\u5230\u7684 <code>PP_ARGS_OPT</code> \u5b8f\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-33-1\" name=\"__codelineno-33-1\" href=\"#__codelineno-33-1\"></a><span class=\"cp\">#define PP_COMMA_IF_ARGS(...) PP_ARGS_OPT((,), (), __VA_ARGS__)</span>\n<a id=\"__codelineno-33-2\" name=\"__codelineno-33-2\" href=\"#__codelineno-33-2\"></a><span class=\"cp\">#define PP_ARGS_SIZE(...) PP_ARGS_ELEM(8, __VA_ARGS__ PP_COMMA_IF_ARGS(__VA_ARGS__) 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0)</span>\n<a id=\"__codelineno-33-3\" name=\"__codelineno-33-3\" href=\"#__codelineno-33-3\"></a>\n<a id=\"__codelineno-33-4\" name=\"__codelineno-33-4\" href=\"#__codelineno-33-4\"></a><span class=\"n\">PP_ARGS_SIZE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">             </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-33-5\" name=\"__codelineno-33-5\" href=\"#__codelineno-33-5\"></a><span class=\"n\">PP_ARGS_SIZE</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; 2</span>\n<a id=\"__codelineno-33-6\" name=\"__codelineno-33-6\" href=\"#__codelineno-33-6\"></a><span class=\"n\">PP_ARGS_SIZE</span><span class=\"p\">(</span><span class=\"n\">PP_COMMA</span><span class=\"p\">())</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; 2</span>\n<a id=\"__codelineno-33-7\" name=\"__codelineno-33-7\" href=\"#__codelineno-33-7\"></a><span class=\"n\">PP_ARGS_SIZE</span><span class=\"p\">()</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-33-8\" name=\"__codelineno-33-8\" href=\"#__codelineno-33-8\"></a><span class=\"n\">PP_ARGS_SIZE</span><span class=\"p\">(,,,)</span><span class=\"w\">           </span><span class=\"c1\">// -&gt; 4</span>\n</code></pre></div>\n<p>\u95ee\u9898\u7684\u5173\u952e\u5c31\u662f\u9017\u53f7 <code>,</code>\uff0c\u5728 <code>__VA_ARGS__</code> \u4e3a\u7a7a\u7684\u65f6\u5019\uff0c\u628a\u9017\u53f7\u9690\u53bb\u5c31\u80fd\u6b63\u786e\u8fd4\u56de <code>0</code>\u3002</p>\n<h4 id=\"_23\">\u904d\u5386\u8bbf\u95ee</h4>\n<p>\u7c7b\u4f3c C++ \u7684 <code>for_each</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u5b8f\u7684 <code>PP_FOR_EACH</code>\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-34-1\" name=\"__codelineno-34-1\" href=\"#__codelineno-34-1\"></a><span class=\"cp\">#define PP_FOR_EACH(macro, contex, ...) \\</span>\n<a id=\"__codelineno-34-2\" name=\"__codelineno-34-2\" href=\"#__codelineno-34-2\"></a><span class=\"cp\">    PP_CONCAT(PP_FOR_EACH_, PP_ARGS_SIZE(__VA_ARGS__))(0, macro, contex, __VA_ARGS__)</span>\n<a id=\"__codelineno-34-3\" name=\"__codelineno-34-3\" href=\"#__codelineno-34-3\"></a>\n<a id=\"__codelineno-34-4\" name=\"__codelineno-34-4\" href=\"#__codelineno-34-4\"></a><span class=\"cp\">#define PP_FOR_EACH_0(index, macro, contex, ...)</span>\n<a id=\"__codelineno-34-5\" name=\"__codelineno-34-5\" href=\"#__codelineno-34-5\"></a><span class=\"cp\">#define PP_FOR_EACH_1(index, macro, contex, arg, ...) macro(index, contex, arg)</span>\n<a id=\"__codelineno-34-6\" name=\"__codelineno-34-6\" href=\"#__codelineno-34-6\"></a>\n<a id=\"__codelineno-34-7\" name=\"__codelineno-34-7\" href=\"#__codelineno-34-7\"></a><span class=\"cp\">#define PP_FOR_EACH_2(index, macro, contex, arg, ...) \\</span>\n<a id=\"__codelineno-34-8\" name=\"__codelineno-34-8\" href=\"#__codelineno-34-8\"></a><span class=\"cp\">    macro(index, contex, arg) \\</span>\n<a id=\"__codelineno-34-9\" name=\"__codelineno-34-9\" href=\"#__codelineno-34-9\"></a><span class=\"cp\">    PP_FOR_EACH_1(PP_INC(index), macro, contex, __VA_ARGS__)</span>\n<a id=\"__codelineno-34-10\" name=\"__codelineno-34-10\" href=\"#__codelineno-34-10\"></a>\n<a id=\"__codelineno-34-11\" name=\"__codelineno-34-11\" href=\"#__codelineno-34-11\"></a><span class=\"cp\">#define PP_FOR_EACH_3(index, macro, contex, arg, ...) \\</span>\n<a id=\"__codelineno-34-12\" name=\"__codelineno-34-12\" href=\"#__codelineno-34-12\"></a><span class=\"cp\">    macro(index, contex, arg) \\</span>\n<a id=\"__codelineno-34-13\" name=\"__codelineno-34-13\" href=\"#__codelineno-34-13\"></a><span class=\"cp\">    PP_FOR_EACH_2(PP_INC(index), macro, contex, __VA_ARGS__)</span>\n<a id=\"__codelineno-34-14\" name=\"__codelineno-34-14\" href=\"#__codelineno-34-14\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-34-15\" name=\"__codelineno-34-15\" href=\"#__codelineno-34-15\"></a><span class=\"cp\">#define PP_FOR_EACH_8(index, macro, contex, arg, ...) \\</span>\n<a id=\"__codelineno-34-16\" name=\"__codelineno-34-16\" href=\"#__codelineno-34-16\"></a><span class=\"cp\">    macro(index, contex, arg) \\</span>\n<a id=\"__codelineno-34-17\" name=\"__codelineno-34-17\" href=\"#__codelineno-34-17\"></a><span class=\"cp\">    PP_FOR_EACH_7(PP_INC(index), macro, contex, __VA_ARGS__)</span>\n<a id=\"__codelineno-34-18\" name=\"__codelineno-34-18\" href=\"#__codelineno-34-18\"></a>\n<a id=\"__codelineno-34-19\" name=\"__codelineno-34-19\" href=\"#__codelineno-34-19\"></a><span class=\"cp\">#define DECLARE_EACH(index, contex, arg)    PP_IF(index, PP_COMMA, PP_EMPTY)() contex arg</span>\n<a id=\"__codelineno-34-20\" name=\"__codelineno-34-20\" href=\"#__codelineno-34-20\"></a>\n<a id=\"__codelineno-34-21\" name=\"__codelineno-34-21\" href=\"#__codelineno-34-21\"></a><span class=\"n\">PP_FOR_EACH</span><span class=\"p\">(</span><span class=\"n\">DECLARE_EACH</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"p\">);</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; int x, y, z;</span>\n<a id=\"__codelineno-34-22\" name=\"__codelineno-34-22\" href=\"#__codelineno-34-22\"></a><span class=\"n\">PP_FOR_EACH</span><span class=\"p\">(</span><span class=\"n\">DECLARE_EACH</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; bool a, b;</span>\n</code></pre></div>\n<p><code>PP_FOR_EACH</code> \u63a5\u6536\u4e24\u4e2a\u56fa\u5b9a\u53c2\u6570\uff1a <code>macro</code> \u53ef\u4ee5\u7406\u89e3\u4e3a\u904d\u5386\u7684\u65f6\u5019\u8c03\u7528\u7684\u5b8f\uff0c<code>contex</code> \u53ef\u4ee5\u4f5c\u4e3a\u56fa\u5b9a\u503c\u53c2\u6570\u4f20\u7ed9 <code>macro</code>\u3002<code>PP_FOR_EACH</code> \u5148\u901a\u8fc7 <code>PP_ARGS_SIZE</code> \u83b7\u53d6\u53d8\u957f\u53c2\u6570\u7684\u957f\u5ea6 <code>N</code>\uff0c\u518d\u7528 <code>PP_CONCAT</code> \u62fc\u63a5\u5f97\u5230 <code>PP_FOR_EACH_N</code>\uff0c\u4e4b\u540e <code>PP_FOR_EACH_N</code> \u4f1a\u8fed\u4ee3\u8c03\u7528 <code>PP_FOR_EACH_N-1</code> \u6765\u5b9e\u73b0\u8ddf\u53d8\u957f\u53c2\u6570\u4e2a\u6570\u76f8\u540c\u7684\u904d\u5386\u6b21\u6570\u3002</p>\n<p>\u4f8b\u5b50\u91cc\u6211\u4eec\u58f0\u660e\u4e86 <code>DECLARE_EACH</code> \u4f5c\u4e3a\u53c2\u6570 <code>macro</code>\uff0c<code>DECLARE_EACH</code> \u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de <code>contex arg</code>\uff0c\u5982\u679c <code>contex</code> \u662f\u7c7b\u578b\u540d\u5b57\uff0c<code>arg</code> \u662f\u53d8\u91cf\u540d\u5b57\uff0c<code>DECLARE_EACH</code> \u5c31\u53ef\u4ee5\u7528\u6765\u58f0\u660e\u53d8\u91cf\u3002</p>\n<h4 id=\"_24\">\u6761\u4ef6\u5faa\u73af</h4>\n<p>\u6709\u4e86 <code>FOR_EACH</code> \u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7684\u5199\u6cd5\u5199\u51fa <code>PP_WHILE</code>\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-35-1\" name=\"__codelineno-35-1\" href=\"#__codelineno-35-1\"></a><span class=\"cp\">#define PP_WHILE PP_WHILE_1</span>\n<a id=\"__codelineno-35-2\" name=\"__codelineno-35-2\" href=\"#__codelineno-35-2\"></a>\n<a id=\"__codelineno-35-3\" name=\"__codelineno-35-3\" href=\"#__codelineno-35-3\"></a><span class=\"cp\">#define PP_WHILE_1(pred, op, val) PP_WHILE_1_IMPL(PP_BOOL(pred(val)), pred, op, val)</span>\n<a id=\"__codelineno-35-4\" name=\"__codelineno-35-4\" href=\"#__codelineno-35-4\"></a><span class=\"cp\">#define PP_WHILE_1_IMPL(cond, pred, op, val) \\</span>\n<a id=\"__codelineno-35-5\" name=\"__codelineno-35-5\" href=\"#__codelineno-35-5\"></a><span class=\"cp\">    PP_IF(cond, PP_WHILE_2, val PP_EMPTY_EAT)(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</span>\n<a id=\"__codelineno-35-6\" name=\"__codelineno-35-6\" href=\"#__codelineno-35-6\"></a>\n<a id=\"__codelineno-35-7\" name=\"__codelineno-35-7\" href=\"#__codelineno-35-7\"></a><span class=\"cp\">#define PP_WHILE_2(pred, op, val) PP_WHILE_2_IMPL(PP_BOOL(pred(val)), pred, op, val)</span>\n<a id=\"__codelineno-35-8\" name=\"__codelineno-35-8\" href=\"#__codelineno-35-8\"></a><span class=\"cp\">#define PP_WHILE_2_IMPL(cond, pred, op, val) \\</span>\n<a id=\"__codelineno-35-9\" name=\"__codelineno-35-9\" href=\"#__codelineno-35-9\"></a><span class=\"cp\">    PP_IF(cond, PP_WHILE_3, val PP_EMPTY_EAT)(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</span>\n<a id=\"__codelineno-35-10\" name=\"__codelineno-35-10\" href=\"#__codelineno-35-10\"></a>\n<a id=\"__codelineno-35-11\" name=\"__codelineno-35-11\" href=\"#__codelineno-35-11\"></a><span class=\"cp\">#define PP_WHILE_3(pred, op, val) PP_WHILE_3_IMPL(PP_BOOL(pred(val)), pred, op, val)</span>\n<a id=\"__codelineno-35-12\" name=\"__codelineno-35-12\" href=\"#__codelineno-35-12\"></a><span class=\"cp\">#define PP_WHILE_3_IMPL(cond, pred, op, val) \\</span>\n<a id=\"__codelineno-35-13\" name=\"__codelineno-35-13\" href=\"#__codelineno-35-13\"></a><span class=\"cp\">    PP_IF(cond, PP_WHILE_4, val PP_EMPTY_EAT)(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</span>\n<a id=\"__codelineno-35-14\" name=\"__codelineno-35-14\" href=\"#__codelineno-35-14\"></a>\n<a id=\"__codelineno-35-15\" name=\"__codelineno-35-15\" href=\"#__codelineno-35-15\"></a><span class=\"cp\">#define PP_WHILE_4(pred, op, val) PP_WHILE_4_IMPL(PP_BOOL(pred(val)), pred, op, val)</span>\n<a id=\"__codelineno-35-16\" name=\"__codelineno-35-16\" href=\"#__codelineno-35-16\"></a><span class=\"cp\">#define PP_WHILE_4_IMPL(cond, pred, op, val) \\</span>\n<a id=\"__codelineno-35-17\" name=\"__codelineno-35-17\" href=\"#__codelineno-35-17\"></a><span class=\"cp\">    PP_IF(cond, PP_WHILE_5, val PP_EMPTY_EAT)(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</span>\n<a id=\"__codelineno-35-18\" name=\"__codelineno-35-18\" href=\"#__codelineno-35-18\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-35-19\" name=\"__codelineno-35-19\" href=\"#__codelineno-35-19\"></a>\n<a id=\"__codelineno-35-20\" name=\"__codelineno-35-20\" href=\"#__codelineno-35-20\"></a><span class=\"cp\">#define PP_WHILE_8(pred, op, val) PP_WHILE_8_IMPL(PP_BOOL(pred(val)), pred, op, val)</span>\n<a id=\"__codelineno-35-21\" name=\"__codelineno-35-21\" href=\"#__codelineno-35-21\"></a><span class=\"cp\">#define PP_WHILE_8_IMPL(cond, pred, op, val) \\</span>\n<a id=\"__codelineno-35-22\" name=\"__codelineno-35-22\" href=\"#__codelineno-35-22\"></a><span class=\"cp\">    PP_IF(cond, PP_WHILE_8, val PP_EMPTY_EAT)(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</span>\n<a id=\"__codelineno-35-23\" name=\"__codelineno-35-23\" href=\"#__codelineno-35-23\"></a>\n<a id=\"__codelineno-35-24\" name=\"__codelineno-35-24\" href=\"#__codelineno-35-24\"></a><span class=\"cp\">#define PP_EMPTY_EAT(...)</span>\n<a id=\"__codelineno-35-25\" name=\"__codelineno-35-25\" href=\"#__codelineno-35-25\"></a>\n<a id=\"__codelineno-35-26\" name=\"__codelineno-35-26\" href=\"#__codelineno-35-26\"></a><span class=\"cp\">#define SUM_OP(xy_tuple) SUM_OP_OP_IMPL xy_tuple</span>\n<a id=\"__codelineno-35-27\" name=\"__codelineno-35-27\" href=\"#__codelineno-35-27\"></a><span class=\"cp\">#define SUM_OP_OP_IMPL(x, y) (PP_DEC(x), y + x)</span>\n<a id=\"__codelineno-35-28\" name=\"__codelineno-35-28\" href=\"#__codelineno-35-28\"></a>\n<a id=\"__codelineno-35-29\" name=\"__codelineno-35-29\" href=\"#__codelineno-35-29\"></a><span class=\"cp\">#define SUM_PRED(xy_tuple) SUM_PRED_IMPL xy_tuple</span>\n<a id=\"__codelineno-35-30\" name=\"__codelineno-35-30\" href=\"#__codelineno-35-30\"></a><span class=\"cp\">#define SUM_PRED_IMPL(x, y) x</span>\n<a id=\"__codelineno-35-31\" name=\"__codelineno-35-31\" href=\"#__codelineno-35-31\"></a>\n<a id=\"__codelineno-35-32\" name=\"__codelineno-35-32\" href=\"#__codelineno-35-32\"></a><span class=\"cp\">#define SUM(max_num, origin_num) \\</span>\n<a id=\"__codelineno-35-33\" name=\"__codelineno-35-33\" href=\"#__codelineno-35-33\"></a><span class=\"cp\">    PP_IDENTITY(SUM_IMPL PP_WHILE(SUM_PRED, SUM_OP, (max_num, origin_num)))</span>\n<a id=\"__codelineno-35-34\" name=\"__codelineno-35-34\" href=\"#__codelineno-35-34\"></a><span class=\"cp\">#define SUM_IMPL(ignore, ret) ret</span>\n<a id=\"__codelineno-35-35\" name=\"__codelineno-35-35\" href=\"#__codelineno-35-35\"></a>\n<a id=\"__codelineno-35-36\" name=\"__codelineno-35-36\" href=\"#__codelineno-35-36\"></a><span class=\"n\">PP_WHILE</span><span class=\"p\">(</span><span class=\"n\">SUM_PRED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SUM_OP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">))</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; (0, a + 2 + 1)</span>\n<a id=\"__codelineno-35-37\" name=\"__codelineno-35-37\" href=\"#__codelineno-35-37\"></a><span class=\"n\">SUM</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"c1\">// -&gt; a + 2 + 1</span>\n</code></pre></div>\n<p><code>PP_WHILE</code> \u63a5\u53d7\u4e09\u4e2a\u53c2\u6570\uff1a <code>pred</code> \u6761\u4ef6\u5224\u65ad\u51fd\u6570\uff0c<code>op</code> \u64cd\u4f5c\u51fd\u6570\uff0c<code>val</code> \u521d\u59cb\u503c\uff1b\u5faa\u73af\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u65ad\u7528 <code>pred(val)</code> \u6765\u505a\u5faa\u73af\u7ec8\u6b62\u5224\u65ad\uff0c\u628a <code>op(val)</code> \u5f97\u5230\u7684\u503c\u4f20\u7ed9\u540e\u7eed\u7684\u5b8f\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u6267\u884c\u4ee5\u4e0b\u4ee3\u7801\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-36-1\" name=\"__codelineno-36-1\" href=\"#__codelineno-36-1\"></a><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-36-2\" name=\"__codelineno-36-2\" href=\"#__codelineno-36-2\"></a><span class=\"w\">    </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">);</span>\n<a id=\"__codelineno-36-3\" name=\"__codelineno-36-3\" href=\"#__codelineno-36-3\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>PP_WHILE_N</code> \u9996\u5148\u7528 <code>pred(val)</code> \u5f97\u5230\u6761\u4ef6\u5224\u65ad\u7ed3\u679c\uff0c\u628a\u6761\u4ef6\u7ed3\u679c <code>cond</code> \u548c\u5176\u4f59\u53c2\u6570\u518d\u4f20\u7ed9 <code>PP_WHILE_N_IMPL</code>\u3002\n<code>PP_WHILE_N_IMPL</code> \u53ef\u4ee5\u5206\u4e24\u90e8\u5206\u770b\uff1a\u540e\u534a\u90e8\u5206 <code>(pred, op, PP_IF(cond, op, PP_EMPTY_EAT)(val))</code> \u662f\u4f5c\u4e3a\u524d\u534a\u90e8\u5206\u7684\u53c2\u6570\uff0c<code>PP_IF(cond, op, PP_EMPTY_EAT)(val)</code> \u662f\u5982\u679c <code>cond</code> \u4e3a\u771f\uff0c\u5219\u6c42\u503c <code>op(val)</code>\uff0c \u5426\u5219\u6c42\u503c <code>PP_EMPTY_EAT(val)</code> \u5f97\u5230\u7a7a\u3002\u524d\u534a\u90e8\u5206 <code>PP_IF(cond, PP_WHILE_N+1, val PP_EMPTY_EAT)</code>\uff0c\u5982\u679c <code>cond</code> \u4e3a\u771f\uff0c\u5219\u8fd4\u56de <code>PP_WHILE_N+1</code>\uff0c\u7ed3\u5408\u540e\u534a\u90e8\u5206\u7684\u53c2\u6570\u7ee7\u7eed\u6267\u884c\u5faa\u73af\uff1b\u5426\u5219\u8fd4\u56de <code>val PP_EMPTY_EAT</code>\uff0c\u6b64\u65f6 <code>val</code> \u5c31\u662f\u6700\u7ec8\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u800c <code>PP_EMPTY_EAT</code> \u4f1a\u541e\u6389\u540e\u534a\u90e8\u5206\u7684\u7ed3\u679c\u3002</p>\n<p><code>SUM</code> \u5b9e\u73b0 <code>N + N-1 + ... + 1</code>\u3002\u521d\u59cb\u503c <code>(max_num, origin_num)</code>\uff1b<code>SUM_PRED</code> \u53d6\u503c\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 <code>x</code>\uff0c\u5224\u65ad\u662f\u5426\u5927\u4e8e 0\uff1b<code>SUM_OP</code> \u5bf9 <code>x</code> \u6267\u884c\u9012\u51cf\u64cd\u4f5c <code>x = x - 1</code>\uff0c\u5bf9 <code>y</code> \u6267\u884c <code>+ x</code> \u64cd\u4f5c <code>y = y + x</code>\u3002\u76f4\u63a5\u7528 <code>SUM_PRED</code> \u548c <code>SUM_OP</code> \u4f20\u7ed9 <code>PP_WHILE</code>\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5143\u7ec4\uff0c\u6211\u4eec\u771f\u6b63\u60f3\u8981\u7684\u7ed3\u679c\u662f\u5143\u7ec4\u7684\u7b2c 2 \u4e2a\u5143\u7d20\uff0c\u4e8e\u662f\u518d\u7528 <code>SUM</code> \u53d6\u7b2c 2 \u4e2a\u5143\u7d20\u7684\u503c\u3002</p>\n<h4 id=\"_25\">\u9012\u5f52\u91cd\u5165</h4>\n<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u7684\u904d\u5386\u8bbf\u95ee\u548c\u6761\u4ef6\u5faa\u73af\u90fd\u8fd0\u4f5c\u7684\u5f88\u597d\uff0c\u7ed3\u679c\u7b26\u5408\u9884\u671f\u3002\u8fd8\u8bb0\u5f97\u6211\u4eec\u5728\u8bb2\u5b8f\u5c55\u5f00\u89c4\u5219\u7684\u65f6\u5019\u63d0\u5230\u7684\u7981\u6b62\u9012\u5f52\u91cd\u5165\u4e48\uff0c\u5f53\u6211\u4eec\u60f3\u8981\u6267\u884c\u4e24\u91cd\u5faa\u73af\u7684\u65f6\u5019\u5c31\u4e0d\u5e78\u9047\u5230\u5230\u4e86\u7981\u6b62\u9012\u5f52\u91cd\u5165\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-37-1\" name=\"__codelineno-37-1\" href=\"#__codelineno-37-1\"></a><span class=\"cp\">#define SUM_OP2(xy_tuple) SUM_OP_OP_IMPL2 xy_tuple</span>\n<a id=\"__codelineno-37-2\" name=\"__codelineno-37-2\" href=\"#__codelineno-37-2\"></a><span class=\"cp\">#define SUM_OP_OP_IMPL2(x, y) (PP_DEC(x), y + SUM(x, 0))</span>\n<a id=\"__codelineno-37-3\" name=\"__codelineno-37-3\" href=\"#__codelineno-37-3\"></a>\n<a id=\"__codelineno-37-4\" name=\"__codelineno-37-4\" href=\"#__codelineno-37-4\"></a><span class=\"cp\">#define SUM2(max_num, origin_num) \\</span>\n<a id=\"__codelineno-37-5\" name=\"__codelineno-37-5\" href=\"#__codelineno-37-5\"></a><span class=\"cp\">    PP_IDENTITY(SUM_IMPL PP_WHILE(SUM_PRED, SUM_OP2, (max_num, origin_num)))</span>\n<a id=\"__codelineno-37-6\" name=\"__codelineno-37-6\" href=\"#__codelineno-37-6\"></a>\n<a id=\"__codelineno-37-7\" name=\"__codelineno-37-7\" href=\"#__codelineno-37-7\"></a><span class=\"n\">SUM2</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; a + SUM_IMPL PP_WHILE_1(SUM_PRED, SUM_OP, (1, a))</span>\n</code></pre></div>\n<p><code>SUM2</code> \u628a\u53c2\u6570 <code>op</code> \u6539\u7528 <code>SUM_OP2</code>\uff0c<code>SUM_OP2</code> \u91cc\u9762\u4f1a\u8c03\u7528\u5230 <code>SUM</code>\uff0c\u800c <code>SUM</code> \u5c55\u5f00\u8fd8\u4f1a\u662f <code>PP_WHILE_1</code>\uff0c\u76f8\u5f53\u4e8e <code>PP_WHILE_1</code> \u9012\u5f52\u8c03\u7528\u5230\u4e86\u81ea\u8eab\uff0c\u9884\u5904\u7406\u5668\u505c\u6b62\u5c55\u5f00\u3002</p>\n<p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u79cd\u81ea\u52a8\u63a8\u5bfc\u9012\u5f52\u7684\u65b9\u6cd5\uff08Automatic Recursion\uff09\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-38-1\" name=\"__codelineno-38-1\" href=\"#__codelineno-38-1\"></a><span class=\"cp\">#define PP_AUTO_WHILE PP_CONCAT(PP_WHILE_, PP_AUTO_REC(PP_WHILE_PRED))</span>\n<a id=\"__codelineno-38-2\" name=\"__codelineno-38-2\" href=\"#__codelineno-38-2\"></a>\n<a id=\"__codelineno-38-3\" name=\"__codelineno-38-3\" href=\"#__codelineno-38-3\"></a><span class=\"cp\">#define PP_AUTO_REC(check) PP_IF(check(2), PP_AUTO_REC_12, PP_AUTO_REC_34)(check)</span>\n<a id=\"__codelineno-38-4\" name=\"__codelineno-38-4\" href=\"#__codelineno-38-4\"></a><span class=\"cp\">#define PP_AUTO_REC_12(check) PP_IF(check(1), 1, 2)</span>\n<a id=\"__codelineno-38-5\" name=\"__codelineno-38-5\" href=\"#__codelineno-38-5\"></a><span class=\"cp\">#define PP_AUTO_REC_34(check) PP_IF(check(3), 3, 4)</span>\n<a id=\"__codelineno-38-6\" name=\"__codelineno-38-6\" href=\"#__codelineno-38-6\"></a>\n<a id=\"__codelineno-38-7\" name=\"__codelineno-38-7\" href=\"#__codelineno-38-7\"></a><span class=\"cp\">#define PP_WHILE_PRED(n) \\</span>\n<a id=\"__codelineno-38-8\" name=\"__codelineno-38-8\" href=\"#__codelineno-38-8\"></a><span class=\"cp\">    PP_CONCAT(PP_WHILE_CHECK_, PP_WHILE_ ## n(PP_WHILE_FALSE, PP_WHILE_FALSE, PP_WHILE_FALSE))</span>\n<a id=\"__codelineno-38-9\" name=\"__codelineno-38-9\" href=\"#__codelineno-38-9\"></a><span class=\"cp\">#define PP_WHILE_FALSE(...) 0</span>\n<a id=\"__codelineno-38-10\" name=\"__codelineno-38-10\" href=\"#__codelineno-38-10\"></a>\n<a id=\"__codelineno-38-11\" name=\"__codelineno-38-11\" href=\"#__codelineno-38-11\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_FALSE 1</span>\n<a id=\"__codelineno-38-12\" name=\"__codelineno-38-12\" href=\"#__codelineno-38-12\"></a>\n<a id=\"__codelineno-38-13\" name=\"__codelineno-38-13\" href=\"#__codelineno-38-13\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_1(...) 0</span>\n<a id=\"__codelineno-38-14\" name=\"__codelineno-38-14\" href=\"#__codelineno-38-14\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_2(...) 0</span>\n<a id=\"__codelineno-38-15\" name=\"__codelineno-38-15\" href=\"#__codelineno-38-15\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_3(...) 0</span>\n<a id=\"__codelineno-38-16\" name=\"__codelineno-38-16\" href=\"#__codelineno-38-16\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_4(...) 0</span>\n<a id=\"__codelineno-38-17\" name=\"__codelineno-38-17\" href=\"#__codelineno-38-17\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-38-18\" name=\"__codelineno-38-18\" href=\"#__codelineno-38-18\"></a><span class=\"cp\">#define PP_WHILE_CHECK_PP_WHILE_8(...) 0</span>\n<a id=\"__codelineno-38-19\" name=\"__codelineno-38-19\" href=\"#__codelineno-38-19\"></a>\n<a id=\"__codelineno-38-20\" name=\"__codelineno-38-20\" href=\"#__codelineno-38-20\"></a><span class=\"n\">PP_AUTO_WHILE</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; PP_WHILE_1</span>\n<a id=\"__codelineno-38-21\" name=\"__codelineno-38-21\" href=\"#__codelineno-38-21\"></a>\n<a id=\"__codelineno-38-22\" name=\"__codelineno-38-22\" href=\"#__codelineno-38-22\"></a><span class=\"cp\">#define SUM3(max_num, origin_num) \\</span>\n<a id=\"__codelineno-38-23\" name=\"__codelineno-38-23\" href=\"#__codelineno-38-23\"></a><span class=\"cp\">    PP_IDENTITY(SUM_IMPL PP_AUTO_WHILE(SUM_PRED, SUM_OP, (max_num, origin_num)))</span>\n<a id=\"__codelineno-38-24\" name=\"__codelineno-38-24\" href=\"#__codelineno-38-24\"></a>\n<a id=\"__codelineno-38-25\" name=\"__codelineno-38-25\" href=\"#__codelineno-38-25\"></a><span class=\"cp\">#define SUM_OP4(xy_tuple) SUM_OP_OP_IMPL4 xy_tuple</span>\n<a id=\"__codelineno-38-26\" name=\"__codelineno-38-26\" href=\"#__codelineno-38-26\"></a><span class=\"cp\">#define SUM_OP_OP_IMPL4(x, y) (PP_DEC(x), y + SUM3(x, 0))</span>\n<a id=\"__codelineno-38-27\" name=\"__codelineno-38-27\" href=\"#__codelineno-38-27\"></a>\n<a id=\"__codelineno-38-28\" name=\"__codelineno-38-28\" href=\"#__codelineno-38-28\"></a><span class=\"cp\">#define SUM4(max_num, origin_num) \\</span>\n<a id=\"__codelineno-38-29\" name=\"__codelineno-38-29\" href=\"#__codelineno-38-29\"></a><span class=\"cp\">    PP_IDENTITY(SUM_IMPL PP_AUTO_WHILE(SUM_PRED, SUM_OP4, (max_num, origin_num)))</span>\n<a id=\"__codelineno-38-30\" name=\"__codelineno-38-30\" href=\"#__codelineno-38-30\"></a>\n<a id=\"__codelineno-38-31\" name=\"__codelineno-38-31\" href=\"#__codelineno-38-31\"></a><span class=\"n\">SUM4</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; a + 0 + 2 + 1 + 0 + 1</span>\n</code></pre></div>\n<p><code>PP_AUTO_WHILE</code> \u5c31\u662f <code>PP_WHILE</code> \u7684\u81ea\u52a8\u63a8\u5bfc\u9012\u5f52\u7248\u672c\uff0c\u6838\u5fc3\u7684\u5b8f\u662f <code>PP_AUTO_REC(PP_WHILE_PRED)</code>\uff0c\u8fd9\u4e2a\u5b8f\u53ef\u4ee5\u627e\u51fa\u5f53\u524d\u53ef\u7528\u7684 <code>PP_WHILE_N</code> \u7248\u672c\u7684\u6570\u5b57 <code>N</code>\u3002</p>\n<p>\u63a8\u5bfc\u7684\u539f\u7406\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u641c\u7d22\u6240\u6709\u7248\u672c\uff0c\u627e\u51fa\u80fd\u591f\u6b63\u786e\u5c55\u5f00\u7684\u7248\u672c\uff0c\u8fd4\u56de\u8be5\u7248\u672c\u7684\u6570\u5b57\uff0c\u4e3a\u4e86\u63d0\u5347\u641c\u7d22\u7684\u901f\u5ea6\uff0c\u4e00\u822c\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\uff0c\u8fd9\u5c31\u662f <code>PP_AUTO_REC</code> \u5728\u505a\u7684\u4e8b\u60c5\u3002<code>PP_AUTO_REC</code> \u63a5\u53d7\u4e00\u4e2a\u53c2\u6570 <code>check</code>\uff0c<code>check</code> \u8d1f\u8d23\u68c0\u67e5\u7248\u672c\u53ef\u7528\u6027\uff0c\u8fd9\u91cc\u7ed9\u51fa\u7684\u662f\u652f\u6301\u641c\u7d22\u7248\u672c\u8303\u56f4 <code>[1, 4]</code>\u3002<code>PP_AUTO_REC</code> \u4f1a\u9996\u5148\u68c0\u67e5 <code>check(2)</code>\uff0c\u5982\u679c <code>check(2)</code> \u4e3a\u771f\uff0c\u5219\u8c03\u7528 <code>PP_AUTO_REC_12</code> \u641c\u7d22\u8303\u56f4 <code>[1, 2]</code>\uff0c\u5426\u5219\u7528 <code>PP_AUTO_REC_34</code> \u641c\u7d22 <code>[3, 4]</code>\u3002<code>PP_AUTO_REC_12</code> \u68c0\u67e5 <code>check(1)</code> \u5982\u679c\u4e3a\u771f\uff0c\u8bf4\u660e\u7248\u672c <code>1</code> \u53ef\u7528\uff0c\u5426\u5219\u7528\u7248\u672c <code>2</code>\uff0c<code>PP_AUTO_REC_34</code> \u540c\u7406\u3002</p>\n<p><code>check</code> \u5b8f\u8981\u600e\u4e48\u5199\u624d\u80fd\u77e5\u9053\u7248\u672c\u662f\u5426\u53ef\u7528\u5462\uff1f\u5728\u8fd9\u91cc\uff0c<code>PP_WHILE_PRED</code> \u4f1a\u5c55\u5f00\u6210\u4e24\u90e8\u5206\u7684\u62fc\u63a5\uff0c\u6211\u4eec\u6765\u770b\u540e\u90e8\u5206 <code>PP_WHILE_ ## n(PP_WHILE_FALSE, PP_WHILE_FALSE, PP_WHILE_FALSE)</code>\uff1a\u5982\u679c <code>PP_WHILE_ ## n</code> \u53ef\u7528\uff0c\u7531\u4e8e <code>PP_WHILE_FALSE</code> \u56fa\u5b9a\u8fd4\u56de <code>0</code>\uff0c\u8fd9\u90e8\u5206\u4f1a\u5c55\u5f00\u5f97\u5230 <code>val</code> \u53c2\u6570\u7684\u503c\uff0c\u4e5f\u5c31\u662f <code>PP_WHILE_FALSE</code>\uff1b\u5426\u5219\u8fd9\u90e8\u5206\u5b8f\u4f1a\u4fdd\u6301\u4e0d\u53d8\uff0c\u4f9d\u7136\u662f <code>PP_WHILE_n(PP_WHILE_FALSE, PP_WHILE_FALSE, PP_WHILE_FALSE)</code>\u3002</p>\n<p>\u628a\u540e\u90e8\u5206\u7684\u7ed3\u679c\u8ddf\u524d\u90e8\u5206 <code>PP_WHILE_CHECK_</code> \u62fc\u63a5\u8d77\u6765\uff0c\u5f97\u5230\u4e24\u79cd\u7ed3\u679c\uff1a<code>PP_WHILE_CHECK_PP_WHILE_FALSE</code> \u6216\u8005 <code>PP_WHILE_CHECK_PP_WHILE_n(PP_WHILE_FALSE, PP_WHILE_FALSE, PP_WHILE_FALSE)</code>\uff0c\u4e8e\u662f\u6211\u4eec\u8ba9 <code>PP_WHILE_CHECK_PP_WHILE_FALSE</code> \u8fd4\u56de <code>1</code> \u8868\u660e\u53ef\u7528\uff0c<code>PP_WHILE_CHECK_PP_WHILE_n</code> \u8fd4\u56de <code>0</code> \u8868\u793a\u4e0d\u53ef\u7528\u3002\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u81ea\u52a8\u63a8\u5bfc\u9012\u5f52\u7684\u529f\u80fd\u3002</p>\n<h4 id=\"_26\">\u7b97\u672f\u6bd4\u8f83</h4>\n<p>\u4e0d\u76f8\u7b49\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-39-1\" name=\"__codelineno-39-1\" href=\"#__codelineno-39-1\"></a><span class=\"cp\">#define PP_NOT_EQUAL(x, y) PP_NOT_EQUAL_IMPL(x, y)</span>\n<a id=\"__codelineno-39-2\" name=\"__codelineno-39-2\" href=\"#__codelineno-39-2\"></a><span class=\"cp\">#define PP_NOT_EQUAL_IMPL(x, y) \\</span>\n<a id=\"__codelineno-39-3\" name=\"__codelineno-39-3\" href=\"#__codelineno-39-3\"></a><span class=\"cp\">    PP_CONCAT(PP_NOT_EQUAL_CHECK_, PP_NOT_EQUAL_ ## x(0, PP_NOT_EQUAL_ ## y))</span>\n<a id=\"__codelineno-39-4\" name=\"__codelineno-39-4\" href=\"#__codelineno-39-4\"></a>\n<a id=\"__codelineno-39-5\" name=\"__codelineno-39-5\" href=\"#__codelineno-39-5\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_EQUAL_NIL 1</span>\n<a id=\"__codelineno-39-6\" name=\"__codelineno-39-6\" href=\"#__codelineno-39-6\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_0(...) 0</span>\n<a id=\"__codelineno-39-7\" name=\"__codelineno-39-7\" href=\"#__codelineno-39-7\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_1(...) 0</span>\n<a id=\"__codelineno-39-8\" name=\"__codelineno-39-8\" href=\"#__codelineno-39-8\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_2(...) 0</span>\n<a id=\"__codelineno-39-9\" name=\"__codelineno-39-9\" href=\"#__codelineno-39-9\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_3(...) 0</span>\n<a id=\"__codelineno-39-10\" name=\"__codelineno-39-10\" href=\"#__codelineno-39-10\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_4(...) 0</span>\n<a id=\"__codelineno-39-11\" name=\"__codelineno-39-11\" href=\"#__codelineno-39-11\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-39-12\" name=\"__codelineno-39-12\" href=\"#__codelineno-39-12\"></a><span class=\"cp\">#define PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_8(...) 0</span>\n<a id=\"__codelineno-39-13\" name=\"__codelineno-39-13\" href=\"#__codelineno-39-13\"></a>\n<a id=\"__codelineno-39-14\" name=\"__codelineno-39-14\" href=\"#__codelineno-39-14\"></a><span class=\"cp\">#define PP_NOT_EQUAL_0(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-15\" name=\"__codelineno-39-15\" href=\"#__codelineno-39-15\"></a><span class=\"cp\">#define PP_NOT_EQUAL_1(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-16\" name=\"__codelineno-39-16\" href=\"#__codelineno-39-16\"></a><span class=\"cp\">#define PP_NOT_EQUAL_2(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-17\" name=\"__codelineno-39-17\" href=\"#__codelineno-39-17\"></a><span class=\"cp\">#define PP_NOT_EQUAL_3(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-18\" name=\"__codelineno-39-18\" href=\"#__codelineno-39-18\"></a><span class=\"cp\">#define PP_NOT_EQUAL_4(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-19\" name=\"__codelineno-39-19\" href=\"#__codelineno-39-19\"></a><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-39-20\" name=\"__codelineno-39-20\" href=\"#__codelineno-39-20\"></a><span class=\"cp\">#define PP_NOT_EQUAL_8(cond, y) PP_IF(cond, PP_EQUAL_NIL, y(1, PP_EQUAL_NIL))</span>\n<a id=\"__codelineno-39-21\" name=\"__codelineno-39-21\" href=\"#__codelineno-39-21\"></a>\n<a id=\"__codelineno-39-22\" name=\"__codelineno-39-22\" href=\"#__codelineno-39-22\"></a><span class=\"n\">PP_NOT_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-39-23\" name=\"__codelineno-39-23\" href=\"#__codelineno-39-23\"></a><span class=\"n\">PP_NOT_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; 1</span>\n</code></pre></div>\n<p>\u5224\u65ad\u6570\u503c\u662f\u5426\u76f8\u7b49\uff0c\u7528\u5230\u4e86\u7981\u6b62\u9012\u5f52\u91cd\u5165\u7684\u7279\u6027\uff0c\u628a <code>x</code> \u548c <code>y</code> \u9012\u5f52\u62fc\u63a5\u6210 <code>PP_NOT_EQUAL_x PP_NOT_EQUAL_y</code> \u5b8f\uff0c\u5982\u679c <code>x == y</code>\uff0c\u5219\u4e0d\u4f1a\u5c55\u5f00 <code>PP_NOT_EQUAL_y</code> \u5b8f\uff0c\u8ddf <code>PP_NOT_EQUAL_CHECK_</code> \u62fc\u63a5\u6210 <code>PP_NOT_EQUAL_CHECK_PP_NOT_EQUAL_y</code> \u8fd4\u56de <code>0</code>\uff1b\u53cd\u4e4b\uff0c\u4e24\u6b21\u90fd\u6210\u529f\u5c55\u5f00\u6700\u540e\u5f97\u5230 <code>PP_EQUAL_NIL</code>\uff0c\u62fc\u63a5\u5f97\u5230 <code>PP_NOT_EQUAL_CHECK_PP_EQUAL_NIL</code> \u8fd4\u56de <code>1</code>\u3002</p>\n<p>\u76f8\u7b49\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-40-1\" name=\"__codelineno-40-1\" href=\"#__codelineno-40-1\"></a><span class=\"cp\">#define PP_EQUAL(x, y) PP_NOT(PP_NOT_EQUAL(x, y))</span>\n<a id=\"__codelineno-40-2\" name=\"__codelineno-40-2\" href=\"#__codelineno-40-2\"></a>\n<a id=\"__codelineno-40-3\" name=\"__codelineno-40-3\" href=\"#__codelineno-40-3\"></a><span class=\"n\">PP_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-40-4\" name=\"__codelineno-40-4\" href=\"#__codelineno-40-4\"></a><span class=\"n\">PP_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\">              </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p>\u5c0f\u4e8e\u7b49\u4e8e\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-41-1\" name=\"__codelineno-41-1\" href=\"#__codelineno-41-1\"></a><span class=\"cp\">#define PP_LESS_EQUAL(x, y) PP_NOT(PP_SUB(x, y))</span>\n<a id=\"__codelineno-41-2\" name=\"__codelineno-41-2\" href=\"#__codelineno-41-2\"></a>\n<a id=\"__codelineno-41-3\" name=\"__codelineno-41-3\" href=\"#__codelineno-41-3\"></a><span class=\"n\">PP_LESS_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">         </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-41-4\" name=\"__codelineno-41-4\" href=\"#__codelineno-41-4\"></a><span class=\"n\">PP_LESS_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">         </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-41-5\" name=\"__codelineno-41-5\" href=\"#__codelineno-41-5\"></a><span class=\"n\">PP_LESS_EQUAL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">         </span><span class=\"c1\">// -&gt; 1</span>\n</code></pre></div>\n<p>\u5c0f\u4e8e\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-42-1\" name=\"__codelineno-42-1\" href=\"#__codelineno-42-1\"></a><span class=\"cp\">#define PP_LESS(x, y) PP_AND(PP_LESS_EQUAL(x, y), PP_NOT_EQUAL(x, y))</span>\n<a id=\"__codelineno-42-2\" name=\"__codelineno-42-2\" href=\"#__codelineno-42-2\"></a>\n<a id=\"__codelineno-42-3\" name=\"__codelineno-42-3\" href=\"#__codelineno-42-3\"></a><span class=\"n\">PP_LESS</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">               </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-42-4\" name=\"__codelineno-42-4\" href=\"#__codelineno-42-4\"></a><span class=\"n\">PP_LESS</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">               </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-42-5\" name=\"__codelineno-42-5\" href=\"#__codelineno-42-5\"></a><span class=\"n\">PP_LESS</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">               </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p>\u53e6\u5916\u8fd8\u6709\u5927\u4e8e\uff0c\u5927\u4e8e\u7b49\u4e8e\u7b49\u7b49\u7b97\u672f\u6bd4\u8f83\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002</p>\n<h4 id=\"_27\">\u7b97\u672f\u8fd0\u7b97</h4>\n<p>\u5229\u7528 <code>PP_AUTO_WHILE</code> \u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u57fa\u7840\u7684\u7b97\u672f\u8fd0\u7b97\u4e86\uff0c\u800c\u4e14\u652f\u6301\u5d4c\u5957\u8fd0\u7b97\u3002</p>\n<p>\u52a0\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-43-1\" name=\"__codelineno-43-1\" href=\"#__codelineno-43-1\"></a><span class=\"cp\">#define PP_ADD(x, y) \\</span>\n<a id=\"__codelineno-43-2\" name=\"__codelineno-43-2\" href=\"#__codelineno-43-2\"></a><span class=\"cp\">    PP_IDENTITY(PP_ADD_IMPL PP_AUTO_WHILE(PP_ADD_PRED, PP_ADD_OP, (x, y)))</span>\n<a id=\"__codelineno-43-3\" name=\"__codelineno-43-3\" href=\"#__codelineno-43-3\"></a><span class=\"cp\">#define PP_ADD_IMPL(x, y) x</span>\n<a id=\"__codelineno-43-4\" name=\"__codelineno-43-4\" href=\"#__codelineno-43-4\"></a>\n<a id=\"__codelineno-43-5\" name=\"__codelineno-43-5\" href=\"#__codelineno-43-5\"></a><span class=\"cp\">#define PP_ADD_PRED(xy_tuple) PP_ADD_PRED_IMPL xy_tuple</span>\n<a id=\"__codelineno-43-6\" name=\"__codelineno-43-6\" href=\"#__codelineno-43-6\"></a><span class=\"cp\">#define PP_ADD_PRED_IMPL(x, y) y</span>\n<a id=\"__codelineno-43-7\" name=\"__codelineno-43-7\" href=\"#__codelineno-43-7\"></a>\n<a id=\"__codelineno-43-8\" name=\"__codelineno-43-8\" href=\"#__codelineno-43-8\"></a><span class=\"cp\">#define PP_ADD_OP(xy_tuple) PP_ADD_OP_IMPL xy_tuple</span>\n<a id=\"__codelineno-43-9\" name=\"__codelineno-43-9\" href=\"#__codelineno-43-9\"></a><span class=\"cp\">#define PP_ADD_OP_IMPL(x, y) (PP_INC(x), PP_DEC(y))</span>\n<a id=\"__codelineno-43-10\" name=\"__codelineno-43-10\" href=\"#__codelineno-43-10\"></a>\n<a id=\"__codelineno-43-11\" name=\"__codelineno-43-11\" href=\"#__codelineno-43-11\"></a><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">                  </span><span class=\"c1\">// -&gt; 3</span>\n<a id=\"__codelineno-43-12\" name=\"__codelineno-43-12\" href=\"#__codelineno-43-12\"></a><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; 4</span>\n</code></pre></div>\n<p>\u51cf\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-44-1\" name=\"__codelineno-44-1\" href=\"#__codelineno-44-1\"></a><span class=\"cp\">#define PP_SUB(x, y) \\</span>\n<a id=\"__codelineno-44-2\" name=\"__codelineno-44-2\" href=\"#__codelineno-44-2\"></a><span class=\"cp\">    PP_IDENTITY(PP_SUB_IMPL PP_AUTO_WHILE(PP_SUB_PRED, PP_SUB_OP, (x, y)))</span>\n<a id=\"__codelineno-44-3\" name=\"__codelineno-44-3\" href=\"#__codelineno-44-3\"></a><span class=\"cp\">#define PP_SUB_IMPL(x, y) x</span>\n<a id=\"__codelineno-44-4\" name=\"__codelineno-44-4\" href=\"#__codelineno-44-4\"></a>\n<a id=\"__codelineno-44-5\" name=\"__codelineno-44-5\" href=\"#__codelineno-44-5\"></a><span class=\"cp\">#define PP_SUB_PRED(xy_tuple) PP_SUB_PRED_IMPL xy_tuple</span>\n<a id=\"__codelineno-44-6\" name=\"__codelineno-44-6\" href=\"#__codelineno-44-6\"></a><span class=\"cp\">#define PP_SUB_PRED_IMPL(x, y) y</span>\n<a id=\"__codelineno-44-7\" name=\"__codelineno-44-7\" href=\"#__codelineno-44-7\"></a>\n<a id=\"__codelineno-44-8\" name=\"__codelineno-44-8\" href=\"#__codelineno-44-8\"></a><span class=\"cp\">#define PP_SUB_OP(xy_tuple) PP_SUB_OP_IMPL xy_tuple</span>\n<a id=\"__codelineno-44-9\" name=\"__codelineno-44-9\" href=\"#__codelineno-44-9\"></a><span class=\"cp\">#define PP_SUB_OP_IMPL(x, y) (PP_DEC(x), PP_DEC(y))</span>\n<a id=\"__codelineno-44-10\" name=\"__codelineno-44-10\" href=\"#__codelineno-44-10\"></a>\n<a id=\"__codelineno-44-11\" name=\"__codelineno-44-11\" href=\"#__codelineno-44-11\"></a><span class=\"n\">PP_SUB</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-44-12\" name=\"__codelineno-44-12\" href=\"#__codelineno-44-12\"></a><span class=\"n\">PP_SUB</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 0</span>\n</code></pre></div>\n<p>\u4e58\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-45-1\" name=\"__codelineno-45-1\" href=\"#__codelineno-45-1\"></a><span class=\"cp\">#define PP_MUL(x, y) \\</span>\n<a id=\"__codelineno-45-2\" name=\"__codelineno-45-2\" href=\"#__codelineno-45-2\"></a><span class=\"cp\">    IDENTITY(PP_MUL_IMPL PP_AUTO_WHILE(PP_MUL_PRED, PP_MUL_OP, (0, x, y)))</span>\n<a id=\"__codelineno-45-3\" name=\"__codelineno-45-3\" href=\"#__codelineno-45-3\"></a><span class=\"cp\">#define PP_MUL_IMPL(ret, x, y) ret</span>\n<a id=\"__codelineno-45-4\" name=\"__codelineno-45-4\" href=\"#__codelineno-45-4\"></a>\n<a id=\"__codelineno-45-5\" name=\"__codelineno-45-5\" href=\"#__codelineno-45-5\"></a><span class=\"cp\">#define PP_MUL_PRED(rxy_tuple) PP_MUL_PRED_IMPL rxy_tuple</span>\n<a id=\"__codelineno-45-6\" name=\"__codelineno-45-6\" href=\"#__codelineno-45-6\"></a><span class=\"cp\">#define PP_MUL_PRED_IMPL(ret, x, y) y</span>\n<a id=\"__codelineno-45-7\" name=\"__codelineno-45-7\" href=\"#__codelineno-45-7\"></a>\n<a id=\"__codelineno-45-8\" name=\"__codelineno-45-8\" href=\"#__codelineno-45-8\"></a><span class=\"cp\">#define PP_MUL_OP(rxy_tuple) PP_MUL_OP_IMPL rxy_tuple</span>\n<a id=\"__codelineno-45-9\" name=\"__codelineno-45-9\" href=\"#__codelineno-45-9\"></a><span class=\"cp\">#define PP_MUL_OP_IMPL(ret, x, y) (PP_ADD(ret, x), x, PP_DEC(y))</span>\n<a id=\"__codelineno-45-10\" name=\"__codelineno-45-10\" href=\"#__codelineno-45-10\"></a>\n<a id=\"__codelineno-45-11\" name=\"__codelineno-45-11\" href=\"#__codelineno-45-11\"></a><span class=\"n\">PP_MUL</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; 1</span>\n<a id=\"__codelineno-45-12\" name=\"__codelineno-45-12\" href=\"#__codelineno-45-12\"></a><span class=\"n\">PP_MUL</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 2</span>\n</code></pre></div>\n<p>\u4e58\u6cd5\u5b9e\u73b0\u8fd9\u91cc\u589e\u52a0\u4e86\u4e00\u4e2a\u53c2\u6570 <code>ret</code>\uff0c\u521d\u59cb\u503c\u4e3a <code>0</code>\uff0c\u6bcf\u6b21\u8fed\u4ee3\u4f1a\u6267\u884c <code>ret = ret + x</code>\u3002</p>\n<p>\u9664\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-46-1\" name=\"__codelineno-46-1\" href=\"#__codelineno-46-1\"></a><span class=\"cp\">#define PP_DIV(x, y) \\</span>\n<a id=\"__codelineno-46-2\" name=\"__codelineno-46-2\" href=\"#__codelineno-46-2\"></a><span class=\"cp\">    IDENTITY(PP_DIV_IMPL PP_AUTO_WHILE(PP_DIV_PRED, PP_DIV_OP, (0, x, y)))</span>\n<a id=\"__codelineno-46-3\" name=\"__codelineno-46-3\" href=\"#__codelineno-46-3\"></a><span class=\"cp\">#define PP_DIV_IMPL(ret, x, y) ret</span>\n<a id=\"__codelineno-46-4\" name=\"__codelineno-46-4\" href=\"#__codelineno-46-4\"></a>\n<a id=\"__codelineno-46-5\" name=\"__codelineno-46-5\" href=\"#__codelineno-46-5\"></a><span class=\"cp\">#define PP_DIV_PRED(rxy_tuple) PP_DIV_PRED_IMPL rxy_tuple</span>\n<a id=\"__codelineno-46-6\" name=\"__codelineno-46-6\" href=\"#__codelineno-46-6\"></a><span class=\"cp\">#define PP_DIV_PRED_IMPL(ret, x, y) PP_LESS_EQUAL(y, x)</span>\n<a id=\"__codelineno-46-7\" name=\"__codelineno-46-7\" href=\"#__codelineno-46-7\"></a>\n<a id=\"__codelineno-46-8\" name=\"__codelineno-46-8\" href=\"#__codelineno-46-8\"></a><span class=\"cp\">#define PP_DIV_OP(rxy_tuple) PP_DIV_OP_IMPL rxy_tuple</span>\n<a id=\"__codelineno-46-9\" name=\"__codelineno-46-9\" href=\"#__codelineno-46-9\"></a><span class=\"cp\">#define PP_DIV_OP_IMPL(ret, x, y) (PP_INC(ret), PP_SUB(x, y), y)</span>\n<a id=\"__codelineno-46-10\" name=\"__codelineno-46-10\" href=\"#__codelineno-46-10\"></a>\n<a id=\"__codelineno-46-11\" name=\"__codelineno-46-11\" href=\"#__codelineno-46-11\"></a><span class=\"n\">PP_DIV</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-46-12\" name=\"__codelineno-46-12\" href=\"#__codelineno-46-12\"></a><span class=\"n\">PP_DIV</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\">                </span><span class=\"c1\">// -&gt; 2</span>\n<a id=\"__codelineno-46-13\" name=\"__codelineno-46-13\" href=\"#__codelineno-46-13\"></a><span class=\"n\">PP_DIV</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PP_ADD</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\">     </span><span class=\"c1\">// -&gt; 1</span>\n</code></pre></div>\n<p>\u9664\u6cd5\u5229\u7528\u4e86 <code>PP_LESS_EQUAL</code>\uff0c\u53ea\u6709 <code>y &lt;= x</code> \u7684\u60c5\u51b5\u4e0b\u624d\u7ee7\u7eed\u5faa\u73af\u3002</p>\n<h4 id=\"_28\">\u6570\u636e\u7ed3\u6784</h4>\n<p>\u5b8f\u4e5f\u53ef\u4ee5\u6709\u6570\u636e\u7ed3\u6784\uff0c\u5176\u5b9e\u6211\u4eec\u5728\u524d\u9762\u7684\u4e5f\u7a0d\u5fae\u7528\u5230\u4e86\u4e00\u79cd\u6570\u636e\u7ed3\u6784 <code>tuple</code>\uff0c<code>PP_REMOVE_PARENS</code> \u5c31\u662f\u53ef\u4ee5\u53bb\u6389 <code>tuple</code> \u7684\u5916\u5c42\u62ec\u53f7\uff0c\u8fd4\u56de\u91cc\u9762\u7684\u5143\u7d20\u3002\u6211\u4eec\u8fd9\u91cc\u5c31\u4ee5 <code>tuple</code> \u4e3a\u4f8b\u5b50\u8ba8\u8bba\u76f8\u5173\u7684\u5b9e\u73b0\uff0c\u5176\u4ed6\u7684\u6570\u636e\u7ed3\u6784 <code>list, array</code> \u7b49\u6709\u5174\u8da3\u53ef\u4ee5\u53bb\u770b <code>Boost</code> \u7684\u5b9e\u73b0\u3002</p>\n<p><code>tuple</code> \u5b9a\u4e49\u4e3a\u7528\u62ec\u53f7\u5305\u4f4f\u7684\u9017\u53f7\u5206\u5f00\u7684\u5143\u7d20\u96c6\u5408\uff1a<code>(a, b, c)</code>\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-47-1\" name=\"__codelineno-47-1\" href=\"#__codelineno-47-1\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE_PARENS(tuple) PP_REMOVE_PARENS(tuple)</span>\n<a id=\"__codelineno-47-2\" name=\"__codelineno-47-2\" href=\"#__codelineno-47-2\"></a>\n<a id=\"__codelineno-47-3\" name=\"__codelineno-47-3\" href=\"#__codelineno-47-3\"></a><span class=\"c1\">// \u83b7\u53d6\u6307\u5b9a\u4e0b\u6807\u7684\u5143\u7d20</span>\n<a id=\"__codelineno-47-4\" name=\"__codelineno-47-4\" href=\"#__codelineno-47-4\"></a><span class=\"cp\">#define PP_TUPLE_ELEM(i, tuple) PP_ARGS_ELEM(i, PP_TUPLE_REMOVE_PARENS(tuple))</span>\n<a id=\"__codelineno-47-5\" name=\"__codelineno-47-5\" href=\"#__codelineno-47-5\"></a>\n<a id=\"__codelineno-47-6\" name=\"__codelineno-47-6\" href=\"#__codelineno-47-6\"></a><span class=\"c1\">// \u541e\u6389\u6574\u4e2a tuple \u8fd4\u56de\u7a7a</span>\n<a id=\"__codelineno-47-7\" name=\"__codelineno-47-7\" href=\"#__codelineno-47-7\"></a><span class=\"cp\">#define PP_TUPLE_EAT() PP_EMPTY_EAT</span>\n<a id=\"__codelineno-47-8\" name=\"__codelineno-47-8\" href=\"#__codelineno-47-8\"></a>\n<a id=\"__codelineno-47-9\" name=\"__codelineno-47-9\" href=\"#__codelineno-47-9\"></a><span class=\"c1\">// \u83b7\u53d6\u5927\u5c0f</span>\n<a id=\"__codelineno-47-10\" name=\"__codelineno-47-10\" href=\"#__codelineno-47-10\"></a><span class=\"cp\">#define PP_TUPLE_SIZE(tuple) PP_ARGS_SIZE(PP_TUPLE_REMOVE_PARENS(tuple))</span>\n<a id=\"__codelineno-47-11\" name=\"__codelineno-47-11\" href=\"#__codelineno-47-11\"></a>\n<a id=\"__codelineno-47-12\" name=\"__codelineno-47-12\" href=\"#__codelineno-47-12\"></a><span class=\"c1\">// \u6dfb\u52a0\u5143\u7d20</span>\n<a id=\"__codelineno-47-13\" name=\"__codelineno-47-13\" href=\"#__codelineno-47-13\"></a><span class=\"cp\">#define PP_TUPLE_PUSH_BACK(elem, tuple) \\</span>\n<a id=\"__codelineno-47-14\" name=\"__codelineno-47-14\" href=\"#__codelineno-47-14\"></a><span class=\"cp\">    PP_TUPLE_PUSH_BACK_IMPL(PP_TUPLE_SIZE(tuple), elem, tuple)</span>\n<a id=\"__codelineno-47-15\" name=\"__codelineno-47-15\" href=\"#__codelineno-47-15\"></a><span class=\"cp\">#define PP_TUPLE_PUSH_BACK_IMPL(size, elem, tuple) \\</span>\n<a id=\"__codelineno-47-16\" name=\"__codelineno-47-16\" href=\"#__codelineno-47-16\"></a><span class=\"cp\">    (PP_TUPLE_REMOVE_PARENS(tuple) PP_IF(size, PP_COMMA, PP_EMPTY)() elem)</span>\n<a id=\"__codelineno-47-17\" name=\"__codelineno-47-17\" href=\"#__codelineno-47-17\"></a>\n<a id=\"__codelineno-47-18\" name=\"__codelineno-47-18\" href=\"#__codelineno-47-18\"></a><span class=\"c1\">// \u63d2\u5165\u5143\u7d20</span>\n<a id=\"__codelineno-47-19\" name=\"__codelineno-47-19\" href=\"#__codelineno-47-19\"></a><span class=\"cp\">#define PP_TUPLE_INSERT(i, elem, tuple) \\</span>\n<a id=\"__codelineno-47-20\" name=\"__codelineno-47-20\" href=\"#__codelineno-47-20\"></a><span class=\"cp\">    PP_TUPLE_ELEM( \\</span>\n<a id=\"__codelineno-47-21\" name=\"__codelineno-47-21\" href=\"#__codelineno-47-21\"></a><span class=\"cp\">        3, \\</span>\n<a id=\"__codelineno-47-22\" name=\"__codelineno-47-22\" href=\"#__codelineno-47-22\"></a><span class=\"cp\">        PP_AUTO_WHILE( \\</span>\n<a id=\"__codelineno-47-23\" name=\"__codelineno-47-23\" href=\"#__codelineno-47-23\"></a><span class=\"cp\">            PP_TUPLE_INSERT_PRED, \\</span>\n<a id=\"__codelineno-47-24\" name=\"__codelineno-47-24\" href=\"#__codelineno-47-24\"></a><span class=\"cp\">            PP_TUPLE_INSERT_OP, \\</span>\n<a id=\"__codelineno-47-25\" name=\"__codelineno-47-25\" href=\"#__codelineno-47-25\"></a><span class=\"cp\">            (0, i, elem, (), tuple) \\</span>\n<a id=\"__codelineno-47-26\" name=\"__codelineno-47-26\" href=\"#__codelineno-47-26\"></a><span class=\"cp\">        ) \\</span>\n<a id=\"__codelineno-47-27\" name=\"__codelineno-47-27\" href=\"#__codelineno-47-27\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-28\" name=\"__codelineno-47-28\" href=\"#__codelineno-47-28\"></a><span class=\"cp\">#define PP_TUPLE_INSERT_PRED(args) PP_TUPLE_INSERT_PERD_IMPL args</span>\n<a id=\"__codelineno-47-29\" name=\"__codelineno-47-29\" href=\"#__codelineno-47-29\"></a><span class=\"cp\">#define PP_TUPLE_INSERT_PERD_IMPL(curi, i, elem, ret, tuple) \\</span>\n<a id=\"__codelineno-47-30\" name=\"__codelineno-47-30\" href=\"#__codelineno-47-30\"></a><span class=\"cp\">    PP_NOT_EQUAL(PP_TUPLE_SIZE(ret), PP_INC(PP_TUPLE_SIZE(tuple)))</span>\n<a id=\"__codelineno-47-31\" name=\"__codelineno-47-31\" href=\"#__codelineno-47-31\"></a><span class=\"cp\">#define PP_TUPLE_INSERT_OP(args) PP_TUPLE_INSERT_OP_IMPL args</span>\n<a id=\"__codelineno-47-32\" name=\"__codelineno-47-32\" href=\"#__codelineno-47-32\"></a><span class=\"cp\">#define PP_TUPLE_INSERT_OP_IMPL(curi, i, elem, ret, tuple) \\</span>\n<a id=\"__codelineno-47-33\" name=\"__codelineno-47-33\" href=\"#__codelineno-47-33\"></a><span class=\"cp\">    ( \\</span>\n<a id=\"__codelineno-47-34\" name=\"__codelineno-47-34\" href=\"#__codelineno-47-34\"></a><span class=\"cp\">    PP_IF(PP_NOT_EQUAL(PP_TUPLE_SIZE(ret), i), PP_INC(curi), curi), \\</span>\n<a id=\"__codelineno-47-35\" name=\"__codelineno-47-35\" href=\"#__codelineno-47-35\"></a><span class=\"cp\">    i, elem, \\</span>\n<a id=\"__codelineno-47-36\" name=\"__codelineno-47-36\" href=\"#__codelineno-47-36\"></a><span class=\"cp\">    PP_TUPLE_PUSH_BACK(\\</span>\n<a id=\"__codelineno-47-37\" name=\"__codelineno-47-37\" href=\"#__codelineno-47-37\"></a><span class=\"cp\">        PP_IF( \\</span>\n<a id=\"__codelineno-47-38\" name=\"__codelineno-47-38\" href=\"#__codelineno-47-38\"></a><span class=\"cp\">            PP_NOT_EQUAL(PP_TUPLE_SIZE(ret), i), \\</span>\n<a id=\"__codelineno-47-39\" name=\"__codelineno-47-39\" href=\"#__codelineno-47-39\"></a><span class=\"cp\">            PP_TUPLE_ELEM(curi, tuple), elem \\</span>\n<a id=\"__codelineno-47-40\" name=\"__codelineno-47-40\" href=\"#__codelineno-47-40\"></a><span class=\"cp\">        ), \\</span>\n<a id=\"__codelineno-47-41\" name=\"__codelineno-47-41\" href=\"#__codelineno-47-41\"></a><span class=\"cp\">        ret \\</span>\n<a id=\"__codelineno-47-42\" name=\"__codelineno-47-42\" href=\"#__codelineno-47-42\"></a><span class=\"cp\">    ), \\</span>\n<a id=\"__codelineno-47-43\" name=\"__codelineno-47-43\" href=\"#__codelineno-47-43\"></a><span class=\"cp\">    tuple \\</span>\n<a id=\"__codelineno-47-44\" name=\"__codelineno-47-44\" href=\"#__codelineno-47-44\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-45\" name=\"__codelineno-47-45\" href=\"#__codelineno-47-45\"></a>\n<a id=\"__codelineno-47-46\" name=\"__codelineno-47-46\" href=\"#__codelineno-47-46\"></a><span class=\"c1\">// \u5220\u9664\u672b\u5c3e\u5143\u7d20</span>\n<a id=\"__codelineno-47-47\" name=\"__codelineno-47-47\" href=\"#__codelineno-47-47\"></a><span class=\"cp\">#define PP_TUPLE_POP_BACK(tuple) \\</span>\n<a id=\"__codelineno-47-48\" name=\"__codelineno-47-48\" href=\"#__codelineno-47-48\"></a><span class=\"cp\">    PP_TUPLE_ELEM( \\</span>\n<a id=\"__codelineno-47-49\" name=\"__codelineno-47-49\" href=\"#__codelineno-47-49\"></a><span class=\"cp\">        1, \\</span>\n<a id=\"__codelineno-47-50\" name=\"__codelineno-47-50\" href=\"#__codelineno-47-50\"></a><span class=\"cp\">        PP_AUTO_WHILE( \\</span>\n<a id=\"__codelineno-47-51\" name=\"__codelineno-47-51\" href=\"#__codelineno-47-51\"></a><span class=\"cp\">            PP_TUPLE_POP_BACK_PRED, \\</span>\n<a id=\"__codelineno-47-52\" name=\"__codelineno-47-52\" href=\"#__codelineno-47-52\"></a><span class=\"cp\">            PP_TUPLE_POP_BACK_OP, \\</span>\n<a id=\"__codelineno-47-53\" name=\"__codelineno-47-53\" href=\"#__codelineno-47-53\"></a><span class=\"cp\">            (0, (), tuple) \\</span>\n<a id=\"__codelineno-47-54\" name=\"__codelineno-47-54\" href=\"#__codelineno-47-54\"></a><span class=\"cp\">        ) \\</span>\n<a id=\"__codelineno-47-55\" name=\"__codelineno-47-55\" href=\"#__codelineno-47-55\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-56\" name=\"__codelineno-47-56\" href=\"#__codelineno-47-56\"></a><span class=\"cp\">#define PP_TUPLE_POP_BACK_PRED(args) PP_TUPLE_POP_BACK_PRED_IMPL args</span>\n<a id=\"__codelineno-47-57\" name=\"__codelineno-47-57\" href=\"#__codelineno-47-57\"></a><span class=\"cp\">#define PP_TUPLE_POP_BACK_PRED_IMPL(curi, ret, tuple) \\</span>\n<a id=\"__codelineno-47-58\" name=\"__codelineno-47-58\" href=\"#__codelineno-47-58\"></a><span class=\"cp\">    PP_IF( \\</span>\n<a id=\"__codelineno-47-59\" name=\"__codelineno-47-59\" href=\"#__codelineno-47-59\"></a><span class=\"cp\">        PP_TUPLE_SIZE(tuple), \\</span>\n<a id=\"__codelineno-47-60\" name=\"__codelineno-47-60\" href=\"#__codelineno-47-60\"></a><span class=\"cp\">        PP_NOT_EQUAL(PP_TUPLE_SIZE(ret), PP_DEC(PP_TUPLE_SIZE(tuple))), \\</span>\n<a id=\"__codelineno-47-61\" name=\"__codelineno-47-61\" href=\"#__codelineno-47-61\"></a><span class=\"cp\">        0 \\</span>\n<a id=\"__codelineno-47-62\" name=\"__codelineno-47-62\" href=\"#__codelineno-47-62\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-63\" name=\"__codelineno-47-63\" href=\"#__codelineno-47-63\"></a><span class=\"cp\">#define PP_TUPLE_POP_BACK_OP(args) PP_TUPLE_POP_BACK_OP_IMPL args</span>\n<a id=\"__codelineno-47-64\" name=\"__codelineno-47-64\" href=\"#__codelineno-47-64\"></a><span class=\"cp\">#define PP_TUPLE_POP_BACK_OP_IMPL(curi, ret, tuple) \\</span>\n<a id=\"__codelineno-47-65\" name=\"__codelineno-47-65\" href=\"#__codelineno-47-65\"></a><span class=\"cp\">    (PP_INC(curi), PP_TUPLE_PUSH_BACK(PP_TUPLE_ELEM(curi, tuple), ret), tuple)</span>\n<a id=\"__codelineno-47-66\" name=\"__codelineno-47-66\" href=\"#__codelineno-47-66\"></a>\n<a id=\"__codelineno-47-67\" name=\"__codelineno-47-67\" href=\"#__codelineno-47-67\"></a><span class=\"c1\">// \u5220\u9664\u5143\u7d20</span>\n<a id=\"__codelineno-47-68\" name=\"__codelineno-47-68\" href=\"#__codelineno-47-68\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE(i, tuple) \\</span>\n<a id=\"__codelineno-47-69\" name=\"__codelineno-47-69\" href=\"#__codelineno-47-69\"></a><span class=\"cp\">    PP_TUPLE_ELEM( \\</span>\n<a id=\"__codelineno-47-70\" name=\"__codelineno-47-70\" href=\"#__codelineno-47-70\"></a><span class=\"cp\">        2, \\</span>\n<a id=\"__codelineno-47-71\" name=\"__codelineno-47-71\" href=\"#__codelineno-47-71\"></a><span class=\"cp\">        PP_AUTO_WHILE( \\</span>\n<a id=\"__codelineno-47-72\" name=\"__codelineno-47-72\" href=\"#__codelineno-47-72\"></a><span class=\"cp\">            PP_TUPLE_REMOVE_PRED, \\</span>\n<a id=\"__codelineno-47-73\" name=\"__codelineno-47-73\" href=\"#__codelineno-47-73\"></a><span class=\"cp\">            PP_TUPLE_REMOVE_OP, \\</span>\n<a id=\"__codelineno-47-74\" name=\"__codelineno-47-74\" href=\"#__codelineno-47-74\"></a><span class=\"cp\">            (0, i, (), tuple) \\</span>\n<a id=\"__codelineno-47-75\" name=\"__codelineno-47-75\" href=\"#__codelineno-47-75\"></a><span class=\"cp\">        ) \\</span>\n<a id=\"__codelineno-47-76\" name=\"__codelineno-47-76\" href=\"#__codelineno-47-76\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-77\" name=\"__codelineno-47-77\" href=\"#__codelineno-47-77\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE_PRED(args) PP_TUPLE_REMOVE_PRED_IMPL args</span>\n<a id=\"__codelineno-47-78\" name=\"__codelineno-47-78\" href=\"#__codelineno-47-78\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE_PRED_IMPL(curi, i, ret, tuple) \\</span>\n<a id=\"__codelineno-47-79\" name=\"__codelineno-47-79\" href=\"#__codelineno-47-79\"></a><span class=\"cp\">    PP_IF( \\</span>\n<a id=\"__codelineno-47-80\" name=\"__codelineno-47-80\" href=\"#__codelineno-47-80\"></a><span class=\"cp\">        PP_TUPLE_SIZE(tuple), \\</span>\n<a id=\"__codelineno-47-81\" name=\"__codelineno-47-81\" href=\"#__codelineno-47-81\"></a><span class=\"cp\">        PP_NOT_EQUAL(PP_TUPLE_SIZE(ret), PP_DEC(PP_TUPLE_SIZE(tuple))), \\</span>\n<a id=\"__codelineno-47-82\" name=\"__codelineno-47-82\" href=\"#__codelineno-47-82\"></a><span class=\"cp\">        0 \\</span>\n<a id=\"__codelineno-47-83\" name=\"__codelineno-47-83\" href=\"#__codelineno-47-83\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-84\" name=\"__codelineno-47-84\" href=\"#__codelineno-47-84\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE_OP(args) PP_TUPLE_REMOVE_OP_IMPL args</span>\n<a id=\"__codelineno-47-85\" name=\"__codelineno-47-85\" href=\"#__codelineno-47-85\"></a><span class=\"cp\">#define PP_TUPLE_REMOVE_OP_IMPL(curi, i, ret, tuple) \\</span>\n<a id=\"__codelineno-47-86\" name=\"__codelineno-47-86\" href=\"#__codelineno-47-86\"></a><span class=\"cp\">    ( \\</span>\n<a id=\"__codelineno-47-87\" name=\"__codelineno-47-87\" href=\"#__codelineno-47-87\"></a><span class=\"cp\">    PP_INC(curi), \\</span>\n<a id=\"__codelineno-47-88\" name=\"__codelineno-47-88\" href=\"#__codelineno-47-88\"></a><span class=\"cp\">    i, \\</span>\n<a id=\"__codelineno-47-89\" name=\"__codelineno-47-89\" href=\"#__codelineno-47-89\"></a><span class=\"cp\">    PP_IF( \\</span>\n<a id=\"__codelineno-47-90\" name=\"__codelineno-47-90\" href=\"#__codelineno-47-90\"></a><span class=\"cp\">        PP_NOT_EQUAL(curi, i), \\</span>\n<a id=\"__codelineno-47-91\" name=\"__codelineno-47-91\" href=\"#__codelineno-47-91\"></a><span class=\"cp\">        PP_TUPLE_PUSH_BACK(PP_TUPLE_ELEM(curi, tuple), ret), \\</span>\n<a id=\"__codelineno-47-92\" name=\"__codelineno-47-92\" href=\"#__codelineno-47-92\"></a><span class=\"cp\">        ret \\</span>\n<a id=\"__codelineno-47-93\" name=\"__codelineno-47-93\" href=\"#__codelineno-47-93\"></a><span class=\"cp\">    ), \\</span>\n<a id=\"__codelineno-47-94\" name=\"__codelineno-47-94\" href=\"#__codelineno-47-94\"></a><span class=\"cp\">    tuple \\</span>\n<a id=\"__codelineno-47-95\" name=\"__codelineno-47-95\" href=\"#__codelineno-47-95\"></a><span class=\"cp\">    )</span>\n<a id=\"__codelineno-47-96\" name=\"__codelineno-47-96\" href=\"#__codelineno-47-96\"></a>\n<a id=\"__codelineno-47-97\" name=\"__codelineno-47-97\" href=\"#__codelineno-47-97\"></a><span class=\"n\">PP_TUPLE_SIZE</span><span class=\"p\">(())</span><span class=\"w\">               </span><span class=\"c1\">// -&gt; 0</span>\n<a id=\"__codelineno-47-98\" name=\"__codelineno-47-98\" href=\"#__codelineno-47-98\"></a>\n<a id=\"__codelineno-47-99\" name=\"__codelineno-47-99\" href=\"#__codelineno-47-99\"></a><span class=\"n\">PP_TUPLE_PUSH_BACK</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\">      </span><span class=\"c1\">// -&gt; (1, 2)</span>\n<a id=\"__codelineno-47-100\" name=\"__codelineno-47-100\" href=\"#__codelineno-47-100\"></a><span class=\"n\">PP_TUPLE_PUSH_BACK</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">())</span><span class=\"w\">       </span><span class=\"c1\">// -&gt; (2)</span>\n<a id=\"__codelineno-47-101\" name=\"__codelineno-47-101\" href=\"#__codelineno-47-101\"></a>\n<a id=\"__codelineno-47-102\" name=\"__codelineno-47-102\" href=\"#__codelineno-47-102\"></a><span class=\"n\">PP_TUPLE_INSERT</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; (1, 2, 3)</span>\n<a id=\"__codelineno-47-103\" name=\"__codelineno-47-103\" href=\"#__codelineno-47-103\"></a>\n<a id=\"__codelineno-47-104\" name=\"__codelineno-47-104\" href=\"#__codelineno-47-104\"></a><span class=\"n\">PP_TUPLE_POP_BACK</span><span class=\"p\">(())</span><span class=\"w\">           </span><span class=\"c1\">// -&gt; ()</span>\n<a id=\"__codelineno-47-105\" name=\"__codelineno-47-105\" href=\"#__codelineno-47-105\"></a><span class=\"n\">PP_TUPLE_POP_BACK</span><span class=\"p\">((</span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\">          </span><span class=\"c1\">// -&gt; ()</span>\n<a id=\"__codelineno-47-106\" name=\"__codelineno-47-106\" href=\"#__codelineno-47-106\"></a><span class=\"n\">PP_TUPLE_POP_BACK</span><span class=\"p\">((</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span><span class=\"w\">    </span><span class=\"c1\">// -&gt; (1, 2)</span>\n<a id=\"__codelineno-47-107\" name=\"__codelineno-47-107\" href=\"#__codelineno-47-107\"></a>\n<a id=\"__codelineno-47-108\" name=\"__codelineno-47-108\" href=\"#__codelineno-47-108\"></a><span class=\"n\">PP_TUPLE_REMOVE</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; (1, 3)</span>\n<a id=\"__codelineno-47-109\" name=\"__codelineno-47-109\" href=\"#__codelineno-47-109\"></a><span class=\"n\">PP_TUPLE_REMOVE</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span><span class=\"w\">   </span><span class=\"c1\">// -&gt; (2, 3)</span>\n</code></pre></div>\n<p>\u8fd9\u91cc\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u63d2\u5165\u5143\u7d20\u7684\u5b9e\u73b0\uff0c\u5176\u4ed6\u5220\u9664\u5143\u7d20\u7b49\u64cd\u4f5c\u4e5f\u662f\u901a\u8fc7\u7c7b\u4f3c\u7684\u539f\u7406\u6765\u5b9e\u73b0\u7684\u3002<code>PP_TUPLE_INSERT(i, elem, tuple)</code> \u53ef\u4ee5\u5728 <code>tuple</code> \u7684\u4f4d\u7f6e <code>i</code> \u63d2\u5165\u5143\u7d20 <code>elem</code>\uff0c\u4e3a\u4e86\u5b8c\u6210\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u5148\u628a\u4f4d\u7f6e\u5c0f\u4e8e <code>i</code> \u7684\u5143\u7d20\u90fd\u5148\u7528 <code>PP_TUPLE_PUSH_BACK</code> \u653e\u5230\u4e00\u4e2a\u65b0\u7684 <code>tuple</code> \u4e0a\uff08<code>ret</code>\uff09\uff0c\u7136\u540e\u5728\u4f4d\u7f6e <code>i</code> \u653e\u5165\u5143\u7d20 <code>elem</code>\uff0c\u4e4b\u540e\u518d\u628a\u539f <code>tuple</code> \u4f4d\u7f6e\u5927\u4e8e\u7b49\u4e8e <code>i</code> \u7684\u5143\u7d20\u653e\u5230 <code>ret</code> \u540e\u9762\uff0c\u6700\u540e <code>ret</code> \u5c31\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\u3002</p>\n<h2 id=\"_29\">\u5c0f\u7ed3</h2>\n<p>\u672c\u6587\u7684\u76ee\u7684\u662f\u60f3\u8981\u9610\u8ff0\u6e05\u695a C/C++ \u5b8f\u7f16\u7a0b\u7684\u539f\u7406\u548c\u57fa\u672c\u5b9e\u73b0\uff0c\u5728\u8bb0\u5f55\u6211\u672c\u4eba\u7684\u4e00\u4e9b\u7406\u89e3\u548c\u8ba4\u8bc6\u7684\u540c\u65f6\uff0c\u5e0c\u671b\u80fd\u591f\u5bf9\u5176\u4ed6\u4eba\u80fd\u5e26\u6765\u4e00\u4e9b\u89e3\u60d1\u548c\u542f\u53d1\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c3d\u7ba1\u672c\u6587\u7bc7\u5e45\u6709\u70b9\u957f\uff0c\u4f46\u8fd8\u662f\u6709\u4e00\u4e9b\u5173\u4e8e\u5b8f\u7f16\u7a0b\u7684\u6280\u5de7\u548c\u7528\u6cd5\u662f\u6ca1\u6709\u6d89\u53ca\u5230\u7684\uff0c\u8b6c\u5982 CHAOS_PP \u63d0\u51fa\u7684<a href=\"https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms#deferred-expression\">\u57fa\u4e8e\u5ef6\u8fdf\u5c55\u5f00\u7684\u9012\u5f52\u8c03\u7528\u65b9\u6cd5</a>\uff0cBOOST_PP \u91cc\u9762\u7684 <code>REPEAT</code> \u76f8\u5173\u5b8f\u7b49\u7b49\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\u8d44\u6599\u3002</p>\n<p>\u5b8f\u7f16\u7a0b\u7684\u8c03\u8bd5\u662f\u4e00\u4e2a\u75db\u82e6\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\uff1a</p>\n<ul>\n<li>\u7528 <code>-P -E</code> \u9009\u9879\u8f93\u51fa\u9884\u5904\u7406\u7ed3\u679c\uff1b</li>\n<li>\u7528\u524d\u9762\u63d0\u5230\u7684\u6211\u81ea\u5df1\u4fee\u6539\u7684 <code>clang</code> \u7248\u672c\u4ed4\u7ec6\u7814\u7a76\u5c55\u5f00\u8fc7\u7a0b\uff1b</li>\n<li>\u628a\u590d\u6742\u7684\u5b8f\u62c6\u89e3\uff0c\u67e5\u770b\u4e2d\u95f4\u5b8f\u7684\u5c55\u5f00\u7ed3\u679c\uff1b</li>\n<li>\u5c4f\u853d\u65e0\u5173\u7684\u5934\u6587\u4ef6\u548c\u5b8f\uff1b</li>\n<li>\u6700\u540e\u5c31\u662f\u8981\u8111\u8865\u5b8f\u5c55\u5f00\u7684\u8fc7\u7a0b\u4e86\uff0c\u719f\u6089\u5b8f\u5c55\u5f00\u4e4b\u540e\u8c03\u8bd5\u7684\u6548\u7387\u4e5f\u4f1a\u63d0\u5347\u3002</li>\n</ul>\n<p>\u672c\u6587\u4e2d\u7684\u5b8f\u662f\u6211\u81ea\u5df1\u5728\u7406\u89e3\u4e86\u539f\u7406\u4e4b\u540e\u91cd\u65b0\u5b9e\u73b0\u51fa\u6765\u7684\uff0c\u6709\u90e8\u5206\u5b8f\u501f\u9274\u4e86 <code>Boost</code> \u7684\u5b9e\u73b0\u548c\u5f15\u7528\u91cc\u9762\u7684\u6587\u7ae0\uff0c\u6709\u4efb\u4f55\u9519\u8bef\u4e4b\u5904\uff0c\u6b22\u8fce\u968f\u65f6\u6307\u6b63\uff0c\u4e5f\u6b22\u8fce\u627e\u6211\u6765\u8ba8\u8bba\u76f8\u5173\u7684\u95ee\u9898\u3002</p>\n<p>\u672c\u6587\u7684\u4ee3\u7801\u5168\u90e8\u90fd\u5728\u8fd9\u91cc\uff1a<a href=\"../assets/img/2021-3-31-cpp-preprocess/macros.cpp\">\u4e0b\u8f7d</a>\uff0c<a href=\"https://godbolt.org/z/coWvc5Pse\">\u5728\u7ebf\u6f14\u793a</a>\u3002</p>\n<h2 id=\"_30\">\u5f15\u7528</h2>\n<ul>\n<li><a href=\"https://www.boost.org/doc/libs/1_75_0/libs/preprocessor/doc/\">Boost.Preprocessor</a></li>\n<li><a href=\"https://bot-man-jl.github.io/articles/?post=2020/Macro-Programming-Art\">C/C++ \u5b8f\u7f16\u7a0b\u7684\u827a\u672f</a></li>\n</ul>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/cpp-C%E5%92%8CCpp%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93/",
            "url": "https://wiki.disenone.site/cpp-C%E5%92%8CCpp%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "C/C++ \u7684\u547d\u4ee4\u884c\u53c2\u6570\u5904\u7406\u603b\u7ed3",
            "content_html": "<p><meta property=\"og:title\" content=\"C/C++ \u7684\u547d\u4ee4\u884c\u53c2\u6570\u5904\u7406\u603b\u7ed3\" /></p>\n<p><img alt=\"\" src=\"https://img.shields.io/badge/vs-2015-68217A.svg\" style=\"display: inline-block\" />\n<img alt=\"\" src=\"https://img.shields.io/badge/gcc-4.9-blue.svg\" style=\"display: inline-block\" />\n<img alt=\"\" src=\"https://img.shields.io/badge/clang-3.7-birghtgreen.svg\" style=\"display: inline-block\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2016-11-19-aparsing/aparsing.png\" /></p>\n<p>\u524d\u4e00\u9635\u5b50\u7ffb Linux \u5185\u6838\u4ee3\u7801\u7684\u65f6\u5019\u770b\u5230\u4e86\u5185\u6838\u5bf9\u6a21\u5757\u53c2\u6570 (moduleparam) \u7684\u5904\u7406\uff0c\u89c9\u5f97\u633a\u7cbe\u5999\uff0c\u8ba9\u6211\u4e0d\u7981\u60f3\u7814\u7a76\u4e0b C \u4e0b\u7684\u547d\u4ee4\u884c\u53c2\u6570\u8981\u600e\u6837\u66f4\u597d\u5730\u5904\u7406\u3002\u672c\u6587\u6240\u7528\u4ee3\u7801\u90fd\u5728\u8fd9\u91cc <a href=\"https://github.com/disenone/aparsing\">aparsing</a> \u3002\u4ee3\u7801\u652f\u6301\u5728 Windows \u3001 Linux \u3001 Mac OS X \u4e0b\u7f16\u8bd1\u8fd0\u884c\uff0c\u8be6\u7ec6\u7684\u7f16\u8bd1\u6307\u5357\u5728 README.md \u91cc\u9762\u3002 </p>\n<h2 id=\"getenv\">getenv</h2>\n<p>\u6807\u51c6\u5e93\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u51fd\u6570 <code>getenv</code> \uff0c\u6309\u7167\u5b57\u9762\u610f\u601d\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u7528\u6765\u83b7\u53d6\u73af\u5883\u53d8\u91cf\u7684\uff0c\u90a3\u4e48\u53ea\u8981\u6211\u4eec\u9884\u5148\u8bbe\u7f6e\u597d\u9700\u8981\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5728\u7a0b\u5e8f\u91cc\u9762\u62ff\u51fa\u6765\uff0c\u5c31\u95f4\u63a5\u5730\u628a\u53c2\u6570\u4f20\u5230\u7a0b\u5e8f\u91cc\u9762\u5566\u3002\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u6bb5<a href=\"https://github.com/disenone/aparsing/blob/master/getenv/getenv_test.c\">\u4ee3\u7801</a>\uff1a</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-0-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-22\">22</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdlib.h&gt;</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdio.h&gt;</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\"></a>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\"></a><span class=\"c1\">//char *getenv( const char *name );</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\"></a><span class=\"c1\">//GETENV_ADD=abc GETENV_NUM=2 ./getenv_test </span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\"></a>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">add</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">num</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"p\">((</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">getenv</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_ADD&quot;</span><span class=\"p\">)))</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_ADD = %s</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_ADD not found</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\"></a>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"p\">((</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">getenv</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_NUM&quot;</span><span class=\"p\">)))</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">numi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">atoi</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_NUM = %d</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">numi</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;GETENV_NUM not found</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\"></a><span class=\"p\">}</span>\n</code></pre></div></td></tr></table></div>\n<p><code>getenv</code> \u51fd\u6570\u58f0\u660e\u5982\u7b2c <a href=\"#__codelineno-0-5\">4</a> \u884c\uff0c\u4f20\u5165\u60f3\u8981\u83b7\u53d6\u7684\u53d8\u91cf\u540d\u5b57\uff0c\u8fd4\u56de\u8be5\u53d8\u91cf\u7684\u503c\uff0c\u5982\u679c\u627e\u4e0d\u5230\u53d8\u91cf\uff0c\u5219\u8fd4\u56de0\u3002<a href=\"#__codelineno-0-10\">10</a> \u548c <a href=\"#__codelineno-0-15\">15</a> \u884c\u5c31\u662f\u5206\u522b\u83b7\u53d6\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u7684\u503c\uff0c\u5982\u679c\u53d8\u91cf\u6709\u6548\u5219\u6253\u5370\u53d8\u91cf\u503c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f <code>getenv</code> \u8fd4\u56de\u7684\u90fd\u662f\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u4f7f\u7528\u8005\u624b\u52a8\u8f6c\u6362\u6570\u503c\u7c7b\u578b\u7684\uff0c\u6240\u4ee5\u4f7f\u7528\u8d77\u6765\u4e0d\u591f\u65b9\u4fbf\u3002\u7f16\u8bd1\u8fd0\u884c:</p>\n<p>Windows \u4e0b\uff1a</p>\n<div class=\"language-bat highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">set</span> <span class=\"nv\">GETENV_ADD</span><span class=\"p\">=</span>abc <span class=\"p\">&amp;</span> <span class=\"k\">set</span> <span class=\"nv\">GETENV_NUM</span><span class=\"p\">=</span>1 <span class=\"p\">&amp;</span> .\\getenv_test.exe\n</code></pre></div>\n<p>Linux \u4e0b\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"nv\">GETENV_ADD</span><span class=\"o\">=</span>abc<span class=\"w\"> </span><span class=\"nv\">GETENV_NUM</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"w\"> </span>./getenv_test<span class=\"w\"> </span>\n</code></pre></div>\n<p>\u8f93\u51fa\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>GETENV_ADD = abc\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>GETENV_NUM = 2\n</code></pre></div>\n<h2 id=\"getopt\">getopt</h2>\n<p>Linux \u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u7ec4\u51fd\u6570 <code>getopt, getopt_long, getopt_long_only</code> \u6765\u5904\u7406\u547d\u4ee4\u884c\u4f20\u9012\u8fdb\u6765\u7684\u51fd\u6570\uff0c\u8fd9\u4e09\u4e2a\u51fd\u6570\u7684\u58f0\u660e\u5206\u522b\u662f\uff1a</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-4-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-4-13\">13</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\"></a><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">optarg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\"></a><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">optind</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">opterr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">optopt</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\"></a>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">getopt</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">[],</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\"></a><span class=\"w\">                  </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">optstring</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\"></a>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">getopt_long</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">[],</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\"></a><span class=\"w\">            </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">optstring</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\"></a><span class=\"w\">            </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">option</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">longopts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">longindex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\"></a>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">getopt_long_only</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">[],</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\"></a><span class=\"w\">            </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">optstring</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\"></a><span class=\"w\">            </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">option</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">longopts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">longindex</span><span class=\"p\">);</span>\n</code></pre></div></td></tr></table></div>\n<p><code>getopt</code> \u53ea\u80fd\u5904\u7406\u77ed\u53c2\u6570\uff08\u5373\u5355\u5b57\u7b26\u53c2\u6570\uff09\uff0c<code>getopt_long, getopt_long_only</code> \u5219\u53ef\u4ee5\u5904\u7406\u957f\u53c2\u6570\u3002\u8be6\u7ec6\u7684\u51fd\u6570\u89e3\u91ca\u53ef\u4ee5\u53bb\u7ffb Linux \u4e0b\u7684\u624b\u518c\uff0c\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u4f8b\u5b50\u6765\u8bf4\u660e <code>getopt</code> \u548c <code>getopt_long</code> \u7684\u7528\u6cd5\u3002</p>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c Windows \u4e0b\u662f\u6ca1\u6709\u63d0\u4f9b\u8fd9\u4e00\u7ec4\u51fd\u6570\u7684\uff0c\u6240\u4ee5\u6211\u627e\u4e86\u4e00\u4efd\u53ef\u4ee5\u5728 Windows \u4e0b\u7f16\u8bd1\u7684\u6e90\u7801\uff0c\u505a\u4e86\u5c0f\u5c0f\u7684\u6539\u52a8\uff0c\u4ee3\u7801\u90fd\u5728<a href=\"https://github.com/disenone/aparsing/tree/master/getopt\">\u8fd9\u91cc</a>\u3002</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-5-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-48\">48</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-49\">49</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-50\">50</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-51\">51</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-52\">52</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-53\">53</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-54\">54</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-55\">55</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-56\">56</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-57\">57</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-58\">58</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-59\">59</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-60\">60</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-61\">61</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-62\">62</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-63\">63</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-64\">64</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-65\">65</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-66\">66</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-67\">67</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-68\">68</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-69\">69</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-70\">70</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-71\">71</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-72\">72</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-73\">73</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-74\">74</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-75\">75</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-76\">76</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-77\">77</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-78\">78</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-79\">79</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-80\">80</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-81\">81</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-82\">82</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-83\">83</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-84\">84</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-85\">85</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-86\">86</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-87\">87</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-88\">88</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-89\">89</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-90\">90</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-91\">91</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-92\">92</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-93\">93</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-94\">94</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-95\">95</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-96\">96</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-97\">97</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\"></a><span class=\"c1\">// test getopt</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\"></a>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;getopt.h&gt;</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdio.h&gt;</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;string.h&gt;</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\"></a>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">option</span><span class=\"w\"> </span><span class=\"n\">long_options</span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;add&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">required_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"sc\">&#39;a&#39;</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;append&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">no_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;delete&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">required_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;verbose&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">optional_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;create&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">no_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;file&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">required_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"s\">&quot;help&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">no_argument</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">},</span>\n<a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\"></a><span class=\"w\">    </span><span class=\"p\">{</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\"></a><span class=\"p\">};</span>\n<a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\"></a>\n<a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"n\">simple_options</span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;a:bc::d:0123456789&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\"></a>\n<a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\"></a>\n<a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">digit_optind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\"></a>\n<a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">this_option_optind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">optind</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"n\">optind</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">longindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\"></a>\n<a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\"></a><span class=\"w\">        </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">getopt_long</span><span class=\"p\">(</span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">simple_options</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">long_options</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">longindex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\"></a><span class=\"w\">        </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\"></a>\n<a id=\"__codelineno-5-36\" name=\"__codelineno-5-36\"></a><span class=\"w\">        </span><span class=\"k\">switch</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-37\" name=\"__codelineno-5-37\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-38\" name=\"__codelineno-5-38\"></a><span class=\"w\">            </span><span class=\"c1\">// long option</span>\n<a id=\"__codelineno-5-39\" name=\"__codelineno-5-39\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-40\" name=\"__codelineno-5-40\"></a><span class=\"w\">                   </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option %s&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">long_options</span><span class=\"p\">[</span><span class=\"n\">longindex</span><span class=\"p\">].</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-41\" name=\"__codelineno-5-41\"></a><span class=\"w\">                   </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">optarg</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-42\" name=\"__codelineno-5-42\"></a><span class=\"w\">                       </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot; with arg %s&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">optarg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-43\" name=\"__codelineno-5-43\"></a><span class=\"w\">                   </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-44\" name=\"__codelineno-5-44\"></a><span class=\"w\">                   </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-45\" name=\"__codelineno-5-45\"></a>\n<a id=\"__codelineno-5-46\" name=\"__codelineno-5-46\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-47\" name=\"__codelineno-5-47\"></a>\n<a id=\"__codelineno-5-48\" name=\"__codelineno-5-48\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;0&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-49\" name=\"__codelineno-5-49\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;1&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-50\" name=\"__codelineno-5-50\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;2&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-51\" name=\"__codelineno-5-51\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;3&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-52\" name=\"__codelineno-5-52\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;4&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-53\" name=\"__codelineno-5-53\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;5&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-54\" name=\"__codelineno-5-54\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;6&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-55\" name=\"__codelineno-5-55\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;7&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-56\" name=\"__codelineno-5-56\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;8&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-57\" name=\"__codelineno-5-57\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;9&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-58\" name=\"__codelineno-5-58\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">digit_optind</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">digit_optind</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">this_option_optind</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-59\" name=\"__codelineno-5-59\"></a><span class=\"w\">                    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;digits occur in two different argv-elements.</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-60\" name=\"__codelineno-5-60\"></a>\n<a id=\"__codelineno-5-61\" name=\"__codelineno-5-61\"></a><span class=\"w\">                </span><span class=\"n\">digit_optind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">this_option_optind</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-62\" name=\"__codelineno-5-62\"></a><span class=\"w\">                </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option %c</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-63\" name=\"__codelineno-5-63\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-64\" name=\"__codelineno-5-64\"></a>\n<a id=\"__codelineno-5-65\" name=\"__codelineno-5-65\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;a&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-66\" name=\"__codelineno-5-66\"></a><span class=\"w\">                </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option a with value &#39;%s&#39;</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">optarg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-67\" name=\"__codelineno-5-67\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-68\" name=\"__codelineno-5-68\"></a>\n<a id=\"__codelineno-5-69\" name=\"__codelineno-5-69\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;b&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-70\" name=\"__codelineno-5-70\"></a><span class=\"w\">                </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option b</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-71\" name=\"__codelineno-5-71\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-72\" name=\"__codelineno-5-72\"></a>\n<a id=\"__codelineno-5-73\" name=\"__codelineno-5-73\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;c&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-74\" name=\"__codelineno-5-74\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">optarg</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-75\" name=\"__codelineno-5-75\"></a><span class=\"w\">                    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option c with value &#39;%s&#39;</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">optarg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-76\" name=\"__codelineno-5-76\"></a><span class=\"w\">                </span><span class=\"k\">else</span>\n<a id=\"__codelineno-5-77\" name=\"__codelineno-5-77\"></a><span class=\"w\">                    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;option c</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-78\" name=\"__codelineno-5-78\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-79\" name=\"__codelineno-5-79\"></a>\n<a id=\"__codelineno-5-80\" name=\"__codelineno-5-80\"></a><span class=\"w\">            </span><span class=\"k\">case</span><span class=\"w\"> </span><span class=\"sc\">&#39;?&#39;</span><span class=\"p\">:</span>\n<a id=\"__codelineno-5-81\" name=\"__codelineno-5-81\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-82\" name=\"__codelineno-5-82\"></a>\n<a id=\"__codelineno-5-83\" name=\"__codelineno-5-83\"></a><span class=\"w\">            </span><span class=\"k\">default</span><span class=\"o\">:</span>\n<a id=\"__codelineno-5-84\" name=\"__codelineno-5-84\"></a><span class=\"w\">                </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;?? getopt returned character code 0%o ??</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-85\" name=\"__codelineno-5-85\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"c1\">// switch</span>\n<a id=\"__codelineno-5-86\" name=\"__codelineno-5-86\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"c1\">// while</span>\n<a id=\"__codelineno-5-87\" name=\"__codelineno-5-87\"></a>\n<a id=\"__codelineno-5-88\" name=\"__codelineno-5-88\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">optind</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-89\" name=\"__codelineno-5-89\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-90\" name=\"__codelineno-5-90\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;non-option ARGV-elements: &quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-91\" name=\"__codelineno-5-91\"></a><span class=\"w\">        </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">optind</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-92\" name=\"__codelineno-5-92\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;%s &quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"n\">optind</span><span class=\"o\">++</span><span class=\"p\">]);</span>\n<a id=\"__codelineno-5-93\" name=\"__codelineno-5-93\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-94\" name=\"__codelineno-5-94\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-95\" name=\"__codelineno-5-95\"></a>\n<a id=\"__codelineno-5-96\" name=\"__codelineno-5-96\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-97\" name=\"__codelineno-5-97\"></a><span class=\"p\">}</span>\n</code></pre></div></td></tr></table></div>\n<p>\u6211\u4eec\u6765\u7740\u91cd\u5206\u6790 <code>getopt_long</code> \u7684\u7528\u6cd5\uff0c<code>getopt_long</code> \u7684\u524d\u4e09\u4e2a\u53c2\u6570\u8ddf <code>getopt</code> \u662f\u4e00\u6837\u7684\uff0c\u5206\u522b\u662f\uff1a\u547d\u4ee4\u884c\u53c2\u6570\u4e2a\u6570 <code>argc</code> \uff0c\u547d\u4ee4\u884c\u53c2\u6570\u6570\u7ec4 <code>argv</code>\uff0c\u77ed\u53c2\u6570\u5177\u4f53\u5f62\u5f0f <code>optstring</code>\u3002<code>otpstring</code> \u7684\u683c\u5f0f\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u77ed\u53c2\u6570\u5b57\u7b26\uff0c\u540e\u9762\u52a0\u5192\u53f7 <code>:</code> \u8868\u793a\u5e26\u53c2\u6570\uff0c\u4e24\u4e2a\u5192\u53f7 <code>::</code> \u8868\u793a\u53ef\u9009\u53c2\u6570\uff0c\u8b6c\u5982\u7b2c 19 \u884c\uff0c\u5c31\u662f\u58f0\u660e\u77ed\u53c2\u6570\u7684\u5f62\u5f0f\uff0c<code>b</code> \u53c2\u6570\u4e0d\u5e26\u989d\u5916\u53c2\u6570\uff0c <code>a</code> \u53c2\u6570\u5e26\u989d\u5916\u53c2\u6570\uff0c<code>c</code> \u5e26\u53ef\u9009\u53c2\u6570\u3002</p>\n<p><code>getopt_long</code> \u540e\u4e24\u4e2a\u53c2\u6570\u662f\u7528\u6765\u5904\u7406\u957f\u53c2\u6570\u7684\uff0c\u5176\u4e2d <code>option</code> \u7684\u7ed3\u6784\u662f\uff1a</p>\n<p><div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">option</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">name</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// \u957f\u53c2\u6570\u540d\u5b57</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\">         </span><span class=\"n\">has_arg</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// \u662f\u5426\u5e26\u989d\u5916\u53c2\u6570</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\">        </span><span class=\"o\">*</span><span class=\"n\">flag</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// \u8bbe\u7f6e\u5982\u4f55\u8fd4\u56de\u51fd\u6570\u8c03\u7528\u7ed3\u679c</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\">         </span><span class=\"n\">val</span><span class=\"p\">;</span><span class=\"w\">        </span><span class=\"c1\">// \u8fd4\u56de\u7684\u6570\u503c</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"p\">};</span>\n</code></pre></div>\n\u867d\u7136\u8bf4\u662f\u957f\u53c2\u6570\uff0c\u4f46 <code>name</code> \u8fd8\u662f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5355\u5b57\u7b26\u957f\u5ea6\u7684\u3002</p>\n<p><code>has_arg</code> \u53ef\u4ee5\u8bbe\u7f6e\u4e3a <code>no_argument, required_argument, optional_argument</code>\uff0c\u5206\u522b\u8868\u793a\u4e0d\u5e26\u53c2\u6570\uff0c\u5e26\u53c2\u6570\uff0c\u5e26\u53ef\u9009\u53c2\u6570\u3002</p>\n<p><code>flag</code> \u548c <code>val</code> \u662f\u914d\u5408\u4f7f\u7528\u7684\uff0c\u5982\u679c <code>flag = NULL</code>\uff0c<code>getopt_long</code> \u4f1a\u76f4\u63a5\u8fd4\u56de <code>val</code> \uff0c\u5426\u5219\u5982\u679c <code>flag</code> \u4e3a\u6709\u6548\u6307\u9488\uff0c<code>getopt_long</code> \u4f1a\u6267\u884c\u7c7b\u4f3c <code>*flag = val</code> \u7684\u64cd\u4f5c\uff0c\u628a <code>flag</code> \u6307\u5411\u7684\u53d8\u91cf\u8bbe\u7f6e\u4e3a <code>val</code> \u7684\u6570\u503c\u3002</p>\n<p>\u5982\u679c <code>getopt_long</code> \u627e\u5230\u5339\u914d\u7684\u77ed\u53c2\u6570\uff0c\u4f1a\u8fd4\u56de\u8be5\u77ed\u53c2\u6570\u7684\u5b57\u7b26\u503c\uff0c\u5982\u679c\u627e\u5230\u5339\u914d\u7684\u957f\u53c2\u6570\uff0c\u4f1a\u8fd4\u56de <code>val</code>\uff08 <code>flag = NULL</code> \uff09\u6216\u8005\u8fd4\u56de <code>0</code> \uff08 <code>flag != NULL; *flag = val;</code> \uff09\uff1b\u5982\u679c\u9047\u5230\u975e\u53c2\u6570\u7684\u5b57\u7b26\uff0c\u4f1a\u8fd4\u56de <code>?</code>\uff1b\u5982\u679c\u6240\u6709\u53c2\u6570\u90fd\u5904\u7406\u5b8c\u6bd5\uff0c\u5219\u8fd4\u56de <code>-1</code> \u3002</p>\n<p>\u5229\u7528\u8fd4\u56de\u503c\u7684\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u51fa\u7528\u957f\u53c2\u8ddf\u77ed\u53c2\u542b\u4e49\u76f8\u540c\u7684\u6548\u679c\uff0c\u8b6c\u5982 <code>long_options</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>add</code>\uff0c\u5176 <code>val</code> \u503c\u8bbe\u7f6e\u4e3a\u77ed\u53c2\u6570\u7684\u5b57\u7b26 <code>'a'</code>\uff0c\u90a3\u4e48\u5224\u65ad\u8fd4\u56de\u65f6\uff0c<code>--add</code> \u548c <code>-a</code> \u4f1a\u8fdb\u5165\u76f8\u540c\u7684\u5904\u7406\u5206\u652f\uff0c\u88ab\u5f53\u4f5c\u76f8\u540c\u7684\u542b\u4e49\u6765\u5904\u7406\u4e86\u3002</p>\n<p>\u62fc\u56fe\u7684\u6700\u540e\u4e00\u5757\u5c31\u662f <code>optind</code> \u548c <code>optarg</code> \u7684\u7528\u6cd5\uff0c<code>optind</code> \u662f\u4e0b\u4e00\u4e2a\u5f85\u5904\u7406\u53c2\u6570\u5728 <code>argv</code> \u4e2d\u7684\u4f4d\u7f6e\uff0c <code>optarg</code> \u5219\u6307\u5411\u989d\u5916\u53c2\u6570\u5b57\u7b26\u4e32\u3002</p>\n<p>\u7f16\u8bd1\u8fd0\u884c\u4ee3\u7801\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>$ .\\getopt_test -a 1 -b -c4 --add 2 --verbose --verbose=3 -123 -e --e\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>option a with value &#39;1&#39;\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a>option b\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>option c with value &#39;4&#39;\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>option a with value &#39;2&#39;\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a>option verbose\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a>option verbose with arg 3\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a>option 1\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a>option 2\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a>option 3\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a>.\\getopt_test: invalid option -- e\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a>.\\getopt_test: unrecognized option `--e&#39;\n</code></pre></div>\n<p><code>-a</code> \u548c <code>--add</code> \u7684\u542b\u4e49\u76f8\u540c\uff0c\u77ed\u53c2\u6570\u7684\u53ef\u9009\u53c2\u6570\u76f4\u63a5\u8ddf\u5728\u540e\u9762\uff0c\u8b6c\u5982 <code>-c4</code>\uff0c\u800c\u957f\u53c2\u6570\u7684\u53ef\u9009\u53c2\u6570\u9700\u8981\u6709\u7b49\u53f7\uff0c\u8b6c\u5982 <code>--verbose=3</code>\u3002</p>\n<h2 id=\"mobuleparam\">mobuleparam</h2>\n<p>ok\uff0c\u7ec8\u4e8e\u6765\u5230\u6700\u521d\u5f15\u53d1\u8fd9\u7bc7\u6587\u7ae0\u7684\u65b9\u6cd5\uff0cLinux \u5185\u6838\u7528\u4e86\u4e00\u79cd\u5f88\u53d6\u5de7\u7684\u65b9\u6cd5\u6765\u7ed9\u5185\u6838\u6a21\u5757\u4f20\u9012\u53c2\u6570\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f <code>moduleparam</code> \u3002\u6211\u5728\u8fd9\u91cc\u5148\u7b80\u5355\u89e3\u91ca Linux \u5185\u6838\u7684 <code>moduleparam</code> \u7684\u505a\u6cd5\uff0c\u66f4\u8be6\u7ec6\u7684\u89e3\u91ca\u53ef\u4ee5\u53bb\u770b\u4ee3\u7801\u3002\u867d\u7136\u6211\u501f\u9274\u4e86\u4e00\u4e9b <code>moduleparam</code> \u7684\u5904\u7406\u65b9\u6cd5\uff0c\u4f46\u548c Linux \u5185\u6838\u7684 <code>moduleparam</code> \u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u4e3a\u4e86\u533a\u5206\uff0c\u6211\u4f1a\u628a\u6211\u7684\u65b9\u6cd5\u53eb\u505a <code>small moduleparam</code> \uff0c Linux \u5185\u6838\u7684\u4f9d\u7136\u53eb\u505a <code>moduleparam</code> \u3002</p>\n<p>\u5148\u6765\u770b\u770b <code>moduleparam</code> \u7684\u7528\u6cd5\uff0c\u5728\u6a21\u5757\u91cc\u9762\u58f0\u660e\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">enable_debug</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"n\">module_param</span><span class=\"p\">(</span><span class=\"n\">enable_debug</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u7136\u540e\u52a0\u8f7d\u6a21\u5757\u65f6\u8f93\u5165\u53c2\u6570\uff1a</p>\n<div class=\"language-shell highlight\"><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a>$<span class=\"w\"> </span>insmod<span class=\"w\"> </span>mod<span class=\"w\"> </span><span class=\"nv\">enable_debug</span><span class=\"o\">=</span><span class=\"m\">1</span>\n</code></pre></div>\n<p>\u53d8\u91cf <code>enable_debug</code> \u5c31\u88ab\u6b63\u786e\u5730\u8bbe\u7f6e\u4e3a <code>1</code>\uff0c\u4f7f\u7528\u8d77\u6765\u5f88\u65b9\u4fbf\uff0c\u9700\u8981\u589e\u52a0\u7684\u4ee3\u7801\u4e5f\u5f88\u5c11\uff0c\u4ee3\u7801\u53ef\u4ee5\u5199\u5f97\u5f88\u7b80\u77ed\u4f18\u96c5\uff0c\u4e0d\u7528\u50cf <code>getenv</code> \u548c <code>getopt</code> \u90a3\u6837\u5199\u5f88\u591a\u5faa\u73af\u5224\u65ad\uff0c\u800c\u4e14\u8fd8\u81ea\u5e26\u7c7b\u578b\u8f6c\u6362\uff0c\u6240\u4ee5\u6211\u770b\u5230\u5c31\u60f3\uff0c\u8981\u662f\u80fd\u628a\u8fd9\u4e2a\u65b9\u6cd5\u62ff\u6765\u5904\u7406\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u90a3\u5c31\u66f4\u597d\u4e86\u3002</p>\n<p>\u63a5\u7740\u6765\u770b\u770b <code>moduleparam</code> \u7684\u6838\u5fc3\u5b9e\u73b0\uff1a</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-10-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-37\">37</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">kernel_param</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\"></a><span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">name</span><span class=\"p\">;</span><span class=\"w\">           </span><span class=\"c1\">// \u53d8\u91cf\u540d\u5b57</span>\n<a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\"></a><span class=\"w\">    </span><span class=\"n\">u16</span><span class=\"w\"> </span><span class=\"n\">perm</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// \u53d8\u91cf\u8bbf\u95ee\u6743\u9650</span>\n<a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\"></a><span class=\"w\">    </span><span class=\"n\">u16</span><span class=\"w\"> </span><span class=\"n\">flags</span><span class=\"p\">;</span><span class=\"w\">                  </span><span class=\"c1\">// \u53d8\u91cf\u662f\u5426 bool \u7c7b\u578b</span>\n<a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\"></a><span class=\"w\">    </span><span class=\"n\">param_set_fn</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"p\">;</span><span class=\"w\">           </span><span class=\"c1\">// str -&gt; \u53d8\u91cf\u503c</span>\n<a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\"></a><span class=\"w\">    </span><span class=\"n\">param_get_fn</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"p\">;</span><span class=\"w\">           </span><span class=\"c1\">// \u53d8\u91cf\u503c -&gt; str</span>\n<a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\"></a><span class=\"w\">    </span><span class=\"k\">union</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\"></a><span class=\"w\">        </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">arg</span><span class=\"p\">;</span><span class=\"w\">              </span><span class=\"c1\">// \u53d8\u91cf\u6307\u9488</span>\n<a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">kparam_string</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">str</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\"></a><span class=\"w\">        </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">kparam_array</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">arr</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\"></a><span class=\"w\">    </span><span class=\"p\">};</span>\n<a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\"></a><span class=\"p\">};</span>\n<a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\"></a>\n<a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\"></a><span class=\"cp\">#define __module_param_call(prefix, name, set, get, arg, isbool, perm)  \\</span>\n<a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\"></a><span class=\"cp\">    </span><span class=\"cm\">/* Default value instead of permissions? */</span><span class=\"cp\">         \\</span>\n<a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\"></a><span class=\"cp\">    static int __param_perm_check_##name __attribute__((unused)) =  \\</span>\n<a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\"></a><span class=\"cp\">    BUILD_BUG_ON_ZERO((perm) &lt; 0 || (perm) &gt; 0777 || ((perm) &amp; 2))  \\</span>\n<a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\"></a><span class=\"cp\">    + BUILD_BUG_ON_ZERO(sizeof(&quot;&quot;prefix) &gt; MAX_PARAM_PREFIX_LEN);   \\</span>\n<a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\"></a><span class=\"cp\">    static const char __param_str_##name[] = prefix #name;      \\</span>\n<a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\"></a><span class=\"cp\">    static struct kernel_param __moduleparam_const __param_##name   \\</span>\n<a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\"></a><span class=\"cp\">    __used                              \\</span>\n<a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\"></a><span class=\"cp\">        __attribute__ ((unused,__section__ (&quot;__param&quot;),aligned(sizeof(void *)))) \\</span>\n<a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\"></a><span class=\"cp\">    = { __param_str_##name, perm, isbool ? KPARAM_ISBOOL : 0,   \\</span>\n<a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\"></a><span class=\"cp\">        set, get, { arg } }</span>\n<a id=\"__codelineno-10-25\" name=\"__codelineno-10-25\"></a>\n<a id=\"__codelineno-10-26\" name=\"__codelineno-10-26\"></a><span class=\"cp\">#define module_param_call(name, set, get, arg, perm)                  \\</span>\n<a id=\"__codelineno-10-27\" name=\"__codelineno-10-27\"></a><span class=\"cp\">    __module_param_call(MODULE_PARAM_PREFIX,                  \\</span>\n<a id=\"__codelineno-10-28\" name=\"__codelineno-10-28\"></a><span class=\"cp\">                name, set, get, arg,                  \\</span>\n<a id=\"__codelineno-10-29\" name=\"__codelineno-10-29\"></a><span class=\"cp\">                __same_type(*(arg), bool), perm)</span>\n<a id=\"__codelineno-10-30\" name=\"__codelineno-10-30\"></a>\n<a id=\"__codelineno-10-31\" name=\"__codelineno-10-31\"></a><span class=\"cp\">#define module_param_named(name, value, type, perm)            \\</span>\n<a id=\"__codelineno-10-32\" name=\"__codelineno-10-32\"></a><span class=\"cp\">    param_check_##type(name, &amp;(value));                \\</span>\n<a id=\"__codelineno-10-33\" name=\"__codelineno-10-33\"></a><span class=\"cp\">    module_param_call(name, param_set_##type, param_get_##type, &amp;value, perm); \\</span>\n<a id=\"__codelineno-10-34\" name=\"__codelineno-10-34\"></a><span class=\"cp\">    __MODULE_PARM_TYPE(name, #type)</span>\n<a id=\"__codelineno-10-35\" name=\"__codelineno-10-35\"></a>\n<a id=\"__codelineno-10-36\" name=\"__codelineno-10-36\"></a><span class=\"cp\">#define module_param(name, type, perm)              \\</span>\n<a id=\"__codelineno-10-37\" name=\"__codelineno-10-37\"></a><span class=\"cp\">    module_param_named(name, name, type, perm)</span>\n</code></pre></div></td></tr></table></div>\n<p><code>module_param</code> \u662f\u4e00\u4e2a\u5b8f\uff0c\u5b83\u5b9e\u9645\u505a\u7684\u4e8b\u60c5\u662f\u5efa\u7acb\u4e86\u4e00\u4e2a\u53ef\u4ee5\u53cd\u5c04\u5230\u4f20\u5165\u53d8\u91cf\u7684\u7ed3\u6784 <code>kernel_param</code> \uff0c\u8be5\u7ed3\u6784\u4fdd\u5b58\u4e86\u8db3\u591f\u8bbf\u95ee\u548c\u8bbe\u7f6e\u53d8\u91cf\u7684\u4fe1\u606f\uff0c\u5373\u7b2c 20-24 \u884c\uff0c\u5e76\u4e14\u628a\u7ed3\u6784\u653e\u5728\u53eb\u505a <code>__param</code> \u7684 <code>section</code> \u4e2d\uff08 <code>__section__ (\"__param\")</code> \uff09\u3002\u7ed3\u6784\u4fdd\u5b58\u597d\u4e4b\u540e\uff0c\u5185\u6838\u4f1a\u5728\u52a0\u8f7d\u6a21\u5757\u65f6\uff0c\u627e\u51fa elf \u6587\u4ef6\u7684 <code>section __param</code> \u7684\u4f4d\u7f6e\u548c\u7ed3\u6784\u6570\u91cf\uff0c\u5728\u6839\u636e\u540d\u5b57\u548c <code>param_set_fn</code> \u5206\u522b\u8bbe\u7f6e\u6bcf\u4e2a\u53c2\u6570\u7684\u6570\u503c\u3002\u627e\u51fa\u7279\u5b9a\u540d\u5b57 <code>section</code> \u7684\u65b9\u6cd5\u662f\u5e73\u53f0\u76f8\u5173\u7684\uff0cLinux \u5185\u6838\u5b9e\u73b0\u7684\u662f\u5bf9 elf \u6587\u4ef6\u7684\u5904\u7406\uff0cLinux \u63d0\u4f9b\u4e86\u6307\u4ee4 <code>readelf</code> \u6765\u67e5\u770b elf \u6587\u4ef6\u7684\u4fe1\u606f\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u67e5\u770b <code>readelf</code> \u7684\u5e2e\u52a9\u4fe1\u606f\u3002</p>\n<p>\u4e0a\u9762\u8bf4\u9053 Linux \u5185\u6838\u7684\u505a\u6cd5\u662f\u5e73\u53f0\u76f8\u5173\u7684\uff0c\u800c\u6211\u60f3\u8981\u7684\u5e73\u53f0\u65e0\u5173\u7684\u5904\u7406\u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u8981\u6539\u4e00\u6539\u539f\u59cb\u7684 <code>moduleparam</code> \u7684\u505a\u6cd5\uff0c\u628a <code>__section__ (\"__param\")</code> \u58f0\u660e\u53bb\u6389\uff0c\u6bd5\u7adf\u6211\u4eec\u5e76\u4e0d\u50cf\u53bb\u5f88\u9ebb\u70e6\u5730\u8bfb\u53d6 elf \u6587\u4ef6\u7684 <code>section</code> \u3002\u5148\u6765\u770b\u770b\u4fee\u6539\u540e\u7684\u7528\u6cd5\uff1a</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-11-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-11-45\">45</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&quot;moduleparam.h&quot;</span>\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdio.h&gt;</span>\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\"></a>\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">btest</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">latest_num</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">latest</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"mi\">0</span><span class=\"p\">};</span>\n<a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"n\">strtest</span><span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;</span><span class=\"se\">\\0</span><span class=\"s\">&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\"></a>\n<a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">usage</span><span class=\"p\">()</span>\n<a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-11-12\" name=\"__codelineno-11-12\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;usage: moduleparam_test [test=int] [btest[=bool]] [latest=int array] [strtest=string]</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-13\" name=\"__codelineno-11-13\"></a><span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-14\" name=\"__codelineno-11-14\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-11-15\" name=\"__codelineno-11-15\"></a>\n<a id=\"__codelineno-11-16\" name=\"__codelineno-11-16\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">unknown_handler</span><span class=\"p\">(</span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">param</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">val</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-17\" name=\"__codelineno-11-17\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-11-18\" name=\"__codelineno-11-18\"></a><span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;find unknown param: %s</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">param</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-19\" name=\"__codelineno-11-19\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-20\" name=\"__codelineno-11-20\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-11-21\" name=\"__codelineno-11-21\"></a>\n<a id=\"__codelineno-11-22\" name=\"__codelineno-11-22\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-23\" name=\"__codelineno-11-23\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-11-24\" name=\"__codelineno-11-24\"></a><span class=\"w\">    </span><span class=\"n\">init_module_param</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-25\" name=\"__codelineno-11-25\"></a><span class=\"w\">    </span><span class=\"n\">module_param</span><span class=\"p\">(</span><span class=\"n\">test</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-26\" name=\"__codelineno-11-26\"></a><span class=\"w\">    </span><span class=\"n\">module_param_bool</span><span class=\"p\">(</span><span class=\"n\">btest</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-27\" name=\"__codelineno-11-27\"></a><span class=\"w\">    </span><span class=\"n\">module_param_array</span><span class=\"p\">(</span><span class=\"n\">latest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">latest_num</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-28\" name=\"__codelineno-11-28\"></a><span class=\"w\">    </span><span class=\"n\">module_param_string</span><span class=\"p\">(</span><span class=\"n\">strtest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">strtest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">strtest</span><span class=\"p\">));</span>\n<a id=\"__codelineno-11-29\" name=\"__codelineno-11-29\"></a>\n<a id=\"__codelineno-11-30\" name=\"__codelineno-11-30\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">parse_params</span><span class=\"p\">(</span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">unknown_handler</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-31\" name=\"__codelineno-11-31\"></a>\n<a id=\"__codelineno-11-32\" name=\"__codelineno-11-32\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-33\" name=\"__codelineno-11-33\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-34\" name=\"__codelineno-11-34\"></a><span class=\"w\">        </span><span class=\"n\">usage</span><span class=\"p\">();</span>\n<a id=\"__codelineno-11-35\" name=\"__codelineno-11-35\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-36\" name=\"__codelineno-11-36\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-37\" name=\"__codelineno-11-37\"></a>\n<a id=\"__codelineno-11-38\" name=\"__codelineno-11-38\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"p\">[</span><span class=\"mi\">1024</span><span class=\"p\">];</span>\n<a id=\"__codelineno-11-39\" name=\"__codelineno-11-39\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">MODULE_INIT_VARIABLE_NUM</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"o\">++</span><span class=\"n\">i</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-40\" name=\"__codelineno-11-40\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-41\" name=\"__codelineno-11-41\"></a><span class=\"w\">        </span><span class=\"n\">MODULE_INIT_VARIABLE</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">].</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">MODULE_INIT_VARIABLE</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n<a id=\"__codelineno-11-42\" name=\"__codelineno-11-42\"></a><span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;%s = %s</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">MODULE_INIT_VARIABLE</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">].</span><span class=\"n\">name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-43\" name=\"__codelineno-11-43\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-44\" name=\"__codelineno-11-44\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-45\" name=\"__codelineno-11-45\"></a><span class=\"p\">}</span>\n</code></pre></div></td></tr></table></div>\n<p>\u90a3\u4e48\u4e3a\u4e86\u4fdd\u5b58\u6bcf\u4e00\u4e2a\u53cd\u5c04\u7684\u7ed3\u6784\uff0c\u6211\u5c31\u589e\u52a0\u4e86\u4e00\u4e2a\u5b8f <code>init_module_param(num)</code> \uff0c\u6765\u58f0\u660e\u4fdd\u5b58\u7ed3\u6784\u7684\u7a7a\u95f4\uff0c <code>num</code> \u662f\u53c2\u6570\u7684\u4e2a\u6570\uff0c\u5982\u679c\u5b9e\u9645\u58f0\u660e\u7684\u53c2\u6570\u4e2a\u6570\u8d85\u51fa <code>num</code> \uff0c\u7a0b\u5e8f\u4f1a\u89e6\u53d1\u65ad\u8a00\u9519\u8bef\u3002<code>module_param</code> \u7684\u58f0\u660e\u8ddf\u539f\u59cb\u7684\u7a0d\u6709\u4e0d\u540c\uff0c\u53bb\u6389\u4e86\u6700\u540e\u4e00\u4e2a\u8868\u793a\u8bbf\u95ee\u6743\u9650\u7684\u53c2\u6570\uff0c\u4e0d\u505a\u6743\u9650\u7684\u63a7\u5236\u3002\u53e6\u5916\u65b0\u589e\u4e86\u5b8f <code>module_param_bool</code> \u6765\u5904\u7406\u8868\u793a <code>bool</code> \u7684\u53d8\u91cf\uff0c\u8fd9\u5728 Linux \u7684\u7248\u672c\u662f\u4e0d\u9700\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u7528\u5230\u4e86 gcc \u5185\u5efa\u51fd\u6570 <code>__builtin_types_compatible_p</code> \u6765\u5224\u65ad\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u5f88\u9057\u61be\uff0cMSVC \u662f\u6ca1\u6709\u8fd9\u4e2a\u51fd\u6570\u7684\uff0c\u6240\u4ee5\u6211\u53ea\u80fd\u628a\u8fd9\u4e2a\u529f\u80fd\u53bb\u6389\uff0c\u589e\u52a0\u4e00\u4e2a\u5b8f\u3002 <code>module_param_array</code> \u548c <code>module_param_string</code> \u5c31\u662f\u5bf9\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u7684\u5904\u7406\uff0c\u8fd9\u4e24\u4e2a\u529f\u80fd\u5728\u539f\u59cb\u7684\u7248\u672c\u4e5f\u662f\u6709\u7684\u3002</p>\n<p>\u58f0\u660e\u53c2\u6570\u5b8c\u6bd5\uff0c\u5c31\u662f\u5904\u7406\u4f20\u5165\u7684\u53c2\u6570\u4e86\uff0c\u4f7f\u7528\u5b8f <code>parse_params</code> \uff0c\u4f20\u5165 <code>argc, argv</code>\uff0c\u7b2c 3 \u4e2a\u53c2\u6570\u662f\u5bf9\u672a\u77e5\u53c2\u6570\u7684\u5904\u7406\u56de\u8c03\u51fd\u6570\u6307\u9488\uff0c\u53ef\u4ee5\u4f20 <code>NULL</code> \uff0c\u5219\u5165\u5230\u4f4d\u7f6e\u53c2\u6570\u4f1a\u4e2d\u65ad\u5904\u7406\u53c2\u6570\uff0c\u8fd4\u56de\u9519\u8bef\u7801\u3002</p>\n<p>\u7f16\u8bd1\u8fd0\u884c\u4ee3\u7801\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a>.\\moduleparam_test.exe error=0 test=101 btest=1 latest=1,2,3 strtest=\\&quot;Hello World!\\&quot;\n<a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a>Parsing ARGS: error=0 test=101 btest=1 latest=1,2,3 strtest=&quot;Hello World!&quot;\n<a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a>find unknown param: error\n<a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a>test = 101\n<a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a>btest = Y\n<a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a>latest = 1,2,3\n<a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a>strtest = Hello World!\n</code></pre></div>\n<p>\u53ef\u4ee5\u770b\u5230\u6570\u503c\uff0c\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u90fd\u80fd\u6b63\u786e\u8bfb\u5165\u5e76\u8f6c\u6362\u683c\u5f0f\uff0c\u5982\u679c\u9047\u5230\u4e0d\u80fd\u8f6c\u6362\u683c\u5f0f\u7684\u53c2\u6570\uff0c\u4f1a\u8fd4\u56de\u9519\u8bef\u7801\u5e76\u6253\u5370\u76f8\u5173\u4fe1\u606f\u3002\u6211\u4eec\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u6dfb\u52a0\u51e0\u884c\u4ee3\u7801\uff0c\u5c31\u5b8c\u6210\u53c2\u6570\u7684\u8bfb\u5165\u548c\u8f6c\u6362\u5904\u7406\uff0c\u7528\u8d77\u6765\u5f88\u4f18\u96c5\u3002\u66f4\u8be6\u7ec6\u5b9e\u73b0\u53ef\u4ee5\u76f4\u63a5\u770b\u4ee3\u7801\uff0c<a href=\"https://github.com/disenone/aparsing\">\u5728\u8fd9\u91cc</a>\u3002</p>\n<h2 id=\"_1\">\u603b\u7ed3</h2>\n<p>\u8fd9\u6b21\u6211\u4eec\u603b\u7ed3\u4e86\u4e00\u4e0b C/C++ \u4e0b\u4e09\u79cd\u5904\u7406\u547d\u4ee4\u884c\u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f <code>getenv</code> \uff0c<code>getopt</code> \u548c <code>moduleparam</code>\u3002\u4e09\u79cd\u65b9\u6cd5\u6709\u5404\u81ea\u7684\u7279\u70b9\uff0c\u4ee5\u540e\u6709\u9700\u8981\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u7684\u9700\u6c42\u6765\u9009\u62e9\u5408\u9002\u7684\u65b9\u6cd5\uff1a</p>\n<ul>\n<li><code>getenv</code> \u662f\u539f\u751f\u591a\u5e73\u53f0\u5c31\u652f\u6301\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u4f46\u4e5f\u8fc7\u4e8e\u539f\u59cb\uff0c\u5e76\u4f7f\u7528\u7684\u662f\u73af\u5883\u53d8\u91cf\uff0c\u5bf9\u73af\u5883\u6709\u4e00\u5b9a\u7684\u6c61\u67d3\uff0c\u6bcf\u6b21\u4f7f\u7528\u524d\u6700\u597d\u6e05\u9664\u4e0d\u5fc5\u8981\u7684\u73af\u5883\u53d8\u91cf\u9632\u6b62\u4e0a\u6b21\u7684\u8bbe\u7f6e\u5b58\u7559\u6c61\u67d3</li>\n<li><code>getopt</code> \u662f Linux \u5e73\u53f0\u539f\u751f\u652f\u6301\u7684\uff0cWindows \u4e0d\u652f\u6301\uff0c\u6240\u4ee5\u9700\u8981\u5305\u542b\u5b9e\u73b0\u7684\u4ee3\u7801\u624d\u80fd\u8de8\u5e73\u53f0\u4f7f\u7528\u3002\u53c2\u6570\u7684\u4f20\u9012\u7b26\u5408 Linux \u7684\u547d\u4ee4\u4f20\u53c2\u6807\u51c6\uff0c\u652f\u6301\u53ef\u9009\u53c2\u6570\uff0c\u4f46\u4f7f\u7528\u8d77\u6765\u7565\u5fae\u9ebb\u70e6\uff0c\u901a\u5e38\u9700\u8981\u5faa\u73af\u548c\u6761\u4ef6\u5224\u65ad\u6765\u5904\u7406\u4e0d\u540c\u7684\u53c2\u6570\uff0c\u5e76\u5bf9\u6570\u503c\u7c7b\u578b\u7684\u53c2\u6570\u4e0d\u53cb\u597d\u3002</li>\n<li><code>moduleparam</code> \u662f\u53c2\u8003 Linux \u5185\u6838\u7684 <code>moduleparam</code> \u5b9e\u73b0\u7684\u547d\u4ee4\u884c\u53c2\u6570\u5904\u7406\u5de5\u5177\uff0c\u652f\u6301\u8de8\u5e73\u53f0\u4f7f\u7528\uff0c\u4f7f\u7528\u7b80\u5355\uff0c\u80fd\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u53c2\u6570\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\uff0c\u7f3a\u70b9\u5c31\u662f\u6bcf\u4e2a\u53c2\u6570\u90fd\u9700\u8981\u4e00\u4e2a\u76f8\u5e94\u7684\u53d8\u91cf\u5b58\u50a8\u3002</li>\n</ul>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/cpp-KCP%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/",
            "url": "https://wiki.disenone.site/cpp-KCP%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "KCP \u6e90\u7801\u5256\u6790",
            "content_html": "<p><meta property=\"og:title\" content=\"KCP \u6e90\u7801\u5256\u6790\" /></p>\n<p>\u9605\u8bfb\u672c\u6587\u4e4b\u524d\uff0c\u5982\u679c\u6ca1\u542c\u8bf4\u8fc7 KCP \uff0c\u6216\u8005\u4e00\u70b9\u90fd\u4e0d\u4e86\u89e3 KCP\uff0c\u9ebb\u70e6\u62bd\u4e00\u70b9\u65f6\u95f4\u5148\u770b\u770b KCP \u9879\u76ee\u7684\u8bf4\u660e\u6587\u6863\uff1a<a href=\"https://github.com/skywind3000/kcp\">\u4f20\u9001\u95e8</a>\u3002\u672c\u6587\u7684\u76ee\u7684\u662f\u6df1\u5165 KCP \u7684\u5b9e\u73b0\u7ec6\u8282\u53bb\u7406\u89e3 KCP \u3002</p>\n<h2 id=\"kcp\">\u4ec0\u4e48\u662f KCP</h2>\n<p>KCP \u662f\u4e00\u4e2a\u5feb\u901f\u53ef\u9760\u534f\u8bae\uff0c\u80fd\u591f\u4ee5\u6bd4 TCP \u66f4\u4f4e\u7684\u5ef6\u8fdf\u6765\u4f20\u9001\u6570\u636e\uff0c\u6570\u636e\u91cd\u4f20\u66f4\u5feb\uff0c\u7b49\u5f85\u65f6\u95f4\u66f4\u77ed\u3002</p>\n<blockquote>\n<p>TCP\u662f\u4e3a\u6d41\u91cf\u8bbe\u8ba1\u7684\uff08\u6bcf\u79d2\u5185\u53ef\u4ee5\u4f20\u8f93\u591a\u5c11KB\u7684\u6570\u636e\uff09\uff0c\u8bb2\u7a76\u7684\u662f\u5145\u5206\u5229\u7528\u5e26\u5bbd\u3002\u800c KCP\u662f\u4e3a\u6d41\u901f\u8bbe\u8ba1\u7684\uff08\u5355\u4e2a\u6570\u636e\u5305\u4ece\u4e00\u7aef\u53d1\u9001\u5230\u4e00\u7aef\u9700\u8981\u591a\u5c11\u65f6\u95f4\uff09\uff0c\u4ee510%-20%\u5e26\u5bbd\u6d6a\u8d39\u7684\u4ee3\u4ef7\u6362\u53d6\u4e86\u6bd4 TCP\u5feb30%-40%\u7684\u4f20\u8f93\u901f\u5ea6\u3002TCP\u4fe1\u9053\u662f\u4e00\u6761\u6d41\u901f\u5f88\u6162\uff0c\u4f46\u6bcf\u79d2\u6d41\u91cf\u5f88\u5927\u7684\u5927\u8fd0\u6cb3\uff0c\u800cKCP\u662f\u6c34\u6d41\u6e4d\u6025\u7684\u5c0f\u6fc0\u6d41</p>\n</blockquote>\n<p>\u4ee5\u4e0a\u662f KCP \u6587\u6863\u4e0a\u9762\u5199\u7684\uff0c\u5173\u952e\u8bcd\u662f<strong>\u5e26\u5bbd</strong>\u548c<strong>\u6d41\u901f</strong>\uff0cKCP \u4f1a\u635f\u8017\u5e26\u5bbd\uff0c\u5e26\u6765\u7684\u597d\u5904\u662f\u66f4\u5927\u66f4\u5747\u8861\u7684\u4f20\u8f93\u901f\u7387\u3002\u66f4\u591a\u7684\u8bf4\u660e\u53c2\u8003 KCP \u81ea\u8eab\u7684\u6587\u6863\u3002</p>\n<h2 id=\"kcp_1\">KCP \u6570\u636e\u7ed3\u6784</h2>\n<p>KCP \u6e90\u7801\u5728 <code>ikcp.h</code> \u548c <code>ikcp.c</code> \u91cc\u9762\uff0c<code>ikcp.h</code> \u6838\u5fc3\u7684\u662f\u6570\u636e\u7ed3\u6784\u7684\u58f0\u660e\uff0c\u9996\u5148\u662f <code>SEGMENT</code> \u6570\u636e\u5305\uff0c\u662f KCP \u534f\u8bae\u5904\u7406\u6570\u636e\u7684\u6700\u5c0f\u5355\u4f4d\uff1a</p>\n<details>\n<summary> SEGMENT \u7ed3\u6784\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\">//=====================================================================</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"c1\">// SEGMENT \u4e00\u4e2a SETMENT \u5c31\u662f\u4e00\u4e2a\u6570\u636e\u5305</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"c1\">//=====================================================================</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IKCPSEG</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"c1\">// \u94fe\u8868\u8282\u70b9\uff0c\u53d1\u9001\u548c\u63a5\u53d7\u961f\u5217\u90fd\u662f\u8fd9\u91cc\u7684\u94fe\u8868\u7684\u7ed3\u6784</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4f1a\u8bdd\u7f16\u53f7\uff0c\u540c\u4e00\u4e2a\u4f1a\u8bdd\u7f16\u53f7\u76f8\u540c</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6570\u636e\u5305\u7c7b\u578b\uff0c\u8b6c\u5982 DATA \u6216\u8005 ACK</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"c1\">// \u7531\u4e8e MTU \u7684\u9650\u5236\uff0c\u5927\u6570\u636e\u5305\u4f1a\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u6570\u636e\u5305\uff0c\u8fd9\u4e2a\u662f\u5c0f\u6570\u636e\u5305\u7684\u7f16\u53f7</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">frg</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6bcf\u4e2a\u6570\u636e\u5305\uff0c\u90fd\u4f1a\u9644\u5e26\u4e0a\u53d1\u9001\u65b9\u7684\u63a5\u53d7\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u65f6\u95f4\uff0c\u5982\u679c\u662f ACK \u5305\uff0c\u4f1a\u8bbe\u7f6e\u4e3a\u6e90\u6570\u636e\u5305\u7684 ts</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a>\n<a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"c1\">// \u552f\u4e00\u6807\u8bc6\u6570\u636e\u5305\u7684\u7f16\u53f7</span>\n<a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a>\n<a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\" href=\"#__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4ee3\u8868\u5c0f\u4e8e una \u7684\u6570\u636e\u5305\u90fd\u63a5\u6536\u6210\u529f\uff0c\u8ddf TCP \u542b\u4e49\u4e00\u81f4\uff1aoldest unacknowledged sequence number SND</span>\n<a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\" href=\"#__codelineno-0-28\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">una</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\" href=\"#__codelineno-0-29\"></a>\n<a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\" href=\"#__codelineno-0-30\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6570\u636e\u957f\u5ea6</span>\n<a id=\"__codelineno-0-31\" name=\"__codelineno-0-31\" href=\"#__codelineno-0-31\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-32\" name=\"__codelineno-0-32\" href=\"#__codelineno-0-32\"></a>\n<a id=\"__codelineno-0-33\" name=\"__codelineno-0-33\" href=\"#__codelineno-0-33\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8d85\u65f6\u91cd\u4f20\u65f6\u95f4</span>\n<a id=\"__codelineno-0-34\" name=\"__codelineno-0-34\" href=\"#__codelineno-0-34\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">resendts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-35\" name=\"__codelineno-0-35\" href=\"#__codelineno-0-35\"></a>\n<a id=\"__codelineno-0-36\" name=\"__codelineno-0-36\" href=\"#__codelineno-0-36\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4e0b\u6b21\u8d85\u65f6\u7b49\u5f85\u65f6\u95f4</span>\n<a id=\"__codelineno-0-37\" name=\"__codelineno-0-37\" href=\"#__codelineno-0-37\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-38\" name=\"__codelineno-0-38\" href=\"#__codelineno-0-38\"></a>\n<a id=\"__codelineno-0-39\" name=\"__codelineno-0-39\" href=\"#__codelineno-0-39\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5feb\u901f\u91cd\u4f20\uff0c\u6536\u5230\u672c\u6570\u636e\u5305\u4e4b\u540e\u7684\u6570\u636e\u5305\u7684\u6570\u91cf\uff0c\u5927\u4e8e\u4e00\u5b9a\u6570\u91cf\u5c31\u89e6\u53d1\u5feb\u901f\u91cd\u4f20</span>\n<a id=\"__codelineno-0-40\" name=\"__codelineno-0-40\" href=\"#__codelineno-0-40\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">fastack</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-41\" name=\"__codelineno-0-41\" href=\"#__codelineno-0-41\"></a>\n<a id=\"__codelineno-0-42\" name=\"__codelineno-0-42\" href=\"#__codelineno-0-42\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u6b21\u6570</span>\n<a id=\"__codelineno-0-43\" name=\"__codelineno-0-43\" href=\"#__codelineno-0-43\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">xmit</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-44\" name=\"__codelineno-0-44\" href=\"#__codelineno-0-44\"></a>\n<a id=\"__codelineno-0-45\" name=\"__codelineno-0-45\" href=\"#__codelineno-0-45\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6570\u636e</span>\n<a id=\"__codelineno-0-46\" name=\"__codelineno-0-46\" href=\"#__codelineno-0-46\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n<a id=\"__codelineno-0-47\" name=\"__codelineno-0-47\" href=\"#__codelineno-0-47\"></a><span class=\"p\">};</span>\n</code></pre></div>\n</details>\n\n<p>\u770b\u5b8c <code>SEGMENT</code> \u7684\u6ce8\u91ca\uff0c\u5927\u81f4\u80fd\u770b\u51fa KCP \u7684\u6838\u5fc3\u4e5f\u662f\u4e00\u4e2a ARQ \u534f\u8bae\uff0c\u901a\u8fc7\u81ea\u52a8\u8d85\u65f6\u91cd\u4f20\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u9001\u8fbe\u3002\u63a5\u7740\u518d\u6765\u770b\u770b KCP \u7ed3\u6784 <code>KCPCB</code> \u7684\u5b9a\u4e49\uff1a</p>\n<details>\n<summary> KCP \u7ed3\u6784\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"c1\">// IKCPCB</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IKCPCB</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"c1\">// conv: \u4f1a\u8bdd\u7f16\u53f7</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"c1\">// mtu, mss: \u6700\u5927\u4f20\u8f93\u5355\u5143\uff0c\u6700\u5927\u62a5\u6587\u6bb5\u5927\u5c0f</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"c1\">// state: \u4f1a\u8bdd\u72b6\u6001\uff0c0 \u6709\u6548\uff0c-1 \u65ad\u5f00</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mtu</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"c1\">// snd_una: \u7b49\u5f85 ACK \u7684\u5305\u7f16\u53f7</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">    </span><span class=\"c1\">// snd_nxt: \u4e0b\u4e00\u4e2a\u7b49\u5f85\u53d1\u9001\u7684\u6570\u636e\u5305\u7f16\u53f7</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">    </span><span class=\"c1\">// rcv_nxt: \u4e0b\u4e00\u4e2a\u7b49\u5f85\u63a5\u6536\u7684\u6570\u636e\u5305\u7f16\u53f7</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">snd_una</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">snd_nxt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcv_nxt</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">    </span><span class=\"c1\">// ts_recent, ts_lastack: \u672a\u7528\u5230</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">    </span><span class=\"c1\">// ssthresh: \u62e5\u585e\u63a7\u5236\u6162\u542f\u52a8\u9608\u503c</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ts_recent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ts_lastack</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ssthresh</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">    </span><span class=\"c1\">// rx_rto: rto (retransmission timeout)\uff0c\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"c1\">// rx_rttval, rx_srtt, rx_minrto: \u8ba1\u7b97 rto \u7684\u4e2d\u95f4\u53d8\u91cf</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">    </span><span class=\"n\">IINT32</span><span class=\"w\"> </span><span class=\"n\">rx_rttval</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rx_srtt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rx_rto</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rx_minrto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a>\n<a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">    </span><span class=\"c1\">// snd_wnd, rcv_wnd: \u6700\u5927\u53d1\u9001\u548c\u63a5\u6536\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">    </span><span class=\"c1\">// rmt_wnd: remote wnd \uff0c\u5bf9\u7aef\u5269\u4f59\u63a5\u53d7\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"w\">    </span><span class=\"c1\">// cwnd: \u53ef\u53d1\u9001\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">    </span><span class=\"c1\">// probe: \u662f\u5426\u8981\u53d1\u9001\u63a7\u5236\u62a5\u6587\u7684\u6807\u5fd7</span>\n<a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">snd_wnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcv_wnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rmt_wnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">probe</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a>\n<a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">    </span><span class=\"c1\">// current: \u5f53\u524d\u65f6\u95f4</span>\n<a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">    </span><span class=\"c1\">// interval: \u66f4\u65b0\u95f4\u9694</span>\n<a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">    </span><span class=\"c1\">// ts_flush: \u4e0b\u6b21\u9700\u8981\u66f4\u65b0\u7684\u65f6\u95f4</span>\n<a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a><span class=\"w\">    </span><span class=\"c1\">// xmit: \u53d1\u9001\u5931\u8d25\u6b21\u6570</span>\n<a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">interval</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ts_flush</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">xmit</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a>\n<a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5bf9\u5e94\u94fe\u8868\u7684\u957f\u5ea6</span>\n<a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">nrcv_buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nsnd_buf</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">nrcv_que</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nsnd_que</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a>\n<a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">    </span><span class=\"c1\">// nodelay: \u63a7\u5236\u8d85\u65f6\u91cd\u4f20\u7684 rto \u589e\u957f\u901f\u5ea6</span>\n<a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">    </span><span class=\"c1\">// updated: \u662f\u5426\u8c03\u7528\u8fc7 ikcp_update</span>\n<a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">nodelay</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a>\n<a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"w\">    </span><span class=\"c1\">// ts_probe, probe_wait: \u5bf9\u7aef\u63a5\u6536\u7a97\u53e3\u957f\u65f6\u95f4\u4e3a 0 \u65f6\u4e3b\u52a8\u5b9a\u671f\u53d1\u8d77\u8be2\u95ee</span>\n<a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ts_probe</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">probe_wait</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a>\n<a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a><span class=\"w\">    </span><span class=\"c1\">// deal_link: \u5bf9\u7aef\u957f\u65f6\u95f4\u65e0\u5e94\u7b54</span>\n<a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">    </span><span class=\"c1\">// incr: \u53c2\u4e0e\u8ba1\u7b97\u53d1\u9001\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">dead_link</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">incr</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a>\n<a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">    </span><span class=\"c1\">// queue: \u8ddf\u7528\u6237\u5c42\u63a5\u89e6\u7684\u6570\u636e\u5305</span>\n<a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">    </span><span class=\"c1\">// buf: \u534f\u8bae\u7f13\u5b58\u7684\u6570\u636e\u5305</span>\n<a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"n\">snd_queue</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"n\">rcv_queue</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"n\">snd_buf</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-56\" name=\"__codelineno-1-56\" href=\"#__codelineno-1-56\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"n\">rcv_buf</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-57\" name=\"__codelineno-1-57\" href=\"#__codelineno-1-57\"></a>\n<a id=\"__codelineno-1-58\" name=\"__codelineno-1-58\" href=\"#__codelineno-1-58\"></a><span class=\"w\">    </span><span class=\"c1\">// \u9700\u8981\u53d1\u9001 ack \u7684\u6570\u636e\u5305\u4fe1\u606f</span>\n<a id=\"__codelineno-1-59\" name=\"__codelineno-1-59\" href=\"#__codelineno-1-59\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">acklist</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-60\" name=\"__codelineno-1-60\" href=\"#__codelineno-1-60\"></a>\n<a id=\"__codelineno-1-61\" name=\"__codelineno-1-61\" href=\"#__codelineno-1-61\"></a><span class=\"w\">    </span><span class=\"c1\">// \u9700\u8981 ack \u7684\u5305\u6570\u91cf</span>\n<a id=\"__codelineno-1-62\" name=\"__codelineno-1-62\" href=\"#__codelineno-1-62\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ackcount</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-63\" name=\"__codelineno-1-63\" href=\"#__codelineno-1-63\"></a>\n<a id=\"__codelineno-1-64\" name=\"__codelineno-1-64\" href=\"#__codelineno-1-64\"></a><span class=\"w\">    </span><span class=\"c1\">// acklist \u5185\u5b58\u5927\u5c0f</span>\n<a id=\"__codelineno-1-65\" name=\"__codelineno-1-65\" href=\"#__codelineno-1-65\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ackblock</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-66\" name=\"__codelineno-1-66\" href=\"#__codelineno-1-66\"></a>\n<a id=\"__codelineno-1-67\" name=\"__codelineno-1-67\" href=\"#__codelineno-1-67\"></a><span class=\"w\">    </span><span class=\"c1\">// \u7528\u6237\u5c42\u4f20\u8fdb\u6765\u7684\u6570\u636e</span>\n<a id=\"__codelineno-1-68\" name=\"__codelineno-1-68\" href=\"#__codelineno-1-68\"></a><span class=\"w\">    </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">user</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-69\" name=\"__codelineno-1-69\" href=\"#__codelineno-1-69\"></a>\n<a id=\"__codelineno-1-70\" name=\"__codelineno-1-70\" href=\"#__codelineno-1-70\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5b58\u653e\u4e00\u4e2a kcp \u5305\u7684\u7a7a\u95f4</span>\n<a id=\"__codelineno-1-71\" name=\"__codelineno-1-71\" href=\"#__codelineno-1-71\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-72\" name=\"__codelineno-1-72\" href=\"#__codelineno-1-72\"></a>\n<a id=\"__codelineno-1-73\" name=\"__codelineno-1-73\" href=\"#__codelineno-1-73\"></a><span class=\"w\">    </span><span class=\"c1\">// \u89e6\u53d1\u5feb\u901f\u91cd\u4f20\u7684 fastack \u6b21\u6570</span>\n<a id=\"__codelineno-1-74\" name=\"__codelineno-1-74\" href=\"#__codelineno-1-74\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">fastresend</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-75\" name=\"__codelineno-1-75\" href=\"#__codelineno-1-75\"></a>\n<a id=\"__codelineno-1-76\" name=\"__codelineno-1-76\" href=\"#__codelineno-1-76\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5feb\u901f\u91cd\u4f20\u6700\u5927\u6b21\u6570</span>\n<a id=\"__codelineno-1-77\" name=\"__codelineno-1-77\" href=\"#__codelineno-1-77\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">fastlimit</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-78\" name=\"__codelineno-1-78\" href=\"#__codelineno-1-78\"></a>\n<a id=\"__codelineno-1-79\" name=\"__codelineno-1-79\" href=\"#__codelineno-1-79\"></a><span class=\"w\">    </span><span class=\"c1\">// nocwnd: \u4e0d\u8003\u8651\u6162\u542f\u52a8\u7684\u53d1\u9001\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-1-80\" name=\"__codelineno-1-80\" href=\"#__codelineno-1-80\"></a><span class=\"w\">    </span><span class=\"c1\">// stream: \u6d41\u6a21\u5f0f</span>\n<a id=\"__codelineno-1-81\" name=\"__codelineno-1-81\" href=\"#__codelineno-1-81\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">nocwnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-82\" name=\"__codelineno-1-82\" href=\"#__codelineno-1-82\"></a>\n<a id=\"__codelineno-1-83\" name=\"__codelineno-1-83\" href=\"#__codelineno-1-83\"></a><span class=\"w\">    </span><span class=\"c1\">// debug log</span>\n<a id=\"__codelineno-1-84\" name=\"__codelineno-1-84\" href=\"#__codelineno-1-84\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">logmask</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-85\" name=\"__codelineno-1-85\" href=\"#__codelineno-1-85\"></a>\n<a id=\"__codelineno-1-86\" name=\"__codelineno-1-86\" href=\"#__codelineno-1-86\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u6570\u636e\u63a5\u53e3</span>\n<a id=\"__codelineno-1-87\" name=\"__codelineno-1-87\" href=\"#__codelineno-1-87\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">output</span><span class=\"p\">)(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IKCPCB</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">user</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-88\" name=\"__codelineno-1-88\" href=\"#__codelineno-1-88\"></a>\n<a id=\"__codelineno-1-89\" name=\"__codelineno-1-89\" href=\"#__codelineno-1-89\"></a><span class=\"w\">    </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">writelog</span><span class=\"p\">)(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">log</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IKCPCB</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">user</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-90\" name=\"__codelineno-1-90\" href=\"#__codelineno-1-90\"></a><span class=\"p\">};</span>\n</code></pre></div>\n</details>\n\n<p>\u9010\u4e00\u628a KCP \u7ed3\u6784\u91cc\u9762\u7684\u5b57\u6bb5\u6ce8\u91ca\u4e0a\uff0c\u53ef\u4ee5\u521d\u6b65\u611f\u89c9\u5230\uff0c\u6574\u5957 KCP \u7684\u534f\u8bae\u4e0d\u592a\u590d\u6742\uff0c\u7ec6\u7ec6\u53bb\u5206\u6790\u4ee3\u7801\uff0c\u4f60\u6211\u90fd\u80fd\u8bfb\u61c2\u5e76\u7406\u89e3 KCP \u534f\u8bae <img alt=\"\ud83d\ude04\" class=\"twemoji\" src=\"https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f604.svg\" title=\":smile:\" /></p>\n<h2 id=\"kcp-arq\">KCP \u7684 ARQ \u5b9e\u73b0</h2>\n<p>KCP \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a ARQ (Auto Repeat-reQuest\uff0c\u81ea\u52a8\u91cd\u4f20) \u534f\u8bae\uff0c\u6700\u57fa\u672c\u7684\u662f\u8981\u4fdd\u8bc1\u53ef\u9760\u7684\u4f20\u8f93\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u6765\u5173\u6ce8 KCP \u7684\u57fa\u672c ARQ \u90e8\u5206\uff0cKCP \u662f\u600e\u4e48\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u7684\u3002</p>\n<p>ARQ \u987e\u540d\u601d\u4e49\uff0c\u5f53\u6211\u4eec\u8ba4\u4e3a\u5bf9\u7aef\u63a5\u6536\u6570\u636e\u5305\u5931\u8d25\u65f6\uff0c\u81ea\u52a8\u91cd\u65b0\u53d1\u9001\u5bf9\u5e94\u7684\u6570\u636e\u5305\uff0c\u5b83\u662f\u901a\u8fc7\u786e\u8ba4\u63a5\u6536\u548c\u8d85\u65f6\u91cd\u4f20\u4e24\u4e2a\u673a\u5236\uff0c\u6765\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u3002\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u73b0\u4e0a\uff0c KCP \u7ed9\u6bcf\u4e2a\u6570\u636e\u5305\uff08\u5c31\u662f\u4e0a\u4e00\u8282\u63d0\u5230\u7684 <code>SEGMENT</code> \uff09 \u5206\u914d\u552f\u4e00\u7684 <code>sn</code> \u6807\u8bc6\u7b26\uff0c\u4e00\u65e6\u5bf9\u7aef\u63a5\u6536\u5230\u6570\u636e\u5305\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a ACK \u5305\uff08\u540c\u6837\u662f <code>SEGMENT</code>\uff09\uff0cACK \u5305\u7684 <code>sn</code> \u8ddf\u63a5\u6536\u5230\u7684\u6570\u636e\u5305 <code>sn</code> \u76f8\u540c\uff0c\u901a\u77e5\u63a5\u6536\u5230\u6b64\u6570\u636e\u5305\u5df2\u7ecf\u63a5\u6536\u6210\u529f\u3002<code>SEGMENT</code> \u4e0a\u8fd8\u6709\u4e00\u4e2a <code>una</code> \u5b57\u6bb5\uff0c\u8868\u793a\u4e0b\u4e00\u4e2a\u671f\u5f85\u63a5\u6536\u7684\u6570\u636e\u5305\u7684\u7f16\u53f7\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5373\u662f\u6240\u6709\u5728\u8be5\u7f16\u53f7\u4e4b\u524d\u7684\u6570\u636e\u5305\u90fd\u5df2\u7ecf\u63a5\u6536\u5b8c\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5168\u91cf\u7684 ACK \u5305\uff0c\u53d1\u9001\u7aef\u53ef\u4ee5\u66f4\u5feb\u7684\u66f4\u65b0\u53d1\u9001\u7f13\u51b2\u548c\u53d1\u9001\u7a97\u53e3\u3002</p>\n<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8ddf\u8e2a KCP \u5305\u7684\u53d1\u9001\u548c\u63a5\u53d7\u4ee3\u7801\uff0c\u6765\u7406\u89e3\u6700\u57fa\u672c\u7684 ARQ \u5b9e\u73b0\uff1a</p>\n<h3 id=\"_1\">\u53d1\u9001</h3>\n<p>\u53d1\u9001\u7684\u8fc7\u7a0b\u662f <code>ikcp_send</code> -&gt; <code>ikcp_update</code> -&gt; <code>ikcp_output</code>\uff0c\u4e0a\u5c42\u8c03\u7528 <code>ikcp_send</code> \u628a\u6570\u636e\u4f20\u7ed9 KCP\uff0cKCP \u5728 <code>ikcp_update</code> \u4e2d\u5904\u7406\u6570\u636e\u7684\u53d1\u9001\u3002</p>\n<details>\n<summary> ikcp_send\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"c1\">// \u53d1\u9001\u6570\u636e\u63a5\u53e3\uff0c\u7528\u6237\u8c03\u7528 ikcp_send \u6765\u8ba9 kcp \u53d1\u9001\u6570\u636e</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"c1\">// user/upper level send, returns below zero for error</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">ikcp_send</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">seg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">    </span><span class=\"c1\">// mss \u4e0d\u80fd\u5c0f\u4e8e1</span>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">    </span><span class=\"c1\">// append to previous segment in streaming mode (if possible)</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">stream</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5904\u7406\u6d41\u6a21\u5f0f</span>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">        </span><span class=\"c1\">// ......</span>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97\u5206\u5305\uff0c\u5982\u679c\u6570\u636e\u957f\u5ea6 len \u5927\u4e8e mss\uff0c\u9700\u8981\u5206\u6210\u591a\u4e2a\u5305\u53d1\u9001\uff0c\u5bf9\u7aef\u63a5\u53d7\u5230\u4e4b\u540e\u518d\u62fc\u8d77\u6765</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">IKCP_WND_RCV</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5206\u5305</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-30\" name=\"__codelineno-2-30\" href=\"#__codelineno-2-30\"></a><span class=\"w\">        </span><span class=\"c1\">// \u8ba1\u7b97\u5305\u7684\u6570\u636e\u957f\u5ea6\uff0c\u5e76\u5206\u914d\u5bf9\u5e94\u7684 seg \u7ed3\u6784</span>\n<a id=\"__codelineno-2-31\" name=\"__codelineno-2-31\" href=\"#__codelineno-2-31\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-32\" name=\"__codelineno-2-32\" href=\"#__codelineno-2-32\"></a><span class=\"w\">        </span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_segment_new</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-33\" name=\"__codelineno-2-33\" href=\"#__codelineno-2-33\"></a><span class=\"w\">        </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-34\" name=\"__codelineno-2-34\" href=\"#__codelineno-2-34\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-35\" name=\"__codelineno-2-35\" href=\"#__codelineno-2-35\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-36\" name=\"__codelineno-2-36\" href=\"#__codelineno-2-36\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-37\" name=\"__codelineno-2-37\" href=\"#__codelineno-2-37\"></a>\n<a id=\"__codelineno-2-38\" name=\"__codelineno-2-38\" href=\"#__codelineno-2-38\"></a><span class=\"w\">        </span><span class=\"c1\">// \u8bbe\u7f6e seg \u7684 \u6570\u636e\u4fe1\u606f\uff0cfrg \u8868\u793a\u5206\u5305\u7f16\u53f7</span>\n<a id=\"__codelineno-2-39\" name=\"__codelineno-2-39\" href=\"#__codelineno-2-39\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">buffer</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-40\" name=\"__codelineno-2-40\" href=\"#__codelineno-2-40\"></a><span class=\"w\">            </span><span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-41\" name=\"__codelineno-2-41\" href=\"#__codelineno-2-41\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-42\" name=\"__codelineno-2-42\" href=\"#__codelineno-2-42\"></a><span class=\"w\">        </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-43\" name=\"__codelineno-2-43\" href=\"#__codelineno-2-43\"></a><span class=\"w\">        </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">frg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">stream</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-44\" name=\"__codelineno-2-44\" href=\"#__codelineno-2-44\"></a>\n<a id=\"__codelineno-2-45\" name=\"__codelineno-2-45\" href=\"#__codelineno-2-45\"></a><span class=\"w\">        </span><span class=\"c1\">// \u52a0\u5230 snd_queue \u7684\u672b\u5c3e\uff0cnsnd_qua \u52a0\u4e00</span>\n<a id=\"__codelineno-2-46\" name=\"__codelineno-2-46\" href=\"#__codelineno-2-46\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_init</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-47\" name=\"__codelineno-2-47\" href=\"#__codelineno-2-47\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_add_tail</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_queue</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-48\" name=\"__codelineno-2-48\" href=\"#__codelineno-2-48\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nsnd_que</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-49\" name=\"__codelineno-2-49\" href=\"#__codelineno-2-49\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">buffer</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-50\" name=\"__codelineno-2-50\" href=\"#__codelineno-2-50\"></a><span class=\"w\">            </span><span class=\"n\">buffer</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-51\" name=\"__codelineno-2-51\" href=\"#__codelineno-2-51\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-52\" name=\"__codelineno-2-52\" href=\"#__codelineno-2-52\"></a><span class=\"w\">        </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-53\" name=\"__codelineno-2-53\" href=\"#__codelineno-2-53\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-54\" name=\"__codelineno-2-54\" href=\"#__codelineno-2-54\"></a>\n<a id=\"__codelineno-2-55\" name=\"__codelineno-2-55\" href=\"#__codelineno-2-55\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-56\" name=\"__codelineno-2-56\" href=\"#__codelineno-2-56\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p><code>ikcp_send</code> \u662f\u7531 KCP \u7684\u4e0a\u5c42\u6765\u8c03\u7528\u7684\u53d1\u9001\u6570\u636e\u63a5\u53e3\uff0c\u6240\u6709\u8ba9 KCP \u53d1\u9001\u7684\u6570\u636e\uff0c\u90fd\u5e94\u8be5\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u3002 <code>ikcp_send</code> \u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u5c31\u662f\u628a\u6570\u636e\uff0c\u6839\u636e <code>kcp-&gt;mss</code> \uff08\u4e00\u4e2a\u5305\u6700\u5927\u6570\u636e\u957f\u5ea6\uff09\u6765\u5206\u6210\u591a\u4e2a\u5305\uff0c\u5e76\u8bbe\u7f6e\u5206\u5305\u7f16\u53f7\uff0c\u6700\u540e\u653e\u5230\u53d1\u9001\u94fe\u8868 <code>snd_queue</code> \u7684\u672b\u5c3e\u3002\u6d41\u6a21\u5f0f\u5c31\u662f\u628a\u591a\u6b21\u8c03\u7528 <code>ikcp_send</code> \u7684\u6570\u636e\u90fd\u770b\u6210\u4e00\u4e2a\u6d41\uff0c\u4f1a\u5148\u81ea\u52a8\u586b\u5145\u672a\u6ee1\u7684 <code>SEGMENT</code> \u518d\u5206\u914d\u65b0\u7684\uff0c\u8be6\u7ec6\u5b9e\u73b0\u672c\u6587\u4e0d\u8ba8\u8bba\uff0c\u611f\u5174\u8da3\u7684\uff0c\u76f8\u4fe1\u770b\u5b8c\u672c\u6587\uff0c\u518d\u5bf9\u5e94\u770b\u770b\u4ee3\u7801\u5c31\u80fd\u7406\u89e3\u3002</p>\n<p><code>ikcp_send</code> \u8c03\u7528\u5b8c\u6210\u4e4b\u540e\uff0c\u6570\u636e\u653e\u5728\u7684 KCP \u7684 <code>snd_queue</code> \u4e2d\uff0c\u90a3\u4e48\u540e\u9762 KCP \u9700\u8981\u627e\u4e2a\u65f6\u673a\uff0c\u628a\u5f85\u53d1\u9001\u7684\u6570\u636e\u53d1\u9001\u51fa\u53bb\uff0c\u8fd9\u5757\u4ee3\u7801\u90fd\u653e\u5728 <code>ikcp_update</code> \u548c <code>ikcp_flush</code> \u91cc\u9762\uff1a</p>\n<details>\n<summary> ikcp_update\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"c1\">// ikcp_update \u662f\u7ed9\u4e0a\u5c42\u5b9a\u671f\u8c03\u7528\u7684\u63a5\u53e3\uff0c\u7528\u6765\u66f4\u65b0 kcp \u7684\u72b6\u6001\uff0c\u53d1\u9001\u6570\u636e</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"c1\">// update state (call it repeatedly, every 10ms-100ms), or you can ask </span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"c1\">// ikcp_check when to call it again (without ikcp_input/_send calling).</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"c1\">// &#39;current&#39; - current timestamp in millisec. </span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_update</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">    </span><span class=\"n\">IINT32</span><span class=\"w\"> </span><span class=\"n\">slap</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">    </span><span class=\"c1\">// ikcp_flush \u4f1a\u68c0\u67e5\u8fd9\u4e2a\uff0c\u4e0a\u5c42\u5fc5\u987b\u8c03\u7528\u8fc7 ikcp_update \u624d\u80fd\u8c03\u7528 ikcp_flush\uff0c\u5efa\u8bae\u53ea\u4f7f\u7528 ikcp_update</span>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">    </span><span class=\"n\">slap</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">slap</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">10000</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">slap</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">-10000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"w\">        </span><span class=\"n\">slap</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a>\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">slap</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a><span class=\"w\">        </span><span class=\"c1\">// \u4e0b\u6b21 flush \u7684\u65f6\u95f4</span>\n<a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">interval</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ts_flush</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">interval</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\" href=\"#__codelineno-3-33\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\" href=\"#__codelineno-3-34\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p><code>ikcp_update</code> \u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u5224\u65ad\u4e00\u4e0b <code>ts_flush</code> \u7684\u65f6\u95f4\uff0c\u7b26\u5408\u6761\u4ef6\u5219\u8c03\u7528 <code>ikcp_flush</code>\uff0c\u4e3b\u8981\u7684\u5904\u7406\u903b\u8f91\u90fd\u5728 <code>ikcp_flush</code> \u91cc\u9762\u4e86\uff0c\u56e0\u4e3a <code>ikcp_flush</code> \u5185\u5bb9\u590d\u6742\u4e00\u70b9\uff0c\u6211\u4eec\u76ee\u524d\u53ea\u5173\u6ce8\u8ddf ARQ \u53d1\u9001\u76f8\u5173\u7684\u90e8\u5206\uff1a</p>\n<details>\n<summary> \u53d1\u9001\u6570\u636e\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"c1\">// ikcp_flush</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">    </span><span class=\"c1\">// buffer \u662f\u8981\u4f20\u7ed9 ikcp_output \u7684\u6570\u636e\uff0c\u521d\u59cb\u5316\u4e3a 3 \u500d\u6570\u636e\u5305\u5927\u5c0f</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">buffer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">resent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">rtomin</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">lost</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">    </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a>\n<a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">    </span><span class=\"c1\">// &#39;ikcp_update&#39; haven&#39;t been called.</span>\n<a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a>\n<a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">conv</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_ACK</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">frg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a>\n<a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">    </span><span class=\"c1\">// seg.wnd \u662f\u8868\u793a\u5f53\u524d\u53ef\u63a5\u6536\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_wnd_unused</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a><span class=\"w\">    </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a>\n<a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001 ack</span>\n<a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97 \u53d1\u9001\u7a97\u53e3</span>\n<a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a><span class=\"w\">    </span><span class=\"c1\">//...</span>\n<a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a>\n<a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">    </span><span class=\"c1\">// \u628a\u6570\u636e\u5305\u4ece snd_queue \u79fb\u52a8\u5230 snd_buf</span>\n<a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">    </span><span class=\"c1\">// \u79fb\u52a8\u662f\u9700\u8981\u6ee1\u8db3 \u53d1\u9001\u7a97\u53e3 \u5927\u5c0f\uff0c\u53d1\u9001\u7a97\u53e3\u6ee1\u4e86\uff0c\u5c31\u505c\u6b62\u79fb\u52a8</span>\n<a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">    </span><span class=\"c1\">// \u653e\u5728 snd_buf \u7684\u91cc\u9762\u7684\u6570\u636e\uff0c\u5c31\u662f\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528 ikcp_output \u7ed9\u5bf9\u7aef\u53d1\u9001\u7684\u6570\u636e</span>\n<a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_nxt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">newseg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">iqueue_is_empty</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_queue</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a>\n<a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_queue</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a>\n<a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_del</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_add_tail</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nsnd_que</span><span class=\"o\">--</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-49\" name=\"__codelineno-4-49\" href=\"#__codelineno-4-49\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nsnd_buf</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-50\" name=\"__codelineno-4-50\" href=\"#__codelineno-4-50\"></a>\n<a id=\"__codelineno-4-51\" name=\"__codelineno-4-51\" href=\"#__codelineno-4-51\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">conv</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-52\" name=\"__codelineno-4-52\" href=\"#__codelineno-4-52\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_PUSH</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-53\" name=\"__codelineno-4-53\" href=\"#__codelineno-4-53\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-54\" name=\"__codelineno-4-54\" href=\"#__codelineno-4-54\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-55\" name=\"__codelineno-4-55\" href=\"#__codelineno-4-55\"></a>\n<a id=\"__codelineno-4-56\" name=\"__codelineno-4-56\" href=\"#__codelineno-4-56\"></a><span class=\"w\">        </span><span class=\"c1\">// seg \u552f\u4e00\u5e8f\u53f7\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u9012\u589e\u7684 kcp-&gt;snd_nxt</span>\n<a id=\"__codelineno-4-57\" name=\"__codelineno-4-57\" href=\"#__codelineno-4-57\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_nxt</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-58\" name=\"__codelineno-4-58\" href=\"#__codelineno-4-58\"></a>\n<a id=\"__codelineno-4-59\" name=\"__codelineno-4-59\" href=\"#__codelineno-4-59\"></a><span class=\"w\">        </span><span class=\"c1\">// una \u5728\u8fd9\u91cc\u8bbe\u7f6e\uff0c\u901a\u77e5\u5bf9\u7aef\u4e0b\u4e00\u4e2a\u7b49\u5f85\u63a5\u6536\u7684\u5305\u5e8f\u53f7</span>\n<a id=\"__codelineno-4-60\" name=\"__codelineno-4-60\" href=\"#__codelineno-4-60\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-61\" name=\"__codelineno-4-61\" href=\"#__codelineno-4-61\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-62\" name=\"__codelineno-4-62\" href=\"#__codelineno-4-62\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rx_rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-63\" name=\"__codelineno-4-63\" href=\"#__codelineno-4-63\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">fastack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-64\" name=\"__codelineno-4-64\" href=\"#__codelineno-4-64\"></a><span class=\"w\">        </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-65\" name=\"__codelineno-4-65\" href=\"#__codelineno-4-65\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-66\" name=\"__codelineno-4-66\" href=\"#__codelineno-4-66\"></a>\n<a id=\"__codelineno-4-67\" name=\"__codelineno-4-67\" href=\"#__codelineno-4-67\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97\u5feb\u901f\u91cd\u4f20\u6807\u5fd7\uff0c\u8d85\u65f6\u7b49\u5f85\u65f6\u95f4</span>\n<a id=\"__codelineno-4-68\" name=\"__codelineno-4-68\" href=\"#__codelineno-4-68\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-4-69\" name=\"__codelineno-4-69\" href=\"#__codelineno-4-69\"></a>\n<a id=\"__codelineno-4-70\" name=\"__codelineno-4-70\" href=\"#__codelineno-4-70\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001 snd_buf</span>\n<a id=\"__codelineno-4-71\" name=\"__codelineno-4-71\" href=\"#__codelineno-4-71\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-72\" name=\"__codelineno-4-72\" href=\"#__codelineno-4-72\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-73\" name=\"__codelineno-4-73\" href=\"#__codelineno-4-73\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-74\" name=\"__codelineno-4-74\" href=\"#__codelineno-4-74\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-75\" name=\"__codelineno-4-75\" href=\"#__codelineno-4-75\"></a><span class=\"w\">            </span><span class=\"c1\">// \u9996\u6b21\u53d1\u9001</span>\n<a id=\"__codelineno-4-76\" name=\"__codelineno-4-76\" href=\"#__codelineno-4-76\"></a><span class=\"w\">            </span><span class=\"c1\">// set-&gt;xmit \u8868\u793a\u53d1\u9001\u6b21\u6570</span>\n<a id=\"__codelineno-4-77\" name=\"__codelineno-4-77\" href=\"#__codelineno-4-77\"></a><span class=\"w\">            </span><span class=\"c1\">// resendts \u8d85\u65f6\u91cd\u4f20\u7684\u7b49\u5f85\u65f6\u95f4</span>\n<a id=\"__codelineno-4-78\" name=\"__codelineno-4-78\" href=\"#__codelineno-4-78\"></a><span class=\"w\">            </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-79\" name=\"__codelineno-4-79\" href=\"#__codelineno-4-79\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-80\" name=\"__codelineno-4-80\" href=\"#__codelineno-4-80\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rx_rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-81\" name=\"__codelineno-4-81\" href=\"#__codelineno-4-81\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">rtomin</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-82\" name=\"__codelineno-4-82\" href=\"#__codelineno-4-82\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-83\" name=\"__codelineno-4-83\" href=\"#__codelineno-4-83\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-84\" name=\"__codelineno-4-84\" href=\"#__codelineno-4-84\"></a><span class=\"w\">            </span><span class=\"c1\">// \u8d85\u65f6\u91cd\u4f20</span>\n<a id=\"__codelineno-4-85\" name=\"__codelineno-4-85\" href=\"#__codelineno-4-85\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-4-86\" name=\"__codelineno-4-86\" href=\"#__codelineno-4-86\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-87\" name=\"__codelineno-4-87\" href=\"#__codelineno-4-87\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">fastack</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">resent</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-88\" name=\"__codelineno-4-88\" href=\"#__codelineno-4-88\"></a><span class=\"w\">            </span><span class=\"c1\">// \u5feb\u901f\u91cd\u4f20</span>\n<a id=\"__codelineno-4-89\" name=\"__codelineno-4-89\" href=\"#__codelineno-4-89\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-4-90\" name=\"__codelineno-4-90\" href=\"#__codelineno-4-90\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-91\" name=\"__codelineno-4-91\" href=\"#__codelineno-4-91\"></a>\n<a id=\"__codelineno-4-92\" name=\"__codelineno-4-92\" href=\"#__codelineno-4-92\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">needsend</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-93\" name=\"__codelineno-4-93\" href=\"#__codelineno-4-93\"></a><span class=\"w\">            </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-94\" name=\"__codelineno-4-94\" href=\"#__codelineno-4-94\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-95\" name=\"__codelineno-4-95\" href=\"#__codelineno-4-95\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-96\" name=\"__codelineno-4-96\" href=\"#__codelineno-4-96\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-97\" name=\"__codelineno-4-97\" href=\"#__codelineno-4-97\"></a>\n<a id=\"__codelineno-4-98\" name=\"__codelineno-4-98\" href=\"#__codelineno-4-98\"></a><span class=\"w\">            </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)(</span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-99\" name=\"__codelineno-4-99\" href=\"#__codelineno-4-99\"></a><span class=\"w\">            </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_OVERHEAD</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-100\" name=\"__codelineno-4-100\" href=\"#__codelineno-4-100\"></a>\n<a id=\"__codelineno-4-101\" name=\"__codelineno-4-101\" href=\"#__codelineno-4-101\"></a><span class=\"w\">            </span><span class=\"c1\">// \u6bcf\u5f53 buffer \u4e2d\u7684\u6570\u636e\u8d85\u8fc7 mtu \uff0c\u90a3\u5c31\u5148\u53d1\u51fa\u53bb\uff0c\u5c3d\u91cf\u907f\u514d\u5e95\u5c42\u518d\u5206\u5305</span>\n<a id=\"__codelineno-4-102\" name=\"__codelineno-4-102\" href=\"#__codelineno-4-102\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mtu</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-103\" name=\"__codelineno-4-103\" href=\"#__codelineno-4-103\"></a><span class=\"w\">                </span><span class=\"n\">ikcp_output</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-104\" name=\"__codelineno-4-104\" href=\"#__codelineno-4-104\"></a><span class=\"w\">                </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-105\" name=\"__codelineno-4-105\" href=\"#__codelineno-4-105\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-106\" name=\"__codelineno-4-106\" href=\"#__codelineno-4-106\"></a>\n<a id=\"__codelineno-4-107\" name=\"__codelineno-4-107\" href=\"#__codelineno-4-107\"></a><span class=\"w\">            </span><span class=\"c1\">// \u628a seg \u63a7\u5236\u6570\u636e\u590d\u5236\u5230 buffer \u4e0a\uff0ckcp \u81ea\u5df1\u6765\u5904\u7406\u5927\u5c0f\u7aef\u95ee\u9898</span>\n<a id=\"__codelineno-4-108\" name=\"__codelineno-4-108\" href=\"#__codelineno-4-108\"></a><span class=\"w\">            </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_encode_seg</span><span class=\"p\">(</span><span class=\"n\">ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-109\" name=\"__codelineno-4-109\" href=\"#__codelineno-4-109\"></a>\n<a id=\"__codelineno-4-110\" name=\"__codelineno-4-110\" href=\"#__codelineno-4-110\"></a><span class=\"w\">            </span><span class=\"c1\">// \u518d\u590d\u5236\u6570\u636e</span>\n<a id=\"__codelineno-4-111\" name=\"__codelineno-4-111\" href=\"#__codelineno-4-111\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-112\" name=\"__codelineno-4-112\" href=\"#__codelineno-4-112\"></a><span class=\"w\">                </span><span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-113\" name=\"__codelineno-4-113\" href=\"#__codelineno-4-113\"></a><span class=\"w\">                </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-114\" name=\"__codelineno-4-114\" href=\"#__codelineno-4-114\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-115\" name=\"__codelineno-4-115\" href=\"#__codelineno-4-115\"></a>\n<a id=\"__codelineno-4-116\" name=\"__codelineno-4-116\" href=\"#__codelineno-4-116\"></a>\n<a id=\"__codelineno-4-117\" name=\"__codelineno-4-117\" href=\"#__codelineno-4-117\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">dead_link</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-118\" name=\"__codelineno-4-118\" href=\"#__codelineno-4-118\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">state</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IUINT32</span><span class=\"p\">)</span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-119\" name=\"__codelineno-4-119\" href=\"#__codelineno-4-119\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-120\" name=\"__codelineno-4-120\" href=\"#__codelineno-4-120\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-121\" name=\"__codelineno-4-121\" href=\"#__codelineno-4-121\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-122\" name=\"__codelineno-4-122\" href=\"#__codelineno-4-122\"></a>\n<a id=\"__codelineno-4-123\" name=\"__codelineno-4-123\" href=\"#__codelineno-4-123\"></a><span class=\"w\">    </span><span class=\"c1\">// flash remain segments</span>\n<a id=\"__codelineno-4-124\" name=\"__codelineno-4-124\" href=\"#__codelineno-4-124\"></a><span class=\"w\">    </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)(</span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-125\" name=\"__codelineno-4-125\" href=\"#__codelineno-4-125\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-126\" name=\"__codelineno-4-126\" href=\"#__codelineno-4-126\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_output</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-127\" name=\"__codelineno-4-127\" href=\"#__codelineno-4-127\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-128\" name=\"__codelineno-4-128\" href=\"#__codelineno-4-128\"></a>\n<a id=\"__codelineno-4-129\" name=\"__codelineno-4-129\" href=\"#__codelineno-4-129\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97 ssthresh\uff0c\u66f4\u65b0\u6162\u542f\u52a8\u7a97\u53e3</span>\n<a id=\"__codelineno-4-130\" name=\"__codelineno-4-130\" href=\"#__codelineno-4-130\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-4-131\" name=\"__codelineno-4-131\" href=\"#__codelineno-4-131\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>\u6211\u4eec\u76ee\u524d\u53ea\u5173\u6ce8 <code>ikcp_flush</code> \u91cc\u9762\u6709\u5173\u53d1\u9001\u6570\u636e\u7684\u903b\u8f91\uff1a</p>\n<ul>\n<li>\u9996\u5148 KCP \u4f1a\u6839\u636e\u5bf9\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u628a <code>snd_queue</code> \u4e0a\u7684\u6570\u636e\u79fb\u52a8\u5230 <code>snd_buf</code> \u4e0a\u9762\uff0c\u8ba1\u7b97\u79fb\u52a8\u6570\u91cf\u7684\u516c\u5f0f\u662f <code>num = snd_nxt - (snd_una + cwnd)</code>\uff0c\u4e5f\u5c31\u662f\uff1a\u5df2\u53d1\u9001\u6210\u529f\u7684\u6700\u5927\u5305\u5e8f\u53f7 <code>snd_una</code> \u52a0\u4e0a \u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f <code>cwnd</code> \u5927\u4e8e \u4e0b\u4e2a\u5f85\u53d1\u9001\u7684\u5305\u5e8f\u53f7<code>snd_nxt</code>\uff0c\u5219\u53ef\u4ee5\u7ee7\u7eed\u518d\u53d1\u9001\u65b0\u7684\u6570\u636e\u5305\u3002\u79fb\u52a8 <code>SEG</code> \u7684\u540c\u65f6\uff0c\u8bbe\u7f6e\u63a7\u5236\u5b57\u6bb5\u3002</li>\n</ul>\n<ul>\n<li>\u904d\u5386 <code>snd_buf</code>\uff0c\u5982\u679c\u9700\u8981\u53d1\u9001\u6570\u636e\u5305\uff0c\u5219\u628a\u6570\u636e\u590d\u5236\u5230 <code>buffer</code> \u4e0a\uff0c\u590d\u5236\u7684\u540c\u65f6\u7528 <code>ikcp_encode_seg</code> \u5904\u7406\u63a7\u5236\u5b57\u6bb5\u6570\u636e\u7684\u5927\u5c0f\u7aef\u95ee\u9898\u3002</li>\n</ul>\n<ul>\n<li>\u6700\u540e\u8c03\u7528 <code>ikcp_output</code> \u628a <code>buffer</code> \u4e0a\u7684\u6570\u636e\u53d1\u9001\u51fa\u53bb</li>\n</ul>\n<p>\u81f3\u6b64\uff0c KCP \u5b8c\u6210\u6570\u636e\u7684\u53d1\u9001\u3002</p>\n<h3 id=\"_2\">\u63a5\u6536</h3>\n<p>\u63a5\u6536\u7684\u8fc7\u7a0b\u662f\u8ddf\u53d1\u9001\u76f8\u53cd\u7684\uff1a<code>ikcp_input</code> -&gt; <code>ikcp_update</code> -&gt; <code>ikcp_recv</code>\uff0c\u7528\u6237\u63a5\u6536\u5230\u7f51\u7edc\u4e0a\u7684\u6570\u636e\u4e4b\u540e\uff0c\u9700\u8981\u8c03\u7528 <code>ikcp_input</code> \u4f20\u7ed9 KCP \u89e3\u6790\uff0c\u8c03\u7528 <code>ikcp_update</code> \u7684\u65f6\u5019\u4f1a\u7ed9\u53d1\u9001\u7aef\u56de\u590d ACK \u5305\uff0c\u4e0a\u5c42\u901a\u8fc7\u8c03\u7528 <code>ikcp_recv</code> \u6765\u63a5\u6536 KCP \u89e3\u6790\u4e4b\u540e\u7684\u6570\u636e\u3002</p>\n<details>\n<summary> \u63a5\u6536\u6570\u636e\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"c1\">// input data</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">ikcp_input</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">prev_una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">maxack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">latest_ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5408\u6cd5\u6027\u68c0\u67e5</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">IKCP_OVERHEAD</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a>\n<a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\">    </span><span class=\"c1\">// data \u53ef\u80fd\u662f\u591a\u4e2a KCP \u5305\uff0c\u5faa\u73af\u5904\u7406</span>\n<a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"w\">        </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">una</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a><span class=\"w\">        </span><span class=\"n\">IUINT16</span><span class=\"w\"> </span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a><span class=\"w\">        </span><span class=\"n\">IUINT8</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">frg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">seg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a>\n<a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a><span class=\"w\">        </span><span class=\"c1\">// \u4e0d\u591f\u4e00\u4e2a KCP \u5305\uff0c\u9000\u51fa</span>\n<a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">IKCP_OVERHEAD</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a>\n<a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5148\u628a\u63a7\u5236\u5b57\u6bb5\u89e3\u6790\u51fa\u6765</span>\n<a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\" href=\"#__codelineno-5-24\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">conv</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\" href=\"#__codelineno-5-25\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">conv</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\" href=\"#__codelineno-5-26\"></a>\n<a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\" href=\"#__codelineno-5-27\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode8u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">cmd</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\" href=\"#__codelineno-5-28\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode8u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">frg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\" href=\"#__codelineno-5-29\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode16u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wnd</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\" href=\"#__codelineno-5-30\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">ts</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\" href=\"#__codelineno-5-31\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">sn</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\" href=\"#__codelineno-5-32\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">una</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\" href=\"#__codelineno-5-33\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">len</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\" href=\"#__codelineno-5-34\"></a>\n<a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\" href=\"#__codelineno-5-35\"></a><span class=\"w\">        </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">IKCP_OVERHEAD</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-36\" name=\"__codelineno-5-36\" href=\"#__codelineno-5-36\"></a>\n<a id=\"__codelineno-5-37\" name=\"__codelineno-5-37\" href=\"#__codelineno-5-37\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"kt\">long</span><span class=\"p\">)</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">long</span><span class=\"p\">)</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-38\" name=\"__codelineno-5-38\" href=\"#__codelineno-5-38\"></a>\n<a id=\"__codelineno-5-39\" name=\"__codelineno-5-39\" href=\"#__codelineno-5-39\"></a><span class=\"w\">        </span><span class=\"c1\">// \u6570\u636e\u5305\u7c7b\u578b\u68c0\u67e5</span>\n<a id=\"__codelineno-5-40\" name=\"__codelineno-5-40\" href=\"#__codelineno-5-40\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_PUSH</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_ACK</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span>\n<a id=\"__codelineno-5-41\" name=\"__codelineno-5-41\" href=\"#__codelineno-5-41\"></a><span class=\"w\">            </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_WASK</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_WINS</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-5-42\" name=\"__codelineno-5-42\" href=\"#__codelineno-5-42\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-3</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-43\" name=\"__codelineno-5-43\" href=\"#__codelineno-5-43\"></a>\n<a id=\"__codelineno-5-44\" name=\"__codelineno-5-44\" href=\"#__codelineno-5-44\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-45\" name=\"__codelineno-5-45\" href=\"#__codelineno-5-45\"></a>\n<a id=\"__codelineno-5-46\" name=\"__codelineno-5-46\" href=\"#__codelineno-5-46\"></a><span class=\"w\">        </span><span class=\"c1\">// \u8fd9\u91cc\u7684 una \u662f\u53d1\u9001\u65b9\u7684 kcp-&gt;rcv_nxt\uff0c\u6839\u636e\u8fd9\u4e2a\u6570\u636e\uff0c\u53ef\u4ee5\u53bb\u6389\u5df2\u786e\u8ba4\u63a5\u6536\u7684\u6570\u636e\u5305</span>\n<a id=\"__codelineno-5-47\" name=\"__codelineno-5-47\" href=\"#__codelineno-5-47\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_parse_una</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">una</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-48\" name=\"__codelineno-5-48\" href=\"#__codelineno-5-48\"></a><span class=\"w\">        </span><span class=\"c1\">// \u53bb\u6389\u5df2\u786e\u8ba4\u63a5\u6536\u7684\u5305\u540e\uff0c\u66f4\u65b0 snd_una \u4e0b\u4e00\u4e2a\u8981\u53d1\u9001\u7684\u5e8f\u53f7</span>\n<a id=\"__codelineno-5-49\" name=\"__codelineno-5-49\" href=\"#__codelineno-5-49\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_shrink_buf</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-50\" name=\"__codelineno-5-50\" href=\"#__codelineno-5-50\"></a>\n<a id=\"__codelineno-5-51\" name=\"__codelineno-5-51\" href=\"#__codelineno-5-51\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_ACK</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-52\" name=\"__codelineno-5-52\" href=\"#__codelineno-5-52\"></a><span class=\"w\">            </span><span class=\"c1\">// ack \u5305</span>\n<a id=\"__codelineno-5-53\" name=\"__codelineno-5-53\" href=\"#__codelineno-5-53\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-5-54\" name=\"__codelineno-5-54\" href=\"#__codelineno-5-54\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-55\" name=\"__codelineno-5-55\" href=\"#__codelineno-5-55\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_PUSH</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-56\" name=\"__codelineno-5-56\" href=\"#__codelineno-5-56\"></a><span class=\"w\">            </span><span class=\"c1\">// \u6570\u636e\u5305</span>\n<a id=\"__codelineno-5-57\" name=\"__codelineno-5-57\" href=\"#__codelineno-5-57\"></a><span class=\"w\">            </span><span class=\"c1\">// \u5982\u679c\u63a5\u6536\u5230\u7684\u6570\u636e\u5305\u5e8f\u53f7 sn\uff0c\u5728\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u5219\u6b63\u5e38\u5904\u7406\uff0c\u5426\u5219\u76f4\u63a5\u4e22\u5f03\uff0c\u7b49\u91cd\u4f20</span>\n<a id=\"__codelineno-5-58\" name=\"__codelineno-5-58\" href=\"#__codelineno-5-58\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-59\" name=\"__codelineno-5-59\" href=\"#__codelineno-5-59\"></a>\n<a id=\"__codelineno-5-60\" name=\"__codelineno-5-60\" href=\"#__codelineno-5-60\"></a><span class=\"w\">                </span><span class=\"c1\">// \u63a5\u6536\u5230\u7684\u6bcf\u4e2a\u6570\u636e\u5305\uff0c\u90fd\u8981\u56de\u4e00\u4e2a ack \u5305\uff0c\u8bb0\u5f55\u4e0b\u6765</span>\n<a id=\"__codelineno-5-61\" name=\"__codelineno-5-61\" href=\"#__codelineno-5-61\"></a><span class=\"w\">                </span><span class=\"n\">ikcp_ack_push</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-62\" name=\"__codelineno-5-62\" href=\"#__codelineno-5-62\"></a>\n<a id=\"__codelineno-5-63\" name=\"__codelineno-5-63\" href=\"#__codelineno-5-63\"></a><span class=\"w\">                </span><span class=\"c1\">// \u63a5\u6536\u7684\u6570\u636e\u8c03\u7528 ikcp_parse_data \u5904\u7406</span>\n<a id=\"__codelineno-5-64\" name=\"__codelineno-5-64\" href=\"#__codelineno-5-64\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-65\" name=\"__codelineno-5-65\" href=\"#__codelineno-5-65\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_segment_new</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-66\" name=\"__codelineno-5-66\" href=\"#__codelineno-5-66\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-67\" name=\"__codelineno-5-67\" href=\"#__codelineno-5-67\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-68\" name=\"__codelineno-5-68\" href=\"#__codelineno-5-68\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">frg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">frg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-69\" name=\"__codelineno-5-69\" href=\"#__codelineno-5-69\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-70\" name=\"__codelineno-5-70\" href=\"#__codelineno-5-70\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-71\" name=\"__codelineno-5-71\" href=\"#__codelineno-5-71\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-72\" name=\"__codelineno-5-72\" href=\"#__codelineno-5-72\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">una</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-73\" name=\"__codelineno-5-73\" href=\"#__codelineno-5-73\"></a><span class=\"w\">                    </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-74\" name=\"__codelineno-5-74\" href=\"#__codelineno-5-74\"></a>\n<a id=\"__codelineno-5-75\" name=\"__codelineno-5-75\" href=\"#__codelineno-5-75\"></a><span class=\"w\">                    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-76\" name=\"__codelineno-5-76\" href=\"#__codelineno-5-76\"></a><span class=\"w\">                        </span><span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-77\" name=\"__codelineno-5-77\" href=\"#__codelineno-5-77\"></a><span class=\"w\">                    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-78\" name=\"__codelineno-5-78\" href=\"#__codelineno-5-78\"></a>\n<a id=\"__codelineno-5-79\" name=\"__codelineno-5-79\" href=\"#__codelineno-5-79\"></a><span class=\"w\">                    </span><span class=\"n\">ikcp_parse_data</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-80\" name=\"__codelineno-5-80\" href=\"#__codelineno-5-80\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-81\" name=\"__codelineno-5-81\" href=\"#__codelineno-5-81\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-82\" name=\"__codelineno-5-82\" href=\"#__codelineno-5-82\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-83\" name=\"__codelineno-5-83\" href=\"#__codelineno-5-83\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_WASK</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-84\" name=\"__codelineno-5-84\" href=\"#__codelineno-5-84\"></a><span class=\"w\">            </span><span class=\"c1\">// \u67e5\u8be2\u7a97\u53e3\u5305</span>\n<a id=\"__codelineno-5-85\" name=\"__codelineno-5-85\" href=\"#__codelineno-5-85\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-5-86\" name=\"__codelineno-5-86\" href=\"#__codelineno-5-86\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-87\" name=\"__codelineno-5-87\" href=\"#__codelineno-5-87\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_WINS</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-88\" name=\"__codelineno-5-88\" href=\"#__codelineno-5-88\"></a><span class=\"w\">            </span><span class=\"c1\">// \u67e5\u8be2\u7a97\u53e3\u7684\u56de\u590d\u5305</span>\n<a id=\"__codelineno-5-89\" name=\"__codelineno-5-89\" href=\"#__codelineno-5-89\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-5-90\" name=\"__codelineno-5-90\" href=\"#__codelineno-5-90\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-91\" name=\"__codelineno-5-91\" href=\"#__codelineno-5-91\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-92\" name=\"__codelineno-5-92\" href=\"#__codelineno-5-92\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-3</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-93\" name=\"__codelineno-5-93\" href=\"#__codelineno-5-93\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-94\" name=\"__codelineno-5-94\" href=\"#__codelineno-5-94\"></a>\n<a id=\"__codelineno-5-95\" name=\"__codelineno-5-95\" href=\"#__codelineno-5-95\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-96\" name=\"__codelineno-5-96\" href=\"#__codelineno-5-96\"></a><span class=\"w\">        </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-97\" name=\"__codelineno-5-97\" href=\"#__codelineno-5-97\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-98\" name=\"__codelineno-5-98\" href=\"#__codelineno-5-98\"></a>\n<a id=\"__codelineno-5-99\" name=\"__codelineno-5-99\" href=\"#__codelineno-5-99\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5904\u7406\u5feb\u901f\u91cd\u4f20\u903b\u8f91</span>\n<a id=\"__codelineno-5-100\" name=\"__codelineno-5-100\" href=\"#__codelineno-5-100\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-5-101\" name=\"__codelineno-5-101\" href=\"#__codelineno-5-101\"></a>\n<a id=\"__codelineno-5-102\" name=\"__codelineno-5-102\" href=\"#__codelineno-5-102\"></a><span class=\"w\">    </span><span class=\"c1\">// \u66f4\u65b0\u53d1\u9001\u7a97\u53e3</span>\n<a id=\"__codelineno-5-103\" name=\"__codelineno-5-103\" href=\"#__codelineno-5-103\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-5-104\" name=\"__codelineno-5-104\" href=\"#__codelineno-5-104\"></a>\n<a id=\"__codelineno-5-105\" name=\"__codelineno-5-105\" href=\"#__codelineno-5-105\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-106\" name=\"__codelineno-5-106\" href=\"#__codelineno-5-106\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p><code>ikcp_input</code> \u5faa\u73af\u5904\u7406\u6bcf\u4e00\u4e2a <code>SEG</code> \u5305\uff0c\u5148\u68c0\u67e5\u6570\u636e\u5305\u7684\u5408\u6cd5\u6027\u548c\u7c7b\u578b\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u6570\u636e\u5305\u90fd\u4f1a\u5e26\u4e0a <code>una</code>\uff0c\u5b58\u653e\u7684\u662f\u53d1\u9001\u7aef\u7b49\u5f85\u63a5\u6536\u7684\u5305\u5e8f\u53f7\uff0c\u9700\u8981\u5c0f\u4e8e <code>una</code> \u7684\u5305\u5bf9\u7aef\u90fd\u5df2\u7ecf\u63a5\u53d7\u6210\u529f\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a <code>snd_buff</code> \u4e2d\u9700\u8981\u5c0f\u4e8e <code>una</code> \u7684\u90fd\u5220\u6389\uff0c\u5e76\u66f4\u65b0 <code>snd_nxt</code>\uff0c\u8fd9\u4e00\u90e8\u5206\u7531 <code>ikcp_parse_una</code> \u548c <code>ikcp_shrink_buf</code> \u6765\u5904\u7406\u3002\u63a5\u6536\u5230\u7684\u6bcf\u4e2a\u6570\u636e\u5305\uff0c\u90fd\u9700\u8981\u56de\u590d ACK \u5305\uff0c\u7531 <code>ikcp_ack_push</code> \u8bb0\u5f55\u4e0b\u6765\uff0c\u6700\u540e\u8c03\u7528 <code>ikcp_parse_data</code> \u5904\u7406\u6570\u636e\u3002</p>\n<details>\n<summary> \u89e3\u6790\u6570\u636e\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_parse_data</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">newseg</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">prev</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5e8f\u53f7\u68c0\u67e5</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">||</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">        </span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_segment_delete</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">newseg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"w\">    </span><span class=\"c1\">// \u627e\u51fa newseg \u5e94\u8be5\u653e\u7f6e\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u63a5\u6536\u5230\u7684 seg \u53ef\u80fd\u662f\u4e71\u5e8f\u7684</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">.</span><span class=\"n\">prev</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">prev</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"w\">        </span><span class=\"n\">prev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">            </span><span class=\"c1\">// \u91cd\u590d\u6536\u5230</span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">            </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a>\n<a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a><span class=\"w\">    </span><span class=\"c1\">// \u628a newseg \u653e\u5230 rcv_buf \u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a</span>\n<a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-30\" name=\"__codelineno-6-30\" href=\"#__codelineno-6-30\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_init</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-31\" name=\"__codelineno-6-31\" href=\"#__codelineno-6-31\"></a><span class=\"w\">        </span><span class=\"n\">iqueue_add</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">newseg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-32\" name=\"__codelineno-6-32\" href=\"#__codelineno-6-32\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_buf</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-33\" name=\"__codelineno-6-33\" href=\"#__codelineno-6-33\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-34\" name=\"__codelineno-6-34\" href=\"#__codelineno-6-34\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_segment_delete</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">newseg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-35\" name=\"__codelineno-6-35\" href=\"#__codelineno-6-35\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-36\" name=\"__codelineno-6-36\" href=\"#__codelineno-6-36\"></a>\n<a id=\"__codelineno-6-37\" name=\"__codelineno-6-37\" href=\"#__codelineno-6-37\"></a><span class=\"w\">    </span><span class=\"c1\">// \u628a\u6570\u636e\u4ece rcv_buf \u79fb\u52a8\u5230 rcv_queue</span>\n<a id=\"__codelineno-6-38\" name=\"__codelineno-6-38\" href=\"#__codelineno-6-38\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">iqueue_is_empty</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-39\" name=\"__codelineno-6-39\" href=\"#__codelineno-6-39\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-40\" name=\"__codelineno-6-40\" href=\"#__codelineno-6-40\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5982\u679c seg \u5e8f\u53f7\u662f\u7b49\u5f85\u63a5\u6536\u7684\u5e8f\u53f7\uff0c\u79fb\u52a8\u5230 rcv_queue</span>\n<a id=\"__codelineno-6-41\" name=\"__codelineno-6-41\" href=\"#__codelineno-6-41\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-42\" name=\"__codelineno-6-42\" href=\"#__codelineno-6-42\"></a><span class=\"w\">            </span><span class=\"n\">iqueue_del</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-43\" name=\"__codelineno-6-43\" href=\"#__codelineno-6-43\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_buf</span><span class=\"o\">--</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-44\" name=\"__codelineno-6-44\" href=\"#__codelineno-6-44\"></a><span class=\"w\">            </span><span class=\"n\">iqueue_add_tail</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_queue</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-45\" name=\"__codelineno-6-45\" href=\"#__codelineno-6-45\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-46\" name=\"__codelineno-6-46\" href=\"#__codelineno-6-46\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-47\" name=\"__codelineno-6-47\" href=\"#__codelineno-6-47\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-48\" name=\"__codelineno-6-48\" href=\"#__codelineno-6-48\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-49\" name=\"__codelineno-6-49\" href=\"#__codelineno-6-49\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-50\" name=\"__codelineno-6-50\" href=\"#__codelineno-6-50\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-51\" name=\"__codelineno-6-51\" href=\"#__codelineno-6-51\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p><code>ikcp_parse_data</code> \u4e3b\u8981\u7684\u5de5\u4f5c\u5c31\u662f\u628a <code>newseg</code> \u653e\u7f6e\u5230 <code>kcp-&gt;rcv_buf</code> \u5408\u9002\u7684\u4f4d\u7f6e\u4e0a\uff0c\u5e76\u628a\u6570\u636e\u4ece <code>rcv_buf</code> \u79fb\u52a8\u5230 <code>rcv_queue</code>\u3002<code>rcv_buf</code> \u5408\u9002\u7684\u4f4d\u7f6e\u7684\u610f\u601d\u662f\uff0c<code>rcv_buf</code> \u662f\u6309\u7167 <code>sn</code> \u7684\u9012\u589e\u987a\u5e8f\u6392\u5217\u7684\uff0c<code>newseg</code> \u9700\u8981\u6839\u636e\u81ea\u5df1\u7684 <code>sn</code> \u5927\u5c0f\u67e5\u627e\u5408\u9002\u7684\u4f4d\u7f6e\u3002<code>rcv_buf</code> \u4e0a\u7684\u6570\u636e\u8981\u79fb\u52a8\u5230 <code>rcv_queue</code>\uff0c\u6761\u4ef6\u662f <code>rcv_buf</code> \u4e0a\u7684\u6570\u636e\u5305\u5e8f\u53f7\uff0c\u7b49\u4e8e KCP \u5728\u7b49\u5f85\u63a5\u6536\u7684\u5305\u5e8f\u53f7 <code>kcp-&gt;rcv_nxt</code> \uff0c\u79fb\u52a8\u4e00\u4e2a\u6570\u636e\u5305\u4e4b\u540e\uff0c\u9700\u8981\u66f4\u65b0 <code>kcp-&gt;rvc_nxt</code>\uff0c\u518d\u5904\u7406\u4e0b\u4e00\u4e2a\u6570\u636e\u5305\u3002</p>\n<p><code>ikcp_input</code> \u4e4b\u540e\uff0c\u4e0a\u5c42\u8c03\u7528 <code>ikcp_update</code> \u65f6\u5019\u4f1a\u53d1\u9001 ACK \u5305\uff0c\u8c03\u7528 <code>ikcp_recv</code> \u4f1a\u7ed9\u4e0a\u5c42\u8fd4\u56de\u6709\u6548\u6570\u636e\u3002<code>ikcp_update</code> \u548c <code>ikcp_recv</code> \u4e92\u76f8\u72ec\u7acb\uff0c\u6ca1\u6709\u8c03\u7528\u987a\u5e8f\u8981\u6c42\uff0c\u89c6\u4e0a\u5c42\u7684\u8c03\u7528\u65f6\u673a\u800c\u5b9a\u3002\u6211\u4eec\u5148\u6765\u770b <code>ikcp_update</code> \u91cc\u9762\u6709\u5173 ACK \u53d1\u9001\u7684\u90e8\u5206\uff1a</p>\n<details>\n<summary> \u56de\u590d ACK\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\">// \u524d\u9762\u8bf4\u8fc7\uff0cikcp_update \u6700\u7ec8\u662f\u8c03\u7528 ikcp_flush</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">    </span><span class=\"c1\">// \u56de\u590d ACK \u5305</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">    </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ackcount</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">        </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)(</span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">IKCP_OVERHEAD</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mtu</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">            </span><span class=\"n\">ikcp_output</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">            </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buffer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_ack_get</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"p\">.</span><span class=\"n\">ts</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">        </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_encode_seg</span><span class=\"p\">(</span><span class=\"n\">ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a>\n<a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ackcount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a>\n<a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>ACK \u5305\u7684\u4e4b\u524d\u5df2\u7ecf\u7531 <code>ikcp_ack_push</code> \u4fdd\u5b58\u8d77\u6765\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u9700\u8981 <code>ikcp_ack_get</code> \u83b7\u53d6\u6bcf\u4e2a ACK \u5305\u7684\u4fe1\u606f\uff0c\u53d1\u9001\u7ed9\u5bf9\u65b9\u3002\u4e0a\u5c42\u53ef\u4ee5\u4f7f\u7528 <code>ikcp_recv</code> \u4ece KCP \u83b7\u53d6\u6570\u636e\uff1a</p>\n<details>\n<summary> ikcp_recv\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"c1\">// user/upper level recv: returns size, returns below zero for EAGAIN</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"c1\">//---------------------------------------------------------------------</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">ikcp_recv</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">IQUEUEHEAD</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">ispeek</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">peeksize</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">recover</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"w\">    </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">seg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4e00\u4e9b\u6709\u6548\u6027\u68c0\u67e5</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">iqueue_is_empty</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_queue</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a>\n<a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97\u80fd\u8fd4\u56de\u7684\u6570\u636e\u957f\u5ea6</span>\n<a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">    </span><span class=\"n\">peeksize</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_peeksize</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a>\n<a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">peeksize</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">peeksize</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-24\" name=\"__codelineno-8-24\" href=\"#__codelineno-8-24\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">-3</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-25\" name=\"__codelineno-8-25\" href=\"#__codelineno-8-25\"></a>\n<a id=\"__codelineno-8-26\" name=\"__codelineno-8-26\" href=\"#__codelineno-8-26\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5224\u65ad\u4e0b\u63a5\u6536\u7a97\u53e3</span>\n<a id=\"__codelineno-8-27\" name=\"__codelineno-8-27\" href=\"#__codelineno-8-27\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-28\" name=\"__codelineno-8-28\" href=\"#__codelineno-8-28\"></a><span class=\"w\">        </span><span class=\"n\">recover</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-29\" name=\"__codelineno-8-29\" href=\"#__codelineno-8-29\"></a>\n<a id=\"__codelineno-8-30\" name=\"__codelineno-8-30\" href=\"#__codelineno-8-30\"></a><span class=\"w\">    </span><span class=\"c1\">// \u904d\u5386 rcv_queue\uff0c\u628a\u6570\u636e\u590d\u5236\u5230 buffer \u4e0a</span>\n<a id=\"__codelineno-8-31\" name=\"__codelineno-8-31\" href=\"#__codelineno-8-31\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_queue</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_queue</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-32\" name=\"__codelineno-8-32\" href=\"#__codelineno-8-32\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">fragment</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-33\" name=\"__codelineno-8-33\" href=\"#__codelineno-8-33\"></a><span class=\"w\">        </span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-34\" name=\"__codelineno-8-34\" href=\"#__codelineno-8-34\"></a><span class=\"w\">        </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-35\" name=\"__codelineno-8-35\" href=\"#__codelineno-8-35\"></a>\n<a id=\"__codelineno-8-36\" name=\"__codelineno-8-36\" href=\"#__codelineno-8-36\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">buffer</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-37\" name=\"__codelineno-8-37\" href=\"#__codelineno-8-37\"></a><span class=\"w\">            </span><span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">buffer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-38\" name=\"__codelineno-8-38\" href=\"#__codelineno-8-38\"></a><span class=\"w\">            </span><span class=\"n\">buffer</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-39\" name=\"__codelineno-8-39\" href=\"#__codelineno-8-39\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-40\" name=\"__codelineno-8-40\" href=\"#__codelineno-8-40\"></a>\n<a id=\"__codelineno-8-41\" name=\"__codelineno-8-41\" href=\"#__codelineno-8-41\"></a><span class=\"w\">        </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-42\" name=\"__codelineno-8-42\" href=\"#__codelineno-8-42\"></a>\n<a id=\"__codelineno-8-43\" name=\"__codelineno-8-43\" href=\"#__codelineno-8-43\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5224\u65ad\u5206\u5305</span>\n<a id=\"__codelineno-8-44\" name=\"__codelineno-8-44\" href=\"#__codelineno-8-44\"></a><span class=\"w\">        </span><span class=\"n\">fragment</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">frg</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-45\" name=\"__codelineno-8-45\" href=\"#__codelineno-8-45\"></a>\n<a id=\"__codelineno-8-46\" name=\"__codelineno-8-46\" href=\"#__codelineno-8-46\"></a><span class=\"w\">        </span><span class=\"c1\">// \u79fb\u9664\u6570\u636e\u5305</span>\n<a id=\"__codelineno-8-47\" name=\"__codelineno-8-47\" href=\"#__codelineno-8-47\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">ispeek</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-48\" name=\"__codelineno-8-48\" href=\"#__codelineno-8-48\"></a><span class=\"w\">            </span><span class=\"n\">iqueue_del</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-49\" name=\"__codelineno-8-49\" href=\"#__codelineno-8-49\"></a><span class=\"w\">            </span><span class=\"n\">ikcp_segment_delete</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seg</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-50\" name=\"__codelineno-8-50\" href=\"#__codelineno-8-50\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"o\">--</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-51\" name=\"__codelineno-8-51\" href=\"#__codelineno-8-51\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-52\" name=\"__codelineno-8-52\" href=\"#__codelineno-8-52\"></a>\n<a id=\"__codelineno-8-53\" name=\"__codelineno-8-53\" href=\"#__codelineno-8-53\"></a><span class=\"w\">        </span><span class=\"c1\">// \u6240\u6709\u5206\u5305\u90fd\u590d\u5236\u5b8c\uff0c\u9000\u51fa\u5faa\u73af</span>\n<a id=\"__codelineno-8-54\" name=\"__codelineno-8-54\" href=\"#__codelineno-8-54\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fragment</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-55\" name=\"__codelineno-8-55\" href=\"#__codelineno-8-55\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-56\" name=\"__codelineno-8-56\" href=\"#__codelineno-8-56\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-57\" name=\"__codelineno-8-57\" href=\"#__codelineno-8-57\"></a>\n<a id=\"__codelineno-8-58\" name=\"__codelineno-8-58\" href=\"#__codelineno-8-58\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">peeksize</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-59\" name=\"__codelineno-8-59\" href=\"#__codelineno-8-59\"></a>\n<a id=\"__codelineno-8-60\" name=\"__codelineno-8-60\" href=\"#__codelineno-8-60\"></a><span class=\"w\">    </span><span class=\"c1\">// rcv_queue \u53c8\u7a7a\u4e86\u4e00\u4e9b\uff0c\u5c1d\u8bd5\u7ee7\u7eed\u4ece rcv_buf \u79fb\u52a8\u5230 rcv_queue</span>\n<a id=\"__codelineno-8-61\" name=\"__codelineno-8-61\" href=\"#__codelineno-8-61\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">iqueue_is_empty</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-62\" name=\"__codelineno-8-62\" href=\"#__codelineno-8-62\"></a><span class=\"w\">        </span><span class=\"n\">seg</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_buf</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-63\" name=\"__codelineno-8-63\" href=\"#__codelineno-8-63\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">sn</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-64\" name=\"__codelineno-8-64\" href=\"#__codelineno-8-64\"></a><span class=\"w\">            </span><span class=\"n\">iqueue_del</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-65\" name=\"__codelineno-8-65\" href=\"#__codelineno-8-65\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_buf</span><span class=\"o\">--</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-66\" name=\"__codelineno-8-66\" href=\"#__codelineno-8-66\"></a><span class=\"w\">            </span><span class=\"n\">iqueue_add_tail</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">seg</span><span class=\"o\">-&gt;</span><span class=\"n\">node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_queue</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-67\" name=\"__codelineno-8-67\" href=\"#__codelineno-8-67\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nrcv_que</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-68\" name=\"__codelineno-8-68\" href=\"#__codelineno-8-68\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_nxt</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-69\" name=\"__codelineno-8-69\" href=\"#__codelineno-8-69\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-70\" name=\"__codelineno-8-70\" href=\"#__codelineno-8-70\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-71\" name=\"__codelineno-8-71\" href=\"#__codelineno-8-71\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-72\" name=\"__codelineno-8-72\" href=\"#__codelineno-8-72\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-73\" name=\"__codelineno-8-73\" href=\"#__codelineno-8-73\"></a>\n<a id=\"__codelineno-8-74\" name=\"__codelineno-8-74\" href=\"#__codelineno-8-74\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-75\" name=\"__codelineno-8-75\" href=\"#__codelineno-8-75\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p><code>ikcp_recv</code> \u4e00\u6b21\u8c03\u7528\u53ea\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u5305\uff0c\u4e0a\u5c42\u53ef\u4ee5\u5faa\u73af\u8c03\u7528\u76f4\u5230\u6ca1\u6709\u6570\u636e\u8fd4\u56de\u4e3a\u6b62\uff0c\u51fd\u6570\u7684\u903b\u8f91\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u4ece <code>rcv_queue</code> \u4e2d\u590d\u5236\u6570\u636e\u5230\u4e0a\u5c42\u4f20\u8fdb\u6765\u7684 <code>buffer</code> \u91cc\u9762\uff0c\u81f3\u6b64\u63a5\u6536\u65b9\u5bf9\u4e8e\u63a5\u6536\u5230\u7684\u6570\u636e\u5305\u5df2\u7ecf\u5904\u7406\u5b8c\u6bd5\u3002</p>\n<p>\u63a5\u6536\u65b9\u5904\u7406\u6570\u636e\u5305\u7684\u65f6\u5019\uff0c\u7ed9\u53d1\u9001\u65b9\u53d1\u9001\u4e86 ACK \u5305\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u53d1\u9001\u65b9\u63a5\u53d7 ACK \u5305\u7684\u5904\u7406\uff1a</p>\n<details>\n<summary> \u5904\u7406 ACK \u5305\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">ikcp_input</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">)</span>\n<a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">maxack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">latest_ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"w\">        </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"w\">        </span><span class=\"c1\">// ts \u662f\u5bf9\u7aef\u7684 kcp-&gt; current</span>\n<a id=\"__codelineno-9-9\" name=\"__codelineno-9-9\" href=\"#__codelineno-9-9\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">ts</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-10\" name=\"__codelineno-9-10\" href=\"#__codelineno-9-10\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode32u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">sn</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-11\" name=\"__codelineno-9-11\" href=\"#__codelineno-9-11\"></a>\n<a id=\"__codelineno-9-12\" name=\"__codelineno-9-12\" href=\"#__codelineno-9-12\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">IKCP_CMD_ACK</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-13\" name=\"__codelineno-9-13\" href=\"#__codelineno-9-13\"></a><span class=\"w\">            </span><span class=\"c1\">// \u66f4\u65b0 rot</span>\n<a id=\"__codelineno-9-14\" name=\"__codelineno-9-14\" href=\"#__codelineno-9-14\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-15\" name=\"__codelineno-9-15\" href=\"#__codelineno-9-15\"></a><span class=\"w\">                </span><span class=\"n\">ikcp_update_ack</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">));</span>\n<a id=\"__codelineno-9-16\" name=\"__codelineno-9-16\" href=\"#__codelineno-9-16\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-17\" name=\"__codelineno-9-17\" href=\"#__codelineno-9-17\"></a><span class=\"w\">            </span><span class=\"c1\">// \u66f4\u65b0 snd_buf</span>\n<a id=\"__codelineno-9-18\" name=\"__codelineno-9-18\" href=\"#__codelineno-9-18\"></a><span class=\"w\">            </span><span class=\"n\">ikcp_parse_ack</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-19\" name=\"__codelineno-9-19\" href=\"#__codelineno-9-19\"></a><span class=\"w\">            </span><span class=\"n\">ikcp_shrink_buf</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-20\" name=\"__codelineno-9-20\" href=\"#__codelineno-9-20\"></a>\n<a id=\"__codelineno-9-21\" name=\"__codelineno-9-21\" href=\"#__codelineno-9-21\"></a><span class=\"w\">            </span><span class=\"c1\">// maxack = \u8fd9\u6b21 input \u7684\u6240\u6709 ACK \u5305\u4e2d\u6700\u5927\u7684 sn</span>\n<a id=\"__codelineno-9-22\" name=\"__codelineno-9-22\" href=\"#__codelineno-9-22\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-23\" name=\"__codelineno-9-23\" href=\"#__codelineno-9-23\"></a><span class=\"w\">                </span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-24\" name=\"__codelineno-9-24\" href=\"#__codelineno-9-24\"></a><span class=\"w\">                </span><span class=\"n\">maxack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-25\" name=\"__codelineno-9-25\" href=\"#__codelineno-9-25\"></a><span class=\"w\">                </span><span class=\"n\">latest_ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-26\" name=\"__codelineno-9-26\" href=\"#__codelineno-9-26\"></a><span class=\"w\">            </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-27\" name=\"__codelineno-9-27\" href=\"#__codelineno-9-27\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">sn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">maxack</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-28\" name=\"__codelineno-9-28\" href=\"#__codelineno-9-28\"></a><span class=\"w\">                </span><span class=\"cp\">#ifndef IKCP_FASTACK_CONSERVE</span>\n<a id=\"__codelineno-9-29\" name=\"__codelineno-9-29\" href=\"#__codelineno-9-29\"></a><span class=\"w\">                    </span><span class=\"n\">maxack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-30\" name=\"__codelineno-9-30\" href=\"#__codelineno-9-30\"></a><span class=\"w\">                    </span><span class=\"n\">latest_ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-31\" name=\"__codelineno-9-31\" href=\"#__codelineno-9-31\"></a><span class=\"w\">                </span><span class=\"cp\">#else</span>\n<a id=\"__codelineno-9-32\" name=\"__codelineno-9-32\" href=\"#__codelineno-9-32\"></a><span class=\"w\">                    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">latest_ts</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-33\" name=\"__codelineno-9-33\" href=\"#__codelineno-9-33\"></a><span class=\"w\">                        </span><span class=\"n\">maxack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sn</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-34\" name=\"__codelineno-9-34\" href=\"#__codelineno-9-34\"></a><span class=\"w\">                        </span><span class=\"n\">latest_ts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-35\" name=\"__codelineno-9-35\" href=\"#__codelineno-9-35\"></a><span class=\"w\">                    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-36\" name=\"__codelineno-9-36\" href=\"#__codelineno-9-36\"></a><span class=\"w\">                </span><span class=\"cp\">#endif</span>\n<a id=\"__codelineno-9-37\" name=\"__codelineno-9-37\" href=\"#__codelineno-9-37\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-38\" name=\"__codelineno-9-38\" href=\"#__codelineno-9-38\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-39\" name=\"__codelineno-9-39\" href=\"#__codelineno-9-39\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-40\" name=\"__codelineno-9-40\" href=\"#__codelineno-9-40\"></a><span class=\"w\">        </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-9-41\" name=\"__codelineno-9-41\" href=\"#__codelineno-9-41\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-42\" name=\"__codelineno-9-42\" href=\"#__codelineno-9-42\"></a>\n<a id=\"__codelineno-9-43\" name=\"__codelineno-9-43\" href=\"#__codelineno-9-43\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5982\u679c\u6709\u6536\u5230 ACK \u5305\uff0c\u8bb0\u5f55\u7528\u6765\u505a\u5feb\u901f\u91cd\u4f20</span>\n<a id=\"__codelineno-9-44\" name=\"__codelineno-9-44\" href=\"#__codelineno-9-44\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-45\" name=\"__codelineno-9-45\" href=\"#__codelineno-9-45\"></a><span class=\"w\">        </span><span class=\"n\">ikcp_parse_fastack</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">maxack</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">latest_ts</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-46\" name=\"__codelineno-9-46\" href=\"#__codelineno-9-46\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-47\" name=\"__codelineno-9-47\" href=\"#__codelineno-9-47\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>\u53ef\u4ee5\u770b\u5230\u63a5\u6536\u5230 ACK \u5305\u540e\u540c\u6837\u4f1a\u9700\u8981 <code>ikcp_parse_ack</code> \u548c <code>ikcp_shrink_buf</code> \u6765\u66f4\u65b0 <code>snd_buf</code>\uff0c\u53e6\u5916\u8fd8\u9700\u8981\u8c03\u7528 <code>ikcp_update_ack</code> \u6765\u8ba1\u7b97\u66f4\u65b0 rto \uff08retransmission timeout\uff0c\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\uff09\u3002<code>ikcp_input</code> \u8ba1\u7b97\u6536\u5230\u7684 ACK \u5305\u4e2d\u6700\u5927\u5e8f\u53f7\uff0c\u6765\u8bb0\u5f55\u505a\u5feb\u901f\u91cd\u4f20\u7528\u3002\u5c31\u8fd9\u6837\uff0c\u53d1\u9001\u65b9\u6536\u5230 ACK \u5305\uff0c\u628a\u53d1\u9001\u6570\u636e\u4ece <code>snd_buf</code> \u4e2d\u79fb\u9664\uff0c\u8be5\u6570\u636e\u5305\u53ef\u9760\u5730\u9001\u8fbe\u5230\u4e86\u63a5\u6536\u65b9\uff0c\u4e00\u6b21\u5b8c\u6574\u7684 ARQ \u786e\u8ba4\u63a5\u6536\u8fc7\u7a0b\u7ed3\u675f\u3002</p>\n<h3 id=\"_3\">\u8d85\u65f6\u91cd\u4f20</h3>\n<p>\u524d\u9762\u4ecb\u7ecd\u7684\u662f KCP \u5b9e\u73b0\u7684 ARQ \u4e2d\u7684 \u786e\u8ba4\u63a5\u6536\u673a\u5236\uff0cARQ \u8fd8\u9700\u8981\u4e00\u4e2a\u8d85\u65f6\u91cd\u4f20\u6765\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b KCP \u662f\u600e\u4e48\u505a\u8d85\u65f6\u91cd\u4f20\u7684\u3002</p>\n<p>\u8ba9\u6211\u4eec\u56de\u5230 <code>ikcp_flush</code> \u51fd\u6570\uff1a</p>\n<details>\n<summary> \u8d85\u65f6\u91cd\u4f20\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">)</span>\n<a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001 snd_buf</span>\n<a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">            </span><span class=\"c1\">// \u9996\u6b21\u53d1\u9001</span>\n<a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"w\">            </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a><span class=\"w\">            </span><span class=\"c1\">// \u8bbe\u7f6e segment-&gt;rto</span>\n<a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">            </span><span class=\"c1\">// \u901a\u8fc7 segment-&gt;rto \u8ba1\u7b97 segment-&gt;resendts \u8d85\u65f6\u91cd\u4f20\u65f6\u95f4</span>\n<a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rx_rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">rtomin</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">            </span><span class=\"c1\">// \u8d85\u65f6\u91cd\u4f20</span>\n<a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"w\">            </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\" href=\"#__codelineno-10-22\"></a><span class=\"w\">            </span><span class=\"c1\">// nodelay \u63a7\u5236\u4e0b\u4e00\u6b21\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\u7684\u8ba1\u7b97</span>\n<a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\" href=\"#__codelineno-10-23\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nodelay</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\" href=\"#__codelineno-10-24\"></a><span class=\"w\">                </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rx_rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-25\" name=\"__codelineno-10-25\" href=\"#__codelineno-10-25\"></a><span class=\"w\">            </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-26\" name=\"__codelineno-10-26\" href=\"#__codelineno-10-26\"></a><span class=\"w\">                </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rx_rto</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-27\" name=\"__codelineno-10-27\" href=\"#__codelineno-10-27\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-28\" name=\"__codelineno-10-28\" href=\"#__codelineno-10-28\"></a><span class=\"w\">            </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-29\" name=\"__codelineno-10-29\" href=\"#__codelineno-10-29\"></a><span class=\"w\">            </span><span class=\"n\">lost</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-30\" name=\"__codelineno-10-30\" href=\"#__codelineno-10-30\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-31\" name=\"__codelineno-10-31\" href=\"#__codelineno-10-31\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">fastack</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">resent</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-32\" name=\"__codelineno-10-32\" href=\"#__codelineno-10-32\"></a><span class=\"w\">            </span><span class=\"c1\">// \u5feb\u901f\u91cd\u4f20</span>\n<a id=\"__codelineno-10-33\" name=\"__codelineno-10-33\" href=\"#__codelineno-10-33\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-10-34\" name=\"__codelineno-10-34\" href=\"#__codelineno-10-34\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-35\" name=\"__codelineno-10-35\" href=\"#__codelineno-10-35\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">needsend</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-36\" name=\"__codelineno-10-36\" href=\"#__codelineno-10-36\"></a><span class=\"w\">            </span><span class=\"c1\">// \u53d1\u9001\u6570\u636e</span>\n<a id=\"__codelineno-10-37\" name=\"__codelineno-10-37\" href=\"#__codelineno-10-37\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-10-38\" name=\"__codelineno-10-38\" href=\"#__codelineno-10-38\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-39\" name=\"__codelineno-10-39\" href=\"#__codelineno-10-39\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-10-40\" name=\"__codelineno-10-40\" href=\"#__codelineno-10-40\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>\u4e00\u65e6\u5f53\u524d\u65f6\u95f4 <code>current</code> \u5927\u4e8e <code>segment-&gt;resendts</code> \u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\uff0c\u8bf4\u660e\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u90fd\u6ca1\u6709\u6536\u5230\u63a5\u6536\u65b9\u7684 ACK \u5305\uff0c\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c<code>needsend = 1</code>\uff0c\u91cd\u65b0\u53d1\u9001\u6570\u636e\u3002</p>\n<p>\u6709\u4e86\u786e\u8ba4\u63a5\u6536\u548c\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0cKCP \u5c31\u53ef\u4ee5\u4fdd\u8bc1\u57fa\u7840\u7684\u53ef\u9760\u6570\u636e\u4f20\u8f93\u4e86\u3002\u4f46\u662f\u4e3a\u4e86\u80fd\u591f\u4fdd\u6301\u66f4\u7a33\u5b9a\u7684\u6570\u636e\u6d41\u901f\uff0cKCP \u8fd8\u505a\u4e86\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u4e0b\u9762\u6211\u4eec\u4e00\u8d77\u770b\u770b KCP \u8fd8\u505a\u4e86\u90a3\u4e9b\u4f18\u5316\u3002</p>\n<h2 id=\"kcp_2\">KCP \u63d0\u5347\u6d41\u901f\u7684\u7b56\u7565</h2>\n<h3 id=\"_4\">\u5feb\u901f\u91cd\u4f20</h3>\n<p>\u53d1\u9001\u65b9\u53d1\u9001\u4e86\u5e8f\u53f7\u4e3a <code>sn</code> \u548c <code>sn + 1</code> \u4e24\u4e2a\u6570\u636e\u5305\uff0c\u5982\u679c\u53ea\u6536\u5230\u4e86 <code>sn + 1</code> \u7684 ACK \u5305\uff0c\u90a3\u53ef\u80fd\u662f\u56e0\u4e3a <code>sn</code> \u7684 ACK \u5305\u5728\u7f51\u8def\u4e2d\u8fd8\u6ca1\u5230\u8fbe\uff0c\u53c8\u6216\u8005 ACK \u5305\u4e22\u4e86\uff0c\u53c8\u6216\u8005 <code>sn</code> \u6570\u636e\u5305\u4e22\u4e86\uff0c\u5982\u679c\u6b64\u65f6\u8fd8\u6ca1\u5230\u8d85\u65f6\u91cd\u4f20\u7684\u65f6\u95f4\uff0c\u7f51\u7edc\u4e5f\u8fd8\u4e0d\u592a\u62e5\u5835\uff0c\u53ea\u662f\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u800c\u7a81\u53d1\u4e22\u5305\uff0c\u90a3\u4e48\u53d1\u9001\u65b9\u4e3b\u52a8\u63d0\u524d\u53d1\u9001 <code>sn</code> \u6570\u636e\u5305\uff0c\u53ef\u4ee5\u5e2e\u52a9\u63a5\u6536\u65b9\u66f4\u5feb\u5730\u63a5\u6536\u6570\u636e\uff0c\u63d0\u9ad8\u6d41\u901f\u3002</p>\n<p>KCP \u91cc\u9762\u4e5f\u76f8\u5e94\u5b9e\u73b0\u4e86\u5feb\u901f\u91cd\u4f20\u673a\u5236\uff0c\u4e5f\u5728 <code>ikcp_flush</code> \u91cc\u9762\uff1a</p>\n<details>\n<summary> \u5feb\u901f\u91cd\u4f20\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"w\">    </span><span class=\"n\">resent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastresend</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IUINT32</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastresend</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mh\">0xffffffff</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a>\n<a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001 snd_buf</span>\n<a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_buf</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a><span class=\"w\">        </span><span class=\"n\">IKCPSEG</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iqueue_entry</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IKCPSEG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a><span class=\"w\">        </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\" href=\"#__codelineno-11-10\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\" href=\"#__codelineno-11-11\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-11-12\" name=\"__codelineno-11-12\" href=\"#__codelineno-11-12\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-13\" name=\"__codelineno-11-13\" href=\"#__codelineno-11-13\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">current</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-14\" name=\"__codelineno-11-14\" href=\"#__codelineno-11-14\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-11-15\" name=\"__codelineno-11-15\" href=\"#__codelineno-11-15\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-16\" name=\"__codelineno-11-16\" href=\"#__codelineno-11-16\"></a><span class=\"w\">        </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">fastack</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">resent</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-17\" name=\"__codelineno-11-17\" href=\"#__codelineno-11-17\"></a><span class=\"w\">            </span><span class=\"c1\">// \u5feb\u901f\u91cd\u4f20</span>\n<a id=\"__codelineno-11-18\" name=\"__codelineno-11-18\" href=\"#__codelineno-11-18\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"kt\">int</span><span class=\"p\">)</span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastlimit</span><span class=\"w\"> </span><span class=\"o\">||</span>\n<a id=\"__codelineno-11-19\" name=\"__codelineno-11-19\" href=\"#__codelineno-11-19\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastlimit</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-20\" name=\"__codelineno-11-20\" href=\"#__codelineno-11-20\"></a><span class=\"w\">                </span><span class=\"n\">needsend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-21\" name=\"__codelineno-11-21\" href=\"#__codelineno-11-21\"></a><span class=\"w\">                </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">xmit</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-22\" name=\"__codelineno-11-22\" href=\"#__codelineno-11-22\"></a><span class=\"w\">                </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">fastack</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-23\" name=\"__codelineno-11-23\" href=\"#__codelineno-11-23\"></a><span class=\"w\">                </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">resendts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"o\">-&gt;</span><span class=\"n\">rto</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-24\" name=\"__codelineno-11-24\" href=\"#__codelineno-11-24\"></a><span class=\"w\">                </span><span class=\"n\">change</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-25\" name=\"__codelineno-11-25\" href=\"#__codelineno-11-25\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-26\" name=\"__codelineno-11-26\" href=\"#__codelineno-11-26\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-27\" name=\"__codelineno-11-27\" href=\"#__codelineno-11-27\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">needsend</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-28\" name=\"__codelineno-11-28\" href=\"#__codelineno-11-28\"></a><span class=\"w\">            </span><span class=\"c1\">// \u53d1\u9001\u6570\u636e</span>\n<a id=\"__codelineno-11-29\" name=\"__codelineno-11-29\" href=\"#__codelineno-11-29\"></a><span class=\"w\">            </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-11-30\" name=\"__codelineno-11-30\" href=\"#__codelineno-11-30\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-31\" name=\"__codelineno-11-31\" href=\"#__codelineno-11-31\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-11-32\" name=\"__codelineno-11-32\" href=\"#__codelineno-11-32\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>\u8981\u51fa\u53d1\u5feb\u901f\u91cd\u4f20\uff0c\u6709\u4e24\u4e2a\u6761\u4ef6\uff1a\n* <code>segment-&gt;fastack &gt;= resent</code>\uff0cresent \u662f\u53ef\u914d\u7f6e\u7684\u53c2\u6570 <code>kcp-&gt;fastresend</code>\uff0c\u914d\u7f6e\u4e3a 0 \u4f1a\u5173\u95ed\u5feb\u901f\u91cd\u4f20\u3002<code>segment-&gt;fastack</code> \u662f\u5728\u51fd\u6570 <code>ikcp_parse_fastack</code> \u91cc\u9762\u8bbe\u7f6e\u7684\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u5728 <code>ikcp_input</code> \u91cc\u9762\u8c03\u7528\uff0c\u4f1a\u6839\u636e <code>ikcp_input</code> \u7b97\u51fa\u7684 <code>maxack</code> \u6765\u7ed9\u6240\u6709 <code>sn</code> \u5c0f\u4e8e <code>maxack</code> \u7684 <code>segment-&gt;fastack</code> \u52a0\u4e00\uff0c\u6240\u4ee5 <code>segment-&gt;fastack</code> \u5c31\u662f\u8868\u793a\u6536\u5230\u6bd4 <code>sn</code> \u5927\u7684\u5305\u7684\u6b21\u6570\u3002\n* <code>segment-&gt;xmit &lt;= kcp-&gt;fastlimit || kcp-&gt;fastlimit &lt;= 0</code>\uff0c<code>setgment-&gt;xmit</code> \u662f\u53d1\u9001\u6b21\u6570\uff0c<code>kcp-&gt;fastlimit</code> \u662f\u53ef\u914d\u7f6e\u7684\u6700\u5927\u5feb\u901f\u91cd\u4f20\u6b21\u6570\uff0c\u53d1\u9001\u6b21\u6570\u9700\u8981\u5c0f\u4e8e\u6700\u5927\u5feb\u901f\u91cd\u4f20\u6b21\u6570</p>\n<p>\u4e00\u65e6\u6ee1\u8db3\u5feb\u901f\u91cd\u4f20\u7684\u4ee5\u4e0a\u6761\u4ef6\uff0cKCP \u5c31\u4f1a\u6267\u884c\u5feb\u901f\u91cd\u4f20\uff0c\u8981\u6ce8\u610f\u5feb\u901f\u91cd\u4f20\u5e76\u4e0d\u4f1a\u91cd\u7f6e\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\uff0c\u539f\u6765\u7684\u8d85\u65f6\u65f6\u95f4\u4f9d\u7136\u4f1a\u751f\u6548\u3002</p>\n<h3 id=\"_5\">\u7f29\u77ed\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4</h3>\n<p>\u8d85\u65f6\u91cd\u4f20\u662f\u4e2a\u5f88\u597d\u7684\u673a\u5236\uff0c\u4f46\u5c31\u662f\u592a\u82b1\u65f6\u95f4\u4e86\uff0c\u6309\u7167 TCP \u7684\u7b56\u7565\uff0c\u6bcf\u6b21\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\u7ffb\u500d\uff0c\u7b49\u5f85\u65f6\u95f4\u81a8\u80c0\u5f97\u5f88\u5feb\uff0c\u5728\u7b49\u5f85\u65f6\u95f4\u5185\uff0c\u5f88\u53ef\u80fd\u7531\u4e8e\u63a5\u6536\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u5df2\u8017\u5c3d\uff0c\u65e0\u6cd5\u63a5\u6536\u65b0\u6570\u636e\uff0c\u800c\u7b49\u5f85\u91cd\u4f20\u7684\u5305\u5e8f\u53f7\u662f\u5728\u6700\u524d\u9762\uff0c\u63a5\u6536\u65b9\u8981\u63a5\u6536\u5230\u91cd\u4f20\u7684\u5305\u624d\u80fd\u628a\u6240\u6709\u6570\u636e\u8fd4\u56de\u7ed9\u4e0a\u5c42\uff0c\u8fd9\u79cd\u60c5\u51b5\uff0c\u6574\u4e2a\u7f51\u8def\u7684\u6d41\u901f\u51e0\u4e4e\u4e3a 0\u3002KCP \u589e\u52a0\u4e86\u914d\u7f6e\u53ef\u4ee5\u51cf\u7f13\u7b49\u5f85\u7684\u65f6\u95f4\u589e\u957f\uff0c\u800c\u4e14\u4e5f\u4e0d\u4f1a\u662f\u7ffb\u500d\uff0c\u901a\u8fc7\u914d\u7f6e <code>kcp-&gt;nodelay</code> \u63a7\u5236\u6bcf\u6b21\u7b49\u5f85\u65f6\u95f4\u53ea\u4f1a\u589e\u957f 1 \u500d\u7684 RTO \u6216\u8005 0.5 \u500d\u7684 RTO\uff0c\u6709\u6548\u51cf\u7f13\u7b49\u5f85\u65f6\u95f4\u7684\u589e\u957f\uff0c\u5e2e\u52a9\u7f51\u8def\u5c3d\u5feb\u6062\u590d\u6d41\u901f\u3002</p>\n<h3 id=\"_6\">\u66f4\u65b0\u53d1\u9001\u7a97\u53e3</h3>\n<p>\u53d1\u9001\u7a97\u53e3\u8868\u793a\u7684\u662f\u540c\u65f6\u4f20\u8f93\u7684\u6570\u636e\u5305\u6570\u91cf\uff0c\u7a97\u53e3\u8d8a\u5927\uff0c\u540c\u65f6\u4f20\u8f93\u7684\u6570\u636e\u8d8a\u591a\uff0c\u6d41\u901f\u8d8a\u5927\uff0c\u4f46\u7a97\u53e3\u8fc7\u5927\uff0c\u4f1a\u5bfc\u81f4\u7f51\u7edc\u62e5\u585e\uff0c\u4e22\u5305\u7387\u4e0a\u5347\uff0c\u6570\u636e\u91cd\u4f20\u589e\u591a\uff0c\u6d41\u901f\u4e0b\u964d\u3002\u6240\u4ee5\u53d1\u9001\u7a97\u53e3\u9700\u8981\u6839\u636e\u7f51\u7edc\u60c5\u51b5\u4e0d\u65ad\u66f4\u65b0\uff0c\u6162\u6162\u8d8b\u8fd1\u6700\u4f18\u3002 KCP \u4e2d\u5173\u4e8e\u53d1\u9001\u7a97\u53e3\u7684\u4ee3\u7801\uff1a</p>\n<details>\n<summary> \u53d1\u9001\u7a97\u53e3\uff08\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801\uff09 </summary>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a><span class=\"n\">ikcpcb</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">ikcp_create</span><span class=\"p\">(</span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">user</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-2\" name=\"__codelineno-12-2\" href=\"#__codelineno-12-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-12-3\" name=\"__codelineno-12-3\" href=\"#__codelineno-12-3\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-12-4\" name=\"__codelineno-12-4\" href=\"#__codelineno-12-4\"></a><span class=\"w\">    </span><span class=\"c1\">// snd_wnd\uff0crcv_wnd \u53d1\u9001\u548c\u63a5\u53d7\u7684\u7f13\u51b2\u533a\u5927\u5c0f</span>\n<a id=\"__codelineno-12-5\" name=\"__codelineno-12-5\" href=\"#__codelineno-12-5\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_WND_SND</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// 32</span>\n<a id=\"__codelineno-12-6\" name=\"__codelineno-12-6\" href=\"#__codelineno-12-6\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rcv_wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_WND_RCV</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// 128</span>\n<a id=\"__codelineno-12-7\" name=\"__codelineno-12-7\" href=\"#__codelineno-12-7\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5bf9\u7aef\u63a5\u6536\u7a97\u53e3\u5927\u5c0f              // 128</span>\n<a id=\"__codelineno-12-8\" name=\"__codelineno-12-8\" href=\"#__codelineno-12-8\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_WND_RCV</span>\n<a id=\"__codelineno-12-9\" name=\"__codelineno-12-9\" href=\"#__codelineno-12-9\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u7a97\u53e3 cwnd \u521d\u59cb\u5316 0</span>\n<a id=\"__codelineno-12-10\" name=\"__codelineno-12-10\" href=\"#__codelineno-12-10\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-11\" name=\"__codelineno-12-11\" href=\"#__codelineno-12-11\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u7a97\u53e3\u5b57\u8282\u6570\u5927\u5c0f\uff0c\u53c2\u4e0e\u8ba1\u7b97 cwnd</span>\n<a id=\"__codelineno-12-12\" name=\"__codelineno-12-12\" href=\"#__codelineno-12-12\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<a id=\"__codelineno-12-13\" name=\"__codelineno-12-13\" href=\"#__codelineno-12-13\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6162\u542f\u52a8\u9608\u503c\uff0cslow start threshold</span>\n<a id=\"__codelineno-12-14\" name=\"__codelineno-12-14\" href=\"#__codelineno-12-14\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_THRESH_INIT</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-15\" name=\"__codelineno-12-15\" href=\"#__codelineno-12-15\"></a><span class=\"w\">    </span><span class=\"c1\">// nocwnd \u662f\u53ef\u914d\u7f6e\u53c2\u6570\uff0c1 \u4e0d\u8003\u8651 cwnd</span>\n<a id=\"__codelineno-12-16\" name=\"__codelineno-12-16\" href=\"#__codelineno-12-16\"></a><span class=\"w\">    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nocwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-17\" name=\"__codelineno-12-17\" href=\"#__codelineno-12-17\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-12-18\" name=\"__codelineno-12-18\" href=\"#__codelineno-12-18\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-12-19\" name=\"__codelineno-12-19\" href=\"#__codelineno-12-19\"></a>\n<a id=\"__codelineno-12-20\" name=\"__codelineno-12-20\" href=\"#__codelineno-12-20\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ikcp_flush</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-21\" name=\"__codelineno-12-21\" href=\"#__codelineno-12-21\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-12-22\" name=\"__codelineno-12-22\" href=\"#__codelineno-12-22\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-12-23\" name=\"__codelineno-12-23\" href=\"#__codelineno-12-23\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u6570\u636e\u65f6\u5148\u8ba1\u7b97 \u53d1\u9001\u7a97\u53e3\u5927\u5c0f\uff0c\u662f\u53d1\u9001\u7f13\u51b2\u533a\u5927\u5c0f\u548c\u5bf9\u65b9\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u7684\u5c0f\u503c</span>\n<a id=\"__codelineno-12-24\" name=\"__codelineno-12-24\" href=\"#__codelineno-12-24\"></a><span class=\"w\">    </span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_imin_</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_wnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-25\" name=\"__codelineno-12-25\" href=\"#__codelineno-12-25\"></a><span class=\"w\">    </span><span class=\"c1\">// \u9ed8\u8ba4\u8fd8\u9700\u8981\u8003\u8651 kcp-&gt;cwnd\uff0c\u5373\u662f\u4e0d\u65ad\u66f4\u65b0\u7684\u53d1\u9001\u7a97\u53e3</span>\n<a id=\"__codelineno-12-26\" name=\"__codelineno-12-26\" href=\"#__codelineno-12-26\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">nocwnd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_imin_</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-27\" name=\"__codelineno-12-27\" href=\"#__codelineno-12-27\"></a>\n<a id=\"__codelineno-12-28\" name=\"__codelineno-12-28\" href=\"#__codelineno-12-28\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6839\u636e cwnd \u5927\u5c0f\uff0csnd_queue \u79fb\u52a8\u5230 snd_buf</span>\n<a id=\"__codelineno-12-29\" name=\"__codelineno-12-29\" href=\"#__codelineno-12-29\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_nxt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-30\" name=\"__codelineno-12-30\" href=\"#__codelineno-12-30\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-31\" name=\"__codelineno-12-31\" href=\"#__codelineno-12-31\"></a><span class=\"w\">    </span><span class=\"c1\">// \u53d1\u9001\u6570\u636e</span>\n<a id=\"__codelineno-12-32\" name=\"__codelineno-12-32\" href=\"#__codelineno-12-32\"></a><span class=\"w\">    </span><span class=\"n\">resent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastresend</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IUINT32</span><span class=\"p\">)</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">fastresend</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mh\">0xffffffff</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-33\" name=\"__codelineno-12-33\" href=\"#__codelineno-12-33\"></a><span class=\"w\">    </span><span class=\"c1\">// \u89e6\u53d1\u8d85\u65f6\u91cd\u4f20 lost = 1</span>\n<a id=\"__codelineno-12-34\" name=\"__codelineno-12-34\" href=\"#__codelineno-12-34\"></a><span class=\"w\">    </span><span class=\"c1\">// \u89e6\u53d1\u5feb\u901f\u91cd\u4f20 change++</span>\n<a id=\"__codelineno-12-35\" name=\"__codelineno-12-35\" href=\"#__codelineno-12-35\"></a>\n<a id=\"__codelineno-12-36\" name=\"__codelineno-12-36\" href=\"#__codelineno-12-36\"></a><span class=\"w\">    </span><span class=\"c1\">// \u66f4\u65b0\u6162\u542f\u52a8\u9608\u503c\u548c\u53d1\u9001\u7a97\u53e3</span>\n<a id=\"__codelineno-12-37\" name=\"__codelineno-12-37\" href=\"#__codelineno-12-37\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">change</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-38\" name=\"__codelineno-12-38\" href=\"#__codelineno-12-38\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5982\u679c\u6709\u89e6\u53d1\u5feb\u901f\u91cd\u4f20\uff0cssthresh \u8bbe\u7f6e\u4e3a\u7f51\u7edc\u4e0a\u6b63\u5728\u4f20\u8f93\u7684\u6570\u636e\u5305\u6570\u91cf\u7684\u4e00\u534a</span>\n<a id=\"__codelineno-12-39\" name=\"__codelineno-12-39\" href=\"#__codelineno-12-39\"></a><span class=\"w\">        </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">inflight</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_nxt</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-40\" name=\"__codelineno-12-40\" href=\"#__codelineno-12-40\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">inflight</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-41\" name=\"__codelineno-12-41\" href=\"#__codelineno-12-41\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">IKCP_THRESH_MIN</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-42\" name=\"__codelineno-12-42\" href=\"#__codelineno-12-42\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_THRESH_MIN</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-43\" name=\"__codelineno-12-43\" href=\"#__codelineno-12-43\"></a>\n<a id=\"__codelineno-12-44\" name=\"__codelineno-12-44\" href=\"#__codelineno-12-44\"></a><span class=\"w\">        </span><span class=\"c1\">// \u53d1\u9001\u7a97\u53e3\u4e3a\u9608\u503c\u518d\u52a0\u4e0a\u5feb\u901f\u91cd\u4f20\u76f8\u5173\u7684 resent</span>\n<a id=\"__codelineno-12-45\" name=\"__codelineno-12-45\" href=\"#__codelineno-12-45\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">resent</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-46\" name=\"__codelineno-12-46\" href=\"#__codelineno-12-46\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-47\" name=\"__codelineno-12-47\" href=\"#__codelineno-12-47\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-48\" name=\"__codelineno-12-48\" href=\"#__codelineno-12-48\"></a>\n<a id=\"__codelineno-12-49\" name=\"__codelineno-12-49\" href=\"#__codelineno-12-49\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">lost</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-50\" name=\"__codelineno-12-50\" href=\"#__codelineno-12-50\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5982\u679c\u6709\u8d85\u65f6\u91cd\u4f20\uff0c\u89e6\u53d1\u6162\u542f\u52a8, ssthresh \u9608\u503c\u4e3a\u53d1\u9001\u7a97\u53e3\u7684\u4e00\u534a</span>\n<a id=\"__codelineno-12-51\" name=\"__codelineno-12-51\" href=\"#__codelineno-12-51\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-52\" name=\"__codelineno-12-52\" href=\"#__codelineno-12-52\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">IKCP_THRESH_MIN</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-53\" name=\"__codelineno-12-53\" href=\"#__codelineno-12-53\"></a><span class=\"w\">            </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IKCP_THRESH_MIN</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-54\" name=\"__codelineno-12-54\" href=\"#__codelineno-12-54\"></a><span class=\"w\">        </span><span class=\"c1\">// \u53d1\u9001\u7a97\u53e3\u56de\u5230 1\uff0c\u91cd\u65b0\u6162\u542f\u52a8\u589e\u957f</span>\n<a id=\"__codelineno-12-55\" name=\"__codelineno-12-55\" href=\"#__codelineno-12-55\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-56\" name=\"__codelineno-12-56\" href=\"#__codelineno-12-56\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-57\" name=\"__codelineno-12-57\" href=\"#__codelineno-12-57\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-58\" name=\"__codelineno-12-58\" href=\"#__codelineno-12-58\"></a>\n<a id=\"__codelineno-12-59\" name=\"__codelineno-12-59\" href=\"#__codelineno-12-59\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-60\" name=\"__codelineno-12-60\" href=\"#__codelineno-12-60\"></a><span class=\"w\">        </span><span class=\"c1\">// \u56e0\u4e3a\u521d\u59cb\u5316\u4e3a 0\uff0c\u6765\u5230\u8fd9\u91cc\u4f1a\u518d\u8bbe\u7f6e\u6210 1</span>\n<a id=\"__codelineno-12-61\" name=\"__codelineno-12-61\" href=\"#__codelineno-12-61\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-62\" name=\"__codelineno-12-62\" href=\"#__codelineno-12-62\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-63\" name=\"__codelineno-12-63\" href=\"#__codelineno-12-63\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-64\" name=\"__codelineno-12-64\" href=\"#__codelineno-12-64\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-12-65\" name=\"__codelineno-12-65\" href=\"#__codelineno-12-65\"></a>\n<a id=\"__codelineno-12-66\" name=\"__codelineno-12-66\" href=\"#__codelineno-12-66\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">ikcp_input</span><span class=\"p\">(</span><span class=\"n\">ikcpcb</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">kcp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-67\" name=\"__codelineno-12-67\" href=\"#__codelineno-12-67\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-12-68\" name=\"__codelineno-12-68\" href=\"#__codelineno-12-68\"></a><span class=\"w\">    </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">prev_una</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-69\" name=\"__codelineno-12-69\" href=\"#__codelineno-12-69\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5904\u7406\u63a5\u6536\u7684\u6570\u636e</span>\n<a id=\"__codelineno-12-70\" name=\"__codelineno-12-70\" href=\"#__codelineno-12-70\"></a>\n<a id=\"__codelineno-12-71\" name=\"__codelineno-12-71\" href=\"#__codelineno-12-71\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-72\" name=\"__codelineno-12-72\" href=\"#__codelineno-12-72\"></a><span class=\"w\">        </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-12-73\" name=\"__codelineno-12-73\" href=\"#__codelineno-12-73\"></a><span class=\"w\">        </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ikcp_decode16u</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wnd</span><span class=\"p\">)</span>\n<a id=\"__codelineno-12-74\" name=\"__codelineno-12-74\" href=\"#__codelineno-12-74\"></a><span class=\"w\">        </span><span class=\"c1\">// rmt_wnd \u662f\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f</span>\n<a id=\"__codelineno-12-75\" name=\"__codelineno-12-75\" href=\"#__codelineno-12-75\"></a><span class=\"w\">        </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wnd</span>\n<a id=\"__codelineno-12-76\" name=\"__codelineno-12-76\" href=\"#__codelineno-12-76\"></a><span class=\"w\">        </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-12-77\" name=\"__codelineno-12-77\" href=\"#__codelineno-12-77\"></a><span class=\"w\">        </span><span class=\"c1\">// \u5904\u7406\u6570\u636e</span>\n<a id=\"__codelineno-12-78\" name=\"__codelineno-12-78\" href=\"#__codelineno-12-78\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-79\" name=\"__codelineno-12-79\" href=\"#__codelineno-12-79\"></a>\n<a id=\"__codelineno-12-80\" name=\"__codelineno-12-80\" href=\"#__codelineno-12-80\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6700\u540e\u66f4\u65b0\u53d1\u9001\u7a97\u53e3</span>\n<a id=\"__codelineno-12-81\" name=\"__codelineno-12-81\" href=\"#__codelineno-12-81\"></a><span class=\"w\">    </span><span class=\"c1\">// kcp-&gt;snd_una - prev_una &gt; 0\uff0c\u8868\u793a\u672c\u6b21 input \u6709\u63a5\u53d7\u5230 ACK \u5e76\u4e14\u53d1\u9001\u7f13\u51b2 snd_buf \u6709\u53d8\u5316</span>\n<a id=\"__codelineno-12-82\" name=\"__codelineno-12-82\" href=\"#__codelineno-12-82\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_itimediff</span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">snd_una</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">prev_una</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-83\" name=\"__codelineno-12-83\" href=\"#__codelineno-12-83\"></a><span class=\"w\">        </span><span class=\"c1\">// \u518d\u5224\u65ad\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3</span>\n<a id=\"__codelineno-12-84\" name=\"__codelineno-12-84\" href=\"#__codelineno-12-84\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-85\" name=\"__codelineno-12-85\" href=\"#__codelineno-12-85\"></a><span class=\"w\">            </span><span class=\"n\">IUINT32</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-86\" name=\"__codelineno-12-86\" href=\"#__codelineno-12-86\"></a>\n<a id=\"__codelineno-12-87\" name=\"__codelineno-12-87\" href=\"#__codelineno-12-87\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">ssthresh</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-88\" name=\"__codelineno-12-88\" href=\"#__codelineno-12-88\"></a><span class=\"w\">                </span><span class=\"c1\">// \u5c0f\u4e8e\u6162\u542f\u52a8\u9608\u503c\uff0c\u53cc\u500d\u589e\u957f</span>\n<a id=\"__codelineno-12-89\" name=\"__codelineno-12-89\" href=\"#__codelineno-12-89\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-90\" name=\"__codelineno-12-90\" href=\"#__codelineno-12-90\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-91\" name=\"__codelineno-12-91\" href=\"#__codelineno-12-91\"></a>\n<a id=\"__codelineno-12-92\" name=\"__codelineno-12-92\" href=\"#__codelineno-12-92\"></a><span class=\"w\">            </span><span class=\"p\">}</span><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-93\" name=\"__codelineno-12-93\" href=\"#__codelineno-12-93\"></a><span class=\"w\">                </span><span class=\"c1\">// \u5927\u4e8e\u6162\u542f\u52a8\u9608\u503c\u4e4b\u540e\uff0c\u901a\u8fc7\u516c\u5f0f\u66f4\u65b0 incr \uff0c\u8fdb\u800c\u8ba1\u7b97 cwnd</span>\n<a id=\"__codelineno-12-94\" name=\"__codelineno-12-94\" href=\"#__codelineno-12-94\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-95\" name=\"__codelineno-12-95\" href=\"#__codelineno-12-95\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">);</span>\n<a id=\"__codelineno-12-96\" name=\"__codelineno-12-96\" href=\"#__codelineno-12-96\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-97\" name=\"__codelineno-12-97\" href=\"#__codelineno-12-97\"></a><span class=\"w\">                    </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-98\" name=\"__codelineno-12-98\" href=\"#__codelineno-12-98\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-99\" name=\"__codelineno-12-99\" href=\"#__codelineno-12-99\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-100\" name=\"__codelineno-12-100\" href=\"#__codelineno-12-100\"></a><span class=\"w\">            </span><span class=\"c1\">// \u66f4\u65b0\u51fa\u6765\u7684\u503c\u8fd8\u8981\u518d\u6bd4\u8f83\u4e0b rmt_wnd</span>\n<a id=\"__codelineno-12-101\" name=\"__codelineno-12-101\" href=\"#__codelineno-12-101\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-12-102\" name=\"__codelineno-12-102\" href=\"#__codelineno-12-102\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">cwnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-103\" name=\"__codelineno-12-103\" href=\"#__codelineno-12-103\"></a><span class=\"w\">                </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">incr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">kcp</span><span class=\"o\">-&gt;</span><span class=\"n\">rmt_wnd</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mss</span><span class=\"p\">;</span>\n<a id=\"__codelineno-12-104\" name=\"__codelineno-12-104\" href=\"#__codelineno-12-104\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-105\" name=\"__codelineno-12-105\" href=\"#__codelineno-12-105\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-106\" name=\"__codelineno-12-106\" href=\"#__codelineno-12-106\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-12-107\" name=\"__codelineno-12-107\" href=\"#__codelineno-12-107\"></a><span class=\"p\">}</span>\n</code></pre></div>\n</details>\n\n<p>\u8ba1\u7b97\u53d1\u9001\u7a97\u53e3 <code>kcp-&gt;cwnd</code> \u7684\u5927\u5c0f\u6d89\u53ca\u7684\u4ee3\u7801\u7247\u6bb5\u4f1a\u7a0d\u5fae\u591a\u4e00\u4e9b\uff0c\u56e0\u4e3a\u5728\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u9700\u8981\u66f4\u65b0\u3002<code>kcp-&gt;cwnd</code> \u521d\u59cb\u5316\u4e3a 0\uff0c\n\u4e4b\u540e\u4f1a\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 <code>ikcp_flush</code> \u7684\u65f6\u5019\uff0c\u5224\u65ad\u5c0f\u4e8e 1 \uff0c\u4fbf\u4fee\u6539\u6210 1\u3002\u4e4b\u540e\u53d1\u9001\u65b9\u6839\u636e\u53d1\u9001\u7a97\u53e3\u5927\u5c0f\uff0c\u53d1\u9001\u51fa\u76f8\u5e94\u6570\u91cf\u7684\u6570\u636e\u5305\uff0c\u7b49\u5f85 ACK\n\u56de\u590d\u5305\u3002ACK \u5305\u5728 <code>kcp-&gt;input</code> \u4e2d\u8fdb\u884c\u5904\u7406\uff0c<code>kcp-&gt;input</code> \u4e2d\u5982\u679c\u5224\u65ad\u6709 ACK \u5305\uff0c\u5e76\u6709\u6e05\u9664\u53d1\u9001\u7f13\u51b2\u4e2d\u7684\u53d1\u9001\u6570\u636e\u5305\uff0c\u8bf4\u660e\u6709\u6570\u636e\u5305\u5df2\u7ecf\u5b8c\u6210\u9001\u8fbe\uff0c<code>kcp-&gt;cwnd++</code>\u3002\u5b9e\u9645\u4e0a\u5f88\u53ef\u80fd\u662f\u4e00\u6b21 <code>kcp-&gt;input</code> \u53ea\u5904\u7406\u5230\u4e00\u4e2a ACK \u5305\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u6bcf\u6536\u5230\u4e00\u4e2a ACK \u5305\u90fd\u4f1a\u6709 <code>kcp-&gt;cwnd++</code>\uff0c\u8fd9\u53e5\u81ea\u589e\u5b9e\u73b0\u7684\u662f\u7ffb\u500d\u7684\u6548\u679c\uff0c\u8b6c\u5982\u5f53\u524d <code>kcp-&gt;cwnd = 2</code>\uff0c\u53d1\u9001\u4e24\u4e2a\u6570\u636e\u5305\uff0c\u6536\u5230\u4e24\u4e2a ACK \u5305\uff0c\u89e6\u53d1\u4e86\u4e24\u6b21\u81ea\u589e\uff0c\u6700\u540e\u5c31\u662f <code>kcp-&gt;cwnd = 4</code> \u7ffb\u500d\u3002</p>\n<p><code>cwnd</code> \u53ef\u4ee5\u4e00\u76f4\u6307\u6570\u589e\u957f\uff0c\u76f4\u5230\u8d85\u8fc7\u6162\u542f\u52a8\u9608\u503c\uff0c\u6216\u8005\u53d1\u751f\u62e5\u5835\u8d85\u65f6\u91cd\u4f20\uff0c\u5feb\u901f\u91cd\u4f20\u7684\u60c5\u51b5\u3002\u53d1\u751f\u4e86\u8d85\u65f6\u91cd\u4f20\u4e4b\u540e\uff0c\u4f1a\u89e6\u53d1\u6162\u542f\u52a8\uff0c\u6162\u542f\u52a8\u9608\u503c <code>ssthresh = kcp-&gt;cwnd / 2</code>\uff0c\u53d1\u9001\u7a97\u53e3 <code>kcp-&gt;cwnd = 1</code>\uff0c\u56de\u5230\u6700\u521d\u91cd\u65b0\u6307\u6570\u589e\u957f\u3002\u5982\u679c\u53d1\u751f\u4e86\u5feb\u901f\u91cd\u4f20\uff0cKCP \u5148\u63d0\u524d\u51cf\u5c11 <code>ssthresh</code>\uff0c\u4e5f\u5373\u662f\u51cf\u5c11\u4e86 <code>cwnd</code> \u6307\u6570\u589e\u957f\u7684\u7a7a\u95f4\uff0c\u964d\u4f4e\u589e\u957f\u901f\u5ea6\uff0c\u63d0\u524d\u51cf\u7f13\u62e5\u5835\u7684\u60c5\u51b5\u3002</p>\n<p>KCP \u8fd8\u589e\u52a0\u4e86\u4e00\u4e2a\u914d\u7f6e <code>nocwnd</code>\uff0c\u5f53 <code>nocwnd = 1</code>\uff0c\u53d1\u9001\u6570\u636e\u662f\u4e0d\u518d\u8003\u8651\u53d1\u9001\u7a97\u53e3\u5927\u5c0f\uff0c\u76f4\u63a5\u8ba9\u6700\u5927\u80fd\u53d1\u9001\u7684\u6570\u91cf\u53d1\u9001\u6570\u636e\u5305\uff0c\u6ee1\u8db3\u9ad8\u901f\u6a21\u5f0f\u4e0b\u7684\u8981\u6c42\u3002</p>\n<h2 id=\"_7\">\u5c0f\u7ed3</h2>\n<p>\u672c\u6587\u7b80\u5355\u5730\u5206\u6790\u4e86 KCP \u7684\u6e90\u7801\uff0c\u5e76\u8ba8\u8bba\u4e86 KCP \u4e0a ARQ \u7684\u5b9e\u73b0\uff0c\u548c\u4e00\u4e9b KCP \u63d0\u5347\u6d41\u901f\u7684\u7b56\u7565\u3002\u8fd8\u6709\u5f88\u591a\u7ec6\u8282\u6ca1\u6709\u63d0\u5230\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u7ffb KCP \u7684\u6e90\u7801\u5bf9\u7167\u7740\u770b\uff0c\u76f8\u4fe1\u4e5f\u80fd\u6709\u4e0d\u5c11\u7684\u6536\u83b7\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/cpp-%E7%BC%96%E5%86%99Windows%E4%B8%8B%E7%9A%84MemoryLeakDetector/",
            "url": "https://wiki.disenone.site/cpp-%E7%BC%96%E5%86%99Windows%E4%B8%8B%E7%9A%84MemoryLeakDetector/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "\u7f16\u5199 Windows \u4e0b\u7684 Memory Leak Detector",
            "content_html": "<p><meta property=\"og:title\" content=\"\u7f16\u5199 Windows \u4e0b\u7684 Memory Leak Detector\" /></p>\n<p><img alt=\"\" src=\"https://img.shields.io/badge/windows-10-blue.svg\" style=\"display: inline-block\" />\n<img alt=\"\" src=\"https://img.shields.io/badge/vs-2015-68217A.svg\" style=\"display: inline-block\" /></p>\n<h2 id=\"_1\">\u524d\u8a00</h2>\n<p>\u8fd9\u4e00\u9635\u5b50\u8bfb\u5b8c\u4e86\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\uff1a\u94fe\u63a5\u3001\u88c5\u8f7d\u4e0e\u5e93\u300b\uff08\u540e\u9762\u7b80\u79f0\u300a\u94fe\u63a5\u300b\uff09\uff0c\u6536\u83b7\u826f\u591a\uff0c\u5bfb\u601d\u7740\u80fd\u4e0d\u80fd\u505a\u4e9b\u76f8\u5173\u7684\u5c0f\u4ee3\u7801\u51fa\u6765\u3002\u521a\u597d\u77e5\u9053 Windows \u4e0b\u6709\u4e2a\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177 <a href=\"https://vld.codeplex.com/\">Visual Leak Detector</a>\uff0c\u8fd9\u4e2a\u5de5\u5177\u662f\u901a\u8fc7\u66ff\u6362 Windows \u4e0b\u8d1f\u8d23\u5185\u5b58\u7ba1\u7406\u7684 dll \u63a5\u53e3\u6765\u5b9e\u73b0\u8ddf\u8e2a\u5185\u5b58\u5206\u914d\u91ca\u653e\u3002\u6240\u4ee5\u51b3\u5b9a\u53c2\u8003 Visual Leak Detector \uff08\u540e\u9762\u7b80\u79f0 VLD\uff09\u6765\u505a\u4e2a\u7b80\u6613\u7684\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177\uff0c\u7406\u89e3 dll \u94fe\u63a5\u3002</p>\n<h2 id=\"_2\">\u9884\u5907\u77e5\u8bc6</h2>\n<p>\u300a\u94fe\u63a5\u300b\u4e00\u4e66\u8be6\u7ec6\u89e3\u91ca\u4e86\u5728 Linux \u548c Windows \u4e0b\u53ef\u6267\u884c\u6587\u4ef6\u7684\u94fe\u63a5\u539f\u7406\uff0c\u5176\u4e2d Windows \u4e0b\u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u53eb\u505a PE\uff08Portable Executable\uff09\u6587\u4ef6\u3002\u800c DLL \u6587\u4ef6\u7684\u89e3\u91ca\u662f\u8fd9\u6837\u7684\uff1a</p>\n<blockquote>\n<p>DLL \u5373\u52a8\u6001\u94fe\u63a5\u5e93\uff08Dynamic-Link Library\uff09\u7684\u7f29\u5199\uff0c\u5b83\u76f8\u5f53\u4e8e Linux \u4e0b\u7684\u5171\u4eab\u5bf9\u8c61\u3002Windows \u7cfb\u7edf\u4e2d\u5927\u91cf\u91c7\u7528\u4e86\u8fd9\u79cd DLL \u673a\u5236\uff0c\u751a\u81f3\u5305\u62ec Windows \u7684\u5185\u6838\u7684\u7ed3\u6784\u90fd\u5f88\u5927\u7a0b\u5ea6\u4f9d\u8d56\u4e8e DLL \u673a\u5236\u3002Windows \u4e0b\u7684 DLL \u6587\u4ef6\u548c EXE \u6587\u4ef6\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u5b83\u4eec\u90fd\u662f\u6709 PE \u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u7a0d\u5fae\u6709\u4e9b\u4e0d\u540c\u7684\u662f PE \u6587\u4ef6\u5934\u90e8\u4e2d\u6709\u4e2a\u7b26\u53f7\u4f4d\u8868\u793a\u8be5\u6587\u4ef6\u662f EXE \u6216\u662f DLL\uff0c\u800c DLL \u6587\u4ef6\u7684\u6269\u5c55\u540d\u4e0d\u4e00\u5b9a\u662f .dll\uff0c\u4e5f\u6709\u53ef\u80fd\u662f\u522b\u7684\u6bd4\u5982 .ocx\uff08OCX\u63a7\u4ef6\uff09\u6216\u662f .CPL\uff08\u63a7\u5236\u9762\u677f\u7a0b\u5e8f\uff09\u3002</p>\n</blockquote>\n<p>\u8fd8\u6709\u6bd4\u5982 Python \u7684\u6269\u5c55\u6587\u4ef6 .pyd\u3002\u800c DLL \u4e2d\u6709\u5173\u6211\u4eec\u8fd9\u91cc\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u7684\u6982\u5ff5\u662f<strong>\u7b26\u53f7\u5bfc\u51fa\u5bfc\u5165\u8868</strong>\u3002</p>\n<h4 id=\"_3\">\u7b26\u53f7\u5bfc\u51fa\u8868</h4>\n<blockquote>\n<p>\u5f53\u4e00\u4e2a PE \u9700\u8981\u5c06\u4e00\u4e9b\u51fd\u6570\u6216\u53d8\u91cf\u63d0\u4f9b\u7ed9\u5176\u4ed6 PE \u6587\u4ef6\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u628a\u8fd9\u79cd\u884c\u4e3a\u53eb\u505a<strong>\u7b26\u53f7\u5bfc\u51fa\uff08Symbol Exporting\uff09</strong></p>\n</blockquote>\n<p>\u7b80\u5355\u5730\u7406\u89e3\uff0c\u5728 Windows PE \u4e2d\uff0c\u6240\u6709\u5bfc\u51fa\u7684\u7b26\u53f7\u88ab\u96c6\u4e2d\u5b58\u653e\u5728\u88ab\u79f0\u4f5c<strong>\u5bfc\u51fa\u8868\uff08Export Table\uff09</strong>\u7684\u7ed3\u6784\u4e2d\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b26\u53f7\u540d\u4e0e\u7b26\u53f7\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u3002\u9700\u8981\u5bfc\u51fa\u7684\u7b26\u53f7\u9700\u8981\u52a0\u4e0a\u4fee\u9970\u7b26<code>__declspec(dllexport)</code>\u3002</p>\n<h4 id=\"_4\">\u7b26\u53f7\u5bfc\u5165\u8868</h4>\n<p>\u7b26\u53f7\u5bfc\u5165\u8868\u5c31\u662f\u6211\u4eec\u8fd9\u91cc\u7684\u5173\u952e\u6982\u5ff5\uff0c\u5b83\u8ddf\u7b26\u53f7\u5bfc\u51fa\u8868\u76f8\u5bf9\u5e94\uff0c\u5148\u6765\u770b\u6982\u5ff5\u89e3\u91ca\uff1a</p>\n<blockquote>\n<p>\u5982\u679c\u6211\u4eec\u5728\u67d0\u4e2a\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5230\u4e86\u6765\u81ea DLL \u7684\u51fd\u6570\u6216\u8005\u53d8\u91cf\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u628a\u8fd9\u79cd\u884c\u4e3a\u53eb\u505a<strong>\u7b26\u53f7\u5bfc\u5165\uff08Symbol Importing\uff09</strong>\u3002</p>\n</blockquote>\n<p>Windows PE \u4e2d\u4fdd\u5b58\u6a21\u5757\u9700\u8981\u5bfc\u5165\u7684\u53d8\u91cf\u548c\u51fd\u6570\u7684\u7b26\u53f7\u4ee5\u53ca\u6240\u5728\u7684\u6a21\u5757\u7b49\u4fe1\u606f\u7684\u7ed3\u6784\u53eb\u505a<strong>\u5bfc\u5165\u8868\uff08Import Table\uff09</strong>\u3002Windows \u52a0\u8f7d PE \u6587\u4ef6\u65f6\uff0c\u5176\u4e2d\u4e00\u4e2a\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u5c06\u6240\u6709\u9700\u8981\u5bfc\u5165\u7684\u51fd\u6570\u5730\u5740\u786e\u5b9a\u5e76\u5c06\u5bfc\u5165\u8868\u4e2d\u7684\u5143\u7d20\u8c03\u6574\u5230\u6b63\u786e\u7684\u5730\u5740\uff0c\u4f7f\u5f97\u8fd0\u884c\u65f6\u5019\uff0c\u7a0b\u5e8f\u901a\u8fc7\u67e5\u8be2\u5bfc\u5165\u8868\u6765\u5b9a\u4f4d\u5b9e\u9645\u51fd\u6570\u7684\u5730\u5740\uff0c\u5e76\u8fdb\u884c\u8c03\u7528\u3002\u5bfc\u5165\u8868\u4e2d\u6700\u91cd\u8981\u7684\u7ed3\u6784\u662f<strong>\u5bfc\u5165\u5730\u5740\u6570\u7ec4\uff08Import Address Table\uff0cIAT\uff09</strong>\uff0c\u91cc\u9762\u5b58\u653e\u7684\u5c31\u662f\u5bfc\u5165\u7684\u51fd\u6570\u5b9e\u9645\u5730\u5740\u3002</p>\n<p>\u770b\u5230\u8fd9\u91cc\u662f\u4e0d\u662f\u5df2\u7ecf\u731c\u5230\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u662f\u600e\u4e48\u505a :)\u3002\u6ca1\u9519\u5c31\u662f hack \u5bfc\u5165\u8868\uff0c\u5177\u4f53\u5730\u8bf4\u5c31\u662f\u628a\u9700\u8981\u68c0\u6d4b\u7684\u6a21\u5757\u7684\u5bfc\u5165\u8868\u4e2d\uff0c\u5173\u4e8e\u5185\u5b58\u7533\u8bf7\u548c\u91ca\u653e\u7684\u51fd\u6570\u7684\u5730\u5740\u6539\u6210\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u6a21\u5757\u6bcf\u4e00\u6b21\u7684\u5185\u5b58\u7533\u8bf7\u548c\u91ca\u653e\u60c5\u51b5\u4e86\uff0c\u53ef\u4ee5\u5c3d\u60c5\u505a\u6211\u4eec\u60f3\u505a\u7684\u68c0\u6d4b\u3002</p>\n<p>\u6709\u5173 DLL \u94fe\u63a5\u7684\u66f4\u8be6\u7ec6\u77e5\u8bc6\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\u300a\u94fe\u63a5\u300b\u6216\u8005\u5176\u4ed6\u8d44\u6599\u3002</p>\n<h2 id=\"memory-leak-detector\">Memory Leak Detector</h2>\n<p>\u77e5\u9053\u4e86\u539f\u7406\uff0c\u4e0b\u9762\u5c31\u662f\u6839\u636e\u539f\u7406\u6765\u5b9e\u73b0\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u3002\u4e0b\u9762\u7684\u8bb2\u89e3\u5c06\u57fa\u4e8e\u6211\u81ea\u5df1\u7684\u5b9e\u73b0\uff0c\u6211\u653e\u5728\u4e86\u6211\u7684 Github \u4e0a\uff1a<a href=\"https://github.com/disenone/LeakDetector\">LeakDetector</a>\u3002</p>\n<h4 id=\"_5\">\u66ff\u6362\u51fd\u6570</h4>\n<p>\u5148\u6765\u770b\u5173\u952e\u7684\u51fd\u6570\uff0c\u4f4d\u4e8e<a href=\"https://github.com/disenone/LeakDetector/blob/master/LeakDetector/RealDetector.cpp\">RealDetector.cpp</a>\uff1a</p>\n<div class=\"language-cpp highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-0-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-48\">48</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-49\">49</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-50\">50</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-51\">51</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-52\">52</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-53\">53</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-54\">54</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-55\">55</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-56\">56</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-57\">57</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-58\">58</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-59\">59</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-60\">60</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-61\">61</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-62\">62</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-63\">63</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-64\">64</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-65\">65</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-66\">66</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-67\">67</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-68\">68</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-69\">69</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-70\">70</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-71\">71</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-72\">72</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-73\">73</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-74\">74</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-75\">75</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-76\">76</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-77\">77</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-78\">78</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-79\">79</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-80\">80</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-81\">81</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-82\">82</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-0-83\">83</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\"></a><span class=\"cm\">/* \u628a importModule \u4e2d\u7684 IAT (Import Address Table) \u7684\u67d0\u4e2a\u51fd\u6570\u66ff\u6362\u6210\u522b\u7684\u51fd\u6570\uff0c</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\"></a><span class=\"cm\"> * importModule \u4f1a\u8c03\u7528\u5230\u522b\u7684 module \u7684\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u9700\u8981 patch \u7684\u51fd\u6570\uff0c</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\"></a><span class=\"cm\"> * \u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u8ba9 import module \u6539\u6210\u8c03\u7528\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u3002</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\"></a><span class=\"cm\"> *</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\"></a><span class=\"cm\"> * - importModule (IN): \u8981\u5904\u7406\u7684 module\uff0c\u8fd9\u4e2a module \u8c03\u7528\u5230\u522b\u7684 module \u7684\u9700\u8981 patch \u7684\u51fd\u6570</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\"></a><span class=\"cm\"> *</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\"></a><span class=\"cm\"> * - exportModuleName (IN): \u9700\u8981 patch \u7684\u51fd\u6570\u6765\u81ea\u7684 module \u540d\u5b57</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\"></a><span class=\"cm\"> *</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\"></a><span class=\"cm\"> * - exportModulePath (IN): export module \u6240\u5728\u7684\u8def\u5f84\uff0c\u9996\u5148\u5c1d\u8bd5\u7528 path \u6765\u52a0\u8f7d export module\uff0c</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\"></a><span class=\"cm\"> *          \u5982\u679c\u5931\u8d25\uff0c\u5219\u7528 name \u6765\u52a0\u8f7d</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\"></a><span class=\"cm\"> * - importName (IN): \u51fd\u6570\u540d</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\"></a><span class=\"cm\"> *</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\"></a><span class=\"cm\"> * - replacement (IN): \u66ff\u4ee3\u7684\u51fd\u6570\u6307\u9488</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\"></a><span class=\"cm\"> *</span>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\"></a><span class=\"cm\"> * Return Valur: \u6210\u529f true\uff0c\u5426\u5219 false</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\"></a><span class=\"cm\">*/</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\"></a><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"nf\">RealDetector::patchImport</span><span class=\"p\">(</span>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\"></a><span class=\"w\">    </span><span class=\"n\">HMODULE</span><span class=\"w\"> </span><span class=\"n\">importModule</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\"></a><span class=\"w\">    </span><span class=\"n\">LPCSTR</span><span class=\"w\"> </span><span class=\"n\">exportModuleName</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\"></a><span class=\"w\">    </span><span class=\"n\">LPCSTR</span><span class=\"w\"> </span><span class=\"n\">exportModulePath</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"n\">LPCSTR</span><span class=\"w\"> </span><span class=\"n\">importName</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"n\">LPCVOID</span><span class=\"w\"> </span><span class=\"n\">replacement</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"n\">HMODULE</span><span class=\"w\">                  </span><span class=\"n\">exportmodule</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\"></a><span class=\"w\">    </span><span class=\"n\">IMAGE_THUNK_DATA</span><span class=\"w\">        </span><span class=\"o\">*</span><span class=\"n\">iate</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\"></a><span class=\"w\">    </span><span class=\"n\">IMAGE_IMPORT_DESCRIPTOR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">idte</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"n\">FARPROC</span><span class=\"w\">                  </span><span class=\"k\">import</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\"></a><span class=\"w\">    </span><span class=\"n\">DWORD</span><span class=\"w\">                    </span><span class=\"n\">protect</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\"></a><span class=\"w\">    </span><span class=\"n\">IMAGE_SECTION_HEADER</span><span class=\"w\">    </span><span class=\"o\">*</span><span class=\"n\">section</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\"></a><span class=\"w\">    </span><span class=\"n\">ULONG</span><span class=\"w\">                    </span><span class=\"n\">size</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-31\" name=\"__codelineno-0-31\"></a>\n<a id=\"__codelineno-0-32\" name=\"__codelineno-0-32\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">exportModuleName</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-33\" name=\"__codelineno-0-33\"></a>\n<a id=\"__codelineno-0-34\" name=\"__codelineno-0-34\"></a><span class=\"w\">    </span><span class=\"n\">idte</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IMAGE_IMPORT_DESCRIPTOR</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">ImageDirectoryEntryToDataEx</span><span class=\"p\">((</span><span class=\"n\">PVOID</span><span class=\"p\">)</span><span class=\"n\">importModule</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-35\" name=\"__codelineno-0-35\"></a><span class=\"w\">        </span><span class=\"n\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IMAGE_DIRECTORY_ENTRY_IMPORT</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">size</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">section</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-36\" name=\"__codelineno-0-36\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">idte</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-37\" name=\"__codelineno-0-37\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-38\" name=\"__codelineno-0-38\"></a><span class=\"w\">        </span><span class=\"n\">logMessage</span><span class=\"p\">(</span><span class=\"s\">&quot;patchImport failed: idte == NULL</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-39\" name=\"__codelineno-0-39\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-40\" name=\"__codelineno-0-40\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-41\" name=\"__codelineno-0-41\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">idte</span><span class=\"o\">-&gt;</span><span class=\"n\">FirstThunk</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mh\">0x0</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-42\" name=\"__codelineno-0-42\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-43\" name=\"__codelineno-0-43\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">strcmp</span><span class=\"p\">((</span><span class=\"n\">PCHAR</span><span class=\"p\">)</span><span class=\"n\">R2VA</span><span class=\"p\">(</span><span class=\"n\">importModule</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">idte</span><span class=\"o\">-&gt;</span><span class=\"n\">Name</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">exportModuleName</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-44\" name=\"__codelineno-0-44\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-45\" name=\"__codelineno-0-45\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-46\" name=\"__codelineno-0-46\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-47\" name=\"__codelineno-0-47\"></a><span class=\"w\">        </span><span class=\"n\">idte</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-48\" name=\"__codelineno-0-48\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-49\" name=\"__codelineno-0-49\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">idte</span><span class=\"o\">-&gt;</span><span class=\"n\">FirstThunk</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mh\">0x0</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-50\" name=\"__codelineno-0-50\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-51\" name=\"__codelineno-0-51\"></a><span class=\"w\">        </span><span class=\"n\">logMessage</span><span class=\"p\">(</span><span class=\"s\">&quot;patchImport failed: idte-&gt;FirstThunk == 0x0</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-52\" name=\"__codelineno-0-52\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-53\" name=\"__codelineno-0-53\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-54\" name=\"__codelineno-0-54\"></a>\n<a id=\"__codelineno-0-55\" name=\"__codelineno-0-55\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exportModulePath</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-56\" name=\"__codelineno-0-56\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-57\" name=\"__codelineno-0-57\"></a><span class=\"w\">        </span><span class=\"n\">exportmodule</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetModuleHandleA</span><span class=\"p\">(</span><span class=\"n\">exportModulePath</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-58\" name=\"__codelineno-0-58\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-59\" name=\"__codelineno-0-59\"></a><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-60\" name=\"__codelineno-0-60\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-61\" name=\"__codelineno-0-61\"></a><span class=\"w\">        </span><span class=\"n\">exportmodule</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetModuleHandleA</span><span class=\"p\">(</span><span class=\"n\">exportModuleName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-62\" name=\"__codelineno-0-62\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-63\" name=\"__codelineno-0-63\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">exportmodule</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-64\" name=\"__codelineno-0-64\"></a><span class=\"w\">    </span><span class=\"k\">import</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetProcAddress</span><span class=\"p\">(</span><span class=\"n\">exportmodule</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">importName</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-65\" name=\"__codelineno-0-65\"></a><span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"k\">import</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-66\" name=\"__codelineno-0-66\"></a>\n<a id=\"__codelineno-0-67\" name=\"__codelineno-0-67\"></a><span class=\"w\">    </span><span class=\"n\">iate</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IMAGE_THUNK_DATA</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">R2VA</span><span class=\"p\">(</span><span class=\"n\">importModule</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">idte</span><span class=\"o\">-&gt;</span><span class=\"n\">FirstThunk</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-68\" name=\"__codelineno-0-68\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mh\">0x0</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-69\" name=\"__codelineno-0-69\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-70\" name=\"__codelineno-0-70\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">DWORD_PTR</span><span class=\"p\">)</span><span class=\"k\">import</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-71\" name=\"__codelineno-0-71\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-72\" name=\"__codelineno-0-72\"></a><span class=\"w\">            </span><span class=\"n\">VirtualProtect</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"p\">),</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-73\" name=\"__codelineno-0-73\"></a><span class=\"w\">                </span><span class=\"n\">PAGE_READWRITE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">protect</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-74\" name=\"__codelineno-0-74\"></a><span class=\"w\">            </span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">DWORD_PTR</span><span class=\"p\">)</span><span class=\"n\">replacement</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-75\" name=\"__codelineno-0-75\"></a><span class=\"w\">            </span><span class=\"n\">VirtualProtect</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">iate</span><span class=\"o\">-&gt;</span><span class=\"n\">u1</span><span class=\"p\">.</span><span class=\"n\">Function</span><span class=\"p\">),</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-76\" name=\"__codelineno-0-76\"></a><span class=\"w\">                </span><span class=\"n\">protect</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">protect</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-77\" name=\"__codelineno-0-77\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-78\" name=\"__codelineno-0-78\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-79\" name=\"__codelineno-0-79\"></a><span class=\"w\">        </span><span class=\"n\">iate</span><span class=\"o\">++</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-80\" name=\"__codelineno-0-80\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-0-81\" name=\"__codelineno-0-81\"></a>\n<a id=\"__codelineno-0-82\" name=\"__codelineno-0-82\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-83\" name=\"__codelineno-0-83\"></a><span class=\"p\">}</span>\n</code></pre></div></td></tr></table></div>\n<p>\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u51fd\u6570\uff0c\u5c31\u50cf\u6ce8\u91ca\u6240\u8bf4\u7684\uff0c\u8fd9\u4e2a\u51fd\u6570\u5b9e\u73b0\u7684\u529f\u80fd\u5c31\u662f\u628a IAT \u91cc\u9762\u7684\u67d0\u51fd\u6570\u7684\u5730\u5740\u6539\u6210\u53e6\u4e00\u4e2a\u51fd\u6570\u7684\u5730\u5740\u3002\u5148\u6765\u770b\u7b2c 34-35 \u884c\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"n\">idte</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">IMAGE_IMPORT_DESCRIPTOR</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">ImageDirectoryEntryToDataEx</span><span class=\"p\">((</span><span class=\"n\">PVOID</span><span class=\"p\">)</span><span class=\"n\">importModule</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">    </span><span class=\"n\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IMAGE_DIRECTORY_ENTRY_IMPORT</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">size</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">section</span><span class=\"p\">);</span>\n</code></pre></div>\n<p><code>ImageDirectoryEntryToDataEx</code> \u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u6a21\u5757\u7684\u6587\u4ef6\u5934\u7684\u67d0\u7ed3\u6784\u7684\u5730\u5740\uff0c<code>IMAGE_DIRECTORY_ENTRY_IMPORT</code> \u6307\u5b9a\u8981\u5bfc\u5165\u8868\u7ed3\u6784\uff0c\u6240\u4ee5\u8fd4\u56de\u7684 <code>idte</code> \u5c31\u6307\u5411\u4e86\u6a21\u5757\u5bfc\u5165\u8868\u4e86\u3002</p>\n<p>36-40 \u884c\u5c31\u662f\u68c0\u67e5 <code>idte</code> \u6709\u6548\u300241 \u884c <code>idte-&gt;FirstThunk</code> \u6307\u5411\u7684\u5c31\u662f\u5b9e\u9645\u7684 IAT \u4e86\u3002\u6240\u4ee5 41-48 \u884c\u5c31\u662f\u5728\u6839\u636e\u6a21\u5757\u540d\u5b57\u67e5\u627e\u9700\u8981\u66ff\u6362\u7684\u51fd\u6570\u7684\u6a21\u5757\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u8bf4\u660e\u6ca1\u6709\u8c03\u7528\u5230\u8be5\u6a21\u5757\u7684\u51fd\u6570\uff0c\u53ea\u80fd\u63d0\u793a\u9519\u8bef\u5e76\u8fd4\u56de\u3002</p>\n<p>\u627e\u5230\u6a21\u5757\u540e\uff0c\u81ea\u7136\u5730\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u66ff\u6362\u7684\u90a3\u4e2a\u51fd\u6570\uff0c55-62 \u884c\u6253\u5f00\u51fd\u6570\u6240\u5c5e\u7684\u6a21\u5757\uff0c64 \u884c\u627e\u5230\u51fd\u6570\u5730\u5740\u3002\u56e0\u4e3a IAT \u6ca1\u6709\u4fdd\u5b58\u540d\u5b57\uff0c\u6240\u4ee5\u9700\u8981\u5148\u6839\u636e\u539f\u6765\u7684\u51fd\u6570\u5730\u5740\uff0c\u5b9a\u4f4d\u5230\u51fd\u6570\uff0c\u518d\u4fee\u6539\u8be5\u51fd\u6570\u5730\u5740\uff0c68-80 \u884c\u5c31\u662f\u5728\u505a\u8fd9\u4e2a\u4e8b\u60c5\u3002\u6210\u529f\u627e\u5230\u51fd\u6570\u4e4b\u540e\uff0c\u5c31\u7b80\u5355\u5730\u628a\u5730\u5740\u4fee\u6539\u6210 <code>replacement</code> \u7684\u5730\u5740\u3002</p>\n<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u6210\u529f\u5730\u66ff\u6362\u4e86 IAT \u4e2d\u7684\u51fd\u6570\u4e86\u3002</p>\n<h4 id=\"_6\">\u6a21\u5757\u548c\u51fd\u6570\u540d\u5b57</h4>\n<p>\u867d\u7136\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u66ff\u6362 IAT \u51fd\u6570 <code>patchImport</code>\uff0c\u4f46\u8fd9\u4e2a\u51fd\u6570\u9700\u8981\u6307\u5b9a\u6a21\u5757\u540d\u5b57\u548c\u51fd\u6570\u540d\u5b57\u5440\uff0c\u90a3\u6211\u4eec\u600e\u4e48\u77e5\u9053\u7a0b\u5e8f\u7684\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e\u7528\u4e86\u4ec0\u4e48\u6a21\u5757\u548c\u51fd\u6570\u5462\uff1f\u4e3a\u4e86\u641e\u6e05\u695a\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9 Windows \u4e0b\u7684\u5de5\u5177 <a href=\"http://www.dependencywalker.com/\">Dependency Walker</a>\u3002Visual Studio \u4e0b\u65b0\u5efa\u4e00\u4e2a\u5de5\u7a0b\uff0c\u5728 <code>main</code> \u51fd\u6570\u91cc\u9762\u4f7f\u7528 <code>new</code> \u6765\u7533\u8bf7\u5185\u5b58\uff0c\u7f16\u8bd1 Debug \u7248\uff0c\u4e4b\u540e\u4f7f\u7528 <code>depends.exe</code> \u6765\u6253\u5f00\u7f16\u8bd1\u51fa\u6765\u7684 exe \u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e0b\u7c7b\u4f3c\u7684\u754c\u9762\uff08\u4ee5\u6211\u7684\u5de5\u7a0b <a href=\"https://github.com/disenone/LeakDetector/tree/master/LeakDetectorTest\">LeakDetectorTest</a> \u4e3a\u4f8b\uff09\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2016-6-11-memory-leak-detector/depends.png\" /></p>\n<p>\u53ef\u4ee5\u770b\u5230 LeakDetectorTest.exe \u4f7f\u7528\u4e86 uscrtbased.dll \u91cc\u9762\u7684 <code>malloc</code> \u548c <code>_free_dbg</code> \uff08\u6ca1\u6709\u5728\u56fe\u4e2d\u663e\u793a\u51fa\u6765\uff09\uff0c\u8fd9\u4e24\u4e2a\u51fd\u6570\u5c31\u662f\u6211\u4eec\u9700\u8981\u66ff\u6362\u7684\u51fd\u6570\u4e86\u3002\u8981\u6ce8\u610f\u5b9e\u9645\u7684\u6a21\u5757\u51fd\u6570\u540d\u5b57\u53ef\u80fd\u8ddf\u4f60\u7684 Windows \u548c Visual Studio \u7248\u672c\u6709\u5173\uff0c\u6211\u7684\u662f Windows 10 \u548c Visual Studio 2015\uff0c\u4f60\u9700\u8981\u505a\u7684\u5c31\u662f\u7528 depends.exe \u770b\u770b\u5b9e\u9645\u8c03\u7528\u7684\u662f\u4ec0\u4e48\u51fd\u6570\u3002</p>\n<h4 id=\"_7\">\u5206\u6790\u8c03\u7528\u6808</h4>\n<p>\u8bb0\u5f55\u5185\u5b58\u5206\u914d\u9700\u8981\u8bb0\u5f55\u5f53\u65f6\u7684\u8c03\u7528\u6808\u4fe1\u606f\uff0c\u8fd9\u91cc\u6211\u4e0d\u6253\u7b97\u8be6\u7ec6\u4ecb\u7ecd Windows \u4e0b\u5982\u4f55\u62ff\u5230\u5f53\u524d\u7684\u8c03\u7528\u6808\u4fe1\u606f\uff0c\u76f8\u5173\u7684\u51fd\u6570\u662f <code>RtlCaptureStackBackTrace</code>\uff0c\u7f51\u4e0a\u6709\u8bb8\u591a\u76f8\u5173\u7684\u8d44\u6599\uff0c\u4e5f\u53ef\u4ee5\u770b\u770b\u6211\u7684\u4ee3\u7801\u91cc\u9762\u7684\u51fd\u6570 <a href=\"https://github.com/disenone/LeakDetector/blob/master/LeakDetector/RealDetector.cpp\"><code>printTrace</code></a> \u3002</p>\n<h4 id=\"_8\">\u68c0\u6d4b\u5185\u5b58\u6cc4\u9732</h4>\n<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u628a\u9f99\u73e0\u90fd\u6536\u96c6\u5168\u4e86\uff0c\u4e0b\u9762\u6b63\u5f0f\u53ec\u5524\u795e\u9f99\u3002</p>\n<p>\u6211\u60f3\u505a\u6210\u53ef\u4ee5\u5c40\u90e8\u68c0\u6d4b\u5185\u5b58\u6cc4\u9732\uff08\u8fd9\u662f\u8ddf VLD \u4e0d\u540c\u7684\u5730\u65b9\uff0cVLD \u505a\u7684\u662f\u5168\u5c40\u7684\u68c0\u6d4b\uff0c\u5e76\u652f\u6301\u591a\u7ebf\u7a0b\uff09\u3002\u6240\u4ee5\u6211\u5728\u5b9e\u9645\u66ff\u6362\u51fd\u6570\u7684\u7c7b<code>RealDetector</code>\u4e0a\u53c8\u5c01\u88c5\u4e86\u4e00\u5c42<code>LeakDetector</code>\uff0c\u5e76\u628a<code>LeakDetector</code>\u7684\u63a5\u53e3\u66b4\u9732\u7ed9\u4f7f\u7528\u8005\u3002\u4f7f\u7528\u65f6\u53ea\u9700\u6784\u9020<code>LeakDetector</code>\uff0c\u5373\u5b8c\u6210\u51fd\u6570\u7684\u66ff\u6362\u5e76\u5f00\u59cb\u68c0\u6d4b\u5185\u5b58\u6cc4\u9732\uff0c<code>LeakDetector</code>\u6790\u6784\u65f6\u4f1a\u6062\u590d\u539f\u6765\u7684\u51fd\u6570\uff0c\u4e2d\u6b62\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\uff0c\u5e76\u6253\u5370\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u7ed3\u679c\u3002</p>\n<p>\u7528\u4e0b\u9762\u4ee3\u7801\u6d4b\u8bd5\u4e00\u4e0b\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&quot;LeakDetector.h&quot;</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;iostream&gt;</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"k\">namespace</span><span class=\"w\"> </span><span class=\"nn\">std</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">new_some_mem</span><span class=\"p\">()</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">];</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">];</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">ld</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">LDTools</span><span class=\"o\">::</span><span class=\"n\">LeakDetector</span><span class=\"p\">(</span><span class=\"s\">&quot;LeakDetectorTest.exe&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">    </span><span class=\"n\">new_some_mem</span><span class=\"p\">();</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u4ee3\u7801\u76f4\u63a5 <code>new</code> \u4e86\u4e00\u4e9b\u5185\u5b58\u51fa\u6765\uff0c\u6ca1\u6709\u91ca\u653e\u6389\u5c31\u76f4\u63a5\u9000\u51fa\uff0c\u7a0b\u5e8f\u6253\u5370\u7684\u7ed3\u679c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a>============== LeakDetector::start ===============\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>LeakDetector init success.\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a>============== LeakDetector::stop ================\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>Memory Leak Detected: total 2\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a>Num 1:\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a>    e:\\program\\github\\leakdetector\\leakdetector\\realdetector.cpp (109): LeakDetector.dll!LDTools::RealDetector::_malloc() + 0x1c bytes\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\heap\\new_scalar.cpp (19): LeakDetectorTest.exe!operator new() + 0x9 bytes\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\heap\\new_array.cpp (15): LeakDetectorTest.exe!operator new[]() + 0x9 bytes\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a>    e:\\program\\github\\leakdetector\\leakdetectortest\\leakdetectortest.cpp (12): LeakDetectorTest.exe!new_some_mem() + 0x7 bytes\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a>    e:\\program\\github\\leakdetector\\leakdetectortest\\leakdetectortest.cpp (19): LeakDetectorTest.exe!main()\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (74): LeakDetectorTest.exe!invoke_main() + 0x1b bytes\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (264): LeakDetectorTest.exe!__scrt_common_main_seh() + 0x5 bytes\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (309): LeakDetectorTest.exe!__scrt_common_main()\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_main.cpp (17): LeakDetectorTest.exe!mainCRTStartup()\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a>    KERNEL32.DLL!BaseThreadInitThunk() + 0x24 bytes\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a>    ntdll.dll!RtlUnicodeStringToInteger() + 0x253 bytes\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a>    ntdll.dll!RtlUnicodeStringToInteger() + 0x21e bytes\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a>Num 2:\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a>    e:\\program\\github\\leakdetector\\leakdetector\\realdetector.cpp (109): LeakDetector.dll!LDTools::RealDetector::_malloc() + 0x1c bytes\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\heap\\new_scalar.cpp (19): LeakDetectorTest.exe!operator new() + 0x9 bytes\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\heap\\new_array.cpp (15): LeakDetectorTest.exe!operator new[]() + 0x9 bytes\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a>    e:\\program\\github\\leakdetector\\leakdetectortest\\leakdetectortest.cpp (11): LeakDetectorTest.exe!new_some_mem() + 0x7 bytes\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a>    e:\\program\\github\\leakdetector\\leakdetectortest\\leakdetectortest.cpp (19): LeakDetectorTest.exe!main()\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (74): LeakDetectorTest.exe!invoke_main() + 0x1b bytes\n<a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (264): LeakDetectorTest.exe!__scrt_common_main_seh() + 0x5 bytes\n<a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl (309): LeakDetectorTest.exe!__scrt_common_main()\n<a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a>    f:\\dd\\vctools\\crt\\vcstartup\\src\\startup\\exe_main.cpp (17): LeakDetectorTest.exe!mainCRTStartup()\n<a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a>    KERNEL32.DLL!BaseThreadInitThunk() + 0x24 bytes\n<a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a>    ntdll.dll!RtlUnicodeStringToInteger() + 0x253 bytes\n<a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a>    ntdll.dll!RtlUnicodeStringToInteger() + 0x21e bytes\n</code></pre></div>\n<p>\u7a0b\u5e8f\u6b63\u786e\u5730\u627e\u51fa\u6709\u4e24\u4e2a\u5730\u65b9\u7533\u8bf7\u7684\u5185\u5b58\u6ca1\u6709\u91ca\u653e\uff0c\u5e76\u4e14\u6253\u5370\u51fa\u4e86\u5b8c\u6574\u7684\u8c03\u7528\u6808\u4fe1\u606f\uff0c\u6211\u4eec\u9700\u8981\u7684\u529f\u80fd\u81f3\u6b64\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002</p>\n<h3 id=\"_9\">\u7ed3\u8bed</h3>\n<p>\u5f53\u4f60\u8fd8\u4e0d\u4e86\u89e3\u7a0b\u5e8f\u94fe\u63a5\u3001\u88c5\u8f7d\u4e0e\u5e93\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u5bf9\u5982\u4f55\u627e\u5230\u5171\u4eab\u94fe\u63a5\u5e93\u7684\u51fd\u6570\u4e00\u5934\u96fe\u6c34\uff0c\u66f4\u4e0d\u8981\u8bf4\u8981\u628a\u94fe\u63a5\u5e93\u7684\u51fd\u6570\u66ff\u6362\u6210\u6211\u4eec\u81ea\u5df1\u7684\u51fd\u6570\u4e86\u3002\u8fd9\u91cc\u5c31\u4ee5\u68c0\u6d4b\u5185\u5b58\u6cc4\u9732\u4e3a\u4f8b\u5b50\uff0c\u63a2\u8ba8\u4e0b\u4e86\u5982\u4f55\u66ff\u6362 Windows DLL \u7684\u51fd\u6570\uff0c\u66f4\u8be6\u7ec6\u7684\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003 VLD \u7684\u6e90\u7801\u3002</p>\n<p>\u53e6\u5916\u60f3\u8bf4\u7684\u662f\uff0c\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\uff1a\u94fe\u63a5\u3001\u88c5\u8f7d\u4e0e\u5e93\u300b\u771f\u662f\u672c\u4e0d\u9519\u7684\u4e66\u5462\uff0c\u7eaf\u611f\u6168\u975e\u8f6f\u5e7f\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/py-Python%E6%9D%82%E8%B0%881-%E6%8E%A2%E7%A9%B6__builtins__/",
            "url": "https://wiki.disenone.site/py-Python%E6%9D%82%E8%B0%881-%E6%8E%A2%E7%A9%B6__builtins__/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Python \u6742\u8c08 1 - \u63a2\u7a76 __builtins__",
            "content_html": "<p><meta property=\"og:title\" content=\"Python \u6742\u8c08 1 - \u63a2\u7a76 __builtins__ - Disenone\" /></p>\n<h2 id=\"_1\">\u5f15\u5b50</h2>\n<p>\u6211\u4eec\u77e5\u9053\uff0c<code>__builtins__</code> \u672c\u8eab\u662f\u5728\u5168\u5c40\u547d\u540d\u7a7a\u95f4\u4e2d\u5c31\u6709\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u662f <code>Python</code> \u6545\u610f\u66b4\u9732\u51fa\u6765\u7ed9\u4ee3\u7801\u5c42\u7684\uff0c\u5728\u4ee3\u7801\u7684\u4efb\u610f\u5730\u65b9\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\u4f46\u662f\u6709\u70b9\u51b7\u7684\u77e5\u8bc6\u662f\uff0c<code>__builtins__</code> \u5728 <code>main</code> \u6a21\u5757\uff08\u4e5f\u5c31\u662f <code>__main__</code>\uff0c\u6307\u7684\u90fd\u662f\u540c\u4e00\u4e2a\u6a21\u5757\uff0c\u540e\u6587\u53ef\u80fd\u4f1a\u6df7\u7528\uff09\u91cc\u9762\u662f <code>__builtin__</code> \u8fd9\u4e2a\u6a21\u5757\uff0c\u4f46\u5728\u5176\u4ed6\u6a21\u5757\u91cc\u9762\uff0c\u5b83\u8868\u793a\u7684\u662f <code>__builtin__.__dict__</code>\uff0c\u8fd9\u5c31\u6709\u70b9\u8ba9\u4eba\u83ab\u540d\u5176\u5999\u4e86\u3002\u867d\u7136\u5b98\u65b9\u4e0d\u63a8\u8350\u76f4\u63a5\u4f7f\u7528 <code>__builtins__</code>\uff0c\u4f46\u4f60\u7ed9\u6211\u641e\u4e24\u79cd\u60c5\u51b5\u662f\u600e\u4e48\u56de\u4e8b\uff1f\u672c\u6587\u6211\u4eec\u5c31\u6765\u76d8\u4e00\u76d8\u8fd9\u4e2a\u8bbe\u5b9a\u7684\u7531\u6765\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u627e\u5230\u8fd9\u4e9b\u95ee\u9898\u7684\u7b54\u6848\uff1a<code>__builtin__</code> \u8ddf <code>__builtins__</code> \u6709\u4ec0\u4e48\u533a\u522b\uff1f<code>__builtins__</code> \u5728 <code>main</code> \u6a21\u5757\u8ddf\u5176\u4ed6\u6a21\u5757\u4e3a\u4ec0\u4e48\u4f1a\u8bbe\u5b9a\u6210\u4e0d\u540c\uff1f<code>__builtins__</code> \u662f\u5728\u54ea\u91cc\u5b9a\u4e49\u7684\uff1f</p>\n<h2 id=\"__builtin__\"><code>__builtin__</code></h2>\n<p>\u5728\u63a2\u8ba8 <code>__builtins__</code> \u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u770b\u770b <code>__builtin__</code> \u662f\u4ec0\u4e48\u3002<code>__builtin__</code> \u662f\u5b58\u653e\u6240\u6709\u5185\u5efa\u5bf9\u8c61\u7684\u6a21\u5757\uff0c\u6211\u4eec\u5e73\u5e38\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684 <code>Python</code> \u5185\u5efa\u5bf9\u8c61\uff0c\u672c\u8d28\u4e0a\u90fd\u662f <code>__builtin__</code> \u6a21\u5757\u91cc\u7684\u5bf9\u8c61\uff0c\u5373\u653e\u5728 <code>__builtin__.__dict__</code> \u91cc\uff0c\u5bf9\u5e94\u7740\u7684\u662f <code>Python</code> \u7684\u5185\u5efa\u540d\u5b57\u7a7a\u95f4\u3002\u8bb0\u4f4f\u8fd9\u4e2a\u5173\u952e\u77e5\u8bc6\u70b9\uff1a<code>__buintin__</code> \u662f\u4e00\u4e2a\u6a21\u5757 <code>module</code>\u3002\u6211\u4eec\u53ef\u4ee5\u5728 <code>Python</code> \u6e90\u7801\u4e2d\u627e\u5230 <code>__builtin__</code> \u6a21\u5757\u7684\u5b9a\u4e49\u548c\u4f7f\u7528\uff08\u6ce8\u610f\uff0c\u4e0b\u6587\u63d0\u5230\u7684 <code>Python</code> \u6e90\u7801\uff0c\u90fd\u662f\u6307 CPython-2.7.18 \u6e90\u7801\uff09\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\">// pythonrun.c</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"kt\">void</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"nf\">Py_InitializeEx</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">install_sigs</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">    </span><span class=\"n\">PyInterpreterState</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">interp</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">    </span><span class=\"c1\">// \u521d\u59cb\u5316 __builtin__</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"n\">bimod</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_PyBuiltin_Init</span><span class=\"p\">();</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"c1\">// interp-&gt;builtins = __builtin__.__dict__</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">    </span><span class=\"n\">interp</span><span class=\"o\">-&gt;</span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">bimod</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"c1\">// bltinmodule.c</span>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"nf\">_PyBuiltin_Init</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"w\">    </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">mod</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dict</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">debug</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"w\">    </span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Py_InitModule4</span><span class=\"p\">(</span><span class=\"s\">&quot;__builtin__&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">builtin_methods</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"w\">                         </span><span class=\"n\">builtin_doc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"nb\">NULL</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">                         </span><span class=\"n\">PYTHON_API_VERSION</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"n\">dict</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a>\n<a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a><span class=\"w\">    </span><span class=\"c1\">// \u7ed9 dict \u52a0\u4e0a\u5185\u5efa\u7684\u5bf9\u8c61</span>\n<a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\" href=\"#__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\" href=\"#__codelineno-0-28\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\" href=\"#__codelineno-0-29\"></a>\n<a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\" href=\"#__codelineno-0-30\"></a><span class=\"c1\">// ceval.c</span>\n<a id=\"__codelineno-0-31\" name=\"__codelineno-0-31\" href=\"#__codelineno-0-31\"></a><span class=\"c1\">// \u83b7\u53d6 builtins</span>\n<a id=\"__codelineno-0-32\" name=\"__codelineno-0-32\" href=\"#__codelineno-0-32\"></a><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-0-33\" name=\"__codelineno-0-33\" href=\"#__codelineno-0-33\"></a><span class=\"nf\">PyEval_GetBuiltins</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-34\" name=\"__codelineno-0-34\" href=\"#__codelineno-0-34\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-35\" name=\"__codelineno-0-35\" href=\"#__codelineno-0-35\"></a><span class=\"w\">    </span><span class=\"n\">PyFrameObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">current_frame</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyEval_GetFrame</span><span class=\"p\">();</span>\n<a id=\"__codelineno-0-36\" name=\"__codelineno-0-36\" href=\"#__codelineno-0-36\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">current_frame</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-37\" name=\"__codelineno-0-37\" href=\"#__codelineno-0-37\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">PyThreadState_GET</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">interp</span><span class=\"o\">-&gt;</span><span class=\"n\">builtins</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-38\" name=\"__codelineno-0-38\" href=\"#__codelineno-0-38\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-0-39\" name=\"__codelineno-0-39\" href=\"#__codelineno-0-39\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">current_frame</span><span class=\"o\">-&gt;</span><span class=\"n\">f_builtins</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-40\" name=\"__codelineno-0-40\" href=\"#__codelineno-0-40\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>Python</code> \u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u8c03\u7528 <code>_PyBuiltin_Init</code> \u6765\u521b\u5efa <code>__builtin__</code> \u6a21\u5757\uff0c\u5e76\u5728\u91cc\u9762\u6dfb\u52a0\u4e0a\u5185\u5efa\u7684\u5bf9\u8c61\uff0c\u89e3\u91ca\u5668\u672c\u8eab\u4f1a\u5f15\u7528\u4f4f <code>interp-&gt;builtins = __buintin__.__dict__</code>\uff0c\u5f53\u524d\u6267\u884c\u7684\u6808\u5e27\u7ed3\u6784\u540c\u65f6\u4e5f\u4f1a\u5f15\u7528\u4e00\u4efd <code>current_frame-&gt;f_builtins</code>\u3002\u90a3\u4e48\u5f88\u81ea\u7136\u5730\uff0c\u5f53\u6267\u884c\u4ee3\u7801\u9700\u8981\u6839\u636e\u540d\u5b57\u5bfb\u627e\u5bf9\u8c61\u7684\u65f6\u5019\uff0c<code>Python</code> \u4f1a\u53bb <code>current_frame-&gt;f_builtins</code> \u91cc\u9762\u6765\u627e\uff0c\u81ea\u7136\u5c31\u80fd\u62ff\u5230\u6240\u6709\u7684\u5185\u5efa\u5bf9\u8c61\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"c1\">// ceval.c</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"n\">TARGET</span><span class=\"p\">(</span><span class=\"n\">LOAD_NAME</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5148\u5728 f-&gt;f_locals \u540d\u5b57\u7a7a\u95f4\u91cc\u9762\u627e</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">        </span><span class=\"c1\">// \u518d\u627e\u627e\u5168\u5c40\u7a7a\u95f4</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">        </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyDict_GetItem</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">-&gt;</span><span class=\"n\">f_globals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">            </span><span class=\"c1\">// \u8fd9\u91cc\u5c31\u53bb\u5185\u5efa\u7a7a\u95f4\u627e</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">            </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyDict_GetItem</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">-&gt;</span><span class=\"n\">f_builtins</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">                </span><span class=\"n\">format_exc_check_arg</span><span class=\"p\">(</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">                            </span><span class=\"n\">PyExc_NameError</span><span class=\"p\">,</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">                            </span><span class=\"n\">NAME_ERROR_MSG</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">        </span><span class=\"n\">Py_INCREF</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"n\">PUSH</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">    </span><span class=\"n\">DISPATCH</span><span class=\"p\">();</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u6700\u540e\uff0c\u7531\u4e8e <code>__builtin__</code> \u8fd9\u4e2a\u540d\u5b57\u5b9e\u5728\u662f\u592a\u6709\u8ff7\u60d1\u6027\u4e86\uff0c<code>Python3</code> \u4e2d\u5df2\u7ecf\u6539\u540d\u4e3a <code>builtins</code>\u3002</p>\n<h2 id=\"__builtins__\"><code>__builtins__</code></h2>\n<p><code>__builtins__</code> \u7684\u8868\u73b0\u662f\u6709\u70b9\u5947\u602a\u7684\uff1a\n* \u5728 <code>main</code> \u6a21\u5757\u4e2d\uff08<code>main</code> \u6a21\u5757\uff0c\u6216\u8005\u53eb<code>\u6700\u9ad8\u5c42\u7ea7\u4ee3\u7801\u8fd0\u884c\u6240\u5728\u73af\u5883</code>\uff0c\u662f\u7528\u6237\u6307\u5b9a\u6700\u5148\u542f\u52a8\u8fd0\u884c\u7684 <code>Python</code> \u6a21\u5757\uff0c\u4e5f\u5c31\u662f\u901a\u5e38\u6211\u4eec\u5728\u547d\u4ee4\u884c\u6267\u884c <code>python xxx.py</code> \u65f6\uff0c<code>xxx.py</code> \u8fd9\u4e2a\u6a21\u5757\uff09\uff0c<code>__builtins__ = __builtin__</code>\uff1b\n* \u5728\u5176\u4ed6\u6a21\u5757\u4e2d <code>__builtins__ = __builtin__.__dict__</code>\u3002</p>\n<p>\u76f8\u540c\u7684\u540d\u5b57\uff0c\u4f46\u5728\u4e0d\u540c\u7684\u6a21\u5757\u4e0b\u8868\u73b0\u5374\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u8fd9\u6837\u7684\u8bbe\u5b9a\u5f88\u5bb9\u6613\u8ba9\u4eba\u7591\u60d1\u3002\u4e0d\u8fc7\u53ea\u8981\u77e5\u9053\u8fd9\u4e2a\u8bbe\u5b9a\uff0c\u5c31\u8db3\u591f\u652f\u6301\u4f60\u5728 <code>Python</code> \u4e2d\u4f7f\u7528 <code>__builtins__</code>\uff0c\u7591\u60d1\u5e76\u4e0d\u4f1a\u5f71\u54cd\u4f60\u5199\u51fa\u8db3\u591f\u5b89\u5168\u7684\u4ee3\u7801\uff0c\u8bf8\u5982\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">def</span> <span class=\"nf\">SetBuiltins</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">):</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">,</span> <span class=\"nb\">dict</span><span class=\"p\">):</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>        <span class=\"n\">builtins</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">val</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>    <span class=\"k\">else</span><span class=\"p\">:</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"n\">SetBuiltins</span><span class=\"p\">(</span><span class=\"n\">__builtins__</span><span class=\"p\">,</span> <span class=\"s1\">&#39;test&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>\u9700\u8981\u6ce8\u610f\uff0c\u5176\u5b9e\u5e76\u4e0d\u5efa\u8bae\u4f7f\u7528 <code>__builtins__</code>\uff1a</p>\n<blockquote>\n<p><strong>CPython implementation detail</strong>: Users should not touch <code>__builtins__</code>; it is strictly an implementation detail. Users wanting to override values in the builtins namespace should import the <code>__builtin__</code> (no \u2018s\u2019) module and modify its attributes appropriately.</p>\n</blockquote>\n<p>\u5f53\u7136\uff0c\u8fd9\u6837\u7684\u7591\u60d1\uff0c\u603b\u6709\u4e00\u5929\u4f1a\u8ba9\u4f60\u5fc3\u75d2\u96be\u8010\uff0c\u6211\u8fd9\u91cc\u5c31\u51b3\u5b9a\u7ee7\u7eed\u63a2\u7a76\u4e0b\u53bb\uff0c\u4e5f\u56e0\u4e3a\u8fd9\u6837\uff0c\u624d\u6709\u4e86\u8fd9\u7bc7\u6587\u7ae0\u3002\u6211\u4eec\u4e0b\u9762\u7684\u5185\u5bb9\u4f1a\u6df1\u5165\u5230 <strong>CPython implementation detail</strong> \u4e2d\u53bb\u3002</p>\n<h2 id=\"restricted-execution\">Restricted Execution</h2>\n<p>Restricted Execution \u53ef\u4ee5\u7406\u89e3\u4e3a\u6709\u9650\u5236\u5730\u6267\u884c\u4e0d\u5b89\u5168\u7684\u4ee3\u7801\uff0c\u6240\u8c13\u6709\u9650\u5236\uff0c\u53ef\u4ee5\u662f\u9650\u5236\u7f51\u7edc\u3001io \u7b49\u7b49\uff0c\u628a\u4ee3\u7801\u9650\u5236\u5728\u4e00\u5b9a\u7684\u6267\u884c\u73af\u5883\u4e2d\uff0c\u63a7\u5236\u4ee3\u7801\u7684\u6267\u884c\u6743\u9650\uff0c\u9632\u6b62\u4ee3\u7801\u5f71\u54cd\u5230\u5916\u90e8\u7684\u73af\u5883\u548c\u7cfb\u7edf\u3002\u5e38\u89c1\u7684\u7528\u4f8b\u5c31\u662f\u4e00\u4e9b\u5728\u7ebf\u4ee3\u7801\u6267\u884c\u7f51\u7ad9\uff0c\u8b6c\u5982\u8fd9\u4e2a\uff1a<a href=\"https://pythonsandbox.dev/\">pythonsandbox</a>\u3002</p>\n<p>\u8ddf\u4f60\u731c\u60f3\u7684\u4e00\u6837\uff0c<code>Python</code> \u5bf9 <code>__builtins__</code> \u7684\u8bbe\u5b9a\u662f\u8ddf Restricted Execution \u6709\u5173\u3002<code>Python</code> \u5728 2.3 \u7248\u672c\u4e4b\u524d\uff0c\u66fe\u7ecf\u63d0\u4f9b\u8fc7\u7c7b\u4f3c\u7684\u529f\u80fd <a href=\"https://docs.python.org/2.7/library/restricted.html\">Restricted Execution</a>\uff0c\u53ea\u662f\u7531\u4e8e\u540e\u6765\u88ab\u8bc1\u5b9e\u4e3a\u4e0d\u53ef\u884c\u7684\uff0c\u53ea\u597d\u628a\u8fd9\u4e2a\u529f\u80fd\u4f5c\u5e9f\u4e86\uff0c\u4f46\u4ee3\u7801\u5728 2.7.18 \u7248\u672c\u8fd8\u4fdd\u7559\u7740\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6765\u8003\u53e4\u3002</p>\n<p>\u9996\u5148\u6765\u770b <code>Python</code> \u6e90\u7801\u91cc\u9762\u5bf9 <code>__builtins__</code> \u7684\u8bbe\u7f6e\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"c1\">// pythonrun.c</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">initmain</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">    </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">m</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">    </span><span class=\"c1\">// \u83b7\u53d6 __main__ \u6a21\u5757</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">    </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyImport_AddModule</span><span class=\"p\">(</span><span class=\"s\">&quot;__main__&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">        </span><span class=\"n\">Py_FatalError</span><span class=\"p\">(</span><span class=\"s\">&quot;can&#39;t create __main__ module&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">    </span><span class=\"c1\">// d = __main__.__dict__</span>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">    </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8bbe\u7f6e __main__.__dict__[&#39;__builtins__&#39;]\uff0c\u5982\u679c\u5df2\u6709\uff0c\u5219\u8df3\u8fc7</span>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyDict_GetItemString</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;__builtins__&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">        </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">bimod</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyImport_ImportModule</span><span class=\"p\">(</span><span class=\"s\">&quot;__builtin__&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">bimod</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"w\"> </span><span class=\"o\">||</span>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">            </span><span class=\"n\">PyDict_SetItemString</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;__builtins__&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">bimod</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">            </span><span class=\"n\">Py_FatalError</span><span class=\"p\">(</span><span class=\"s\">&quot;can&#39;t add __builtins__ to __main__&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">        </span><span class=\"n\">Py_XDECREF</span><span class=\"p\">(</span><span class=\"n\">bimod</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5728 <code>initmain</code> \u4e2d\uff0c<code>Python</code> \u4f1a\u7ed9 <code>__main__</code> \u6a21\u5757\u8bbe\u7f6e <code>__builtins__</code> \u5c5e\u6027\uff0c\u9ed8\u8ba4\u7b49\u4e8e <code>__builtin__</code> \u6a21\u5757\uff0c\u4f46\u5982\u679c\u5df2\u6709\uff0c\u5219\u8df3\u8fc7\u4e0d\u4f1a\u91cd\u65b0\u8bbe\u7f6e\u3002\u5229\u7528\u8fd9\u4e2a\u7279\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 <code>__main__.__builtins__</code> \u6765\u4fee\u6539\u5185\u5efa\u7684\u4e00\u4e9b\u529f\u80fd\uff0c\u4ee5\u8fbe\u5230\u9650\u5236\u4ee3\u7801\u6267\u884c\u6743\u9650\u7684\u76ee\u7684\uff0c\u5177\u4f53\u7684\u65b9\u6cd5\u5148\u6309\u4e0b\u4e0d\u8868\uff0c\u6211\u4eec\u770b\u770b <code>__builtins__</code> \u662f\u600e\u4e48\u88ab\u4f20\u9012\u7684\u3002</p>\n<h2 id=\"__builtins___1\"><code>__builtins__</code> \u7684\u4f20\u9012</h2>\n<p>\u5728\u521b\u5efa\u65b0\u7684\u6808\u5e27\u7684\u65f6\u5019\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"n\">PyFrameObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"nf\">PyFrame_New</span><span class=\"p\">(</span><span class=\"n\">PyThreadState</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">tstate</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">code</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">globals</span><span class=\"p\">,</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">            </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">locals</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">back</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">back</span><span class=\"o\">-&gt;</span><span class=\"n\">f_globals</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">globals</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">        </span><span class=\"c1\">// \u53d6 globals[&#39;__builtins__&#39;] \u4f5c\u4e3a\u65b0\u6808\u5e27\u7684 __builtins__</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">        </span><span class=\"c1\">// builtin_object \u5c31\u662f\u5b57\u7b26\u4e32 &#39;__builtins__&#39;</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">        </span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyDict_GetItem</span><span class=\"p\">(</span><span class=\"n\">globals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">builtin_object</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyModule_Check</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">                </span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">                </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">PyDict_Check</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">));</span>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">            </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">PyDict_Check</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">))</span>\n<a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">                </span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">        </span><span class=\"p\">...</span>\n<a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a>\n<a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">        </span><span class=\"cm\">/* If we share the globals, we share the builtins.</span>\n<a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"cm\">           Save a lookup and a call. */</span>\n<a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">        </span><span class=\"c1\">// \u6216\u8005\u76f4\u63a5\u7ee7\u627f\u4e0a\u4e00\u5c42\u6808\u5e27\u7684 f_builtins</span>\n<a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">        </span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">back</span><span class=\"o\">-&gt;</span><span class=\"n\">f_builtins</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">        </span><span class=\"n\">assert</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">PyDict_Check</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">));</span>\n<a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">        </span><span class=\"n\">Py_INCREF</span><span class=\"p\">(</span><span class=\"n\">builtins</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">    </span><span class=\"n\">f</span><span class=\"o\">-&gt;</span><span class=\"n\">f_builtins</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">builtins</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a><span class=\"w\">    </span><span class=\"n\">f</span><span class=\"o\">-&gt;</span><span class=\"n\">f_globals</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">globals</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u521b\u5efa\u65b0\u7684\u6808\u5e27\u65f6\uff0c\u5bf9\u4e8e <code>__builtins__</code> \u7684\u5904\u7406\u4e3b\u8981\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u4e00\u79cd\u662f\u6ca1\u6709\u4e0a\u5c42\u6808\u5e27\u7684\u60c5\u51b5\u4e0b\uff0c\u53d6 <code>globals['__builtins__']</code>\uff1b\u53e6\u4e00\u79cd\u662f\u76f4\u63a5\u53d6\u4e0a\u5c42\u6808\u5e27\u7684 <code>f_builtins</code>\u3002\u8054\u5408\u8d77\u6765\u770b\u7684\u8bdd\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728 <code>__main__</code> \u4e2d\u8bbe\u7f6e\u597d\u7684 <code>__builtins__</code>\uff0c\u4f1a\u4e00\u76f4\u7ee7\u627f\u7ed9\u540e\u9762\u7684\u6808\u5e27\uff0c\u76f8\u5f53\u4e8e\u5171\u7528\u540c\u4e00\u4efd\u3002</p>\n<p><code>import</code> \u6a21\u5757\u65f6\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"nf\">load_compiled_module</span><span class=\"p\">(</span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">cpathname</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">FILE</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">fp</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"w\">    </span><span class=\"kt\">long</span><span class=\"w\"> </span><span class=\"n\">magic</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"w\">    </span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">co</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\">    </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">m</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">    </span><span class=\"n\">co</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">read_compiled_module</span><span class=\"p\">(</span><span class=\"n\">cpathname</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fp</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">    </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyImport_ExecCodeModuleEx</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cpathname</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a>\n<a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a>\n<a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a><span class=\"nf\">PyImport_ExecCodeModuleEx</span><span class=\"p\">(</span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">pathname</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a><span class=\"w\">    </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyImport_AddModule</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a><span class=\"w\">    </span><span class=\"c1\">// d = m.__dict__</span>\n<a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a><span class=\"w\">    </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a>\n<a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\" href=\"#__codelineno-5-24\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5728\u8fd9\u91cc\u8bbe\u7f6e\u65b0\u52a0\u8f7d\u6a21\u5757\u7684 __builtins__ \u5c5e\u6027</span>\n<a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\" href=\"#__codelineno-5-25\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyDict_GetItemString</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;__builtins__&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\" href=\"#__codelineno-5-26\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyDict_SetItemString</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;__builtins__&quot;</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\" href=\"#__codelineno-5-27\"></a><span class=\"w\">                                 </span><span class=\"n\">PyEval_GetBuiltins</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\" href=\"#__codelineno-5-28\"></a><span class=\"w\">            </span><span class=\"k\">goto</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">;</span>\n<a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\" href=\"#__codelineno-5-29\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\" href=\"#__codelineno-5-30\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\" href=\"#__codelineno-5-31\"></a><span class=\"w\">    </span><span class=\"c1\">// globals = d, locals = d</span>\n<a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\" href=\"#__codelineno-5-32\"></a><span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyEval_EvalCode</span><span class=\"p\">((</span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\" href=\"#__codelineno-5-33\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\" href=\"#__codelineno-5-34\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\" href=\"#__codelineno-5-35\"></a>\n<a id=\"__codelineno-5-36\" name=\"__codelineno-5-36\" href=\"#__codelineno-5-36\"></a><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-5-37\" name=\"__codelineno-5-37\" href=\"#__codelineno-5-37\"></a><span class=\"nf\">PyEval_EvalCode</span><span class=\"p\">(</span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">globals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">locals</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-38\" name=\"__codelineno-5-38\" href=\"#__codelineno-5-38\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-5-39\" name=\"__codelineno-5-39\" href=\"#__codelineno-5-39\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">PyEval_EvalCodeEx</span><span class=\"p\">(</span><span class=\"n\">co</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-40\" name=\"__codelineno-5-40\" href=\"#__codelineno-5-40\"></a><span class=\"w\">                      </span><span class=\"n\">globals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">locals</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-41\" name=\"__codelineno-5-41\" href=\"#__codelineno-5-41\"></a><span class=\"w\">                      </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"p\">)</span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-42\" name=\"__codelineno-5-42\" href=\"#__codelineno-5-42\"></a><span class=\"w\">                      </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"p\">)</span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-43\" name=\"__codelineno-5-43\" href=\"#__codelineno-5-43\"></a><span class=\"w\">                      </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"p\">)</span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<a id=\"__codelineno-5-44\" name=\"__codelineno-5-44\" href=\"#__codelineno-5-44\"></a><span class=\"w\">                      </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-45\" name=\"__codelineno-5-45\" href=\"#__codelineno-5-45\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>import</code> \u5176\u4ed6\u6a21\u5757\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u8be5\u6a21\u5757\u7684 <code>__builtins__</code> \u8bbe\u7f6e\u4e3a <code>PyEval_GetBuiltins()</code> \u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd9\u4e2a\u51fd\u6570\u6211\u4eec\u5df2\u7ecf\u8bf4\u8fc7\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u76f8\u5f53\u4e8e <code>current_frame-&gt;f_builtins</code>\u3002\u5bf9\u4e8e <code>__main__</code> \u6a21\u5757\u7684\u91cc\u9762\u7684 <code>import</code>\uff0c<code>current_frame</code> \u5c31\u662f <code>__main__</code> \u6a21\u5757\u7684\u6808\u5e27\uff0c<code>current_frame-&gt;f_builtins = __main__.__dict__['__builtins__']</code>\uff08\u4e0a\u6587 <code>PyFrame_New</code> \u7684\u7b2c\u4e00\u79cd\u60c5\u51b5\uff09\u3002</p>\n<p>\u52a0\u8f7d\u7684\u65b0\u6a21\u5757\uff0c\u4f1a\u4f7f\u7528 <code>PyEval_EvalCode</code> \u6765\u6267\u884c\u65b0\u6a21\u5757\u4e2d\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4f20\u7ed9 <code>PyEval_EvalCode</code> \u7684\u53c2\u6570 <code>globals</code>\u3001<code>locals</code> \u5176\u5b9e\u90fd\u662f\u6a21\u5757\u81ea\u8eab\u7684 <code>__dict__</code>\uff0c\u5e76\u4e14\u6a21\u5757 <code>m.__dict__['__builtins__'] = PyEval_GetBuiltins()</code> \u3002</p>\n<p>\u7efc\u5408\u6765\u770b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u4ece <code>__main__</code> \u6a21\u5757\u5f00\u59cb <code>import</code> \u7684\u6a21\u5757\uff0c\u4e5f\u4f1a\u7ee7\u627f <code>__main__</code> \u4e2d\u7684 <code>__builtins__</code>\uff0c\u5e76\u4f1a\u5728\u5185\u90e8\u7684 <code>import</code> \u4e2d\u4f20\u9012\u4e0b\u53bb\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u786e\u4fdd\uff0c\u6240\u6709\u4ece <code>__main__</code> \u52a0\u8f7d\u7684\u6a21\u5757\u548c\u5b50\u6a21\u5757\uff0c\u90fd\u80fd\u5171\u7528\u540c\u4e00\u4efd\u6765\u81ea <code>__main__</code> \u7684 <code>__builtins__</code>\u3002</p>\n<p>\u90a3\u4e48\u5982\u679c\u662f\u5728\u6a21\u5757\u4e2d\u8c03\u7528\u7684\u51fd\u6570\u5462\uff1f\u5bf9\u4e8e\u6a21\u5757\u4e2d\u7684\u51fd\u6570\uff0c\u521b\u5efa\u548c\u8c03\u7528\u65f6\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"c1\">// ceval.c</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"c1\">// \u521b\u5efa\u51fd\u6570</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"n\">TARGET</span><span class=\"p\">(</span><span class=\"n\">MAKE_FUNCTION</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">POP</span><span class=\"p\">();</span><span class=\"w\"> </span><span class=\"cm\">/* code object */</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8fd9\u91cc\u7684 f-&gt;f_globals\uff0c\u76f8\u5f53\u4e8e\u6a21\u5757\u81ea\u8eab\u7684 globals\uff0c\u7531\u4e0a\u6587\u53ef\u77e5\uff0c\u4e5f\u76f8\u5f53\u4e8e m.__dict__</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">    </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyFunction_New</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">-&gt;</span><span class=\"n\">f_globals</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"n\">PyFunction_New</span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">code</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">globals</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">    </span><span class=\"n\">PyFunctionObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyObject_GC_New</span><span class=\"p\">(</span><span class=\"n\">PyFunctionObject</span><span class=\"p\">,</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">                                        </span><span class=\"o\">&amp;</span><span class=\"n\">PyFunction_Type</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8fd9\u91cc\u76f8\u5f53\u4e8e op-&gt;func_globals = globals = f-&gt;f_globals</span>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">    </span><span class=\"n\">op</span><span class=\"o\">-&gt;</span><span class=\"n\">func_globals</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">globals</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"c1\">// \u8c03\u7528\u51fd\u6570</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a><span class=\"n\">fast_function</span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">***</span><span class=\"n\">pp_stack</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">na</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">nk</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"w\">    </span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">co</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyCodeObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">PyFunction_GET_CODE</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"w\">    </span><span class=\"c1\">// globals = func-&gt;func_globals</span>\n<a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a><span class=\"w\">    </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">globals</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyFunction_GET_GLOBALS</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-6-30\" name=\"__codelineno-6-30\" href=\"#__codelineno-6-30\"></a><span class=\"w\">    </span><span class=\"c1\">// globals \u4f20\u7ed9 PyEval_EvalCodeEx\uff0c\u91cc\u9762\u5c31\u4f1a\u4f20\u7ed9 PyFrame_New \u6765\u521b\u5efa\u65b0\u7684\u6808\u5e27</span>\n<a id=\"__codelineno-6-31\" name=\"__codelineno-6-31\" href=\"#__codelineno-6-31\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">PyEval_EvalCodeEx</span><span class=\"p\">(</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">globals</span><span class=\"p\">,</span>\n<a id=\"__codelineno-6-32\" name=\"__codelineno-6-32\" href=\"#__codelineno-6-32\"></a><span class=\"w\">                             </span><span class=\"p\">(</span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">pp_stack</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"n\">n</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">na</span><span class=\"p\">,</span>\n<a id=\"__codelineno-6-33\" name=\"__codelineno-6-33\" href=\"#__codelineno-6-33\"></a><span class=\"w\">                             </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">pp_stack</span><span class=\"p\">)</span><span class=\"mi\">-2</span><span class=\"o\">*</span><span class=\"n\">nk</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nk</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nd</span><span class=\"p\">,</span>\n<a id=\"__codelineno-6-34\" name=\"__codelineno-6-34\" href=\"#__codelineno-6-34\"></a><span class=\"w\">                             </span><span class=\"n\">PyFunction_GET_CLOSURE</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">));</span>\n<a id=\"__codelineno-6-35\" name=\"__codelineno-6-35\" href=\"#__codelineno-6-35\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u521b\u5efa\u51fd\u6570\u65f6\uff0c\u4f1a\u628a <code>f-&gt;f_globals</code> \u5b58\u5230\u51fd\u6570\u7ed3\u6784\u4f53\u53d8\u91cf <code>func_globals</code> \u91cc\u9762\uff0c\u800c\u5bf9\u4e8e\u6a21\u5757 <code>m</code>\uff0c<code>f-&gt;f_globals = m.__dict__</code>\u3002\u51fd\u6570\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f20\u7ed9 <code>PyFrame_New</code> \u7684 <code>globals</code> \u53c2\u6570\uff0c\u5c31\u662f\u521b\u5efa\u65f6\u5019\u4fdd\u5b58\u8d77\u6765\u7684 <code>func_globals</code>\uff0c<code>__builtins__</code> \u81ea\u7136\u5c31\u53ef\u4ee5\u5728 <code>func_globals</code> \u4e2d\u83b7\u53d6\u3002</p>\n<p>\u81f3\u6b64\uff0c<code>__builtins__</code> \u7684\u4f20\u9012\u662f\u80fd\u4fdd\u8bc1\u4e00\u81f4\u6027\u7684\uff0c\u6240\u6709\u6a21\u5757\u3001\u5b50\u6a21\u5757 \u3001\u51fd\u6570\uff0c\u6808\u5e27\u7b49\u90fd\u80fd\u5f15\u7528\u5230\u540c\u4e00\u4e2a\uff0c\u4e5f\u5c31\u662f\u62e5\u6709\u76f8\u540c\u7684\u5185\u5efa\u540d\u5b57\u7a7a\u95f4\u3002</p>\n<h2 id=\"__main__\">\u6307\u5b9a <code>__main__</code> \u6a21\u5757\u6267\u884c</h2>\n<p>\u6211\u4eec\u5df2\u7ecf\u77e5\u9053 <code>__main__</code> \u6a21\u5757\u81ea\u8eab\u7684 <code>__builtins__</code> \u53ef\u4ee5\u4f20\u9012\u7ed9\u6240\u6709\u5b50\u6a21\u5757\u3001\u51fd\u6570\u548c\u6808\u5e27\uff0c\u800c\u5728\u547d\u4ee4\u884c\u6267\u884c <code>python a.py</code> \u65f6\uff0cPython \u4f1a\u628a <code>a.py</code> \u4f5c\u4e3a <code>__main__</code> \u6a21\u5757\u6765\u6267\u884c\uff0c\u90a3\u8fd9\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1a</p>\n<div class=\"language-c highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\">// python.c</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"kt\">int</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">Py_Main</span><span class=\"p\">(</span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"c1\">// main.c</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"kt\">int</span>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"nf\">Py_Main</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5c1d\u8bd5\u7528\u6a21\u5757\u7684 importer \u6765\u6267\u884c\u4ee3\u7801</span>\n<a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">        </span><span class=\"n\">sts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RunMainFromImporter</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4e00\u822c\u6211\u4eec\u81ea\u5df1\u7684 py \u6587\u4ef6\uff0c\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u6765\u6267\u884c</span>\n<a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">    </span><span class=\"n\">sts</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyRun_AnyFileExFlags</span><span class=\"p\">(</span>\n<a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"w\">            </span><span class=\"n\">fp</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-22\" name=\"__codelineno-7-22\" href=\"#__codelineno-7-22\"></a><span class=\"w\">            </span><span class=\"n\">filename</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"s\">&quot;&lt;stdin&gt;&quot;</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">filename</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-23\" name=\"__codelineno-7-23\" href=\"#__codelineno-7-23\"></a><span class=\"w\">            </span><span class=\"n\">filename</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">cf</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-24\" name=\"__codelineno-7-24\" href=\"#__codelineno-7-24\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-25\" name=\"__codelineno-7-25\" href=\"#__codelineno-7-25\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-26\" name=\"__codelineno-7-26\" href=\"#__codelineno-7-26\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-7-27\" name=\"__codelineno-7-27\" href=\"#__codelineno-7-27\"></a>\n<a id=\"__codelineno-7-28\" name=\"__codelineno-7-28\" href=\"#__codelineno-7-28\"></a><span class=\"c1\">// pythonrun.c</span>\n<a id=\"__codelineno-7-29\" name=\"__codelineno-7-29\" href=\"#__codelineno-7-29\"></a><span class=\"kt\">int</span>\n<a id=\"__codelineno-7-30\" name=\"__codelineno-7-30\" href=\"#__codelineno-7-30\"></a><span class=\"n\">PyRun_AnyFileExFlags</span><span class=\"p\">(</span><span class=\"kt\">FILE</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">fp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">closeit</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-31\" name=\"__codelineno-7-31\" href=\"#__codelineno-7-31\"></a><span class=\"w\">                     </span><span class=\"n\">PyCompilerFlags</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">flags</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-32\" name=\"__codelineno-7-32\" href=\"#__codelineno-7-32\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-33\" name=\"__codelineno-7-33\" href=\"#__codelineno-7-33\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-34\" name=\"__codelineno-7-34\" href=\"#__codelineno-7-34\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">PyRun_SimpleFileExFlags</span><span class=\"p\">(</span><span class=\"n\">fp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">closeit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">flags</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-35\" name=\"__codelineno-7-35\" href=\"#__codelineno-7-35\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-7-36\" name=\"__codelineno-7-36\" href=\"#__codelineno-7-36\"></a>\n<a id=\"__codelineno-7-37\" name=\"__codelineno-7-37\" href=\"#__codelineno-7-37\"></a>\n<a id=\"__codelineno-7-38\" name=\"__codelineno-7-38\" href=\"#__codelineno-7-38\"></a><span class=\"kt\">int</span>\n<a id=\"__codelineno-7-39\" name=\"__codelineno-7-39\" href=\"#__codelineno-7-39\"></a><span class=\"n\">PyRun_SimpleFileExFlags</span><span class=\"p\">(</span><span class=\"kt\">FILE</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">fp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">closeit</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-40\" name=\"__codelineno-7-40\" href=\"#__codelineno-7-40\"></a><span class=\"w\">                        </span><span class=\"n\">PyCompilerFlags</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">flags</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-41\" name=\"__codelineno-7-41\" href=\"#__codelineno-7-41\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-42\" name=\"__codelineno-7-42\" href=\"#__codelineno-7-42\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-43\" name=\"__codelineno-7-43\" href=\"#__codelineno-7-43\"></a><span class=\"w\">    </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyImport_AddModule</span><span class=\"p\">(</span><span class=\"s\">&quot;__main__&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-44\" name=\"__codelineno-7-44\" href=\"#__codelineno-7-44\"></a><span class=\"w\">    </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyModule_GetDict</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-45\" name=\"__codelineno-7-45\" href=\"#__codelineno-7-45\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-46\" name=\"__codelineno-7-46\" href=\"#__codelineno-7-46\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8bbe\u7f6e __file__ \u5c5e\u6027</span>\n<a id=\"__codelineno-7-47\" name=\"__codelineno-7-47\" href=\"#__codelineno-7-47\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">PyDict_SetItemString</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;__file__&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-48\" name=\"__codelineno-7-48\" href=\"#__codelineno-7-48\"></a><span class=\"w\">        </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-49\" name=\"__codelineno-7-49\" href=\"#__codelineno-7-49\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-50\" name=\"__codelineno-7-50\" href=\"#__codelineno-7-50\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-51\" name=\"__codelineno-7-51\" href=\"#__codelineno-7-51\"></a><span class=\"w\">    </span><span class=\"c1\">// globals = locals = d = __main__.__dict__</span>\n<a id=\"__codelineno-7-52\" name=\"__codelineno-7-52\" href=\"#__codelineno-7-52\"></a><span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">run_pyc_file</span><span class=\"p\">(</span><span class=\"n\">fp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">flags</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-53\" name=\"__codelineno-7-53\" href=\"#__codelineno-7-53\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-54\" name=\"__codelineno-7-54\" href=\"#__codelineno-7-54\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-7-55\" name=\"__codelineno-7-55\" href=\"#__codelineno-7-55\"></a>\n<a id=\"__codelineno-7-56\" name=\"__codelineno-7-56\" href=\"#__codelineno-7-56\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span>\n<a id=\"__codelineno-7-57\" name=\"__codelineno-7-57\" href=\"#__codelineno-7-57\"></a><span class=\"n\">run_pyc_file</span><span class=\"p\">(</span><span class=\"kt\">FILE</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">fp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">globals</span><span class=\"p\">,</span>\n<a id=\"__codelineno-7-58\" name=\"__codelineno-7-58\" href=\"#__codelineno-7-58\"></a><span class=\"w\">             </span><span class=\"n\">PyObject</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">locals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PyCompilerFlags</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">flags</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-59\" name=\"__codelineno-7-59\" href=\"#__codelineno-7-59\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-60\" name=\"__codelineno-7-60\" href=\"#__codelineno-7-60\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-61\" name=\"__codelineno-7-61\" href=\"#__codelineno-7-61\"></a><span class=\"w\">    </span><span class=\"c1\">// \u4ece pyc \u6587\u4ef6\u8bfb\u53d6\u4ee3\u7801\u5bf9\u8c61 co \uff0c\u5e76\u6267\u884c\u4ee3\u7801</span>\n<a id=\"__codelineno-7-62\" name=\"__codelineno-7-62\" href=\"#__codelineno-7-62\"></a><span class=\"w\">    </span><span class=\"c1\">// PyEval_EvalCode \u91cc\u9762\u4e5f\u540c\u6837\u4f1a\u8c03\u7528 PyFrame_New \u521b\u5efa\u65b0\u6808\u5e27</span>\n<a id=\"__codelineno-7-63\" name=\"__codelineno-7-63\" href=\"#__codelineno-7-63\"></a><span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PyEval_EvalCode</span><span class=\"p\">(</span><span class=\"n\">co</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">globals</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">locals</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-64\" name=\"__codelineno-7-64\" href=\"#__codelineno-7-64\"></a><span class=\"w\">    </span><span class=\"p\">...</span>\n<a id=\"__codelineno-7-65\" name=\"__codelineno-7-65\" href=\"#__codelineno-7-65\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5f53\u6267\u884c <code>python a.py</code> \u65f6\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4f1a\u8d70\u5230 <code>PyRun_SimpleFileExFlags</code>\uff0c<code>PyRun_SimpleFileExFlags</code> \u91cc\u9762\u4f1a\u53d6\u51fa\u6765 <code>__main__.__dict__</code>\uff0c\u4f5c\u4e3a\u4ee3\u7801\u6267\u884c\u65f6\u7684 <code>globals</code> \u548c <code>locals</code>\uff0c\u6700\u7ec8\u4e5f\u4f1a\u4f20\u5230 <code>PyFrame_New</code> \u4e2d\u521b\u5efa\u65b0\u7684\u6808\u5e27\u6765\u6267\u884c <code>a.py</code>\u3002\u7ed3\u5408\u6211\u4eec\u4e0a\u6587\u63d0\u5230\u7684 <code>__builtins__</code> \u5728\u6a21\u5757\u548c\u51fd\u6570\u4e2d\u4f20\u9012\uff0c\u5c31\u53ef\u4ee5\u8ba9\u540e\u7eed\u6267\u884c\u7684\u4ee3\u7801\u90fd\u80fd\u5171\u7528\u540c\u4e00\u4efd <code>current_frame-&gt;f_builtins = __main__.__builtins__.__dict__</code>\u3002</p>\n<h2 id=\"restricted-execution_1\">\u518d\u8bba Restricted Execution</h2>\n<p><code>Python</code> \u5728 2.3 \u7248\u672c\u4e4b\u524d\uff0c\u66fe\u7ecf\u63d0\u4f9b\u8fc7\u7684 <a href=\"https://docs.python.org/2.7/library/restricted.html\">Restricted Execution</a>\uff0c\u5c31\u662f\u57fa\u4e8e <code>__builtins__</code> \u7684\u7279\u6027\u6765\u5236\u4f5c\u7684\u3002\u6216\u8005\u53ef\u4ee5\u8ba4\u4e3a\uff0c<code>__builtins__</code> \u4e4b\u6240\u4ee5\u8bbe\u8ba1\u6210\u5728 <code>__main__</code> \u6a21\u5757\u4e2d\u662f\u4e00\u4e2a\u6a21\u5757\u5bf9\u8c61\uff0c\u800c\u5728\u5176\u4ed6\u6a21\u5757\u4e2d\u662f\u4e00\u4e2a <code>dict</code> \u5bf9\u8c61\uff0c\u5c31\u662f\u4e3a\u4e86\u53ef\u4ee5\u5b9e\u73b0 <strong>Restricted Execution</strong>\u3002</p>\n<p>\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff1a\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u81ea\u7531\u5b9a\u5236\u81ea\u5df1\u7684 <code>__builtin__</code> \u6a21\u5757\uff0c\u5e76\u8bbe\u7f6e\u6210 <code>__main__.__builtins__</code>\uff0c\u90a3\u5c31\u76f8\u5f53\u4e8e\u540e\u7eed\u6240\u6709\u6267\u884c\u7684\u4ee3\u7801\uff0c\u90fd\u4f1a\u4f7f\u7528\u6211\u4eec\u5b9a\u5236\u7684\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u5236\u7279\u5b9a\u7248\u672c\u7684 <code>open</code>\u3001<code>__import__</code>\u3001<code>file</code> \u7b49\u5185\u5efa\u51fd\u6570\u548c\u7c7b\u578b\uff0c\u66f4\u8fdb\u4e00\u6b65\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u4e0d\u662f\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u9650\u5236\u6267\u884c\u4ee3\u7801\u7684\u6743\u9650\uff0c\u9632\u6b62\u4ee3\u7801\u505a\u4e00\u4e9b\u4e0d\u5b89\u5168\u7684\u51fd\u6570\u8c03\u7528\uff0c\u6216\u8005\u8bbf\u95ee\u4e00\u4e9b\u4e0d\u5b89\u5168\u7684\u6587\u4ef6\uff1f</p>\n<p><code>Python</code> \u5f53\u65f6\u5c31\u505a\u8fc7\u8fd9\u79cd\u5c1d\u8bd5\uff0c\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u7684\u6a21\u5757\u5c31\u53eb\u505a: <code>rexec</code>\u3002</p>\n<h3 id=\"rexec\"><code>rexec</code></h3>\n<p>\u6211\u65e0\u610f\u592a\u6df1\u5165\u8bb2\u89e3 <code>rexec</code> \u7684\u5b9e\u73b0\uff0c\u56e0\u4e3a\u539f\u7406\u5176\u5b9e\u4e0a\u6587\u5df2\u7ecf\u8bb2\u6e05\u695a\u4e86\uff0c\u5e76\u4e14\u8fd9\u4e2a\u6a21\u5757\u672c\u8eab\u5c31\u5df2\u7ecf\u5e9f\u5f03\uff0c\u6211\u8fd9\u4e9b\u4ec5\u7b80\u5355\u505a\u4e00\u4e9b\u5173\u952e\u4ee3\u7801\u7684\u6458\u8981\uff0c\u65b9\u4fbf\u67e5\u9605\u3002</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"c1\"># rexec.py</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"k\">class</span> <span class=\"nc\">RExec</span><span class=\"p\">(</span><span class=\"n\">ihooks</span><span class=\"o\">.</span><span class=\"n\">_Verbose</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a>    <span class=\"o\">...</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a>    <span class=\"n\">nok_builtin_names</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;open&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;file&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;reload&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;__import__&#39;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">hooks</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">verbose</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a>        <span class=\"o\">...</span>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">modules</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a>        <span class=\"o\">...</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_builtin</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_initial_modules</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_sys</span><span class=\"p\">()</span>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">loader</span> <span class=\"o\">=</span> <span class=\"n\">RModuleLoader</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">hooks</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">importer</span> <span class=\"o\">=</span> <span class=\"n\">RModuleImporter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">loader</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a>    <span class=\"k\">def</span> <span class=\"nf\">make_builtin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">copy_except</span><span class=\"p\">(</span><span class=\"n\">__builtin__</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nok_builtin_names</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">__import__</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">r_import</span>\n<a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">reload</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">r_reload</span>\n<a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">open</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">r_open</span>\n<a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a>\n<a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a>    <span class=\"k\">def</span> <span class=\"nf\">add_module</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">mname</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">mname</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-24\" name=\"__codelineno-8-24\" href=\"#__codelineno-8-24\"></a>        <span class=\"k\">if</span> <span class=\"n\">m</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n<a id=\"__codelineno-8-25\" name=\"__codelineno-8-25\" href=\"#__codelineno-8-25\"></a>            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">[</span><span class=\"n\">mname</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">hooks</span><span class=\"o\">.</span><span class=\"n\">new_module</span><span class=\"p\">(</span><span class=\"n\">mname</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-26\" name=\"__codelineno-8-26\" href=\"#__codelineno-8-26\"></a>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">__builtins__</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">[</span><span class=\"s1\">&#39;__builtin__&#39;</span><span class=\"p\">]</span>\n<a id=\"__codelineno-8-27\" name=\"__codelineno-8-27\" href=\"#__codelineno-8-27\"></a>        <span class=\"k\">return</span> <span class=\"n\">m</span>\n<a id=\"__codelineno-8-28\" name=\"__codelineno-8-28\" href=\"#__codelineno-8-28\"></a>\n<a id=\"__codelineno-8-29\" name=\"__codelineno-8-29\" href=\"#__codelineno-8-29\"></a>    <span class=\"k\">def</span> <span class=\"nf\">r_exec</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-30\" name=\"__codelineno-8-30\" href=\"#__codelineno-8-30\"></a>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_module</span><span class=\"p\">(</span><span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-31\" name=\"__codelineno-8-31\" href=\"#__codelineno-8-31\"></a>        <span class=\"n\">exec</span> <span class=\"n\">code</span> <span class=\"ow\">in</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span>\n<a id=\"__codelineno-8-32\" name=\"__codelineno-8-32\" href=\"#__codelineno-8-32\"></a>\n<a id=\"__codelineno-8-33\" name=\"__codelineno-8-33\" href=\"#__codelineno-8-33\"></a>    <span class=\"k\">def</span> <span class=\"nf\">r_eval</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-34\" name=\"__codelineno-8-34\" href=\"#__codelineno-8-34\"></a>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_module</span><span class=\"p\">(</span><span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-35\" name=\"__codelineno-8-35\" href=\"#__codelineno-8-35\"></a>        <span class=\"k\">return</span> <span class=\"nb\">eval</span><span class=\"p\">(</span><span class=\"n\">code</span><span class=\"p\">,</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-36\" name=\"__codelineno-8-36\" href=\"#__codelineno-8-36\"></a>\n<a id=\"__codelineno-8-37\" name=\"__codelineno-8-37\" href=\"#__codelineno-8-37\"></a>    <span class=\"k\">def</span> <span class=\"nf\">r_execfile</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file</span><span class=\"p\">):</span>\n<a id=\"__codelineno-8-38\" name=\"__codelineno-8-38\" href=\"#__codelineno-8-38\"></a>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_module</span><span class=\"p\">(</span><span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-39\" name=\"__codelineno-8-39\" href=\"#__codelineno-8-39\"></a>        <span class=\"n\">execfile</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"vm\">__dict__</span><span class=\"p\">)</span>\n</code></pre></div>\n<p><code>r_execfile</code> \u51fd\u6570\u4f1a\u628a\u6587\u4ef6\u5f53\u4f5c <code>__main__</code> \u6a21\u5757\u6765\u6267\u884c\uff0c\u53ea\u662f <code>__main__</code> \u662f\u5b9a\u5236\u8fc7\u7684\u3002<code>self.add_module('__main__')</code> \u91cc\u9762\uff0c\u4f1a\u8bbe\u7f6e\u6a21\u5757\u7684 <code>m.__builtins__ = self.modules['__builtin__']</code>\uff0c\u8fd9\u4e2a <code>__builtin__</code> \u662f\u7531 <code>make_builtin</code> \u6765\u5b9a\u5236\u751f\u6210\u7684\uff0c\u5728\u91cc\u9762\u66ff\u6362\u4e86 <code>__import__</code>\u3001<code>reload</code>\u3001<code>open</code> \u51fd\u6570\uff0c\u5e76\u5220\u9664\u4e86 <code>file</code> \u7c7b\u578b\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u80fd\u63a7\u5236\u8981\u6267\u884c\u7684\u4ee3\u7801\u5bf9\u5185\u5efa\u547d\u540d\u7a7a\u95f4\u7684\u8bbf\u95ee\u4e86\u3002</p>\n<p>\u5bf9\u4e8e\u4e00\u4e9b\u5185\u5efa\u6a21\u5757\uff0c<code>rexec</code> \u4e5f\u505a\u4e86\u5b9a\u5236\uff0c\u4fdd\u62a4\u4e0d\u5b89\u5168\u7684\u8bbf\u95ee\uff0c\u8b6c\u5982 <code>sys</code> \u6a21\u5757\uff0c\u53ea\u4fdd\u7559\u4e86\u4e00\u90e8\u5206\u7684\u5bf9\u8c61\uff0c\u5e76\u4e14\u901a\u8fc7\u5b9a\u5236\u7684 <code>self.loader</code>\u3001<code>self.importer</code>\uff0c\u6765\u5b9e\u73b0 <code>import</code> \u7684\u65f6\u5019\uff0c\u4f18\u5148\u52a0\u8f7d\u5b9a\u5236\u7684\u6a21\u5757\u3002</p>\n<p>\u5982\u679c\u5bf9\u4ee3\u7801\u7ec6\u8282\u611f\u5174\u8da3\uff0c\u8bf7\u81ea\u884c\u67e5\u9605\u76f8\u5173\u6e90\u7801\u3002</p>\n<h3 id=\"rexec_1\"><code>rexec</code> \u7684\u5931\u8d25</h3>\n<p>\u4e0a\u6587\u63d0\u5230\uff0c<code>Python 2.3</code> \u4e4b\u540e\uff0c<code>rexec</code> \u5c31\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u56e0\u4e3a\u8fd9\u79cd\u65b9\u5f0f\u5df2\u7ecf\u88ab\u8bc1\u5b9e\u4e3a\u4e0d\u53ef\u884c\u3002\u5e26\u7740\u597d\u5947\u5fc3\uff0c\u6211\u4eec\u6765\u7b80\u5355\u6eaf\u6e90\u4e00\u4e0b\uff1a</p>\n<ul>\n<li>\u5728\u793e\u533a\u6709\u4eba\u62a5\u544a\u4e86 <a href=\"https://mail.python.org/pipermail/python-dev/2002-December/031160.html\">Bug</a>\uff0c\u5e76\u5f15\u53d1\u4e86\u5f00\u53d1\u8005\u4e4b\u95f4\u7684\u8ba8\u8bba\uff1a<blockquote>\n<p>it's never going to be safe, and I doubt it's very useful as long as it's not safe.</p>\n<p>Every change is a potential security hole.</p>\n<p>it's hard to predict what change is going to break it.</p>\n<p>I don't expect you'll ever reach the point where it'll be wise to advertise this as safe.  I certainly won't.</p>\n<p>this is only a useful occupation if you expect to eventually reach a point where you expect that there aren't any security flaws left.  Jeremy &amp; I both doubt that Python will ever reach that level, meaning that the whole exercise of fixing security flaws is a waste of time (if you know you <em>can't</em> make it safe, don't waste time trying).</p>\n<p>I agree (but I have said that in past) the best thing is to deprecate/rip out rexec.</p>\n<p>The code will still be in older versions if someone decides to pick it up and work on it as a separate project.</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>\u8be5 Bug \u7684\u8d77\u56e0\u662f <code>Python</code> \u5f15\u5165\u4e86\u65b0\u5f0f\u7c7b\uff08new-style class\uff09 <code>object</code>\uff0c\u5bfc\u81f4 <code>rexec</code> \u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002\u4e8e\u662f\u5f00\u53d1\u8005\u8868\u793a\uff0c\u5728\u53ef\u9884\u89c1\u7684\u672a\u6765\uff0c\u8fd9\u79cd\u60c5\u51b5\u90fd\u5f88\u96be\u907f\u514d\uff0c\u4efb\u610f\u7684\u4fee\u6539\u90fd\u4f1a\u53ef\u80fd\u5bfc\u81f4 <code>rexec</code> \u51fa\u73b0\u6f0f\u6d1e\uff0c\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u6216\u8005\u88ab\u7a81\u7834\u6743\u9650\u7684\u9650\u5236\uff0c\u57fa\u672c\u4e0a\u65e0\u6cd5\u5b9e\u73b0\u6ca1\u6709\u6f0f\u6d1e\u5730\u53bb\u63d0\u4f9b\u4e00\u4e2a\u5b89\u5168\u73af\u5883\u7684\u613f\u666f\uff0c\u5f00\u53d1\u8005\u9700\u8981\u4e0d\u65ad\u5730\u4fee\u4fee\u8865\u8865\uff0c\u6d6a\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u3002\u6700\u7ec8\uff0c<code>rexec</code> \u8fd9\u4e2a\u6a21\u5757\u5c31\u88ab\u5e9f\u5f03\u6389\u4e86\uff0c<code>Python</code> \u4e5f\u6ca1\u6709\u518d\u63d0\u4f9b\u7c7b\u4f3c\u7684\u529f\u80fd\u3002\u4f46\u5173\u4e8e <code>__builtins__</code> \u7684\u8bbe\u5b9a\uff0c\u7531\u4e8e\u517c\u5bb9\u6027\u7b49\u95ee\u9898\uff0c\u5c31\u7ee7\u7eed\u4fdd\u7559\u4e0b\u6765\u4e86\u3002</li>\n</ul>\n<p>\u540e\u9762\u5728\u5927\u6982 2010 \u5e74\u7684\u65f6\u5019\uff0c\u6709\u4f4d\u7a0b\u5e8f\u5458\u63a8\u51fa\u4e86 <a href=\"https://github.com/vstinner/pysandbox\">pysandbox</a>\uff0c\u81f4\u529b\u4e8e\u63d0\u4f9b\u53ef\u4ee5\u66ff\u4ee3 <code>rexec</code> \u7684 <code>Python</code> \u6c99\u76d2\u73af\u5883\u3002\u4f46\u662f 3 \u5e74\u540e\uff0c\u4f5c\u8005\u4e3b\u52a8\u653e\u5f03\u4e86\u8fd9\u4e2a\u9879\u76ee\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u4e86\u4e3a\u4ec0\u4e48\u4f5c\u8005\u8ba4\u4e3a\u8fd9\u4e2a\u9879\u76ee\u662f\u5931\u8d25\u7684\uff1a<a href=\"https://mail.python.org/pipermail/python-dev/2013-November/130132.html\">The pysandbox project is broken</a>\uff0c\u4e5f\u6709\u5176\u4ed6\u4f5c\u8005\u64b0\u6587\u603b\u7ed3\u4e86\u8fd9\u4e2a\u9879\u76ee\u7684\u5931\u8d25\uff1a<a href=\"https://lwn.net/Articles/574215/\">The failure of pysandbox</a>\u3002\u5982\u679c\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u53ef\u4ee5\u5177\u4f53\u53bb\u7ffb\u7ffb\u539f\u6587\uff0c\u6211\u8fd9\u91cc\u4e5f\u7ed9\u4e00\u4e9b\u6458\u8981\u6765\u5e2e\u52a9\u4e86\u89e3\uff1a</p>\n<blockquote>\n<p>After having work during 3 years on a pysandbox project to sandbox untrusted code, I now reached a point where I am convinced that pysandbox is broken by design. Different developers tried to convinced me before that pysandbox design is unsafe, but I had to experience it myself to be convineced.</p>\n<p>I now agree that putting a sandbox in CPython is the wrong design. There are too many ways to escape the untrusted namespace using the various introspection features of the Python language. To guarantee the [safety] of a security product, the code should be [carefully] audited and the code to review must be as small as possible. Using pysandbox, the \"code\" is the whole Python core which is a really huge code base. For example, the Python and Objects directories of Python 3.4 contain more than 126,000 lines of C code.</p>\n<p>The security of pysandbox is the security of its weakest part. A single bug is enough to escape the whole sandbox.</p>\n<p>pysandbox cannot be used in practice. To protect the untrusted namespace, pysandbox installs a lot of different protections. Because of all these protections, it becomes hard to write Python code. Basic features like \"del dict[key]\" are denied. Passing an object to a sandbox is not possible to sandbox, pysandbox is unable to proxify arbitary objects. For something more complex than evaluating \"1+(2*3)\", pysandbox cannot be used in practice, because of all these protections.</p>\n</blockquote>\n<p><strong>pysandbox</strong> \u7684\u4f5c\u8005\u8ba4\u4e3a\uff0c\u5728 <code>Python</code> \u91cc\u9762\u653e\u4e00\u4e2a\u6c99\u76d2\u73af\u5883\u662f\u9519\u8bef\u7684\u8bbe\u8ba1\uff0c\u6709\u592a\u591a\u7684\u65b9\u5f0f\u53ef\u4ee5\u4ece\u6c99\u76d2\u4e2d\u9003\u9038\u51fa\u53bb\uff0c<code>Python</code> \u63d0\u4f9b\u7684\u8bed\u8a00\u7279\u6027\u5f88\u4e30\u5bcc\uff0c<code>CPython</code> \u6e90\u7801\u7684\u4ee3\u7801\u91cf\u5f88\u5927\uff0c\u57fa\u672c\u4e0d\u53ef\u80fd\u4fdd\u8bc1\u6709\u8db3\u591f\u7684\u5b89\u5168\u6027\u3002\u800c <strong>pysandbox</strong> \u7684\u5f00\u53d1\u8fc7\u7a0b\u5c31\u662f\u5728\u4e0d\u65ad\u5730\u6253\u8865\u4e01\uff0c\u8865\u4e01\u592a\u591a\uff0c\u9650\u5236\u592a\u591a\uff0c\u4ee5\u81f3\u4e8e\u4f5c\u8005\u8ba4\u4e3a <strong>pysandbox</strong> \u5df2\u7ecf\u6ca1\u6cd5\u5b9e\u9645\u4f7f\u7528\uff0c\u56e0\u4e3a\u5f88\u591a\u7684\u8bed\u6cd5\u7279\u6027\u548c\u529f\u80fd\u90fd\u88ab\u9650\u5236\u4e0d\u80fd\u4f7f\u7528\u4e86\uff0c\u8b6c\u5982\u7b80\u5355\u7684 <code>del dict[key]</code>\u3002</p>\n<h2 id=\"restricted-execution_2\">Restricted Execution \u51fa\u8def\u5728\u54ea</h2>\n<p>\u65e2\u7136 <code>rexec</code> \u548c <strong>pysandbox</strong> \u8fd9\u79cd\u901a\u8fc7 Patch Python \u6765\u63d0\u4f9b\u6c99\u76d2\u73af\u5883\u7684\u65b9\u6cd5\uff08\u8fd9\u91cc\u59d1\u4e14\u628a\u8fd9\u79cd\u65b9\u6cd5\u79f0\u4f5c Patch Python\uff09\u5df2\u7ecf\u8d70\u4e0d\u901a\u4e86\uff0c\u90a3\u6211\u4e0d\u7981\u597d\u5947\uff1a\u8981\u600e\u4e48\u624d\u80fd\u7ed9 Python \u63d0\u4f9b\u4e00\u4e2a\u80fd\u7528\u7684\u6c99\u76d2\u73af\u5883\uff1f</p>\n<p>\u5728\u8fd9\u91cc\u6211\u7ee7\u7eed\u6536\u96c6\u4e86\u4e00\u4e9b\u5176\u4ed6\u7684\u5b9e\u73b0\u65b9\u6cd5\u6216\u8005\u6848\u4f8b\uff0c\u65b9\u4fbf\u53c2\u8003\u548c\u67e5\u9605\uff1a</p>\n<ul>\n<li><a href=\"https://doc.pypy.org/en/latest/sandbox.html\">PyPy</a> \u6709\u4e00\u4e2a<a href=\"https://foss.heptapod.net/pypy/pypy/-/tree/branch/sandbox-2\">\u5206\u652f</a>\u63d0\u4f9b\u4e86\u6c99\u76d2\u7684\u529f\u80fd\uff0c\u7ed3\u5408\u989d\u5916\u7684 <a href=\"https://foss.heptapod.net/pypy/sandboxlib\">sandboxlib</a>\uff0c\u53ef\u4ee5\u81ea\u884c\u7f16\u8bd1\u51fa\u5e26\u6c99\u76d2\u73af\u5883\u7248\u672c\u7684 PyPy\u3002\u5982\u679c\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u81ea\u884c\u914d\u7f6e\uff0c\u53c2\u8003\u8fd9\u91cc\u7684\u4e00\u4e9b<a href=\"https://foss.heptapod.net/pypy/pypy/-/issues/3192\">\u8bf4\u660e</a>\u3002PyPy \u5b9e\u73b0\u7684\u539f\u7406\u662f\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u7684\u6240\u6709\u8f93\u5165\u8f93\u51fa\u548c\u7cfb\u7edf\u8c03\u7528\uff0c\u90fd\u4f1a\u91cd\u5b9a\u5411\u5230\u5916\u90e8\u8fdb\u7a0b\uff0c\u7531\u5916\u90e8\u8fdb\u7a0b\u63a7\u5236\u8fd9\u4e9b\u6743\u9650\uff0c\u53e6\u5916\u4e5f\u53ef\u4ee5\u63a7\u5236\u5185\u5b58\u548c CPU \u7684\u4f7f\u7528\u91cf\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u5206\u652f\u4e5f\u6709\u6bb5\u65f6\u95f4\u6ca1\u6709\u65b0\u7684\u63d0\u4ea4\u4e86\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u3002</li>\n</ul>\n<ul>\n<li>\u501f\u52a9\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u6c99\u76d2\u73af\u5883\u5de5\u5177\u3002<a href=\"https://en.wikipedia.org/wiki/Seccomp\">seccomp</a> \u662f Linux \u5185\u6838\u63d0\u4f9b\u7684\u8ba1\u7b97\u5b89\u5168\u5de5\u5177\uff0c<a href=\"https://github.com/seccomp/libseccomp/tree/main/src/python\">libsecoomp</a> \u63d0\u4f9b\u4e86 Python \u7ed1\u5b9a\uff0c\u53ef\u4ee5\u5185\u5d4c\u5230\u4ee3\u7801\u91cc\u9762\u4f7f\u7528\uff1b\u6216\u8005\u4f7f\u7528\u57fa\u4e8e seccomp \u5b9e\u73b0\u7684\u5de5\u5177\u6765\u6267\u884c\u4ee3\u7801\uff0c\u8b6c\u5982 <a href=\"https://firejail.wordpress.com/\">Firejail</a>\u3002<a href=\"https://apparmor.net/\">AppArmor</a> \u662f\u4e00\u4e2a Linux \u5185\u6838\u5b89\u5168\u6a21\u5757\uff0c\u5141\u8bb8\u7ba1\u7406\u5458\u63a7\u5236\u7a0b\u5e8f\u80fd\u8bbf\u95ee\u7684\u7cfb\u7edf\u8d44\u6e90\u548c\u529f\u80fd\uff0c\u4fdd\u62a4\u64cd\u4f5c\u7cfb\u7edf\u3002<a href=\"https://github.com/openedx/codejail\">codejail</a> \u662f\u57fa\u4e8e AppArmor \u5b9e\u73b0\u7684 Python \u6c99\u76d2\u73af\u5883\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u5c1d\u8bd5\u3002\u8fd8\u6709\u5f88\u591a\u7c7b\u4f3c\u7684\u5de5\u5177\uff0c\u8fd9\u91cc\u4e0d\u4e00\u4e00\u5217\u4e3e\u3002</li>\n</ul>\n<ul>\n<li>\u4f7f\u7528\u6c99\u76d2\u865a\u62df\u73af\u5883\u6216\u8005\u5bb9\u5668\u3002<a href=\"https://learn.microsoft.com/zh-cn/windows/security/threat-protection/windows-sandbox/windows-sandbox-overview\">Windows \u6c99\u76d2</a>\uff0c<a href=\"https://linuxcontainers.org/\">LXC</a>, <a href=\"https://www.docker.com/\">Docker</a> \u7b49\u7b49\uff0c\u8fd9\u91cc\u4e0d\u518d\u8be6\u8ff0\u3002</li>\n</ul>\n<h2 id=\"_2\">\u603b\u7ed3</h2>\n<p>\u672c\u6587\u7bc7\u5e45\u6709\u70b9\u957f\uff0c\u611f\u8c22\u770b\u5230\u8fd9\u91cc\uff0c\u6587\u7ae0\u4e00\u5f00\u59cb\u6240\u5217\u51fa\u7684\u7591\u95ee\uff0c\u76f8\u4fe1\u90fd\u5df2\u7ecf\u89e3\u7b54\u5b8c\u6bd5\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/py-%E4%BD%BF%E7%94%A8VisualStudio2015%E7%BC%96%E8%AF%91Python2.7.11/",
            "url": "https://wiki.disenone.site/py-%E4%BD%BF%E7%94%A8VisualStudio2015%E7%BC%96%E8%AF%91Python2.7.11/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "\u4f7f\u7528 Visual Studio 2015 \u7f16\u8bd1 Python 2.7.11",
            "content_html": "<p><meta property=\"og:title\" content=\"\u4f7f\u7528 Visual Studio 2015 \u7f16\u8bd1 Python 2.7.11\" /></p>\n<p><img alt=\"\" src=\"https://img.shields.io/badge/python-2.7.11-brightgreen.svg\" style=\"display: inline-block\" />\n<img alt=\"\" src=\"https://img.shields.io/badge/vs-2015-68217A.svg\" style=\"display: inline-block\" /></p>\n<h2 id=\"_1\">\u539f\u56e0</h2>\n<p>Python 2.7 \u7684\u5b98\u65b9\u7248\u672c\u652f\u6301 Visual Studio 2010 \u4ee5\u4e0b\u7248\u672c\u6765\u7f16\u8bd1\uff0c\u53c2\u8003 <code>PCbuild\\readme.txt</code>\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>1.  Install Microsoft Visual Studio 2008, any edition.\n2.  Install Microsoft Visual Studio 2010, any edition, or Windows SDK 7.1 and any version of Microsoft Visual Studio newer than 2010.\n</code></pre></div>\n<p>\u5982\u679c\u4f60\u60f3\u5728 Windows \u4e0b\u81ea\u5df1\u5012\u817e Python\uff0c\u8b6c\u5982\u7f16\u8bd1\u4e2a Debug \u7248\u672c\u3001\u81ea\u5df1\u6539\u6539\u6e90\u4ee3\u7801\u7b49\uff0c\u90a3\u4e48\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u88c5\u4e00\u4e2a VS2010\u3002\n\u4f46\u662f\u5bf9\u6211\u4e2a\u4eba\u6765\u8bf4\uff0c \u6211\u66f4\u60f3\u8981\u7528 VS2015 \u6765\u7f16\u8bd1 Python\uff0c\u539f\u56e0\u4e3b\u8981\u6709\uff1a</p>\n<ul>\n<li>VS2010 \u5b9e\u5728\u6709\u70b9\u8fc7\u65f6\uff0c\u4f7f\u7528\u8d77\u6765\u529f\u80fd\u548c\u4f53\u9a8c\u6bd4 VS2015 \u8981\u5dee\u5f97\u591a\u3002\u4e00\u76f4\u7528\u7740 VS2015\uff0c\u8981\u6211\u518d\u88c5\u4e2a VS2010 \u5b9e\u5728\u4e0d\u613f\u610f\u3002</li>\n<li>\u7531\u4e8e\u4e00\u76f4\u7528 VS2015\uff0c\u4f60\u4f1a\u4f7f\u7528\u5b83\u6765\u5199\u4e00\u4e9b\u81ea\u5df1\u7684\u7a0b\u5e8f\uff0c\u5982\u679c\u4f60\u60f3\u8981\u628a Python \u5d4c\u5165\u8fdb\u53bb\uff0c\u90a3\u4f60\u5c31\u9700\u8981\u4f7f\u7528\u76f8\u540c\u7248\u672c\u7684 VS \u6765\u7f16\u8bd1\u4f60\u7684\u7a0b\u5e8f\uff0c\u5982\u679c\u4f7f\u7528\u4e0d\u540c\u7248\u672c\u7684 VS\uff0c\u90a3\u4f1a\u51fa\u73b0\u5404\u79cd\u65e0\u6cd5\u9884\u6599\u7684\u4e8b\u60c5\u3002<a href=\"http://siomsystems.com/mixing-visual-studio-versions/\">\u8fd9\u91cc\u6709\u66f4\u8be6\u7ec6\u7684\u89e3\u91ca</a>\u3002</li>\n</ul>\n<p>\u6240\u4ee5\u6211\u5f00\u59cb\u7740\u624b\u7528 VS2015 \u641e\u5b9a Python 2.7.11 \u7248\u672c\uff08\u5f53\u524d\u7684 Python 2.7 \u6700\u65b0\u7248\u672c\uff09\u3002</p>\n<p>\u8981\u6ce8\u610f\uff0c<strong>Python 3.x \u5df2\u7ecf\u652f\u6301\u7528 VS2015 \u6765\u7f16\u8bd1</strong>\u3002</p>\n<h2 id=\"_2\">\u6e90\u7801\u4e0b\u8f7d</h2>\n<p>Python \u7684\u7248\u672c\u5f53\u7136\u5c31\u662f 2.7.11\uff0c\u53e6\u5916\u8fd8\u6709\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684\u6a21\u5757\uff0c\u5177\u4f53\u53ef\u4ee5\u8fd0\u884c Python \u6e90\u7801\u76ee\u5f55\u4e0b <code>PCbuild\\get_externals.bat</code> \u811a\u672c\u83b7\u53d6\u6240\u6709\u7f16\u8bd1\u9700\u8981\u7684\u6a21\u5757\uff0c\u6ce8\u610f\u4f60\u9700\u8981\u5b89\u88c5 svn \uff0c\u628a svn.exe \u6dfb\u52a0\u5230\u7cfb\u7edf PATH \u91cc\u9762\u3002</p>\n<p>\u4e0b\u8f7d\u53ef\u80fd\u5f88\u4e0d\u7a33\u5b9a\uff0c\u5e76\u4e14\u6574\u4e2a\u8fc7\u7a0b\u90fd\u6709\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\u800c\u7ec8\u6b62\uff0c\u6240\u4ee5\u8fd8\u662f\u63a8\u8350\u76f4\u63a5\u5728\u6211\u7684github\u4e0a\u4e0b\u8f7dexternals\u76ee\u5f55\uff1a<a href=\"https://github.com/disenone/wpython-2.7.11/tree/e13f43a3b72ae2bdf4d2950c6364750ae668cbf4/externals\">\u6211\u7684 Python \u7248\u672c</a></p>\n<h2 id=\"_3\">\u7f16\u8bd1\u8fc7\u7a0b</h2>\n<h3 id=\"_4\">\u7b2c\u4e09\u65b9\u6a21\u5757</h3>\n<p>\u9996\u5148\u8981\u89e3\u51b3\u7684\u662f\u7b2c\u4e09\u65b9\u7684\u6a21\u5757\uff0c\u4e3b\u8981\u662f tcl, tk, tcltk\u3002</p>\n<p>\u4fee\u6539\u6587\u4ef6 <code>externals/tcl-8.5.15.0/win/makefile.vc</code>\uff0c\u628a 434 \u884c\u6539\u6210</p>\n<div class=\"language-text highlight\"><pre><span></span><code>- cdebug = -Zi -WX $(DEBUGFLAGS)\n+ cdebug = -Zi -WX- $(DEBUGFLAGS)\n</code></pre></div>\n<p>\u5173\u4e8e\u9009\u9879 <code>WX</code>\uff0c\u53ef\u4ee5\u770b\u5fae\u8f6f\u7684\u5b98\u65b9\u6587\u6863\uff1a<a href=\"https://msdn.microsoft.com/en-us/library/ms235592.aspx\">/WX (Treat Linker Warnings as Errors)</a></p>\n<p>\u518d\u6765\u6539<code>PCbuild/tk.vcxproj</code>\uff0c\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\uff0c\u4fee\u6539 63, 64 \u884c</p>\n<div class=\"language-text highlight\"><pre><span></span><code>- &lt;TkOpts&gt;msvcrt&lt;/TkOpts&gt;\n- &lt;TkOpts Condition=&quot;$(Configuration) == &#39;Debug&#39;&quot;&gt;symbols,msvcrt&lt;/TkOpts&gt;\n+ &lt;TkOpts&gt;msvcrt,noxp&lt;/TkOpts&gt;\n+ &lt;TkOpts Condition=&quot;$(Configuration) == &#39;Debug&#39;&quot;&gt;symbols,msvcrt,noxp&lt;/TkOpts&gt;\n</code></pre></div>\n<p>\u6539<code>PCbuild/tcltk.props</code>\uff0c\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\uff0c\u4fee\u653941\u884c</p>\n<div class=\"language-text highlight\"><pre><span></span><code>- &lt;BuildDirTop&gt;$(BuildDirTop)_VC9&lt;/BuildDirTop&gt;\n+ &lt;BuildDirTop&gt;$(BuildDirTop)_VC13&lt;/BuildDirTop&gt;\n</code></pre></div>\n<p>\u7531\u4e8e VS2015 \u53d6\u6d88\u4e86 <code>timezone</code> \u7684\u5b9a\u4e49\uff0c\u6539\u4e3a <code>_timezone</code>\uff0c\u6240\u4ee5\u4ee3\u7801\u91cc\u9762\u7528\u5230 <code>timezone</code> \u7684\u5730\u65b9\u90fd\u8981\u6539\u6210 <code>_timezone</code>\uff0c\u7b2c\u4e09\u65b9\u6a21\u5757\u53ea\u9700\u8981\u6539\u6587\u4ef6<code>externals/tcl-8.5.15.0/win/tclWinTime.c</code>\uff0c\u5728\u6587\u4ef6\u7684\u524d\u9762\u52a0\u4e0a\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>#if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1900\n#define timezone _timezone\n#endif\n</code></pre></div>\n<h3 id=\"python\">\u6539 Python \u6e90\u7801</h3>\n<p><code>timezone</code>\u7684\u95ee\u9898\u5728 Python \u7684\u6a21\u5757 <code>time</code> \u91cc\u9762\u4e5f\u6709\uff0c\u4fee\u6539 767 \u884c</p>\n<div class=\"language-text highlight\"><pre><span></span><code>- #ifdef __CYGWIN__\n+ #if defined(__CYGWIN__) || defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1900\n</code></pre></div>\n<p>\u53e6\u5916\u7531\u4e8e\u5728 Windows \u4e0b Python \u7528\u4e86\u4e00\u79cd\u7279\u6b8a\u7684\u65b9\u6cd5\u6765\u68c0\u67e5\u6587\u4ef6\u53e5\u67c4\u7684\u6709\u6548\u6027\uff0c\u800c\u8fd9\u79cd\u65b9\u6cd5\u5728 VS2015 \u4e2d\u88ab\u5f7b\u5e95\u7981\u6b62\u4e86\uff0c\u4f1a\u51fa\u73b0\u7f16\u8bd1\u9519\u8bef\uff0c\u6240\u4ee5\u5148\u6539\u6389\u3002\u6587\u4ef6 <code>Include/fileobject.h</code>\uff0c73\u300180 \u884c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>73 - #if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1400\n73 + #if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1400 &amp;&amp; _MSC_VER &lt; 1900\n\n80 - #elif defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1200\n80 + #elif defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1200 &amp;&amp; _MSC_VER &lt; 1400\n</code></pre></div>\n<p>\u6587\u4ef6<code>Modules/posixmodule.c</code>\uff0c532 \u884c\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>- #if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1400\n+ #if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1400 &amp;&amp; _MSC_VER &lt; 1900\n</code></pre></div>\n<p>\u81f3\u6b64\uff0cPython \u5c31\u53ef\u4ee5\u7f16\u8bd1\u901a\u8fc7\u3002\u66f4\u5177\u4f53\u7684\u4fee\u6539\u53ef\u4ee5\u770b\u6211 commit \u7684\u5185\u5bb9\uff1a<a href=\"https://github.com/disenone/wpython-2.7.11/commit/4037e2d806518dbf06ffb8ee5c46f419ef8d7edf\">modify to build by vs2015</a></p>\n<h3 id=\"_5\">\u68c0\u67e5\u65e0\u6548\u53e5\u67c4</h3>\n<p>\u867d\u7136\u7f16\u8bd1\u901a\u8fc7\u4e86\uff0c\u4f46\u7531\u4e8e\u662f\u7c97\u66b4\u5730\u5ffd\u7565\u65e0\u6548\u6587\u4ef6\u53e5\u67c4\uff0c\u76f4\u63a5\u5bfc\u81f4\u7684\u540e\u679c\u662f\u4e00\u65e6\u8bbf\u95ee\u65e0\u6548\u7684\u53e5\u67c4\uff08\u8b6c\u5982\u5bf9\u540c\u4e00\u4e2a\u6587\u4ef6<code>close</code>\u4e24\u6b21\uff09\uff0cPython \u5c31\u4f1a\u76f4\u63a5 assert failed\uff0c\u7a0b\u5e8f crash\uff0c\u8fd9\u6837\u7684 Python \u6839\u672c\u6ca1\u6cd5\u7528\u554a\u3002Python \u5c31\u662f\u7528\u4e86\u4e00\u79cd\u5f88\u7279\u6b8a\u7684\u65b9\u6cd5\u6765\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u60dc\u5728 VS2015 \u91cc\u9762\u4e0d\u80fd\u7528\u4e86\uff0c\u6ce8\u91ca\u662f\u8fd9\u6837\u89e3\u91ca\u7684\uff1a</p>\n<div class=\"language-text highlight\"><pre><span></span><code>Microsoft CRT in VS2005 and higher will verify that a filehandle is valid and raise an assertion if it isn&#39;t.\n</code></pre></div>\n<p>\u5e78\u597d\u5df2\u7ecf\u6709\u4e86\u89e3\u51b3\u65b9\u6cd5\uff0c\u6211\u662f\u5728 Python \u7684 issue \u91cc\u9762\u770b\u5230\u7684\uff0c\u5730\u5740\u5728\u8fd9\u91cc\uff1a<a href=\"http://psf.upfronthosting.co.za/roundup/tracker/issue23524\">issue23524</a>, <a href=\"http://psf.upfronthosting.co.za/roundup/tracker/issue25759\">issue25759</a>\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u662f\u7528\u5728\u73b0\u5728 Python 3.x \u91cc\u9762\u3002</p>\n<p>\u5177\u4f53\u5730\u8bf4\u5c31\u662f\u5728\u4f7f\u7528\u6587\u4ef6\u53e5\u67c4\u7684\u65f6\u5019\u7981\u6b62\u6389 Windows \u7684 assert crash \u673a\u5236\uff0c\u6539\u4e3a\u68c0\u67e5\u9519\u8bef\u7801\u3002\u90a3\u8981\u600e\u4e48\u7981\u6b62 Windows \u7684 assert \u673a\u5236\u5462\uff1f\u7b54\u6848\u5c31\u662f\u7528\u81ea\u5df1\u7684\u9519\u8bef\u5904\u7406\u51fd\u6570\u66ff\u4ee3 Windows \u9ed8\u8ba4\u7684\u5904\u7406\u51fd\u6570\uff0c\u5173\u952e\u7684\u4ee3\u7801\uff1a</p>\n<p>\u65b0\u5efa\u6587\u4ef6<code>PC/invalid_parameter_handler.c</code>\uff0c\u5b9a\u4e49\u6211\u4eec\u81ea\u5df1\u7684\u9519\u8bef\u5904\u7406\u51fd\u6570\uff0c\u53ef\u4ee5\u6682\u65f6\u5ffd\u7565\u53d1\u751f\u7684\u9519\u8bef</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"cp\">#ifdef _MSC_VER</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdlib.h&gt;</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"cp\">#if _MSC_VER &gt;= 1900</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"cm\">/* pyconfig.h uses this function in the _Py_BEGIN_SUPPRESS_IPH/_Py_END_SUPPRESS_IPH</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"cm\"> * macros. It does not need to be defined when building using MSVC</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"cm\"> * earlier than 14.0 (_MSC_VER == 1900).</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"cm\"> */</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"kr\">__cdecl</span><span class=\"w\"> </span><span class=\"n\">_silent_invalid_parameter_handler</span><span class=\"p\">(</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"kt\">wchar_t</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">expression</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">    </span><span class=\"kt\">wchar_t</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">    </span><span class=\"kt\">wchar_t</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">,</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"w\">    </span><span class=\"kt\">uintptr_t</span><span class=\"w\"> </span><span class=\"n\">pReserved</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"p\">{}</span>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"n\">_invalid_parameter_handler</span><span class=\"w\"> </span><span class=\"n\">_Py_silent_invalid_parameter_handler</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_silent_invalid_parameter_handler</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"cp\">#endif</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a>\n<a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"cp\">#endif</span>\n</code></pre></div>\n<p>\u5b9a\u4e49\u4e24\u4e2a\u5b8f\u65b9\u4fbf\u66f4\u6362\u9519\u8bef\u5904\u7406\u51fd\u6570\uff0c\u8981\u6ce8\u610f\u662f\u6682\u65f6\u7684\u66f4\u6362\uff0c\u4e4b\u540e\u662f\u9700\u8981\u6362\u56de\u7cfb\u7edf\u9ed8\u8ba4\u7684</p>\n<div class=\"language-c++ highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"cp\">#if defined _MSC_VER &amp;&amp; _MSC_VER &gt;= 1900</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"n\">_invalid_parameter_handler</span><span class=\"w\"> </span><span class=\"n\">_Py_silent_invalid_parameter_handler</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"cp\">#define _Py_BEGIN_SUPPRESS_IPH { _invalid_parameter_handler _Py_old_handler = \\</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"cp\">    _set_thread_local_invalid_parameter_handler(_Py_silent_invalid_parameter_handler);</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"cp\">#define _Py_END_SUPPRESS_IPH _set_thread_local_invalid_parameter_handler(_Py_old_handler); }</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"cp\">#else</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"cp\">#define _Py_BEGIN_SUPPRESS_IPH</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"cp\">#define _Py_END_SUPPRESS_IPH</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"cp\">#endif </span><span class=\"cm\">/* _MSC_VER &gt;= 1900 */</span>\n</code></pre></div>\n<p>\u4e4b\u540e\u5728\u6709\u53ef\u80fd\u89e6\u53d1 Windows \u6587\u4ef6\u53e5\u67c4\u9519\u8bef\u7684\u5730\u65b9\uff0c\u524d\u540e\u5206\u522b\u52a0\u4e0a\u5b8f<code>_Py_BEGIN_SUPPRESS_IPH</code> \u548c <code>_Py_END_SUPPRESS_IPH</code>\uff0c\u4e4b\u540e\u518d\u68c0\u67e5\u9519\u8bef\u7801\u5c31\u53ef\u4ee5\u4e86\uff0c\u9700\u8981\u4fee\u6539\u5230\u7684\u5730\u65b9\u4e0d\u5c11\uff0c\u53c2\u8003\u522b\u4eba\u7684 commit \u6765\u4fee\u6539\uff1a\n<a href=\"https://github.com/kovidgoyal/cpython/commit/a9ec814d466d3c0139d10b69666f88eed10e4940\">\u5728\u8fd9\u91cc</a></p>\n<h2 id=\"_6\">\u7ed3\u675f</h2>\n<p>\u81f3\u6b64 Python 2.7.11 \u5c31\u53ef\u4ee5\u5728 VS2015 \u91cc\u9762\u6b63\u5e38\u7f16\u8bd1\u548c\u8fd0\u884c\u4e86\uff0c\u4e0d\u8fc7\u7531\u4e8e Python \u5b98\u65b9\u662f\u4e0d\u63a8\u8350\u8fd9\u6837\u8bbe\u7f6e</p>\n<div class=\"language-text highlight\"><pre><span></span><code>***WARNING***\nBuilding Python 2.7 for Windows using any toolchain that doesn&#39;t link\nagainst MSVCRT90.dll is *unsupported* as the resulting python.exe will\nnot be able to use precompiled extension modules that do link against\nMSVCRT90.dll.\n</code></pre></div>\n<p>\u6240\u4ee5\u4f7f\u7528\u7684\u65f6\u5019\u6700\u597d\u8981\u6ce8\u610f\u4e00\u4e0b\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/unity-Unity%E4%BA%BA%E7%89%A9%E6%8E%A7%E5%88%B6/",
            "url": "https://wiki.disenone.site/unity-Unity%E4%BA%BA%E7%89%A9%E6%8E%A7%E5%88%B6/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Unity\u4eba\u7269\u63a7\u5236",
            "content_html": "<p><meta property=\"og:title\" content=\"Unity\u4eba\u7269\u63a7\u5236\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-15-unity-3rdperson-control0/run_jump.gif\" /></p>\n<p>\u4eba\u7269\u7684\u52a8\u4f5c\u63a7\u5236\u662f\u6e38\u620f\u91cc\u9762\u5f88\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u64cd\u4f5c\u6027\u5f3a\u7684\u6e38\u620f\u80fd\u591f\u5f88\u597d\u7684\u5438\u5f15\u73a9\u5bb6\u3002\u8fd9\u91cc\u6211\u5c31\u5c1d\u8bd5\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u4eba\u7269\u64cd\u4f5c\u63a7\u5236\uff0c\u4eba\u7269\u80fd\u591f\u5b8c\u6210\u57fa\u672c\u7684\u79fb\u52a8\uff0c\u5305\u62ec\u884c\u8d70\uff0c\u8df3\u8dc3\u3002</p>\n<h2 id=\"_1\">\u9700\u6c42</h2>\n<p>\u5148\u6765\u8003\u8651\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u4eba\u7269\u64cd\u4f5c\u5177\u4f53\u7684\u9700\u6c42\uff1a</p>\n<ol>\n<li>\u884c\u8d70\uff0c\u80fd\u591f\u5728\u521a\u4f53\u7684\u8868\u9762\u884c\u8d70\uff0c\u7531\u6309\u952e\u4e0a\u4e0b\u5de6\u53f3\u8f93\u5165\u6765\u63a7\u5236\uff0c\u6682\u4e0d\u8003\u8651\u52a0\u901f\u51cf\u901f\u8fc7\u7a0b</li>\n<li>\u884c\u8d70\u7684\u901f\u5ea6\u5728\u4e0d\u540c\u65b9\u5411\u4e0a\u53ef\u4ee5\u4e0d\u540c\uff0c\u4f8b\u5982\u540e\u9000\u5e94\u8be5\u6bd4\u524d\u8fdb\u6162</li>\n<li>\u8df3\u8dc3\uff0c\u7531jump\u6309\u952e\u63a7\u5236\uff0c\u4eba\u7269\u4ee5\u4e00\u5b9a\u521d\u901f\u5ea6\u4ece\u4e0a\u79bb\u5f00\u5730\u9762\uff0c\u5e76\u6162\u6162\u56de\u843d\u5230\u5730\u9762</li>\n</ol>\n<p>\u90a3\u4e48\u5927\u81f4\u7684\u601d\u8def\u5c31\u662f\uff1a\u7528\u901f\u5ea6\u6765\u63cf\u8ff0\u4eba\u7269\u7684\u8fd0\u52a8\uff0c\u901f\u5ea6\u6bcf\u4e2a\u65b9\u5411\u4e0a\u7684\u5206\u91cf\u53ef\u4ee5\u5206\u522b\u8ba1\u7b97\uff0c\u6700\u540e\u901f\u5ea6\u4e58\u4ee5\u65f6\u95f4\u5c31\u662f\u4eba\u7269\u7684\u4f4d\u7f6e\u504f\u79fb\u4e86\u3002</p>\n<h2 id=\"_2\">\u4eba\u7269\u7ec4\u4ef6\u8bbe\u7f6e</h2>\n<p>\u5728\u4e3a\u4eba\u7269\u5199\u811a\u672c\u6765\u64cd\u4f5c\u63a7\u5236\u524d\uff0c\u9700\u8981\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\uff0c\u628a\u4eba\u7269\u7684\u76f8\u5173\u7ec4\u4ef6\u5148\u914d\u7f6e\u597d\uff1a</p>\n<ol>\n<li>\u4e3a\u4e86\u63a7\u5236\u4eba\u7269\u5e76\u4f7f\u4eba\u7269\u6709\u4e00\u4e9b\u521a\u6027\u7269\u7406\u4e0a\u7684\u8868\u73b0\u9700\u8981\u4e3a\u4eba\u7269\u6dfb\u52a0\u4e00\u4e2a<code>Character Controller Component</code></li>\n<li>\u4e3a\u4e86\u7ed3\u6784\u66f4\u5206\u660e\u4e00\u4e9b\uff0c\u5148\u628a\u5173\u4e8e\u4eba\u7269\u7684\u64cd\u4f5c\u8f93\u5165\u5206\u51fa\u6765\uff0c\u8bfb\u53d6\u8f93\u5165\u5e76\u521d\u6b65\u5904\u7406\u540e\u628a\u7ed3\u679c\u4f20\u7ed9\u4eba\u7269\u63a7\u5236\u5668\uff0c\u628a\u8fd9\u90e8\u5206\u7684\u811a\u672c\u547d\u540d\u4e3a<code>MyThirdPersonInput.cs</code>\uff1b</li>\n<li>\u771f\u6b63\u63a7\u5236\u4eba\u7269\u79fb\u52a8\u7684\u811a\u672c\u547d\u540d\u4e3a<code>MyThirdPersonController.cs</code></li>\n</ol>\n<p>\u914d\u7f6e\u540e\u7684\u7ed3\u679c\u662f\u8fd9\u6837\uff1a\n<img alt=\"\" src=\"../assets/img/2014-3-15-unity-3rdperson-control0/setting.png\" /></p>\n<h2 id=\"_3\">\u8f93\u5165</h2>\n<p>\u8f93\u5165\u5c31\u662f\u4e0a\u4e0b\u5de6\u53f3\u548c\u8df3\u8dc3\uff0c\u65b9\u5411\u9700\u8981\u505a\u4e00\u4e2a\u5f52\u4e00\u5316\u7684\u5904\u7406\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\">// get movement from input</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Horizontal&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">    </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Vertical&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"c1\">// constrain length to [0, 1]</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"w\">    </span><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">.</span><span class=\"n\">magnitude</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"n\">directionLength</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">.</span><span class=\"n\">normalized</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"n\">person</span><span class=\"p\">.</span><span class=\"n\">inputMoveDirction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"n\">person</span><span class=\"p\">.</span><span class=\"n\">inputJump</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetButton</span><span class=\"p\">(</span><span class=\"s\">&quot;Jump&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"err\">````</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"err\">##\u63cf\u8ff0\u79fb\u52a8\u548c\u8df3\u8dc3</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"err\">\u6211\u4eec\u9700\u8981\u7528\u4e00\u4e9b\u53d8\u91cf\u6765\u63cf\u8ff0\u4eba\u7269\u7684\u52a8\u4f5c\uff0c\u4f8b\u5982\u79fb\u52a8\u901f\u5ea6\uff0c\u8df3\u8dc3\u901f\u5ea6\u7b49\uff0c\u79fb\u52a8\u7528\u4e0b\u9762\u53d8\u91cf\u63cf\u8ff0\uff1a</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"err\">```</span><span class=\"n\">c</span><span class=\"err\">#</span><span class=\"w\">    </span>\n<a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"na\">[System.Serializable]</span>\n<a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Movement</span>\n<a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">forwardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">backwardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sidewardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Movement</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Movement</span><span class=\"p\">();</span>\n</code></pre></div>\n<p><code>[System.Serializable]</code>\u662f\u4e3a\u4e86\u8ba9\u8fd9\u4e9b\u53c2\u6570\u66b4\u9732\u5230Inspector\u4e0a\u3002\u8df3\u8dc3\u7684\u63cf\u8ff0\u5982\u4e0b\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"na\">[System.Serializable]</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Jumping</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// true if can jump</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">jumpSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// original speed when jump</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">gravity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">maxFallSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">20F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// true if now in the air</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Jumping</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Jumping</span><span class=\"p\">();</span>\n</code></pre></div>\n<h2 id=\"_4\">\u5206\u89e3\u901f\u5ea6</h2>\n<p>\u4e3a\u4e86\u65b9\u4fbf\u63cf\u8ff0\u4e0d\u540c\u65b9\u5411\u7684\u79fb\u52a8\uff0c\u628a\u65b9\u5411\u5206\u6210\u4e09\u4e2a\u5206\u91cf\uff1a\u524d\u540e\u3001\u5de6\u53f3\u3001\u4e0a\u4e0b\uff0c\u5206\u522b\u6c42\u89e3\u3002</p>\n<p>\u524d\u540e\u901f\u5ea6\u4e0d\u540c\uff0c\u6839\u636e\u6570\u503c\u7684\u6b63\u8d1f\u5224\u65ad\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">    </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">forwardSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"k\">else</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">backwardSpeed</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u5de6\u53f3\u901f\u5ea6\u4e00\u81f4\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">inputMoveDirction</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">sidewardSpeed</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u8df3\u8dc3\u9ebb\u70e6\u4e00\u70b9\uff0c\u8981\u5224\u65ad\u5f53\u524d\u4eba\u7269\u7684\u72b6\u6001\uff1a</p>\n<ul>\n<li>\u5982\u679c\u5df2\u7ecf\u5728\u7a7a\u4e2d\uff0c\u7528\u91cd\u529b\u8ba1\u7b97\u901f\u5ea6</li>\n<li>\u5982\u679c\u5728\u5730\u4e0a\uff1a</li>\n<li>\n<ul>\n<li>\u5982\u679c\u6309\u4e0b\u8df3\u8dc3\u952e\uff0c\u901f\u5ea6\u4e3a\u8df3\u8dc3\u521d\u59cb\u901f\u5ea6</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>\u5426\u5219y\u65b9\u5411\u901f\u5ea6\u4e3a0</li>\n</ul>\n</li>\n</ul>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isOnGround</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">    </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Max</span><span class=\"p\">(</span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">gravity</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">        </span><span class=\"o\">-</span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">maxFallSpeed</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"k\">else</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">inputJump</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">        </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">jumpSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">        </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h2 id=\"_5\">\u66f4\u65b0\u4eba\u7269\u4f4d\u7f6e</h2>\n<p>\u8ba1\u7b97\u51fa\u6765\u7684\u901f\u5ea6\u5047\u5b9a\u4e3a\u4ece\u672c\u5e27\u5f00\u59cb\u7684\u901f\u5ea6\uff0c\u90a3\u4e48\u672c\u5e27\u8ba1\u7b97\u4f4d\u7f6e\u7684\u901f\u5ea6\u5e94\u8be5\u662f\u524d\u4e00\u5e27\u8ba1\u7b97\u51fa\u6765\u7684\uff0c\u56e0\u6b64\u5728\u66f4\u65b0\u901f\u5ea6\u524d\uff0c\u5148\u8ba1\u7b97\u4eba\u7269\u7684\u65b0\u4f4d\u7f6e\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"c1\">// move to new position</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">collisionFlag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">controller</span><span class=\"p\">.</span><span class=\"n\">Move</span><span class=\"p\">(</span><span class=\"n\">velocity</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"n\">isOnGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">collisionFlag</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">CollisionFlags</span><span class=\"p\">.</span><span class=\"n\">CollidedBelow</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">;</span>\n</code></pre></div>\n<p><code>controller.Move</code>\u4f1a\u8fd4\u56de<code>CollisionFlags</code>\u6765\u8868\u793a\u78b0\u649e\u7684\u72b6\u6001\uff0c\u901a\u8fc7\u8fd9\u4e2a\u72b6\u6001\u5c31\u53ef\u4ee5\u77e5\u9053\u4eba\u7269\u662f\u4e0d\u662f\u7ad9\u5728\u5730\u9762\u4e0a\u3002</p>\n<p>\u5b8c\u6574\u4ee3\u7801\uff1a</p>\n<p>MyThirdPersonInput.cs:</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">UnityEngine</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System.Collections</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"na\">[RequireComponent(typeof(MyThirdPersonController))]</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyThirdPersonInput</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">MonoBehaviour</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"w\">    </span><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"n\">MyThirdPersonController</span><span class=\"w\"> </span><span class=\"n\">person</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Awake</span><span class=\"p\">()</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a><span class=\"w\">        </span><span class=\"n\">person</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetComponent</span><span class=\"o\">&lt;</span><span class=\"n\">MyThirdPersonController</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"w\">    </span><span class=\"c1\">// Update is called once per frame</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Update</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a><span class=\"w\">        </span><span class=\"c1\">// get movement from input</span>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"w\">        </span><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Horizontal&quot;</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"w\">            </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Vertical&quot;</span><span class=\"p\">));</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a><span class=\"w\">            </span><span class=\"c1\">// constrain length to [0, 1]</span>\n<a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"w\">            </span><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">.</span><span class=\"n\">magnitude</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a>\n<a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"w\">            </span><span class=\"n\">directionLength</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a>\n<a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"w\">            </span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">.</span><span class=\"n\">normalized</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">directionLength</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-30\" name=\"__codelineno-6-30\" href=\"#__codelineno-6-30\"></a>\n<a id=\"__codelineno-6-31\" name=\"__codelineno-6-31\" href=\"#__codelineno-6-31\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-32\" name=\"__codelineno-6-32\" href=\"#__codelineno-6-32\"></a>\n<a id=\"__codelineno-6-33\" name=\"__codelineno-6-33\" href=\"#__codelineno-6-33\"></a><span class=\"w\">        </span><span class=\"n\">person</span><span class=\"p\">.</span><span class=\"n\">inputMoveDirction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">;</span>\n<a id=\"__codelineno-6-34\" name=\"__codelineno-6-34\" href=\"#__codelineno-6-34\"></a><span class=\"w\">        </span><span class=\"n\">person</span><span class=\"p\">.</span><span class=\"n\">inputJump</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetButton</span><span class=\"p\">(</span><span class=\"s\">&quot;Jump&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-35\" name=\"__codelineno-6-35\" href=\"#__codelineno-6-35\"></a>\n<a id=\"__codelineno-6-36\" name=\"__codelineno-6-36\" href=\"#__codelineno-6-36\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-6-37\" name=\"__codelineno-6-37\" href=\"#__codelineno-6-37\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>MyThirdPersonController.cs:</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">UnityEngine</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System.Collections</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>\n<a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyThirdPersonController</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">MonoBehaviour</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a>\n<a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">    </span><span class=\"c1\">// The current global direction we want the character to move in.</span>\n<a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">    </span><span class=\"na\">[System.NonSerialized]</span>\n<a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">inputMoveDirction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a>\n<a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">    </span><span class=\"c1\">// Is the jump button held down? We use this interface instead of checking</span>\n<a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">    </span><span class=\"c1\">// for the jump button directly so this script can also be used by AIs.</span>\n<a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">    </span><span class=\"na\">[System.NonSerialized]</span>\n<a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">inputJump</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a>\n<a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">    </span><span class=\"na\">[System.Serializable]</span>\n<a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Movement</span>\n<a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">forwardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">backwardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sidewardSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-22\" name=\"__codelineno-7-22\" href=\"#__codelineno-7-22\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-23\" name=\"__codelineno-7-23\" href=\"#__codelineno-7-23\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Movement</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Movement</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-24\" name=\"__codelineno-7-24\" href=\"#__codelineno-7-24\"></a>\n<a id=\"__codelineno-7-25\" name=\"__codelineno-7-25\" href=\"#__codelineno-7-25\"></a><span class=\"w\">    </span><span class=\"na\">[System.Serializable]</span>\n<a id=\"__codelineno-7-26\" name=\"__codelineno-7-26\" href=\"#__codelineno-7-26\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Jumping</span><span class=\"w\"> </span>\n<a id=\"__codelineno-7-27\" name=\"__codelineno-7-27\" href=\"#__codelineno-7-27\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-28\" name=\"__codelineno-7-28\" href=\"#__codelineno-7-28\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// true if can jump</span>\n<a id=\"__codelineno-7-29\" name=\"__codelineno-7-29\" href=\"#__codelineno-7-29\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">jumpSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// original speed when jump</span>\n<a id=\"__codelineno-7-30\" name=\"__codelineno-7-30\" href=\"#__codelineno-7-30\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">gravity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10F</span><span class=\"p\">;</span><span class=\"w\">     </span>\n<a id=\"__codelineno-7-31\" name=\"__codelineno-7-31\" href=\"#__codelineno-7-31\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">maxFallSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">20F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-32\" name=\"__codelineno-7-32\" href=\"#__codelineno-7-32\"></a><span class=\"w\">        </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// true if now in the air</span>\n<a id=\"__codelineno-7-33\" name=\"__codelineno-7-33\" href=\"#__codelineno-7-33\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-34\" name=\"__codelineno-7-34\" href=\"#__codelineno-7-34\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Jumping</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Jumping</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-35\" name=\"__codelineno-7-35\" href=\"#__codelineno-7-35\"></a>\n<a id=\"__codelineno-7-36\" name=\"__codelineno-7-36\" href=\"#__codelineno-7-36\"></a><span class=\"w\">    </span><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"n\">CharacterController</span><span class=\"w\"> </span><span class=\"n\">controller</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-37\" name=\"__codelineno-7-37\" href=\"#__codelineno-7-37\"></a><span class=\"w\">    </span><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">velocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-38\" name=\"__codelineno-7-38\" href=\"#__codelineno-7-38\"></a><span class=\"w\">    </span><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isOnGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-39\" name=\"__codelineno-7-39\" href=\"#__codelineno-7-39\"></a><span class=\"w\">    </span><span class=\"c1\">// Use this for initialization</span>\n<a id=\"__codelineno-7-40\" name=\"__codelineno-7-40\" href=\"#__codelineno-7-40\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Start</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span>\n<a id=\"__codelineno-7-41\" name=\"__codelineno-7-41\" href=\"#__codelineno-7-41\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-42\" name=\"__codelineno-7-42\" href=\"#__codelineno-7-42\"></a><span class=\"w\">        </span><span class=\"n\">controller</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GetComponent</span><span class=\"o\">&lt;</span><span class=\"n\">CharacterController</span><span class=\"o\">&gt;</span><span class=\"p\">();</span>\n<a id=\"__codelineno-7-43\" name=\"__codelineno-7-43\" href=\"#__codelineno-7-43\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-44\" name=\"__codelineno-7-44\" href=\"#__codelineno-7-44\"></a>\n<a id=\"__codelineno-7-45\" name=\"__codelineno-7-45\" href=\"#__codelineno-7-45\"></a><span class=\"w\">    </span><span class=\"c1\">// Update is called once per frame</span>\n<a id=\"__codelineno-7-46\" name=\"__codelineno-7-46\" href=\"#__codelineno-7-46\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">FixedUpdate</span><span class=\"p\">()</span><span class=\"w\"> </span>\n<a id=\"__codelineno-7-47\" name=\"__codelineno-7-47\" href=\"#__codelineno-7-47\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-48\" name=\"__codelineno-7-48\" href=\"#__codelineno-7-48\"></a><span class=\"w\">        </span><span class=\"c1\">// move to new position</span>\n<a id=\"__codelineno-7-49\" name=\"__codelineno-7-49\" href=\"#__codelineno-7-49\"></a><span class=\"w\">        </span><span class=\"kt\">var</span><span class=\"w\"> </span><span class=\"n\">collisionFlag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">controller</span><span class=\"p\">.</span><span class=\"n\">Move</span><span class=\"p\">(</span><span class=\"n\">velocity</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-50\" name=\"__codelineno-7-50\" href=\"#__codelineno-7-50\"></a><span class=\"w\">        </span><span class=\"n\">isOnGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">collisionFlag</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">CollisionFlags</span><span class=\"p\">.</span><span class=\"n\">CollidedBelow</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-51\" name=\"__codelineno-7-51\" href=\"#__codelineno-7-51\"></a>\n<a id=\"__codelineno-7-52\" name=\"__codelineno-7-52\" href=\"#__codelineno-7-52\"></a><span class=\"w\">        </span><span class=\"c1\">// update velocity</span>\n<a id=\"__codelineno-7-53\" name=\"__codelineno-7-53\" href=\"#__codelineno-7-53\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-54\" name=\"__codelineno-7-54\" href=\"#__codelineno-7-54\"></a><span class=\"w\">        </span><span class=\"n\">velocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-55\" name=\"__codelineno-7-55\" href=\"#__codelineno-7-55\"></a>\n<a id=\"__codelineno-7-56\" name=\"__codelineno-7-56\" href=\"#__codelineno-7-56\"></a><span class=\"w\">        </span><span class=\"c1\">// x-z plane velocity</span>\n<a id=\"__codelineno-7-57\" name=\"__codelineno-7-57\" href=\"#__codelineno-7-57\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">inputMoveDirction</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-58\" name=\"__codelineno-7-58\" href=\"#__codelineno-7-58\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-59\" name=\"__codelineno-7-59\" href=\"#__codelineno-7-59\"></a><span class=\"w\">            </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">inputMoveDirction</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-60\" name=\"__codelineno-7-60\" href=\"#__codelineno-7-60\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-61\" name=\"__codelineno-7-61\" href=\"#__codelineno-7-61\"></a><span class=\"w\">                </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">forwardSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-62\" name=\"__codelineno-7-62\" href=\"#__codelineno-7-62\"></a><span class=\"w\">            </span><span class=\"k\">else</span>\n<a id=\"__codelineno-7-63\" name=\"__codelineno-7-63\" href=\"#__codelineno-7-63\"></a><span class=\"w\">                </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">backwardSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-64\" name=\"__codelineno-7-64\" href=\"#__codelineno-7-64\"></a>\n<a id=\"__codelineno-7-65\" name=\"__codelineno-7-65\" href=\"#__codelineno-7-65\"></a><span class=\"w\">            </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">inputMoveDirction</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">movement</span><span class=\"p\">.</span><span class=\"n\">sidewardSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-66\" name=\"__codelineno-7-66\" href=\"#__codelineno-7-66\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-67\" name=\"__codelineno-7-67\" href=\"#__codelineno-7-67\"></a>\n<a id=\"__codelineno-7-68\" name=\"__codelineno-7-68\" href=\"#__codelineno-7-68\"></a><span class=\"w\">        </span><span class=\"c1\">// y velocity</span>\n<a id=\"__codelineno-7-69\" name=\"__codelineno-7-69\" href=\"#__codelineno-7-69\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isOnGround</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-70\" name=\"__codelineno-7-70\" href=\"#__codelineno-7-70\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-71\" name=\"__codelineno-7-71\" href=\"#__codelineno-7-71\"></a><span class=\"w\">            </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Max</span><span class=\"p\">(</span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">gravity</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-7-72\" name=\"__codelineno-7-72\" href=\"#__codelineno-7-72\"></a><span class=\"w\">                </span><span class=\"o\">-</span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">maxFallSpeed</span><span class=\"p\">);</span>\n<a id=\"__codelineno-7-73\" name=\"__codelineno-7-73\" href=\"#__codelineno-7-73\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-74\" name=\"__codelineno-7-74\" href=\"#__codelineno-7-74\"></a><span class=\"w\">        </span><span class=\"k\">else</span>\n<a id=\"__codelineno-7-75\" name=\"__codelineno-7-75\" href=\"#__codelineno-7-75\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-76\" name=\"__codelineno-7-76\" href=\"#__codelineno-7-76\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">inputJump</span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-77\" name=\"__codelineno-7-77\" href=\"#__codelineno-7-77\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-7-78\" name=\"__codelineno-7-78\" href=\"#__codelineno-7-78\"></a><span class=\"w\">                </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">jumping</span><span class=\"p\">.</span><span class=\"n\">jumpSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-79\" name=\"__codelineno-7-79\" href=\"#__codelineno-7-79\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-80\" name=\"__codelineno-7-80\" href=\"#__codelineno-7-80\"></a><span class=\"w\">            </span><span class=\"k\">else</span>\n<a id=\"__codelineno-7-81\" name=\"__codelineno-7-81\" href=\"#__codelineno-7-81\"></a><span class=\"w\">                </span><span class=\"n\">yVelocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-82\" name=\"__codelineno-7-82\" href=\"#__codelineno-7-82\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-83\" name=\"__codelineno-7-83\" href=\"#__codelineno-7-83\"></a>\n<a id=\"__codelineno-7-84\" name=\"__codelineno-7-84\" href=\"#__codelineno-7-84\"></a><span class=\"w\">        </span><span class=\"n\">velocity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">velocity</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-85\" name=\"__codelineno-7-85\" href=\"#__codelineno-7-85\"></a><span class=\"w\">        </span><span class=\"n\">velocity</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">yVelocity</span><span class=\"p\">;</span>\n<a id=\"__codelineno-7-86\" name=\"__codelineno-7-86\" href=\"#__codelineno-7-86\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-7-87\" name=\"__codelineno-7-87\" href=\"#__codelineno-7-87\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/unity-Unity%E5%AE%9E%E7%8E%B0%E4%BD%93%E7%A7%AF%E5%85%89%E7%85%A7%E6%95%A3%E5%B0%84/",
            "url": "https://wiki.disenone.site/unity-Unity%E5%AE%9E%E7%8E%B0%E4%BD%93%E7%A7%AF%E5%85%89%E7%85%A7%E6%95%A3%E5%B0%84/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Unity\u5b9e\u73b0\u4f53\u79ef\u5149\u7167\u6563\u5c04 (Volumetric Light Scattering\uff0c\u4e91\u9699\u5149)",
            "content_html": "<p><meta property=\"og:title\" content=\"Unity\u5b9e\u73b0\u4f53\u79ef\u5149\u7167\u6563\u5c04 (Volumetric Light Scattering\uff0c\u4e91\u9699\u5149)\" /></p>\n<h2 id=\"_1\">\u539f\u7406</h2>\n<p>Volumetric Light Scattering \u7684\u539f\u7406\u53ef\u4ee5\u53c2\u8003\u300aGPU Gems 3\u300b<a href=\"http://http.developer.nvidia.com/GPUGems3/gpugems3_ch13.html\">\u7b2c13\u7ae0</a>\uff0c\u4e66\u4e0a\u6709\u6548\u679c\u56fe\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/goodeffect.png\" /></p>\n<p>\u597d\u770b\u5427\uff0c\u90a3\u597d\uff0c\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5b9e\u73b0\u8fd9\u79cd\u6548\u679c\u3002</p>\n<p>\u4e66\u4e0a\u4ecb\u7ecd\u4e86\u539f\u7406\uff0c\u4e00\u6761\u5173\u952e\u7684\u516c\u5f0f\u662f\uff1a</p>\n<p>\\[ L(s, \\theta, \\phi) = exposure \\times \\sum_{i=0}^n decay^i \\times weight \\times \\frac{L( s_i, \\theta_i )}{n} \\]</p>\n<p>\u6211\u7684\u7406\u89e3\u662f\uff0c\u5bf9\u4e8e\u56fe\u50cf\u4e0a\u7684\u6bcf\u4e2a\u50cf\u7d20\uff0c\u5149\u7ebf\u90fd\u6709\u53ef\u80fd\u7167\u5c04\u5230\uff0c\u90a3\u4e48\u5bf9\u8be5\u50cf\u7d20\u5230\u5149\u6e90(\u5728\u6295\u5f71\u5230\u56fe\u50cf\u4e0a\u7684\u4f4d\u7f6e)\u7684\u8fde\u7ebf\u8fdb\u884c\u91c7\u6837(\u5bf9\u5e94\u516c\u5f0f\u4e0a\\(i\\))\uff0c\u91c7\u6837\u51fa\u7684\u7ed3\u679c\u8fdb\u884c\u52a0\u6743\u5e73\u5747(\u5bf9\u5e94\u516c\u5f0f\u4e0a\\(\\sum\\))\u5e76\u4f5c\u4e3a\u8be5\u50cf\u7d20\u7684\u65b0\u7684\u989c\u8272\u503c\u3002\u53e6\u5916\u8fd8\u6709\u5173\u952e\u7684\u540e\u7f6e\u50cf\u7d20\u7740\u8272\u5668\uff0c\u4f46\u662f\u5982\u679c\u53ea\u662f\u7528\u90a3\u4e2a\u7740\u8272\u5668\u6765\u5bf9\u76f8\u673a\u6e32\u67d3\u7684\u7ed3\u679c\u8fdb\u884c\u5904\u7406\uff0c\u4f1a\u4ea7\u751f\u660e\u663e\u7684\u4eba\u5de5\u75d5\u8ff9\uff0c\u6709\u8bb8\u591a\u7684\u6761\u7eb9\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/badeffect.png\" /></p>\n<p>\u90a3\u4e48\u4e66\u4e0a\u7684\u6548\u679c\u662f\u600e\u4e48\u505a\u51fa\u6765\u7684\uff1f\u5176\u5b9e\u4e66\u4e0a\u5df2\u7ecf\u7ed9\u51fa\u4e86\u7b54\u6848\uff0c\u53ef\u4ee5\u7528\u4e00\u7ec4\u56fe\u6765\u9610\u8ff0\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/steps.png\" /></p>\n<p>\u56fea \u5c31\u662f\u7c97\u7cd9\u7684\u6548\u679c\uff0c\u7ec6\u5fc3\u5730\u53ef\u4ee5\u770b\u5230\u6709\u8bb8\u591a\u6761\u7eb9\uff0c\u5e76\u4e14\u6ca1\u6709\u906e\u6321\u4e0d\u591f\u771f\u5b9e\uff0cb\u3001c\u3001 d\u5c31\u662f\u4e3a\u4e86\u83b7\u5f97\u597d\u7684\u6548\u679c\u9700\u8981\u8fdb\u884c\u7684\u6b65\u9aa4\uff1a</p>\n<p>b. \u628a\u706f\u5149\u8f90\u5c04\u6548\u679c\u6e32\u67d3\u5230\u56fe\u50cf\u4e0a\uff0c\u5e76\u52a0\u4e0a\u7269\u4f53\u7684\u906e\u6321</p>\n<p>c. \u5bf9b\u6267\u884c Volumetric Light Scattering \u50cf\u7d20\u7740\u8272\u5668\uff0c\u5f97\u5230\u906e\u6321\u540e\u7684\u6548\u679c</p>\n<p>d. \u6dfb\u52a0\u4e0a\u628a\u771f\u5b9e\u573a\u666f\u7684\u989c\u8272</p>\n<p>\u90a3\u4e48\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u4e00\u6b65\u4e00\u6b65\u5730\u5b9e\u73b0\u3002</p>\n<h2 id=\"_2\">\u753b\u906e\u6321\u7269\u4f53</h2>\n<p>\u5728\u5b9e\u9645\u7684\u64cd\u4f5c\u4e2d\uff0c\u6211\u5148\u7528<code>RenderWithShader</code>\u6765\u628a\u4f1a\u53d1\u751f\u906e\u6321\u7684\u7269\u4f53\u753b\u6210\u9ed1\u8272\uff0c\u5176\u4ed6\u5730\u65b9\u4e3a\u767d\u8272\uff0c\u56e0\u4e3a\u8fd9\u9700\u8981\u5bf9\u6bcf\u4e2a\u9762\u7247\u8fdb\u884c\u6e32\u67d3\uff0c\u56e0\u6b64\u5bf9\u4e8e\u590d\u6742\u7684\u573a\u666f\uff0c\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u6d88\u8017\u3002\u573a\u666f\u4e2d\u7684\u7269\u4f53\u6709\u4e0d\u900f\u660e\u548c\u900f\u660e\u7684\uff0c\u6211\u4eec\u5e0c\u671b\u4e0d\u900f\u660e\u7684\u7269\u4f53\u4ea7\u751f\u5b8c\u5168\u7684\u5149\u7ebf\u906e\u6321\uff0c\u800c\u900f\u660e\u7684\u7269\u4f53\u5e94\u8be5\u4ea7\u751f\u90e8\u5206\u7684\u906e\u6321\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u9488\u5bf9\u4e0d\u540cRenderType\u7684\u7269\u4f53\u5199\u4e0d\u540c\u7684Shader\uff0cRenderType\u662fSubShader\u7684Tag\uff0c\u4e0d\u6e05\u695a\u7684\u8bdd\u53ef\u4ee5\u770b<a href=\"http://docs.unity3d.com/Documentation/Components/SL-SubshaderTags.html\">\u8fd9\u91cc</a>\uff0c\u5199\u597d\u4e4b\u540e\u8c03\u7528\uff1a</p>\n<p><div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"n\">camera</span><span class=\"p\">.</span><span class=\"n\">RenderWithShader</span><span class=\"p\">(</span><span class=\"n\">objectOcclusionShader</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;RenderType&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<code>RenderWithShader</code>\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u8981\u6c42\u6839\u636eRenderType\u6765\u66ff\u6362Shader\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u540c\u4e00\u4e2a\u7269\u4f53\u7684\u66ff\u6362\u7684Shader\u7684RenderType\u8981\u8ddf\u66ff\u6362\u524d\u4e00\u81f4\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684RenderType\u7684\u7269\u4f53\u4f7f\u7528\u4e0d\u540c\u7684Shader\uff1a</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Custom</span><span class=\"o\">/</span><span class=\"n\">ObjectOcclusion</span><span class=\"err\">&quot;</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"n\">Properties</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">        </span><span class=\"n\">_MainTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Base</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">RGB</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">        </span><span class=\"n\">Tags</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">            </span><span class=\"err\">&quot;</span><span class=\"n\">Queue</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Geometry</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">            </span><span class=\"err\">&quot;</span><span class=\"n\">RenderType</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Opaque</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"mi\">200</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">        </span><span class=\"n\">Pass</span>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">            </span><span class=\"n\">Lighting</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">            </span><span class=\"n\">ZTest</span><span class=\"w\"> </span><span class=\"n\">Always</span><span class=\"w\"> </span><span class=\"n\">Cull</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"n\">ZWrite</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">            </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">off</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">            </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">            </span><span class=\"cp\">#include &quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a>\n<a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a>\n<a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">            </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">vert</span><span class=\"p\">(</span><span class=\"n\">appdata_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a><span class=\"w\">                </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a>\n<a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COLOR</span>\n<a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">half4</span><span class=\"p\">(</span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">            </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a>\n<a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"w\">        </span><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"w\">        </span><span class=\"n\">Tags</span><span class=\"w\"> </span>\n<a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a><span class=\"w\">            </span><span class=\"err\">&quot;</span><span class=\"n\">Queue</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Geometry</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a><span class=\"w\">            </span><span class=\"err\">&quot;</span><span class=\"n\">RenderType</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Transparent</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"mi\">200</span>\n<a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a><span class=\"w\">        </span><span class=\"n\">Pass</span>\n<a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">            </span><span class=\"n\">Lighting</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a><span class=\"w\">            </span><span class=\"n\">ZTest</span><span class=\"w\"> </span><span class=\"n\">Always</span><span class=\"w\"> </span><span class=\"n\">Cull</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"n\">ZWrite</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">            </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">off</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"w\">            </span><span class=\"n\">Blend</span><span class=\"w\"> </span><span class=\"n\">SrcAlpha</span><span class=\"w\"> </span><span class=\"n\">OneMinusSrcAlpha</span><span class=\"w\">     </span><span class=\"c1\">// blend for transparent objects</span>\n<a id=\"__codelineno-1-56\" name=\"__codelineno-1-56\" href=\"#__codelineno-1-56\"></a><span class=\"w\">            </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-1-57\" name=\"__codelineno-1-57\" href=\"#__codelineno-1-57\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-1-58\" name=\"__codelineno-1-58\" href=\"#__codelineno-1-58\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-1-59\" name=\"__codelineno-1-59\" href=\"#__codelineno-1-59\"></a><span class=\"w\">            </span><span class=\"cp\">#include &quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-1-60\" name=\"__codelineno-1-60\" href=\"#__codelineno-1-60\"></a>\n<a id=\"__codelineno-1-61\" name=\"__codelineno-1-61\" href=\"#__codelineno-1-61\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-62\" name=\"__codelineno-1-62\" href=\"#__codelineno-1-62\"></a>\n<a id=\"__codelineno-1-63\" name=\"__codelineno-1-63\" href=\"#__codelineno-1-63\"></a><span class=\"w\">            </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">vert</span><span class=\"p\">(</span><span class=\"n\">appdata_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span>\n<a id=\"__codelineno-1-64\" name=\"__codelineno-1-64\" href=\"#__codelineno-1-64\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-65\" name=\"__codelineno-1-65\" href=\"#__codelineno-1-65\"></a><span class=\"w\">                </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-66\" name=\"__codelineno-1-66\" href=\"#__codelineno-1-66\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-67\" name=\"__codelineno-1-67\" href=\"#__codelineno-1-67\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MultiplyUV</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">UNITY_MATRIX_TEXTURE0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">texcoord</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-68\" name=\"__codelineno-1-68\" href=\"#__codelineno-1-68\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-69\" name=\"__codelineno-1-69\" href=\"#__codelineno-1-69\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-70\" name=\"__codelineno-1-70\" href=\"#__codelineno-1-70\"></a>\n<a id=\"__codelineno-1-71\" name=\"__codelineno-1-71\" href=\"#__codelineno-1-71\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COLOR</span>\n<a id=\"__codelineno-1-72\" name=\"__codelineno-1-72\" href=\"#__codelineno-1-72\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-73\" name=\"__codelineno-1-73\" href=\"#__codelineno-1-73\"></a><span class=\"w\">                </span><span class=\"n\">half3</span><span class=\"w\"> </span><span class=\"kr\">output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-74\" name=\"__codelineno-1-74\" href=\"#__codelineno-1-74\"></a><span class=\"w\">                </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_MainTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-75\" name=\"__codelineno-1-75\" href=\"#__codelineno-1-75\"></a><span class=\"w\">                </span><span class=\"kr\">half</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-76\" name=\"__codelineno-1-76\" href=\"#__codelineno-1-76\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">half4</span><span class=\"p\">(</span><span class=\"kr\">output</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"o\">-</span><span class=\"n\">alpha</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-77\" name=\"__codelineno-1-77\" href=\"#__codelineno-1-77\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-78\" name=\"__codelineno-1-78\" href=\"#__codelineno-1-78\"></a><span class=\"w\">            </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-1-79\" name=\"__codelineno-1-79\" href=\"#__codelineno-1-79\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-80\" name=\"__codelineno-1-80\" href=\"#__codelineno-1-80\"></a>\n<a id=\"__codelineno-1-81\" name=\"__codelineno-1-81\" href=\"#__codelineno-1-81\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-82\" name=\"__codelineno-1-82\" href=\"#__codelineno-1-82\"></a>\n<a id=\"__codelineno-1-83\" name=\"__codelineno-1-83\" href=\"#__codelineno-1-83\"></a><span class=\"w\">    </span><span class=\"n\">FallBack</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Diffuse</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-1-84\" name=\"__codelineno-1-84\" href=\"#__codelineno-1-84\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u6ce8\u610f\u4e0d\u900f\u660e\u548c\u900f\u660e\u7269\u4f53\u7684Shader\u95f4\u7684\u5dee\u522b\uff1a\u4e0d\u900f\u660e\u7684\u7269\u4f53\u76f4\u63a5\u753b\u6210\u9ed1\u8272\uff1b\u4e0d\u900f\u660e\u7269\u4f53\u9700\u8981\u6267\u884cblending\uff0c\u83b7\u53d6\u7269\u4f53\u7eb9\u7406\u4e0a\u7684alpha\u901a\u9053\uff0c\u5e76\u57fa\u4e8e\u8fd9\u4e2aalpha\u8fdb\u884cblending\u3002\u4e0a\u9762\u4ee3\u7801\u53ea\u662f\u5217\u4e3e\u4e86Opaque\u548cTransparent\uff0c\u53e6\u5916\u8fd8\u6709TreeOpaque (Shader\u8ddfOpaque\u4e00\u6837\uff0c\u53ea\u662f\u6539\u53d8RenderType) \uff0cTreeTransparentCutout (\u540cTransparent) \u7b49\u3002\u7531\u4e8e\u6307\u5b9a\u4e86RenderType\uff0c\u6240\u4ee5\u4e3a\u4e86\u5168\u9762\uff0c\u9700\u8981\u5c3d\u53ef\u80fd\u7a77\u5c3d\u573a\u666f\u4e2d\u7684\u4f1a\u53d1\u751f\u906e\u6321\u7684\u7269\u4f53\uff0c\u6211\u8fd9\u91cc\u5c31\u53ea\u6709\u524d\u9762\u63d0\u5230\u7684\u56db\u79cd\u3002\u7ed3\u679c\u5927\u81f4\u5982\u4e0b\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/objectocclusion.png\" /></p>\n<h2 id=\"_3\">\u7ed3\u5408\u7269\u4f53\u906e\u6321\u753b\u5149\u6e90\u8f90\u5c04</h2>\n<p>\u753b\u5149\u6e90\u7684\u8f90\u5c04\u4e0d\u96be\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u9700\u8981\u6839\u636e\u5c4f\u5e55\u7684\u5927\u5c0f\u505a\u4e00\u4e9b\u5904\u7406\uff0c\u4f7f\u5f97\u5149\u6e90\u7684\u8f90\u5c04\u72b6\u662f\u5706\u5f62\u7684\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"s\">&quot;Custom/LightRadiate&quot;</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"n\">Properties</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">        </span><span class=\"n\">_MainTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">&quot;Base (RGB)&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RECT</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;white&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">        </span><span class=\"n\">_LightPos</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">&quot;Light Pos In Screen Space(XY)&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">        </span><span class=\"n\">_LightRadius</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">&quot;Light radiation radius (Pixel)&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">50</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">    </span><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">        </span><span class=\"n\">Tags</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"s\">&quot;RenderType&quot;</span><span class=\"o\">=</span><span class=\"s\">&quot;Opaque&quot;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"m\">200</span>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">        </span><span class=\"n\">Pass</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">            </span><span class=\"n\">ZTest</span><span class=\"w\"> </span><span class=\"n\">Always</span><span class=\"w\"> </span><span class=\"n\">Cull</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"n\">ZWrite</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">            </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">off</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">            </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">            </span><span class=\"err\">#</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"s\">&quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">            </span><span class=\"n\">uniform</span><span class=\"w\"> </span><span class=\"n\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"w\">            </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">_LightPos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"w\">            </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">_LightRadius</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a><span class=\"w\">            </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"nf\">vert</span><span class=\"p\">(</span><span class=\"n\">appdata_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"w\">                </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-30\" name=\"__codelineno-2-30\" href=\"#__codelineno-2-30\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MultiplyUV</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">UNITY_MATRIX_TEXTURE0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">texcoord</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-31\" name=\"__codelineno-2-31\" href=\"#__codelineno-2-31\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-32\" name=\"__codelineno-2-32\" href=\"#__codelineno-2-32\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-33\" name=\"__codelineno-2-33\" href=\"#__codelineno-2-33\"></a>\n<a id=\"__codelineno-2-34\" name=\"__codelineno-2-34\" href=\"#__codelineno-2-34\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"nf\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"n\">COLOR</span>\n<a id=\"__codelineno-2-35\" name=\"__codelineno-2-35\" href=\"#__codelineno-2-35\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-36\" name=\"__codelineno-2-36\" href=\"#__codelineno-2-36\"></a><span class=\"w\">                </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">deltaTexCoord</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">_LightPos</span><span class=\"p\">.</span><span class=\"n\">xy</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">half2</span><span class=\"p\">(</span><span class=\"n\">_ScreenParams</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_ScreenParams</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-37\" name=\"__codelineno-2-37\" href=\"#__codelineno-2-37\"></a><span class=\"w\">                </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">dis</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dot</span><span class=\"p\">(</span><span class=\"n\">deltaTexCoord</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">deltaTexCoord</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-38\" name=\"__codelineno-2-38\" href=\"#__codelineno-2-38\"></a><span class=\"w\">                </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">maxDis</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_LightRadius</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">_LightRadius</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-39\" name=\"__codelineno-2-39\" href=\"#__codelineno-2-39\"></a><span class=\"w\">                </span><span class=\"n\">dis</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">saturate</span><span class=\"p\">((</span><span class=\"n\">maxDis</span><span class=\"o\">-</span><span class=\"n\">dis</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">maxDis</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-40\" name=\"__codelineno-2-40\" href=\"#__codelineno-2-40\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nf\">half4</span><span class=\"p\">(</span><span class=\"n\">dis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">half4</span><span class=\"p\">(</span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_MainTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">).</span><span class=\"n\">rgb</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">);</span><span class=\"w\">               </span>\n<a id=\"__codelineno-2-41\" name=\"__codelineno-2-41\" href=\"#__codelineno-2-41\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-42\" name=\"__codelineno-2-42\" href=\"#__codelineno-2-42\"></a>\n<a id=\"__codelineno-2-43\" name=\"__codelineno-2-43\" href=\"#__codelineno-2-43\"></a><span class=\"w\">            </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-2-44\" name=\"__codelineno-2-44\" href=\"#__codelineno-2-44\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-45\" name=\"__codelineno-2-45\" href=\"#__codelineno-2-45\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-46\" name=\"__codelineno-2-46\" href=\"#__codelineno-2-46\"></a><span class=\"w\">    </span><span class=\"n\">FallBack</span><span class=\"w\"> </span><span class=\"s\">&quot;Diffuse&quot;</span>\n<a id=\"__codelineno-2-47\" name=\"__codelineno-2-47\" href=\"#__codelineno-2-47\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u8fd9\u4e2aShader\u9700\u8981\u8f93\u5165\u5149\u6e90\u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e(\u53ef\u4ee5\u7528<code>camera.WorldToViewportPoint</code>\u6765\u8ba1\u7b97\uff0c\u5f97\u5230\u7684\u662fuv\u5750\u6807)\uff0c\u7136\u540e\u6839\u636e\u6307\u5b9a\u7684\u534a\u5f84\u753b\u4e00\u4e2a\u4eae\u5ea6\u5f80\u5916\u8870\u51cf\u7684\u5706\uff0c\u5e76\u628a\u7ed3\u679c\u8ddf\u524d\u9762\u5f97\u5230\u7684\u7269\u4f53\u906e\u6321\u56fe\u50cf(\u653e\u5728<code>_MainTex</code>\u91cc)\u7ed3\u5408\uff0c\u7ed3\u679c\u5927\u81f4\u4e3a\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/light.png\" /></p>\n<h2 id=\"light-scattering\">Light Scattering\u5904\u7406\uff0c\u5e76\u7ed3\u5408\u771f\u5b9e\u989c\u8272</h2>\n<p>\u8fd9\u91cc\u5c31\u8981\u7528\u5230\u4e66\u4e0a\u63d0\u4f9b\u7684Pixel Shader\uff0c\u6211\u7684\u7248\u672c\uff1a</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Custom</span><span class=\"o\">/</span><span class=\"n\">LightScattering</span><span class=\"err\">&quot;</span><span class=\"w\"> </span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">    </span><span class=\"n\">Properties</span><span class=\"w\"> </span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">        </span><span class=\"n\">_MainTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Base</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">RGB</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">        </span><span class=\"n\">_LightRadTex</span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Light</span><span class=\"w\"> </span><span class=\"n\">Radiate</span><span class=\"w\"> </span><span class=\"n\">Tex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">RGB</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">        </span><span class=\"n\">_LightPos</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Light</span><span class=\"w\"> </span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"n\">In</span><span class=\"w\"> </span><span class=\"n\">Screen</span><span class=\"w\"> </span><span class=\"n\">Space</span><span class=\"p\">(</span><span class=\"n\">XY</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mo\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">        </span><span class=\"n\">_Params</span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Density</span><span class=\"w\"> </span><span class=\"n\">Weight</span><span class=\"w\"> </span><span class=\"n\">Decay</span><span class=\"w\"> </span><span class=\"n\">Exposure</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">    </span><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"mi\">200</span>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">        </span><span class=\"n\">Pass</span>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">            </span><span class=\"n\">ZTest</span><span class=\"w\"> </span><span class=\"n\">Always</span><span class=\"w\"> </span><span class=\"n\">Cull</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"n\">ZWrite</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">            </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">off</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\">    </span>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">            </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma target 3.0</span>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">            </span><span class=\"cp\">#include &quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a>\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_LightRadTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">_LightPos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">_Params</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a>\n<a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a><span class=\"w\">            </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">vert</span><span class=\"p\">(</span><span class=\"n\">appdata_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a><span class=\"w\">                </span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MultiplyUV</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">UNITY_MATRIX_TEXTURE0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">texcoord</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\" href=\"#__codelineno-3-33\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\" href=\"#__codelineno-3-34\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\" href=\"#__codelineno-3-35\"></a>\n<a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\" href=\"#__codelineno-3-36\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f_img</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COLOR</span>\n<a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\" href=\"#__codelineno-3-37\"></a><span class=\"w\">            </span><span class=\"p\">{</span><span class=\"w\">   </span>\n<a id=\"__codelineno-3-38\" name=\"__codelineno-3-38\" href=\"#__codelineno-3-38\"></a><span class=\"w\">                </span><span class=\"c1\">// Calculate vector from pixel to light source in screen space</span>\n<a id=\"__codelineno-3-39\" name=\"__codelineno-3-39\" href=\"#__codelineno-3-39\"></a><span class=\"w\">                </span><span class=\"n\">float2</span><span class=\"w\"> </span><span class=\"n\">deltaTexCoord</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">_LightPos</span><span class=\"p\">.</span><span class=\"n\">xy</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-40\" name=\"__codelineno-3-40\" href=\"#__codelineno-3-40\"></a>\n<a id=\"__codelineno-3-41\" name=\"__codelineno-3-41\" href=\"#__codelineno-3-41\"></a><span class=\"w\">                </span><span class=\"c1\">// Divide by number of samples and scale by control factor, here I use 32 samples</span>\n<a id=\"__codelineno-3-42\" name=\"__codelineno-3-42\" href=\"#__codelineno-3-42\"></a><span class=\"w\">                </span><span class=\"n\">deltaTexCoord</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">_Params</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">//density;</span>\n<a id=\"__codelineno-3-43\" name=\"__codelineno-3-43\" href=\"#__codelineno-3-43\"></a>\n<a id=\"__codelineno-3-44\" name=\"__codelineno-3-44\" href=\"#__codelineno-3-44\"></a><span class=\"w\">                </span><span class=\"c1\">// Store color.</span>\n<a id=\"__codelineno-3-45\" name=\"__codelineno-3-45\" href=\"#__codelineno-3-45\"></a><span class=\"w\">                </span><span class=\"n\">half3</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_MainTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">).</span><span class=\"n\">rgb</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-46\" name=\"__codelineno-3-46\" href=\"#__codelineno-3-46\"></a>\n<a id=\"__codelineno-3-47\" name=\"__codelineno-3-47\" href=\"#__codelineno-3-47\"></a><span class=\"w\">                </span><span class=\"c1\">// Store initial sample.</span>\n<a id=\"__codelineno-3-48\" name=\"__codelineno-3-48\" href=\"#__codelineno-3-48\"></a><span class=\"w\">                </span><span class=\"n\">half3</span><span class=\"w\"> </span><span class=\"n\">light</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_LightRadTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">).</span><span class=\"n\">rgb</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-49\" name=\"__codelineno-3-49\" href=\"#__codelineno-3-49\"></a>\n<a id=\"__codelineno-3-50\" name=\"__codelineno-3-50\" href=\"#__codelineno-3-50\"></a><span class=\"w\">                </span><span class=\"c1\">// Set up illumination decay factor.</span>\n<a id=\"__codelineno-3-51\" name=\"__codelineno-3-51\" href=\"#__codelineno-3-51\"></a><span class=\"w\">                </span><span class=\"kr\">half</span><span class=\"w\"> </span><span class=\"n\">illuminationDecay</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"n\">f</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-52\" name=\"__codelineno-3-52\" href=\"#__codelineno-3-52\"></a>\n<a id=\"__codelineno-3-53\" name=\"__codelineno-3-53\" href=\"#__codelineno-3-53\"></a><span class=\"w\">                </span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mo\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"o\">++</span><span class=\"n\">j</span><span class=\"p\">)</span>\n<a id=\"__codelineno-3-54\" name=\"__codelineno-3-54\" href=\"#__codelineno-3-54\"></a><span class=\"w\">                </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-55\" name=\"__codelineno-3-55\" href=\"#__codelineno-3-55\"></a><span class=\"w\">                    </span><span class=\"c1\">// Step sample location along ray.</span>\n<a id=\"__codelineno-3-56\" name=\"__codelineno-3-56\" href=\"#__codelineno-3-56\"></a><span class=\"w\">                    </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">deltaTexCoord</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-57\" name=\"__codelineno-3-57\" href=\"#__codelineno-3-57\"></a>\n<a id=\"__codelineno-3-58\" name=\"__codelineno-3-58\" href=\"#__codelineno-3-58\"></a><span class=\"w\">                    </span><span class=\"c1\">// Retrieve sample at new location.</span>\n<a id=\"__codelineno-3-59\" name=\"__codelineno-3-59\" href=\"#__codelineno-3-59\"></a><span class=\"w\">                    </span><span class=\"n\">half3</span><span class=\"w\"> </span><span class=\"k\">sample</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_LightRadTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">).</span><span class=\"n\">rgb</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-60\" name=\"__codelineno-3-60\" href=\"#__codelineno-3-60\"></a>\n<a id=\"__codelineno-3-61\" name=\"__codelineno-3-61\" href=\"#__codelineno-3-61\"></a><span class=\"w\">                    </span><span class=\"c1\">// Apply sample attenuation scale/decay factors.</span>\n<a id=\"__codelineno-3-62\" name=\"__codelineno-3-62\" href=\"#__codelineno-3-62\"></a><span class=\"w\">                    </span><span class=\"k\">sample</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">illuminationDecay</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mf\">0.03125</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">_Params</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">//weight;</span>\n<a id=\"__codelineno-3-63\" name=\"__codelineno-3-63\" href=\"#__codelineno-3-63\"></a>\n<a id=\"__codelineno-3-64\" name=\"__codelineno-3-64\" href=\"#__codelineno-3-64\"></a><span class=\"w\">                    </span><span class=\"c1\">// Accumulate combined light.</span>\n<a id=\"__codelineno-3-65\" name=\"__codelineno-3-65\" href=\"#__codelineno-3-65\"></a><span class=\"w\">                    </span><span class=\"n\">light</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"k\">sample</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-66\" name=\"__codelineno-3-66\" href=\"#__codelineno-3-66\"></a>\n<a id=\"__codelineno-3-67\" name=\"__codelineno-3-67\" href=\"#__codelineno-3-67\"></a><span class=\"w\">                    </span><span class=\"c1\">// Update exponential decay factor.</span>\n<a id=\"__codelineno-3-68\" name=\"__codelineno-3-68\" href=\"#__codelineno-3-68\"></a><span class=\"w\">                    </span><span class=\"n\">illuminationDecay</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">_Params</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">;</span><span class=\"w\">             </span><span class=\"c1\">//decay;</span>\n<a id=\"__codelineno-3-69\" name=\"__codelineno-3-69\" href=\"#__codelineno-3-69\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-70\" name=\"__codelineno-3-70\" href=\"#__codelineno-3-70\"></a>\n<a id=\"__codelineno-3-71\" name=\"__codelineno-3-71\" href=\"#__codelineno-3-71\"></a><span class=\"w\">                </span><span class=\"c1\">// Output final color with a further scale control factor.</span>\n<a id=\"__codelineno-3-72\" name=\"__codelineno-3-72\" href=\"#__codelineno-3-72\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">half4</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"o\">+</span><span class=\"p\">(</span><span class=\"n\">light</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">_Params</span><span class=\"p\">.</span><span class=\"n\">w</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// exposure</span>\n<a id=\"__codelineno-3-73\" name=\"__codelineno-3-73\" href=\"#__codelineno-3-73\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-74\" name=\"__codelineno-3-74\" href=\"#__codelineno-3-74\"></a>\n<a id=\"__codelineno-3-75\" name=\"__codelineno-3-75\" href=\"#__codelineno-3-75\"></a><span class=\"w\">            </span><span class=\"n\">ENDCG</span><span class=\"w\">       </span>\n<a id=\"__codelineno-3-76\" name=\"__codelineno-3-76\" href=\"#__codelineno-3-76\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-3-77\" name=\"__codelineno-3-77\" href=\"#__codelineno-3-77\"></a>\n<a id=\"__codelineno-3-78\" name=\"__codelineno-3-78\" href=\"#__codelineno-3-78\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span>\n<a id=\"__codelineno-3-79\" name=\"__codelineno-3-79\" href=\"#__codelineno-3-79\"></a><span class=\"w\">    </span><span class=\"n\">FallBack</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Diffuse</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-3-80\" name=\"__codelineno-3-80\" href=\"#__codelineno-3-80\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5927\u4f53\u4e0a\u8ddf\u4e66\u4e0a\u7684\u4e00\u81f4\uff0c\u53ea\u662f\u6211\u7684\u53c2\u6570\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u4f20\u8fdb\u6765\uff0c\u5e76\u4e14\u7ed3\u5408\u4e86\u771f\u5b9e\u7684\u989c\u8272\u56fe\u548cLight Scattering\u56fe\uff0c\u7ed3\u679c\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-30-unity-light-scattering/effect.gif\" /></p>\n<h2 id=\"_4\">\u5b8c\u6574\u4ee3\u7801</h2>\n<p>\u4ee3\u7801\u5728<a href=\"../assets/img/2014-3-30-unity-light-scattering/2014-3-30-unity-light-scattering.zip\">\u8fd9\u91cc</a>\uff0c\u628a<code>cs</code>\u811a\u672c\u6dfb\u52a0\u5230\u76f8\u673a\u4e0a\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/unity-Unity%E7%94%BB%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%92%8C%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B/",
            "url": "https://wiki.disenone.site/unity-Unity%E7%94%BB%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%92%8C%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Unity\u753b\u6df1\u5ea6\u56fe(Depth Map)\u548c\u8fb9\u7f18\u68c0\u6d4b(Edge Detection)",
            "content_html": "<p><meta property=\"og:title\" content=\"Unity\u753b\u6df1\u5ea6\u56fe(Depth Map)\u548c\u8fb9\u7f18\u68c0\u6d4b(Edge Detection)\" /></p>\n<p>\u521a\u63a5\u89e6Unity\u6ca1\u591a\u4e45\uff0c\u5bf9Unity\u7684ShaderLab\u4e00\u76f4\u5f88\u611f\u5174\u8da3\uff0c\u611f\u89c9\u5b83\u53ef\u4ee5\u5feb\u901f\u5730\u5b9e\u73b0\u5404\u79cd\u5404\u6837\u7684\u663e\u793a\u6548\u679c\uff0c\u5f88\u6709\u610f\u601d\u3002\u561b\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u95e8\u90fd\u8fd8\u6ca1\u5165\u7684\u4eba\uff0c\u6211\u5c31\u6765\u641e\u4e00\u641e\u6df1\u5ea6\u56fe\u548c\u8fb9\u7f18\u68c0\u6d4b\u5427\u3002</p>\n<h1 id=\"_1\">\u5c0f\u5730\u56fe\u8bbe\u7f6e</h1>\n<p>\u56e0\u4e3a\u6211\u53ea\u662f\u505a\u4e86\u4e00\u4e2a\u5c0f\u96cf\u5f62\uff0c\u6240\u4ee5\u6211\u4e0d\u6253\u7b97\u8be6\u7ec6\u5730\u8bb2\u5982\u4f55\u53bb\u5728\u573a\u666f\u4e0a\u753b\u5c0f\u5730\u56fe\uff0c\u5927\u81f4\u4e0a\u8bf4\u6211\u505a\u4e86\u4ee5\u4e0b\u4e00\u4e9b\u4e8b\u60c5\uff1a</p>\n<ol>\n<li>\u83b7\u53d6\u573a\u666f\u7684 bounding box\uff0c\u8fd9\u4e2a\u5728\u8bbe\u7f6e\u76f8\u673a\u7684\u53c2\u6570\u548c\u4f4d\u7f6e\u65f6\u6709\u7528</li>\n<li>\u628a\u5c0f\u5730\u56fe\u76f8\u673a\u914d\u7f6e\u6210\u6b63\u4ea4\u6295\u5f71\uff0c\u6839\u636e bounding box \u8bbe\u7f6e\u76f8\u673a\u7684\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762</li>\n<li>\u4e3a\u8be5\u76f8\u673a\u589e\u52a0\u4e00\u4e2a\u4eba\u7269\u76ee\u6807\uff0c\u76ee\u6807\u4f1a\u663e\u793a\u5728\u5730\u56fe\u7684\u4e2d\u5fc3</li>\n<li>\u6bcf\u6b21\u66f4\u65b0\u76f8\u673a\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u76ee\u6807\u7684\u4f4d\u7f6e\uff0c\u8fd8\u6709\u573a\u666f\u7684\u6700\u5927 y \u503c</li>\n</ol>\n<p>\u5177\u4f53\u7684\u914d\u7f6e\u53ef\u4ee5\u53c2\u8003\u540e\u9762\u7ed9\u51fa\u7684\u4ee3\u7801\u3002</p>\n<h1 id=\"_2\">\u83b7\u53d6\u6df1\u5ea6\u56fe</h1>\n<h2 id=\"depthtexturemode\">depthTextureMode \u6765\u83b7\u53d6\u6df1\u5ea6\u56fe</h2>\n<p>\u76f8\u673a\u81ea\u5df1\u53ef\u4ee5\u4fdd\u5b58DepthBuffer\u6216\u8005\u4e00\u4e2aDepthNormalBuffer(\u53ef\u7528\u6765\u505a\u8fb9\u7f18\u68c0\u6d4b)\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"n\">Camera</span><span class=\"p\">.</span><span class=\"n\">depthTextureMode</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">DepthTextureMode</span><span class=\"p\">.</span><span class=\"n\">DepthNormals</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u7136\u540e\u5728Shader\u91cc\u9762\u5f15\u7528</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"n\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_CameraDepthNormalsTexture</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u5c31\u53ef\u4ee5\u4e86\uff0c\u5177\u4f53\u7684\u505a\u6cd5\u53ef\u4ee5\u53c2\u8003\u6211\u540e\u9762\u7ed9\u51fa\u7684\u4ee3\u7801\u3002\u5173\u4e8e\u5728Z-Buffer\u91cc\u9762\u4fdd\u5b58\u7684\u6df1\u5ea6\u503c\u8ddf\u771f\u5b9e\u4e16\u754c\u7684\u6df1\u5ea6\u7684\u5173\u7cfb\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e24\u7bc7\u6587\u7ae0\uff1a\n<a href=\"http://www.sjbaker.org/steve/omniv/love_your_z_buffer.html\">Learning to Love your Z-buffer</a>,<a href=\"http://www.humus.name/temp/Linearize%20depth.txt\">Linearize depth</a>\u3002\u53e6\u5916 Unity \u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u51fd\u6570\u6765\u8ba1\u7b97\u6df1\u5ea6: <code>Linear01Depth</code>, <code>LinearEyeDepth</code> \u7b49\u3002</p>\n<p>\u8fd9\u4e0d\u662f\u6211\u8fd9\u91cc\u8ba8\u8bba\u7684\u91cd\u70b9\uff0c\u6211\u60f3\u8bf4\u7684\u662f\uff0c\u672c\u6765\u6211\u7684\u76f8\u673a\u8bbe\u7f6e\u4e3a\u6b63\u4ea4\u6295\u5f71\uff0c\u6df1\u5ea6\u5e94\u8be5\u662f\u7ebf\u6027\u7684\uff0c\u4f46\u6211\u6d4b\u8bd5\u51fa\u6765\u5374\u4e0d\u662f\u7ebf\u6027\u3002\u7136\u540e\u6211\u7528\u4e0a\u9762\u94fe\u63a5\u4ecb\u7ecd\u7684\u65b9\u6cd5\u6765\u8ba1\u7b97\u771f\u5b9e\u4e16\u754c\u7684\u6df1\u5ea6\uff0c\u4e5f\u4e00\u76f4\u90fd\u4e0d\u6b63\u786e\uff0c\u4ee5\u81f3\u4e8e\u4e00\u76f4\u8ba1\u7b97\u4e0d\u51fa\u771f\u5b9e\u7684\u7ebf\u6027\u6df1\u5ea6\uff0c\u4e0d\u77e5\u9053\u662fUnity\u7684Z_Buffer\u7684\u95ee\u9898\u8fd8\u662f\u4ec0\u4e48\uff0c\u90a3\u4f4d\u670b\u53cb\u77e5\u9053\u7684\u8bf7\u6559\u6559\u6211\u3002\u5f53\u7136\uff0c\u5982\u679c\u4e0d\u9700\u8981\u771f\u5b9e\u7684\u6df1\u5ea6\u503c\uff0c\u5355\u5355\u662f\u6bd4\u8f83\u6df1\u5ea6\u7684\u5927\u5c0f\u4e4b\u7c7b\u7684\uff0c\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u5c31\u8db3\u591f\u4e86\uff0c\u800c\u4e14\u5f88\u7b80\u5355\u3002\u4f46\u662f\u5bf9\u4e8e\u6211\u8fd9\u91cc\u6765\u8bf4\uff0c\u6211\u60f3\u8981\u628a\u771f\u5b9e\u6df1\u5ea6\u6620\u5c04\u4e3a\u989c\u8272\u503c\uff0c\u9700\u8981\u83b7\u5f97\u771f\u5b9e\u7684\u7ebf\u6027\u7684\u6df1\u5ea6\u503c\uff08\u867d\u7136\u4e5f\u662f[0, 1]\uff09\uff0c\u6211\u53ea\u597d\u7528\u53e6\u5916\u4e00\u79cd\u7528 RenderWithShader \u65b9\u6cd5\u4e86\u3002</p>\n<h2 id=\"renderwithshader\">RenderWithShader \u6765\u83b7\u53d6\u6df1\u5ea6\u56fe</h2>\n<p>\u8fd9\u79cd\u65b9\u6cd5\u5176\u5b9e\u5c31\u662f\u7528Unity Reference\u91cc\u9762\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a<a href=\"http://docs.unity3d.com/Documentation/Components/SL-ShaderReplacement.html\">Rendering with Replaced Shaders</a>\u3002\u9700\u8981\u7406\u89e3\u7684\u662f\uff0c<code>RenderWithShader</code>\u4f1a\u628a\u573a\u666f\u4e2d\u7684\u76f8\u5e94\u7684Mesh\u753b\u4e00\u904d\u3002</p>\n<p>\u521b\u5efa\u4e00\u4e2a Shader :</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Custom</span><span class=\"o\">/</span><span class=\"n\">DepthByReplaceShader</span><span class=\"err\">&quot;</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"n\">Tags</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">RenderType</span><span class=\"err\">&quot;</span><span class=\"o\">=</span><span class=\"err\">&quot;</span><span class=\"n\">Opaque</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">    </span><span class=\"n\">Pass</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">        </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">        </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">        </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">        </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">        </span><span class=\"cp\">#include &quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">        </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">            </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SV_POSITION</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">            </span><span class=\"n\">float2</span><span class=\"w\"> </span><span class=\"n\">depth</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TEXCOORD0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">        </span><span class=\"p\">};</span>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">        </span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">vert</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">appdata_base</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a><span class=\"w\">            </span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">            </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"w\">            </span><span class=\"n\">UNITY_TRANSFER_DEPTH</span><span class=\"p\">(</span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">depth</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a><span class=\"w\">        </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COLOR</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a><span class=\"w\">            </span><span class=\"c1\">//UNITY_OUTPUT_DEPTH(i.depth);</span>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a><span class=\"w\">            </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">depth</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"o\">/</span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">depth</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">float4</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-30\" name=\"__codelineno-2-30\" href=\"#__codelineno-2-30\"></a><span class=\"w\">        </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-2-31\" name=\"__codelineno-2-31\" href=\"#__codelineno-2-31\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-32\" name=\"__codelineno-2-32\" href=\"#__codelineno-2-32\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-2-33\" name=\"__codelineno-2-33\" href=\"#__codelineno-2-33\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u4e3a\u4f60\u7684\u5c0f\u5730\u56fe\u76f8\u673a(\u6ca1\u6709\u7684\u8bdd\u521b\u5efa\u4e4b)\u6dfb\u52a0\u4e00\u4e2a\u811a\u672c\uff0c\u628a\u76f8\u673a\u914d\u7f6e\u6210\u6b63\u4ea4\u6295\u5f71\u7b49\uff0c\u5e76\u4e14\u5728 <code>Update()</code> \u91cc\u9762\u4f7f\u7528\u8fd9\u4e2a Shader \u6765\u6e32\u67d3\u573a\u666f\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">camera</span><span class=\"p\">.</span><span class=\"n\">targetTexture</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">depthTexture</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"n\">camera</span><span class=\"p\">.</span><span class=\"n\">RenderWithShader</span><span class=\"p\">(</span><span class=\"n\">depthShader</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u6e32\u67d3\u7684\u7ed3\u679c\u5c31\u4f1a\u4fdd\u5b58\u5728 <code>depthTexture</code>\u91cc\u9762\uff0c\u5f88\u7b80\u5355\u5427\u3002</p>\n<h2 id=\"_3\">\u628a\u6df1\u5ea6\u6620\u5c04\u6210\u989c\u8272</h2>\n<p>\u8981\u5b8c\u6210\u8fd9\u4e2a\u5de5\u4f5c\uff0c\u9996\u5148\u9700\u8981\u4e00\u5f20\u989c\u8272\u56fe\uff0c\u8fd9\u5f20\u56fe\u53ef\u4ee5\u7528 Matlab \u5f88\u7b80\u5355\u5730\u751f\u6210\uff0c\u4f8b\u5982\u6211\u7528\u7684\u662f Matlab \u91cc\u9762\u7684 jet \u56fe\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-27-unity-depth-minimap/jet.png\" width=\"200\" /></p>\n<p>\u628a\u8fd9\u5f20\u56fe\u653e\u5230\u9879\u76ee\u76ee\u5f55 <code>Assets\\Resources</code> \u91cc\u9762\uff0c\u5c31\u53ef\u4ee5\u5728\u7a0b\u5e8f\u4e2d\u8bfb\u53d6\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"n\">colorMap</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Resources</span><span class=\"p\">.</span><span class=\"n\">Load</span><span class=\"o\">&lt;</span><span class=\"n\">Texture2D</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;colormap&quot;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u5f20\u56fe\u7247\u7684 <code>Wrap Mode</code> \u5e94\u8be5\u662f <code>Clamp</code>\uff0c\u9632\u6b62\u5728\u4e24\u8fb9\u7f18\u7684\u989c\u8272\u503c\u4e4b\u95f4\u8fdb\u884c\u63d2\u503c\u3002</p>\n<p>\u4e4b\u540e\u5c31\u9700\u8981\u4f7f\u7528 <code>OnRenderImage</code> \u548c <code>Graphics.Blit</code> \u51fd\u6570\uff0c\u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">OnRenderImage</span><span class=\"p\">(</span><span class=\"n\">RenderTexture</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RenderTexture</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">);</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Blit</span><span class=\"p\">(</span><span class=\"n\">Texture</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RenderTexture</span><span class=\"w\"> </span><span class=\"n\">dest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Material</span><span class=\"w\"> </span><span class=\"n\">mat</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"m\">1</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u8fd9\u4e2a\u51fd\u6570\u7684 src \u662f\u76f8\u673a\u6e32\u67d3\u7684\u7ed3\u679c\uff0cdst \u662f\u5904\u7406\u540e\u4f20\u56de\u7ed9\u76f8\u673a\u7684\u7ed3\u679c\uff0c\u56e0\u6b64\u8fd9\u4e2a\u51fd\u6570\u901a\u5e38\u662f\u7528\u6765\u5728\u76f8\u673a\u6e32\u67d3\u5b8c\u6210\u540e\u505a\u56fe\u7247\u7684\u4e00\u4e9b\u6548\u679c\uff0c\u4f8b\u5982\u6211\u4eec\u8fd9\u91cc\u7684\u5bf9\u6df1\u5ea6\u505a\u989c\u8272\u6620\u5c04\uff0c\u8fd8\u6709\u8fb9\u7f18\u68c0\u6d4b\u3002\u505a\u6cd5\u5c31\u662f\u5728<code>OnRenderImage</code>\u4e2d\u8c03\u7528<code>Graphics.Blit</code>\uff0c\u4f20\u5165\u7279\u5b9a\u7684<code>Material</code>\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"n\">depthEdgeMaterial</span><span class=\"p\">.</span><span class=\"n\">SetTexture</span><span class=\"p\">(</span><span class=\"s\">&quot;_DepthTex&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"n\">Graphics</span><span class=\"p\">.</span><span class=\"n\">Blit</span><span class=\"p\">(</span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">depthEdgeMaterial</span><span class=\"p\">);</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"k\">return</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>Graphics.Blit</code>\u5b9e\u9645\u4e0a\u505a\u4e86\u8fd9\u6837\u4e00\u4ef6\u4e8b\u60c5\uff1a\u5728\u76f8\u673a\u524d\u9762\u753b\u4e00\u4e2a\u8ddf\u5c4f\u5e55\u5927\u5c0f\u4e00\u6837\u7684\u5e73\u9762\uff0c\u628a<code>src</code>\u4f5c\u4e3a\u8fd9\u4e2a\u5e73\u9762\u7684<code>_MainTex</code>\u4f20\u8fdb<code>Shader</code>\u4e2d\uff0c\u7136\u540e\u628a\u7ed3\u679c\u653e\u5230<code>dst</code>\u91cc\u9762\uff0c\u800c\u4e0d\u662f\u628a\u5b9e\u9645\u573a\u666f\u4e2d\u7684Mesh\u91cd\u65b0\u753b\u4e00\u904d\u3002</p>\n<p>\u5bf9\u989c\u8272\u6620\u5c04\u5176\u5b9e\u5c31\u662f\u628a\u6df1\u5ea6 [0, 1] \u770b\u6210\u56fe\u7247\u7684 uv\uff0c\u56e0\u4e3a\u6211\u60f3\u8ddd\u79bb\u76f8\u673a\u8fd1\u7684\u4e3a\u7ea2\u8272\uff0c\u6240\u4ee5\u6211\u5bf9\u6df1\u5ea6\u53d6\u4e86\u53cd\uff1a</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_ColorMap</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">float2</span><span class=\"p\">(</span><span class=\"n\">saturate</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"o\">-</span><span class=\"n\">depth</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"mf\">0.5</span><span class=\"p\">));</span>\n</code></pre></div>\n<h1 id=\"_4\">\u8fb9\u7f18\u68c0\u6d4b</h1>\n<p>\u8fb9\u7f18\u68c0\u6d4b\u9700\u8981\u7528\u5230\u4e86\u76f8\u673a\u81ea\u5df1\u7684 <code>_CameraDepthNormalsTexture</code>\uff0c\u4e3b\u8981\u662f\u7528 Normal \u7684\u503c\uff0c\u6df1\u5ea6\u8fd8\u662f\u7528\u4e4b\u524d\u8ba1\u7b97\u51fa\u6765\u7684\u3002\u5728 <code>_CameraDepthNormalsTexture</code> \u7684\u6bcf\u4e2a\u50cf\u7d20 (x, y, z, w) \u4e2d\uff0c(x, y) \u662f\u6cd5\u5411\uff0c(z, w)\u662f\u6df1\u5ea6\uff0c\u6cd5\u5411\u662f\u7528\u4e86\u4e00\u79cd\u65b9\u6cd5\u6765\u5b58\u653e\u7684\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u641c\u7d22\u3002</p>\n<p>\u4ee3\u7801\u662f\u53c2\u8003\u4e86 Unity \u81ea\u5e26\u7684 Image Effect \u91cc\u9762\u7684\u8fb9\u7f18\u68c0\u6d4b\uff0c\u9700\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\uff0c\u6bd4\u8f83\u5f53\u524d\u50cf\u7d20\u7684\u6cd5\u5411\u6df1\u5ea6\u548c\u90bb\u8fd1\u50cf\u7d20\u7684\u5dee\u522b\uff0c\u8db3\u591f\u5927\u6211\u4eec\u5c31\u8ba4\u4e3a\u5b58\u5728\u8fb9\u7f18\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"n\">inline</span><span class=\"w\"> </span><span class=\"n\">half</span><span class=\"w\"> </span><span class=\"nf\">CheckSame</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">centerNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">sampleNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">centerDepth</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sampleDepth</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span><span class=\"c1\">// difference in normals</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">    </span><span class=\"c1\">// do not bother decoding normals - there&#39;s no need here</span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">    </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">centerNormal</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">sampleNormal</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"n\">half</span><span class=\"w\"> </span><span class=\"n\">isSameNormal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">diff</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"w\">    </span><span class=\"c1\">// difference in depth</span>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">zdiff</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">centerDepth</span><span class=\"o\">-</span><span class=\"n\">sampleDepth</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"w\">    </span><span class=\"c1\">// scale the required threshold by the distance</span>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"w\">    </span><span class=\"n\">half</span><span class=\"w\"> </span><span class=\"n\">isSameDepth</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">zdiff</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0.09</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">centerDepth</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">centerDepth</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0.1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">    </span><span class=\"c1\">// return:</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">    </span><span class=\"c1\">// 1 - if normals and depth are similar enough</span>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">    </span><span class=\"c1\">// 0 - otherwise</span>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">isSameNormal</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">isSameDepth</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u5b8c\u6574\u7684 Shader \u5982\u4e0b\uff1a</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Custom</span><span class=\"o\">/</span><span class=\"n\">DepthColorEdge</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a>\n<a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"n\">Properties</span><span class=\"w\"> </span>\n<a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"w\">    </span><span class=\"n\">_DepthTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Depth</span><span class=\"w\"> </span><span class=\"n\">Tex</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"w\">    </span><span class=\"n\">_ColorMap</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Color</span><span class=\"w\"> </span><span class=\"n\">Map</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"w\">    </span><span class=\"n\">SubShader</span><span class=\"w\"> </span>\n<a id=\"__codelineno-9-9\" name=\"__codelineno-9-9\" href=\"#__codelineno-9-9\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-10\" name=\"__codelineno-9-10\" href=\"#__codelineno-9-10\"></a><span class=\"w\">        </span><span class=\"n\">Tags</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">RenderType</span><span class=\"err\">&quot;</span><span class=\"o\">=</span><span class=\"err\">&quot;</span><span class=\"n\">Opaque</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-11\" name=\"__codelineno-9-11\" href=\"#__codelineno-9-11\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"mi\">200</span>\n<a id=\"__codelineno-9-12\" name=\"__codelineno-9-12\" href=\"#__codelineno-9-12\"></a><span class=\"w\">        </span><span class=\"n\">Pass</span>\n<a id=\"__codelineno-9-13\" name=\"__codelineno-9-13\" href=\"#__codelineno-9-13\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-14\" name=\"__codelineno-9-14\" href=\"#__codelineno-9-14\"></a><span class=\"w\">            </span><span class=\"n\">ZTest</span><span class=\"w\"> </span><span class=\"n\">Always</span><span class=\"w\"> </span><span class=\"n\">Cull</span><span class=\"w\"> </span><span class=\"n\">Off</span><span class=\"w\"> </span><span class=\"n\">ZWrite</span><span class=\"w\"> </span><span class=\"n\">Off</span>\n<a id=\"__codelineno-9-15\" name=\"__codelineno-9-15\" href=\"#__codelineno-9-15\"></a><span class=\"w\">            </span><span class=\"n\">Fog</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Mode</span><span class=\"w\"> </span><span class=\"n\">off</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-16\" name=\"__codelineno-9-16\" href=\"#__codelineno-9-16\"></a><span class=\"w\">            </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-9-17\" name=\"__codelineno-9-17\" href=\"#__codelineno-9-17\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma vertex vert</span>\n<a id=\"__codelineno-9-18\" name=\"__codelineno-9-18\" href=\"#__codelineno-9-18\"></a><span class=\"w\">            </span><span class=\"cp\">#pragma fragment frag</span>\n<a id=\"__codelineno-9-19\" name=\"__codelineno-9-19\" href=\"#__codelineno-9-19\"></a><span class=\"w\">            </span><span class=\"cp\">#include &quot;UnityCG.cginc&quot;</span>\n<a id=\"__codelineno-9-20\" name=\"__codelineno-9-20\" href=\"#__codelineno-9-20\"></a><span class=\"w\">            </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_CameraDepthNormalsTexture</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-21\" name=\"__codelineno-9-21\" href=\"#__codelineno-9-21\"></a><span class=\"w\">            </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_DepthTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-22\" name=\"__codelineno-9-22\" href=\"#__codelineno-9-22\"></a><span class=\"w\">            </span><span class=\"k\">uniform</span><span class=\"w\"> </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">_DepthTex_TexelSize</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-23\" name=\"__codelineno-9-23\" href=\"#__codelineno-9-23\"></a><span class=\"w\">            </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_ColorMap</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-24\" name=\"__codelineno-9-24\" href=\"#__codelineno-9-24\"></a><span class=\"w\">            </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">_ZNear</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-25\" name=\"__codelineno-9-25\" href=\"#__codelineno-9-25\"></a><span class=\"w\">            </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">_ZFar</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-26\" name=\"__codelineno-9-26\" href=\"#__codelineno-9-26\"></a>\n<a id=\"__codelineno-9-27\" name=\"__codelineno-9-27\" href=\"#__codelineno-9-27\"></a><span class=\"w\">            </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"n\">v2f</span><span class=\"w\"> </span>\n<a id=\"__codelineno-9-28\" name=\"__codelineno-9-28\" href=\"#__codelineno-9-28\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-29\" name=\"__codelineno-9-29\" href=\"#__codelineno-9-29\"></a><span class=\"w\">                </span><span class=\"n\">float4</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SV_POSITION</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-30\" name=\"__codelineno-9-30\" href=\"#__codelineno-9-30\"></a><span class=\"w\">                </span><span class=\"n\">float2</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TEXCOORD0</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-31\" name=\"__codelineno-9-31\" href=\"#__codelineno-9-31\"></a><span class=\"w\">            </span><span class=\"p\">};</span>\n<a id=\"__codelineno-9-32\" name=\"__codelineno-9-32\" href=\"#__codelineno-9-32\"></a>\n<a id=\"__codelineno-9-33\" name=\"__codelineno-9-33\" href=\"#__codelineno-9-33\"></a><span class=\"w\">            </span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">vert</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">appdata_base</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"p\">)</span>\n<a id=\"__codelineno-9-34\" name=\"__codelineno-9-34\" href=\"#__codelineno-9-34\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-35\" name=\"__codelineno-9-35\" href=\"#__codelineno-9-35\"></a><span class=\"w\">                </span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-36\" name=\"__codelineno-9-36\" href=\"#__codelineno-9-36\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">UNITY_MATRIX_MVP</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"p\">.</span><span class=\"n\">vertex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-37\" name=\"__codelineno-9-37\" href=\"#__codelineno-9-37\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mo\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MultiplyUV</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">UNITY_MATRIX_TEXTURE0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"p\">.</span><span class=\"n\">texcoord</span><span class=\"w\"> </span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-38\" name=\"__codelineno-9-38\" href=\"#__codelineno-9-38\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mo\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">float2</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">_DepthTex_TexelSize</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">_DepthTex_TexelSize</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-39\" name=\"__codelineno-9-39\" href=\"#__codelineno-9-39\"></a><span class=\"w\">                </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mo\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">float2</span><span class=\"p\">(</span><span class=\"o\">+</span><span class=\"n\">_DepthTex_TexelSize</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">_DepthTex_TexelSize</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-40\" name=\"__codelineno-9-40\" href=\"#__codelineno-9-40\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-41\" name=\"__codelineno-9-41\" href=\"#__codelineno-9-41\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-42\" name=\"__codelineno-9-42\" href=\"#__codelineno-9-42\"></a>\n<a id=\"__codelineno-9-43\" name=\"__codelineno-9-43\" href=\"#__codelineno-9-43\"></a>\n<a id=\"__codelineno-9-44\" name=\"__codelineno-9-44\" href=\"#__codelineno-9-44\"></a><span class=\"w\">            </span><span class=\"kr\">inline</span><span class=\"w\"> </span><span class=\"kr\">half</span><span class=\"w\"> </span><span class=\"n\">CheckSame</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">centerNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">sampleNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">centerDepth</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sampleDepth</span><span class=\"p\">)</span>\n<a id=\"__codelineno-9-45\" name=\"__codelineno-9-45\" href=\"#__codelineno-9-45\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-46\" name=\"__codelineno-9-46\" href=\"#__codelineno-9-46\"></a><span class=\"w\">                </span><span class=\"c1\">// difference in normals</span>\n<a id=\"__codelineno-9-47\" name=\"__codelineno-9-47\" href=\"#__codelineno-9-47\"></a><span class=\"w\">                </span><span class=\"c1\">// do not bother decoding normals - there&#39;s no need here</span>\n<a id=\"__codelineno-9-48\" name=\"__codelineno-9-48\" href=\"#__codelineno-9-48\"></a><span class=\"w\">                </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">centerNormal</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">sampleNormal</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-49\" name=\"__codelineno-9-49\" href=\"#__codelineno-9-49\"></a><span class=\"w\">                </span><span class=\"kr\">half</span><span class=\"w\"> </span><span class=\"n\">isSameNormal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">diff</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mf\">0.5</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-50\" name=\"__codelineno-9-50\" href=\"#__codelineno-9-50\"></a>\n<a id=\"__codelineno-9-51\" name=\"__codelineno-9-51\" href=\"#__codelineno-9-51\"></a><span class=\"w\">                </span><span class=\"c1\">// difference in depth</span>\n<a id=\"__codelineno-9-52\" name=\"__codelineno-9-52\" href=\"#__codelineno-9-52\"></a><span class=\"w\">                </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">zdiff</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">centerDepth</span><span class=\"o\">-</span><span class=\"n\">sampleDepth</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-53\" name=\"__codelineno-9-53\" href=\"#__codelineno-9-53\"></a><span class=\"w\">                </span><span class=\"c1\">// scale the required threshold by the distance</span>\n<a id=\"__codelineno-9-54\" name=\"__codelineno-9-54\" href=\"#__codelineno-9-54\"></a><span class=\"w\">                </span><span class=\"kr\">half</span><span class=\"w\"> </span><span class=\"n\">isSameDepth</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">zdiff</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mf\">0.09</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">centerDepth</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">centerDepth</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mf\">0.1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-55\" name=\"__codelineno-9-55\" href=\"#__codelineno-9-55\"></a>\n<a id=\"__codelineno-9-56\" name=\"__codelineno-9-56\" href=\"#__codelineno-9-56\"></a><span class=\"w\">                </span><span class=\"c1\">// return:</span>\n<a id=\"__codelineno-9-57\" name=\"__codelineno-9-57\" href=\"#__codelineno-9-57\"></a><span class=\"w\">                </span><span class=\"c1\">// 1 - if normals and depth are similar enough</span>\n<a id=\"__codelineno-9-58\" name=\"__codelineno-9-58\" href=\"#__codelineno-9-58\"></a><span class=\"w\">                </span><span class=\"c1\">// 0 - otherwise</span>\n<a id=\"__codelineno-9-59\" name=\"__codelineno-9-59\" href=\"#__codelineno-9-59\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">isSameNormal</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">isSameDepth</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-60\" name=\"__codelineno-9-60\" href=\"#__codelineno-9-60\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-61\" name=\"__codelineno-9-61\" href=\"#__codelineno-9-61\"></a>\n<a id=\"__codelineno-9-62\" name=\"__codelineno-9-62\" href=\"#__codelineno-9-62\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">frag</span><span class=\"p\">(</span><span class=\"n\">v2f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COLOR</span><span class=\"w\"> </span>\n<a id=\"__codelineno-9-63\" name=\"__codelineno-9-63\" href=\"#__codelineno-9-63\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-9-64\" name=\"__codelineno-9-64\" href=\"#__codelineno-9-64\"></a><span class=\"w\">                </span><span class=\"c1\">// get color based on depth</span>\n<a id=\"__codelineno-9-65\" name=\"__codelineno-9-65\" href=\"#__codelineno-9-65\"></a><span class=\"w\">                </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">depth</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_DepthTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mo\">0</span><span class=\"p\">]).</span><span class=\"n\">r</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-66\" name=\"__codelineno-9-66\" href=\"#__codelineno-9-66\"></a><span class=\"w\">                </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_ColorMap</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">float2</span><span class=\"p\">(</span><span class=\"n\">saturate</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"o\">-</span><span class=\"n\">depth</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"mf\">0.5</span><span class=\"p\">));</span>\n<a id=\"__codelineno-9-67\" name=\"__codelineno-9-67\" href=\"#__codelineno-9-67\"></a>\n<a id=\"__codelineno-9-68\" name=\"__codelineno-9-68\" href=\"#__codelineno-9-68\"></a><span class=\"w\">                </span><span class=\"c1\">// detect normal diff</span>\n<a id=\"__codelineno-9-69\" name=\"__codelineno-9-69\" href=\"#__codelineno-9-69\"></a><span class=\"w\">                </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">centerNormal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"p\">(</span><span class=\"n\">_CameraDepthNormalsTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mo\">0</span><span class=\"p\">]).</span><span class=\"n\">xy</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-70\" name=\"__codelineno-9-70\" href=\"#__codelineno-9-70\"></a><span class=\"w\">                </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">sampleNormal1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_CameraDepthNormalsTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]).</span><span class=\"n\">xy</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-71\" name=\"__codelineno-9-71\" href=\"#__codelineno-9-71\"></a><span class=\"w\">                </span><span class=\"n\">half2</span><span class=\"w\"> </span><span class=\"n\">sampleNormal2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_CameraDepthNormalsTexture</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]).</span><span class=\"n\">xy</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-72\" name=\"__codelineno-9-72\" href=\"#__codelineno-9-72\"></a><span class=\"w\">                </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sampleDepth1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_DepthTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]).</span><span class=\"n\">r</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-73\" name=\"__codelineno-9-73\" href=\"#__codelineno-9-73\"></a><span class=\"w\">                </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">sampleDepth2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_DepthTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">uv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]).</span><span class=\"n\">r</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-74\" name=\"__codelineno-9-74\" href=\"#__codelineno-9-74\"></a><span class=\"w\">                </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">CheckSame</span><span class=\"p\">(</span><span class=\"n\">centerNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sampleNormal1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">depth</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sampleDepth1</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-75\" name=\"__codelineno-9-75\" href=\"#__codelineno-9-75\"></a><span class=\"w\">                </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"n\">CheckSame</span><span class=\"p\">(</span><span class=\"n\">centerNormal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sampleNormal2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">depth</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sampleDepth2</span><span class=\"p\">);</span>\n<a id=\"__codelineno-9-76\" name=\"__codelineno-9-76\" href=\"#__codelineno-9-76\"></a>\n<a id=\"__codelineno-9-77\" name=\"__codelineno-9-77\" href=\"#__codelineno-9-77\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"p\">;</span>\n<a id=\"__codelineno-9-78\" name=\"__codelineno-9-78\" href=\"#__codelineno-9-78\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-79\" name=\"__codelineno-9-79\" href=\"#__codelineno-9-79\"></a><span class=\"w\">            </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-9-80\" name=\"__codelineno-9-80\" href=\"#__codelineno-9-80\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-81\" name=\"__codelineno-9-81\" href=\"#__codelineno-9-81\"></a>\n<a id=\"__codelineno-9-82\" name=\"__codelineno-9-82\" href=\"#__codelineno-9-82\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-9-83\" name=\"__codelineno-9-83\" href=\"#__codelineno-9-83\"></a><span class=\"w\">    </span><span class=\"n\">FallBack</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Diffuse</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-9-84\" name=\"__codelineno-9-84\" href=\"#__codelineno-9-84\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u7ed3\u679c\u7c7b\u4f3c\u4e8e\u8fd9\u4e2a\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2014-3-27-unity-depth-minimap/topview.png\" width=\"200\" /></p>\n<h1 id=\"_5\">\u6df7\u5408\u771f\u5b9e\u4e16\u754c\u56fe\u50cf</h1>\n<p>\u5355\u5355\u662f\u6df1\u5ea6\u7684\u989c\u8272\u56fe\u53ef\u80fd\u6709\u70b9\u65e0\u8da3\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6df7\u5408\u4e0a\u771f\u5b9e\u573a\u666f\u7684\u989c\u8272\u56fe\uff0c\u53ea\u9700\u8981\u518d\u5efa\u4e00\u4e2a Shader\uff0c\u4f20\u5165\u524d\u9762\u7684\u56fe\u50cf\u548c\u76f8\u673a\u7684\u771f\u5b9e\u56fe\u50cf\uff0c\u5728 <code>OnRenderImage</code> \u4e2d\u8fdb\u884c\u6df7\u5408\uff1a</p>\n<div class=\"language-glsl highlight\"><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"n\">Shader</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Custom</span><span class=\"o\">/</span><span class=\"n\">ColorMixDepth</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"w\">    </span><span class=\"n\">Properties</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">        </span><span class=\"n\">_MainTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Base</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">RGBA</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"w\">        </span><span class=\"n\">_DepthTex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"err\">&quot;</span><span class=\"n\">Depth</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">RGBA</span><span class=\"p\">)</span><span class=\"err\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">D</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">white</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"w\">    </span><span class=\"n\">SubShader</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">        </span><span class=\"n\">Tags</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">RenderType</span><span class=\"err\">&quot;</span><span class=\"o\">=</span><span class=\"err\">&quot;</span><span class=\"n\">Opaque</span><span class=\"err\">&quot;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">        </span><span class=\"n\">LOD</span><span class=\"w\"> </span><span class=\"mi\">200</span>\n<a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a>\n<a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"w\">        </span><span class=\"n\">CGPROGRAM</span>\n<a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\" href=\"#__codelineno-10-11\"></a><span class=\"w\">        </span><span class=\"cp\">#pragma surface surf Lambert</span>\n<a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\" href=\"#__codelineno-10-12\"></a>\n<a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\" href=\"#__codelineno-10-13\"></a><span class=\"w\">        </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\" href=\"#__codelineno-10-14\"></a><span class=\"w\">        </span><span class=\"kt\">sampler2D</span><span class=\"w\"> </span><span class=\"n\">_DepthTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\" href=\"#__codelineno-10-15\"></a>\n<a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\" href=\"#__codelineno-10-16\"></a><span class=\"w\">        </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\" href=\"#__codelineno-10-17\"></a><span class=\"w\">            </span><span class=\"n\">float2</span><span class=\"w\"> </span><span class=\"n\">uv_MainTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\" href=\"#__codelineno-10-18\"></a><span class=\"w\">            </span><span class=\"n\">float2</span><span class=\"w\"> </span><span class=\"n\">uv_DepthTex</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\" href=\"#__codelineno-10-19\"></a><span class=\"w\">        </span><span class=\"p\">};</span>\n<a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\" href=\"#__codelineno-10-20\"></a>\n<a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\" href=\"#__codelineno-10-21\"></a><span class=\"w\">        </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">surf</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"w\"> </span><span class=\"n\">IN</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">inout</span><span class=\"w\"> </span><span class=\"n\">SurfaceOutput</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\" href=\"#__codelineno-10-22\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_MainTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IN</span><span class=\"p\">.</span><span class=\"n\">uv_MainTex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\" href=\"#__codelineno-10-23\"></a><span class=\"w\">            </span><span class=\"n\">half4</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tex2D</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_DepthTex</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IN</span><span class=\"p\">.</span><span class=\"n\">uv_DepthTex</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\" href=\"#__codelineno-10-24\"></a><span class=\"w\">            </span><span class=\"c1\">//d = d.x == 1? 0 : d;</span>\n<a id=\"__codelineno-10-25\" name=\"__codelineno-10-25\" href=\"#__codelineno-10-25\"></a><span class=\"w\">            </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">Albedo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">.</span><span class=\"n\">rgb</span><span class=\"o\">*</span><span class=\"mf\">0.1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">.</span><span class=\"n\">rgb</span><span class=\"o\">*</span><span class=\"mf\">0.9</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-26\" name=\"__codelineno-10-26\" href=\"#__codelineno-10-26\"></a><span class=\"w\">            </span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">Alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-27\" name=\"__codelineno-10-27\" href=\"#__codelineno-10-27\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-10-28\" name=\"__codelineno-10-28\" href=\"#__codelineno-10-28\"></a><span class=\"w\">        </span><span class=\"n\">ENDCG</span>\n<a id=\"__codelineno-10-29\" name=\"__codelineno-10-29\" href=\"#__codelineno-10-29\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span>\n<a id=\"__codelineno-10-30\" name=\"__codelineno-10-30\" href=\"#__codelineno-10-30\"></a><span class=\"w\">    </span><span class=\"n\">FallBack</span><span class=\"w\"> </span><span class=\"err\">&quot;</span><span class=\"n\">Diffuse</span><span class=\"err\">&quot;</span>\n<a id=\"__codelineno-10-31\" name=\"__codelineno-10-31\" href=\"#__codelineno-10-31\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">OnRenderImage</span><span class=\"p\">(</span><span class=\"n\">RenderTexture</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RenderTexture</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"w\">    </span><span class=\"c1\">// if now rendering depth map</span>\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isRenderDepth</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a><span class=\"w\">        </span><span class=\"n\">depthEdgeMaterial</span><span class=\"p\">.</span><span class=\"n\">SetTexture</span><span class=\"p\">(</span><span class=\"s\">&quot;_DepthTex&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">isUseColorMap</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a><span class=\"w\">            </span><span class=\"n\">Graphics</span><span class=\"p\">.</span><span class=\"n\">Blit</span><span class=\"p\">(</span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">depthEdgeMaterial</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a><span class=\"w\">        </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\" href=\"#__codelineno-11-10\"></a><span class=\"w\">            </span><span class=\"n\">Graphics</span><span class=\"p\">.</span><span class=\"n\">Blit</span><span class=\"p\">(</span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\" href=\"#__codelineno-11-11\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-12\" name=\"__codelineno-11-12\" href=\"#__codelineno-11-12\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-13\" name=\"__codelineno-11-13\" href=\"#__codelineno-11-13\"></a><span class=\"w\">    </span><span class=\"c1\">// else rendering real color scene, mix the real color with depth map</span>\n<a id=\"__codelineno-11-14\" name=\"__codelineno-11-14\" href=\"#__codelineno-11-14\"></a><span class=\"w\">    </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-15\" name=\"__codelineno-11-15\" href=\"#__codelineno-11-15\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-16\" name=\"__codelineno-11-16\" href=\"#__codelineno-11-16\"></a><span class=\"w\">        </span><span class=\"n\">mixMaterial</span><span class=\"p\">.</span><span class=\"n\">SetTexture</span><span class=\"p\">(</span><span class=\"s\">&quot;_MainTex&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-17\" name=\"__codelineno-11-17\" href=\"#__codelineno-11-17\"></a><span class=\"w\">        </span><span class=\"n\">mixMaterial</span><span class=\"p\">.</span><span class=\"n\">SetTexture</span><span class=\"p\">(</span><span class=\"s\">&quot;_DepthTex&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">depthTexture</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-18\" name=\"__codelineno-11-18\" href=\"#__codelineno-11-18\"></a><span class=\"w\">        </span><span class=\"n\">Graphics</span><span class=\"p\">.</span><span class=\"n\">Blit</span><span class=\"p\">(</span><span class=\"n\">src</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dst</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mixMaterial</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-19\" name=\"__codelineno-11-19\" href=\"#__codelineno-11-19\"></a><span class=\"w\">        </span><span class=\"n\">ReleaseTexture</span><span class=\"p\">();</span>\n<a id=\"__codelineno-11-20\" name=\"__codelineno-11-20\" href=\"#__codelineno-11-20\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-21\" name=\"__codelineno-11-21\" href=\"#__codelineno-11-21\"></a><span class=\"p\">}</span>\n</code></pre></div>\n\u4e0a\u9762\u7684\u4ee3\u7801\u5c31\u662f\u5b8c\u6210\u8fd9\u4e2a\u5de5\u4f5c\uff0c\u9700\u8981\u7406\u89e3\u7684\u662f\uff0c\u6211\u4eec\u5728\u8c03\u7528 <code>RenderWithShader</code> \u7684\u65f6\u5019\uff0c<code>OnRenderImage</code> \u4e5f\u4f1a\u88ab\u8c03\u7528\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2a\u51fd\u6570\u88ab\u8c03\u7528\u4e86\u4e24\u6b21\uff0c\u800c\u4e24\u6b21\u8c03\u7528\u9700\u8981\u5b8c\u6210\u7684\u529f\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u6307\u793a\u5f53\u524d\u7684\u6e32\u67d3\u72b6\u6001\u662f\u505a\u6df1\u5ea6\u56fe\u8fd8\u662f\u6df7\u5408\u3002</p>\n<h1 id=\"_6\">\u5b8c\u6574\u7684\u4ee3\u7801</h1>\n<p>\u4ee3\u7801\u6587\u4ef6\u6709\u70b9\u591a\uff0c\u5c31\u653e\u5230\u8fd9\u91cc\u4e86<a href=\"../assets/img/2014-3-27-unity-depth-minimap/2014-3-27-unity-depth-minimap.zip\">depth-minimap</a>\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8A%29/",
            "url": "https://wiki.disenone.site/unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8A%29/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Unity\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\u6784\u5efa(\u4e0a)",
            "content_html": "<p><meta property=\"og:title\" content=\"Unity\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\u6784\u5efa(\u4e0a)\" /></p>\n<p>\u6211\u60f3\u5728Unity\u4e2d\u521b\u5efa\u4e00\u4e2a\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\uff0c\u76f8\u673a\u7684\u884c\u4e3a\u53c2\u8003\u300a\u9b54\u517d\u4e16\u754c\u300b\u7684\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\uff0c\u5177\u4f53\u7684\u9700\u6c42\u662f\uff1a</p>\n<ol>\n<li>\u9f20\u6807\u5de6\u952e\uff1a\u63a7\u5236\u76f8\u673a\u56f4\u7ed5\u4eba\u7269\u65cb\u8f6c\uff0c\u4eba\u7269\u4e0d\u65cb\u8f6c</li>\n<li>\u9f20\u6807\u53f3\u952e\uff1a\u63a7\u5236\u76f8\u673a\u56f4\u7ed5\u4eba\u7269\u65cb\u8f6c\uff0c\u4eba\u7269\u7684\u524d\u65b9\u5411(Unity\u4e2d\u7684tranform.forward)\u76f8\u5e94\u65cb\u8f6c\uff0c\u4eba\u7269\u4e0a\u65b9\u5411\u4e0d\u53d8</li>\n<li>\u9f20\u6807\u5de6\u952e\u65cb\u8f6c\u540e\uff0c\u518d\u53f3\u952e\u65cb\u8f6c\uff0c\u89d2\u8272\u524d\u65b9\u5411\u9a6c\u4e0a\u6839\u636e\u5de6\u952e\u7684\u65cb\u8f6c\u505a\u8c03\u6574\uff0c\u518d\u6839\u636e\u53f3\u952e\u65cb\u8f6c\uff0c\u6b64\u65f6\u7b49\u4ef7\u4e8e\u4e24\u6b21\u90fd\u662f\u53f3\u952e\u65cb\u8f6c</li>\n<li>\u9f20\u6807\u6eda\u8f6e\uff1a\u63a7\u5236\u76f8\u673a\u8fdc\u8fd1</li>\n<li>\u76f8\u673a\u4e0d\u80fd\u7a7f\u8fc7\u4efb\u4f55\u521a\u6027\u7269\u4f53</li>\n<li>\u76f8\u673a\u5728\u79bb\u5f00\u78b0\u649e\u7684\u521a\u6027\u7269\u4f53\u540e\uff0c\u6162\u6162\u56de\u5230\u539f\u6765\u7684\u8ddd\u79bb\u4e0a</li>\n<li>\u5982\u679c\u76f8\u673a\u5728\u78b0\u5230\u7269\u4f53\u65f6\uff0c\u4f7f\u7528\u9f20\u6807\u6eda\u8f6e\u64cd\u4f5c\u76f8\u673a\u62c9\u8fd1\uff0c\u76f8\u673a\u9700\u8981\u9a6c\u4e0a\u53cd\u5e94\uff0c\u6b64\u540e\u7b2c6\u70b9\u4e0d\u518d\u53d1\u751f</li>\n<li>\u76f8\u673a\u5728\u65cb\u8f6c\u4e2d\u78b0\u5230\u5730\u9762\uff0c\u505c\u6b62\u56f4\u7ed5\u4eba\u7269\u4e0a\u4e0b\u65cb\u8f6c\uff0c\u6539\u4e3a\u56f4\u7ed5\u81ea\u8eab\u4e0a\u4e0b\u65cb\u8f6c\uff0c\u5de6\u53f3\u65cb\u8f6c\u4f9d\u7136\u662f\u56f4\u7ed5\u4eba\u7269</li>\n</ol>\n<p>\u8fd9\u4e2a\u9700\u6c42\u53ef\u4ee5\u5148\u5206\u6210\u4e24\u90e8\u5206\uff1a\u76f8\u673a\u65cb\u8f6c\uff0c\u76f8\u673a\u521a\u6027\u3002\u7b80\u5355\u8d77\u89c1\uff0c\u8fd9\u91cc\u5148\u6765\u89e3\u51b3\u76f8\u673a\u65cb\u8f6c\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u9700\u6c42\u7684\u524d3\u70b9\u3002</p>\n<h2 id=\"_1\">\u76f8\u673a\u4f4d\u7f6e\u8868\u793a</h2>\n<p>\u5728\u6b63\u5f0f\u89e3\u51b3\u76f8\u673a\u64cd\u4f5c\u524d\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\uff1a\u76f8\u673a\u4f4d\u7f6e\u7684\u8868\u793a\u3002\u8fd9\u53ef\u4ee5\u7528\u591a\u79cd\u65b9\u5f0f\uff1a</p>\n<ul>\n<li>\u76f8\u673a\u7684\u4e16\u754c\u5750\u6807</li>\n<li>\u76f8\u673a\u76f8\u5bf9\u4e8e\u4eba\u7269\u7684\u5750\u6807</li>\n<li>\u76f8\u673a\u5728\u4eba\u7269\u5750\u6807\u7cfb\u4e2d\u7684\u65b9\u5411\u548c\u8ddd\u79bb</li>\n</ul>\n<p>\u56e0\u4e3a\u5728\u6211\u4eec\u7684\u9700\u6c42\u4e2d\uff0c\u76f8\u673a\u662f\u6839\u636e\u4eba\u7269\u4f4d\u7f6e\u8fdb\u884c\u53d8\u6362\u7684\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u4f7f\u7528\u7b2c\u4e09\u79cd\u65b9\u5f0f\uff0c\u800c\u4e14\u5728\u63a7\u5236\u4e2d\u76f8\u673a\u4e00\u76f4\u7784\u51c6\u4eba\u7269\uff0c\u6240\u4ee5\u5728\u76f8\u673a\u5185\u53ea\u9700\u8981\u4fdd\u5b58\u8ddd\u79bb\u4fe1\u606f\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n</code></pre></div>\n<h2 id=\"_2\">\u76f8\u673a\u65cb\u8f6c</h2>\n<p>\u7ee7\u7eed\u7ec6\u5206\u76f8\u673a\u65cb\u8f6c\u7684\u884c\u4e3a\uff0c\u53ef\u4ee5\u5206\u6210\u5de6\u952e\u65cb\u8f6c\u548c\u53f3\u952e\u65cb\u8f6c\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u4e00\u6b65\u4e00\u6b65\u5730\u5b8c\u6210\u8fd9\u4e24\u4e2a\u65cb\u8f6c\u3002\u9996\u5148\u6211\u628a\u76f8\u673a\u8bbe\u4e3a\u4eba\u7269\u7684\u5b50\u7269\u4f53(children)\uff0c\u8fd9\u6837\u4eba\u7269\u7684\u4e00\u4e9b\u57fa\u672c\u7684\u79fb\u52a8\u76f8\u673a\u90fd\u4f1a\u81ea\u52a8\u7684\u8ddf\u8e2a\u3002</p>\n<h3 id=\"_3\">\u5de6\u952e\u65cb\u8f6c</h3>\n<p>\u5355\u5355\u770b\u5de6\u952e\u65cb\u8f6c\uff0c\u9700\u6c42\u5f88\u7b80\u5355\uff1a<strong>\u76f8\u673a\u65cb\u8f6c\uff0c\u4eba\u7269\u4e0d\u65cb\u8f6c</strong>\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u4e00\u4e2a\u89c2\u5bdf\u6a21\u578b\u7684\u76f8\u673a\uff0c\u76f8\u673a\u53ef\u4ee5\u4efb\u610f\u89d2\u5ea6\u89c2\u5bdf\u4e2d\u5fc3\u7269\u4f53\u3002</p>\n<p>\u5728Unity\u4e2d\u83b7\u53d6\u9f20\u6807\u5de6\u952e\u72b6\u6001\u4f7f\u7528\u8bed\u53e5\uff1a<code>Input.GetMouseButton(0)</code>\uff08\u6ce8\uff1a\u540e\u9762\u6d89\u53ca\u5230\u4ee3\u7801\u7684\u5730\u65b9\uff0c\u90fd\u662f\u4f7f\u7528C#\uff09\uff0c\u660e\u663e\uff0c\u53f3\u952e\u5c31\u662f<code>Input.GetMouseButton(1)</code>\u3002\u83b7\u53d6\u9f20\u6807\u5149\u6807\u7684\u79fb\u52a8\u4f4d\u7f6e\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e27\u4e4b\u95f4\u5149\u6807\u5728X-Y\u4e0a\u7684\u504f\u79fb\u91cf\uff09\u4fe1\u606f\u662f\uff1a<code>Input.GetAxis(\"Mouse X\"); Input.GetAxis(\"Mouse Y\")</code>\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u6765\u83b7\u53d6\u9f20\u6807\u5de6\u952e\u6309\u4e0b\u540e\u5149\u6807\u7684\u79fb\u52a8\u4fe1\u606f\uff1a</p>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">))</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse X&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse Y&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u90a3\u4e0b\u9762\u5c31\u662f\u5173\u952e\u7684\u5730\u65b9\uff1a\u5982\u4f55\u63a7\u5236\u76f8\u673a\u6765\u65cb\u8f6c\u3002\u8981\u7406\u89e3\u65cb\u8f6c\uff0c\u8fd9\u91cc\u9700\u8981\u4e00\u4e9b\u5173\u4e8e\u56db\u5143\u6570\u7684\u77e5\u8bc6\uff08\u7f51\u4e0a\u8d44\u6599\u5f88\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5217\u4e3e\u4e86\uff09\uff0c\u56db\u5143\u6570\u91cd\u8981\u7684\u4e00\u70b9\u662f\u5b83\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u6784\u9020\u65cb\u8f6c\uff0c\u7279\u522b\u662f\u56f4\u7ed5\u67d0\u4e2a\u5411\u91cf\u7684\u65cb\u8f6c\uff0c\u7406\u89e3\u56db\u5143\u6570\u540e\uff0c\u5b9e\u73b0\u76f8\u673a\u56f4\u7ed5\u4eba\u7269\u7684\u65cb\u8f6c\u5c31\u4e0d\u96be\u4e86\u3002</p>\n<p>\u53e6\u5916\u8fd8\u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56db\u5143\u6570\u65cb\u8f6c\u8f74\u53ea\u662f\u4e00\u4e2a\u5411\u91cf\uff0c\u4ee5\u539f\u70b9\u4e3a\u51fa\u53d1\u70b9\uff0c\u5982\u679c\u8981\u4ee5\u4e16\u754c\u5750\u6807\u7cfb\u4e2d\u7684\u67d0\u70b9<code>O</code>\u4e3a\u539f\u70b9\uff0c\u4ee5\u8be5\u70b9\u4e3a\u51fa\u53d1\u70b9\u7684\u5411\u91cf<code>V</code>\u4e3a\u65cb\u8f6c\u8f74\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u5750\u6807\u7cfb\u7684\u53d8\u6362\uff0c\u7b80\u5355\u5730\u8bf4\uff0c\u5c31\u662f\u628a\u9700\u8981\u65cb\u8f6c\u7684\u70b9<code>P</code>\u53d8\u6362\u5230\uff0c\u4ee5<code>O</code>\u4e3a\u539f\u70b9\u7684\u5750\u6807\u7cfb\u4e2d\uff0c\u6839\u636e<code>V</code>\u65cb\u8f6c\uff0c\u518d\u53d8\u6362\u4f1a\u4e16\u754c\u5750\u6807\u7cfb\u3002\u6839\u636e\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5199\u51fa\u4e00\u4e2a\u529f\u80fd\u51fd\u6570\uff1a</p>\n<p><div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">oldPosition</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">)</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"c1\">// \u6784\u9020\u4e00\u4e2a\u56db\u5143\u6570\uff0c\u4ee5axis\u4e3a\u65cb\u8f6c\u8f74\uff0c\u8fd9\u662f\u5728\u4eba\u7269\u5750\u6807\u7cfb\u4e2d\u7684\u65cb\u8f6c</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">Quaternion</span><span class=\"w\"> </span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Quaternion</span><span class=\"p\">.</span><span class=\"n\">AngleAxis</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8fd9\u91cc\u505a\u7684\u5c31\u662f\u5750\u6807\u7cfb\u7684\u53d8\u6362\uff0c\u628a\u76f8\u673a\u7684\u4e16\u754c\u5750\u6807\u53d8\u6362\u5230\u4eba\u7269\u5750\u6807\u7cfb\u4e0b\u7684\u5750\u6807</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">oldPosition</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"c1\">// \u8ba1\u7b97\u65cb\u8f6c\u5e76\u53d8\u6362\u56de\u4e16\u754c\u5750\u6807\u7cfb\u4e2d</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<code>Quaternion</code>\u662fUnity\u4e2d\u8868\u793a\u56db\u5143\u6570\u7684\u7c7b\u578b\uff0c\u52a0\u4e0a\u4e4b\u524d\u9f20\u6807\u5de6\u952e\u7684\u68c0\u6d4b\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u5de6\u952e\u63a7\u5236\u76f8\u673a\u5de6\u53f3\u65cb\u8f6c\u3002</p>\n<p>\u9f20\u6807\u5de6\u53f3\u79fb\u52a8\u63a7\u5236\u76f8\u673a\u5de6\u53f3\u65cb\u8f6c\u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u76f4\u63a5\u7ed9\u51fa\uff1a</p>\n<p><div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"n\">newForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">newForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n</code></pre></div>\n\u56e0\u4e3a\u8fd9\u91cc\u53ea\u6709\u524d\u5411\u91cf\u505a\u65cb\u8f6c\uff0c\u6ca1\u6709\u6d89\u53ca\u5230\u5750\u6807\u7cfb\u7684\u8f6c\u6362\uff0c\u6240\u4ee5\u7b2c\u56db\u4e2a\u53c2\u6570\u4e3a<code>Vector3.zero</code>\u3002</p>\n<p>\u63a7\u5236\u4e0a\u4e0b\u65cb\u8f6c\u6bd4\u5de6\u53f3\u65cb\u8f6c\u96be\u7406\u89e3\u4e00\u70b9\uff0c\u56e0\u4e3a\u6b64\u65f6\u7684\u65cb\u8f6c\u8f74\u662f\u4f1a\u4e00\u76f4\u53d8\u5316\u7684(\u8fd9\u91cc\u5047\u8bbe\u4eba\u7269\u7684up\u4e00\u76f4\u662fY\u8f74\u7684\u6b63\u65b9\u5411)\u3002\u6ce8\u610f\u7684\u76f8\u673a\u4e5f\u662f\u4e00\u76f4\u5728\u65cb\u8f6c\uff0c\u5e76\u4e14\u89c6\u70b9\u4e2d\u5fc3\u4e00\u76f4\u5bf9\u51c6\u4eba\u7269\uff0c\u90a3\u4e48\u76f8\u673a\u7684\u53f3\u65b9\u5411(right)\u5c31\u662f\u6211\u4eec\u60f3\u8981\u56f4\u7ed5\u7740\u65cb\u8f6c\u7684\u8f74\u4e86(\u628a\u76f8\u673aright\u60f3\u8c61\u6210\u4eba\u7269\u7684right)\uff0c\u8fd9\u6837\u7406\u89e3\uff0c\u90a3\u4e48\u4e0a\u4e0b\u65cb\u8f6c\u7684\u4ee3\u7801\u4e5f\u5f88\u7b80\u5355\u4e86\uff1a</p>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"n\">newForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">newForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">y</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n</code></pre></div>\n<h3 id=\"_4\">\u53f3\u952e\u65cb\u8f6c</h3>\n<p>\u505a\u4e86\u5de6\u952e\u65cb\u8f6c\uff0c\u53f3\u952e\u65cb\u8f6c\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u53ea\u9700\u8981\u5728\u5de6\u53f3\u65cb\u8f6c\u7684\u65f6\u5019\u8bbe\u7f6e\u4eba\u7269\u7684\u524d\u65b9\u5411\uff1a</p>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Normalize</span><span class=\"p\">(</span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">));</span>\n</code></pre></div>\n<p>\u4e0a\u4e0b\u65cb\u8f6c\u8ddf\u5de6\u952e\u7684\u4ee3\u7801\u4e00\u6837\u3002</p>\n<h3 id=\"_5\">\u5148\u5de6\u952e\uff0c\u540e\u53f3\u952e</h3>\n<p>\u4e0a\u9762\u867d\u7136\u53ef\u4ee5\u5206\u522b\u5de6\u952e\u65cb\u8f6c\uff0c\u53f3\u952e\u65cb\u8f6c\uff0c\u4f46\u662f\u4e00\u65e6\u5148\u7528\u5de6\u952e\u65cb\u8f6c\uff0c\u518d\u7528\u53f3\u952e\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u95ee\u9898\u5c31\u4f1a\u51fa\u73b0\uff1a\u4eba\u7269\u7684\u524d\u65b9\u5411\u548c\u76f8\u673a\u7684\u524d\u65b9\u5411\u4e0d\u540c\u4e86\uff01\u90a3\u4e48\u76f8\u673a\u548c\u4eba\u7269\u7684\u6b63\u65b9\u5411\u5c31\u4ece\u6b64\u5206\u79bb\uff0c\u5b9e\u9645\u64cd\u4f5c\u8d77\u6765\u5f88\u5947\u602a\u3002\u90a3\u4e48\u6211\u4eec\u5728\u7528\u53f3\u952e\u65cb\u8f6c\u7684\u65f6\u5019\u5c31\u8981\u5148\u628a\u4eba\u7269\u8c03\u6574\u4e3a\u8ddf\u76f8\u673a\u7684\u6b63\u65b9\u5411\u4e00\u81f4\uff1a</p>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Normalize</span><span class=\"p\">(</span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">));</span>\n</code></pre></div>\n<hr />\n<h3 id=\"_6\">\u6b27\u62c9\u89d2\u4e07\u5411\u9501</h3>\n<p>\u81f3\u6b64\uff0c\u76f8\u673a\u7684\u65cb\u8f6c\u5dee\u4e0d\u591a\u5c31\u5b8c\u6210\uff0c\u4e0d\u8fc7\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u8981\u6ce8\u610f\uff1a\u6b27\u62c9\u89d2\u4e07\u5411\u9501\u3002\u539f\u7406\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bb2\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u884c\u641c\u7d22\uff0c\u9488\u5bf9\u8fd9\u91cc\u76f8\u673a\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u5f53\u76f8\u673a\u4e0a\u4e0b\u65cb\u8f6c\u5230\u8ddf\u4eba\u7269\u7684\u4e0a\u65b9\u5411\u91cd\u5408\u7684\u65f6\u5019\uff0c\u76f8\u673a\u7684\u89c6\u89d2\u4f1a\u53d1\u751f\u7a81\u53d8\u3002\u8fd9\u662f\u56e0\u4e3a\u76f8\u673a\u5230\u8fbe\u4eba\u7269\u7684\u5934\u9876\u6216\u8005\u811a\u5e95\uff0c\u76f8\u673a\u7684\u4e0a\u65b9\u5411\u4f1a\u53d1\u751f\u7a81\u53d8(\u56e0\u4e3a\u76f8\u673a\u7684\u4e0a\u65b9\u5411\u7684Y\u503c\u4e00\u76f4\u90fd\u8981\u5927\u4e8e\u96f6)\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u9650\u5236\u76f8\u673a\u7684\u4e0a\u4e0b\u65cb\u8f6c\u8303\u56f4\uff0c\u9632\u6b62\u53d1\u751f\u4e07\u5411\u9501\u3002\u64cd\u4f5c\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u9650\u5236\u76f8\u673a\u7684\u524d\u65b9\u5411\u4e0e\u4eba\u7269\u7684\u4e0a\u65b9\u5411\u7684\u5939\u89d2\u7684\u8303\u56f4\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">parent</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"m\">0.95F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">parent</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"m\">0.95F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">))</span>\n</code></pre></div>\n<h3 id=\"_7\">\u5b8c\u6574\u4ee3\u7801</h3>\n<div class=\"language-csharp highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"c1\">// rotate oldPosition around a axis starting at axisPosition</span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">oldPosition</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">    </span><span class=\"n\">Quaternion</span><span class=\"w\"> </span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Quaternion</span><span class=\"p\">.</span><span class=\"n\">AngleAxis</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">oldPosition</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a>\n<a id=\"__codelineno-8-9\" name=\"__codelineno-8-9\" href=\"#__codelineno-8-9\"></a><span class=\"c1\">// rotate oldForward, player forward may change when use mouse RB</span>\n<a id=\"__codelineno-8-10\" name=\"__codelineno-8-10\" href=\"#__codelineno-8-10\"></a><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">RotateIt</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">oldForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Transform</span><span class=\"w\"> </span><span class=\"n\">player</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-11\" name=\"__codelineno-8-11\" href=\"#__codelineno-8-11\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-12\" name=\"__codelineno-8-12\" href=\"#__codelineno-8-12\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">newForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">oldForward</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-13\" name=\"__codelineno-8-13\" href=\"#__codelineno-8-13\"></a><span class=\"w\">    </span><span class=\"c1\">// mouse LB RB rotate camera and character</span>\n<a id=\"__codelineno-8-14\" name=\"__codelineno-8-14\" href=\"#__codelineno-8-14\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-15\" name=\"__codelineno-8-15\" href=\"#__codelineno-8-15\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-16\" name=\"__codelineno-8-16\" href=\"#__codelineno-8-16\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse X&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">rotateSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-17\" name=\"__codelineno-8-17\" href=\"#__codelineno-8-17\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse Y&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">rotateSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-18\" name=\"__codelineno-8-18\" href=\"#__codelineno-8-18\"></a>\n<a id=\"__codelineno-8-19\" name=\"__codelineno-8-19\" href=\"#__codelineno-8-19\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-20\" name=\"__codelineno-8-20\" href=\"#__codelineno-8-20\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-21\" name=\"__codelineno-8-21\" href=\"#__codelineno-8-21\"></a><span class=\"w\">            </span><span class=\"n\">newForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">newForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-22\" name=\"__codelineno-8-22\" href=\"#__codelineno-8-22\"></a>\n<a id=\"__codelineno-8-23\" name=\"__codelineno-8-23\" href=\"#__codelineno-8-23\"></a><span class=\"w\">            </span><span class=\"c1\">// mouse RB, character rotate together</span>\n<a id=\"__codelineno-8-24\" name=\"__codelineno-8-24\" href=\"#__codelineno-8-24\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-25\" name=\"__codelineno-8-25\" href=\"#__codelineno-8-25\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-26\" name=\"__codelineno-8-26\" href=\"#__codelineno-8-26\"></a><span class=\"w\">                </span><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Normalize</span><span class=\"p\">(</span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-8-27\" name=\"__codelineno-8-27\" href=\"#__codelineno-8-27\"></a><span class=\"w\">                    </span><span class=\"n\">oldForward</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">));</span>\n<a id=\"__codelineno-8-28\" name=\"__codelineno-8-28\" href=\"#__codelineno-8-28\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-29\" name=\"__codelineno-8-29\" href=\"#__codelineno-8-29\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-30\" name=\"__codelineno-8-30\" href=\"#__codelineno-8-30\"></a>\n<a id=\"__codelineno-8-31\" name=\"__codelineno-8-31\" href=\"#__codelineno-8-31\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-32\" name=\"__codelineno-8-32\" href=\"#__codelineno-8-32\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-33\" name=\"__codelineno-8-33\" href=\"#__codelineno-8-33\"></a>\n<a id=\"__codelineno-8-34\" name=\"__codelineno-8-34\" href=\"#__codelineno-8-34\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"m\">0.95F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-8-35\" name=\"__codelineno-8-35\" href=\"#__codelineno-8-35\"></a><span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"m\">0.95F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-36\" name=\"__codelineno-8-36\" href=\"#__codelineno-8-36\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-8-37\" name=\"__codelineno-8-37\" href=\"#__codelineno-8-37\"></a><span class=\"w\">                </span><span class=\"n\">newForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">MyRotate</span><span class=\"p\">(</span><span class=\"n\">newForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">y</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-38\" name=\"__codelineno-8-38\" href=\"#__codelineno-8-38\"></a>\n<a id=\"__codelineno-8-39\" name=\"__codelineno-8-39\" href=\"#__codelineno-8-39\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-40\" name=\"__codelineno-8-40\" href=\"#__codelineno-8-40\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-41\" name=\"__codelineno-8-41\" href=\"#__codelineno-8-41\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-8-42\" name=\"__codelineno-8-42\" href=\"#__codelineno-8-42\"></a>\n<a id=\"__codelineno-8-43\" name=\"__codelineno-8-43\" href=\"#__codelineno-8-43\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">newForward</span><span class=\"p\">;</span>\n<a id=\"__codelineno-8-44\" name=\"__codelineno-8-44\" href=\"#__codelineno-8-44\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8B%29/",
            "url": "https://wiki.disenone.site/unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8B%29/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "Unity\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\u6784\u5efa(\u4e0b)",
            "content_html": "<p><meta property=\"og:title\" content=\"Unity\u7b2c\u4e09\u4eba\u79f0\u76f8\u673a\u6784\u5efa(\u4e0b)\" /></p>\n<p>\u4e0a\u4e00\u96c6\u8bb2\u5b8c\u4e86<a href=\"../unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8A%29/\">\u76f8\u673a\u7684\u65cb\u8f6c</a>\uff0c\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u76f8\u673a\u7684\u521a\u6027\uff0c\u8981\u600e\u4e48\u505a\u5462\uff1f</p>\n<h2 id=\"_1\">\u76f8\u673a\u521a\u6027</h2>\n<p>\u56de\u987e\u4e4b\u524d\u63d0\u7684\u9700\u6c42\uff1a</p>\n<ol>\n<li>\u9f20\u6807\u6eda\u8f6e\uff1a\u63a7\u5236\u76f8\u673a\u8fdc\u8fd1</li>\n<li>\u76f8\u673a\u4e0d\u80fd\u7a7f\u8fc7\u4efb\u4f55\u521a\u6027\u7269\u4f53</li>\n<li>\u76f8\u673a\u5728\u79bb\u5f00\u78b0\u649e\u7684\u521a\u6027\u7269\u4f53\u540e\uff0c\u6162\u6162\u56de\u5230\u539f\u6765\u7684\u8ddd\u79bb\u4e0a</li>\n<li>\u5982\u679c\u76f8\u673a\u5728\u78b0\u5230\u521a\u4f53\u65f6\uff0c\u4f7f\u7528\u9f20\u6807\u6eda\u8f6e\u64cd\u4f5c\u76f8\u673a\u62c9\u8fd1\uff0c\u76f8\u673a\u9700\u8981\u9a6c\u4e0a\u53cd\u5e94\uff0c\u6b64\u540e\u7b2c6\u70b9\u4e0d\u518d\u53d1\u751f\uff1b\u78b0\u649e\u5730\u9762\u540e\u4e0d\u80fd\u8fdb\u884c\u7f29\u653e\u64cd\u4f5c</li>\n<li>\u76f8\u673a\u5728\u65cb\u8f6c\u4e2d\u78b0\u5230\u5730\u9762\uff0c\u505c\u6b62\u56f4\u7ed5\u4eba\u7269\u4e0a\u4e0b\u65cb\u8f6c\uff0c\u6539\u4e3a\u56f4\u7ed5\u81ea\u8eab\u4e0a\u4e0b\u65cb\u8f6c\uff0c\u5de6\u53f3\u65cb\u8f6c\u4f9d\u7136\u662f\u56f4\u7ed5\u4eba\u7269</li>\n</ol>\n<p>\u8fd9\u51e0\u70b9\u7684\u610f\u601d\u662f\uff1a\u76f8\u673a\u5728\u78b0\u5230\u521a\u6027\u7269\u4f53\u65f6\uff0c\u4f1a\u88ab\u8feb\u62c9\u8fd1\u8ddf\u4eba\u7269\u7684\u8ddd\u79bb\uff0c\u90a3\u4e48\u6211\u4eec\u60f3\u8981\u76f8\u673a\u5728\u79bb\u5f00\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6162\u6162\u5730\u56de\u5230\u539f\u6765\u7684\u8ddd\u79bb\uff1b\u4f46\u662f\u5982\u679c\u5728\u81ea\u52a8\u62c9\u8fd1\u8ddd\u79bb\u540e\uff0c\u7528\u6eda\u8f6e\u518d\u624b\u52a8\u62c9\u8fd1\uff0c\u8bf4\u660e\u76f8\u673a\u79bb\u5f00\u78b0\u649e\u7684\u7269\u4f53\uff0c\u90a3\u4e48\u8fd9\u4e2a\u62c9\u8fd1\u7684\u8ddd\u79bb\u5c31\u662f\u76f8\u673a\u7684\u5b9e\u9645\u8ddd\u79bb\u3002\u4e0b\u9762\u6211\u4eec\u6765\u4e00\u70b9\u4e00\u70b9\u7684\u89e3\u8fd9\u4e9b\u9700\u6c42\u3002</p>\n<h2 id=\"_2\">\u6eda\u8f6e\u63a7\u5236</h2>\n<p>\u9f20\u6807\u6eda\u8f6e\u63a7\u5236\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u77e5\u9053\u83b7\u53d6\u6eda\u8f6e\u4fe1\u606f\u662f<code>Input.GetAxis(\"Mouse ScrollWheel\")</code>\uff0c\u5e76\u8bbe\u5b9a\u8ddd\u79bb\u7684\u6700\u5927\u503c\u6700\u5c0f\u503c\u5c31ok\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">mouseWheelSensitivity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// control zoom speed</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">mouseWheelZoomMin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// min distance</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">mouseWheelZoomMax</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// max distance</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse ScrollWheel&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">)</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"w\">    </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mouseWheelSensitivity</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">    </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"n\">mouseWheelZoomMax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Max</span><span class=\"p\">(</span><span class=\"n\">mouseWheelZoomMin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">));</span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u8fd9\u91cc<code>playerTransform</code>\u6307\u5411\u4eba\u7269\u3002</p>\n<h2 id=\"_3\">\u4e0d\u80fd\u7a7f\u8fc7\u4efb\u4f55\u521a\u6027\u7269\u4f53</h2>\n<p>\u8fd9\u9700\u8981\u68c0\u6d4b\u76f8\u673a\u8ddf\u521a\u4f53\u7684\u63a5\u89e6\uff0c\u6709\u4e00\u4e2a\u51fd\u6570\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"nf\">Raycast</span><span class=\"p\">(</span><span class=\"n\">Ray</span><span class=\"w\"> </span><span class=\"n\">ray</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RaycastHit</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Mathf</span><span class=\"p\">.</span><span class=\"n\">Infinity</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">layerMask</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">DefaultRaycastLayers</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>\u5177\u4f53\u7528\u6cd5\u53c2\u8003Unity\u7684<a href=\"http://docs.unity3d.com/Documentation/ScriptReference/Physics.Raycast.html\">Reference</a>\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5b9e\u73b0\u78b0\u649e\u7684\u68c0\u6d4b\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">RaycastHit</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Physics</span><span class=\"p\">.</span><span class=\"n\">Raycast</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">desiredPosition</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">desiredPosition</span><span class=\"p\">).</span><span class=\"n\">magnitude</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">.</span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>targetPosition</code>\u5c31\u662f\u78b0\u649e\u7684\u4f4d\u7f6e\uff0c\u628a\u76f8\u673a\u7684\u4f4d\u7f6e\u8bbe\u5230\u78b0\u649e\u7684\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u3002</p>\n<h2 id=\"_4\">\u79bb\u5f00\u521a\u4f53\u540e\uff0c\u6162\u6162\u56de\u5230\u539f\u6765\u7684\u8ddd\u79bb\u4e0a</h2>\n<p>\u8981\u5b8c\u6210\u8fd9\u4e2a\u529f\u80fd\uff0c\u9996\u5148\u8981\u5206\u522b\u8bb0\u5f55\u4e0b\u76f8\u673a\u5e94\u8be5\u5904\u4e8e\u7684\u8ddd\u79bb(<code>desiredDistance</code>)\u548c\u76ee\u524d\u8ddd\u79bb(<code>curDistance</code>)\uff0c\u628a\u6eda\u8f6e\u64cd\u4f5c\u7684\u7ed3\u679c\u7528<code>desiredDistance</code>\u5148\u5b58\u8d77\u6765\uff0c\u518d\u6839\u636e\u78b0\u649e\u8ba1\u7b97\u7269\u4f53\u7684\u65b0\u8ddd\u79bb\uff1b\n\u5728\u68c0\u6d4b\u5230\u76f8\u673a\u79bb\u5f00\u521a\u4f53\uff0c\u6216\u8005\u78b0\u649e\u5230\u66f4\u8fdc\u7684\u521a\u4f53\u65f6\u5019\uff0c\u4e0d\u80fd\u76f4\u63a5\u628a\u78b0\u649e\u7684\u4f4d\u7f6e\u8d4b\u503c\u7ed9\u76f8\u673a\uff0c\u9700\u8981\u7528\u4e00\u4e2a\u79fb\u52a8\u901f\u5ea6\u6765\u5411\u65b0\u7684\u8ddd\u79bb\u79fb\u52a8\u3002\u5148\u6765\u83b7\u53d6\u65b0\u7684\u8ddd\u79bb\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"n\">RaycastHit</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Physics</span><span class=\"p\">.</span><span class=\"n\">Raycast</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">desiredPosition</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">    </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">desiredPosition</span><span class=\"p\">).</span><span class=\"n\">magnitude</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">    </span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">.</span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u90a3\u4e48\u600e\u4e48\u5224\u65ad\u76f8\u673a\u6b63\u5728\u5411\u66f4\u8fdc\u7684\u8ddd\u79bb\u79fb\u52a8\u5462\uff1f\u53ef\u4ee5\u7528<code>newDistances</code>\u548c\u5f53\u524d\u7684\u8ddd\u79bb\u8fdb\u884c\u6bd4\u8f83\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"c1\">// \u5411\u66f4\u8fd1\u7684\u8ddd\u79bb\u79fb\u52a8</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">    </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"c1\">// \u5411\u66f4\u8fdc\u7684\u8ddd\u79bb\u79fb\u52a8</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"nf\">if</span><span class=\"p\">(</span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">)</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u90a3\u4e48\u5224\u65ad\u5230\u5411\u66f4\u8fdc\u8ddd\u79bb\u79fb\u52a8\u540e\uff0c\u5c31\u5f88\u76f4\u89c2\u4e86\uff0c\u76f4\u63a5\u52a0\u4e2a\u901f\u5ea6\u6765\u79fb\u52a8\uff1a</p>\n<p><div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">autoZoomOutSpeed</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"p\">);</span>\n</code></pre></div>\n\u76f8\u673a\u7684\u5927\u81f4\u884c\u4e3a\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u9700\u8981\u5904\u7406\u3002</p>\n<h2 id=\"_5\">\u78b0\u5230\u521a\u4f53\u540e\u6eda\u8f6e\u62c9\u8fd1\uff0c\u5730\u9762\u4e0d\u7f29\u653e</h2>\n<p>\u8fd9\u91cc\u6709\u4e24\u4e2a\u8981\u6c42\uff1a</p>\n<ol>\n<li>\u78b0\u5230\u521a\u4f53\u540e\u53ea\u80fd\u62c9\u8fd1\uff0c\u4e0d\u80fd\u62c9\u8fdc</li>\n<li>\u78b0\u5230\u5730\u9762\u540e\u4e0d\u80fd\u7f29\u653e</li>\n</ol>\n<p>\u9996\u5148\u7528\u53d8\u91cf\u6765\u4fdd\u5b58\u76f8\u673a\u7684\u78b0\u649e\u72b6\u6001\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// \u8868\u793a\u662f\u5426\u78b0\u649e\u5730\u9762</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isHitObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// \u8868\u793a\u662f\u5426\u78b0\u649e\u521a\u4f53(\u9664\u5f00\u5730\u9762)</span>\n</code></pre></div>\n<p>\u5728\u5224\u65ad\u6eda\u8f6e\u7f29\u653e\u7684\u65f6\u5019\u52a0\u4e0a\u6761\u4ef6\u5224\u65ad\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isHitObject</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">)</span>\n<a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"c1\">// calculate distance</span>\n<a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<h2 id=\"_6\">\u78b0\u5230\u5730\u9762\u7ed5\u81ea\u8eab\u4e0a\u4e0b\u65cb\u8f6c</h2>\n<p>\u8fd9\u4e2a\u529f\u80fd\u5b9e\u73b0\u8d77\u6765\u6709\u70b9\u9ebb\u70e6\uff0c\u9700\u8981\u56e0\u4e3a\u8fd9\u65f6\u5019\u6211\u4eec\u4e4b\u524d\u5047\u8bbe\u76f8\u673a\u4e00\u76f4\u5bf9\u51c6\u4eba\u7269\u4e0d\u6210\u7acb\u4e86\uff0c\u8fd9\u65f6\u5206\u6210\u4e24\u4e2a\u5411\u91cf\uff1a<strong>\u76f8\u673a\u81ea\u8eab\u7684\u671d\u5411(<code>desireForward</code>)</strong>\u548c<strong>\u4eba\u7269\u5230\u76f8\u673a\u7684\u65b9\u5411(<code>cameraToPlayer</code>)</strong>\uff0c\u5206\u522b\u8ba1\u7b97\u8fd9\u4e24\u4e2a\u5411\u91cf\u7684\u503c\uff0c\u524d\u8005\u5c31\u51b3\u5b9a\u76f8\u673a\u7684\u671d\u5411\uff0c\u540e\u8005\u5c31\u51b3\u5b9a\u76f8\u673a\u7684\u4f4d\u7f6e\u3002\u4e3a\u4e86\u65b9\u4fbf\uff0c\u628a<a href=\"../unity-Unity%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E7%9B%B8%E6%9C%BA%E6%9E%84%E5%BB%BA%28%E4%B8%8A%29/\">\u4e0a\u4e00\u96c6</a>\u7684\u65cb\u8f6c\u51fd\u6570\u62c6\u6210X\u65cb\u8f6c(<code>RotateX</code>)\u548cY\u65cb\u8f6c(<code>RotateY</code>)\uff0c\u90a3\u4e48\u5728\u8ba1\u7b97<code>cameraToPlayer</code>\u7684<code>RotateY</code>\u65f6\u52a0\u4e0a\u6761\u4ef6\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span>\n<a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">))</span>\n<a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">    </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateY</span><span class=\"p\">(</span><span class=\"n\">cameraToPlayer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">        </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u8fd9\u4e2a\u6761\u4ef6\u6709\u4e24\u90e8\u5206\uff1a</p>\n<ul>\n<li>\u6ca1\u6709\u78b0\u5230\u5730\u9762</li>\n<li>\u78b0\u5230\u5730\u9762\uff0c\u4f46\u662f\u51c6\u5907\u79bb\u5f00\u5730\u9762</li>\n</ul>\n<p>\u7136\u540e\u7528<code>cameraToPlayer</code>\u8ba1\u7b97\u76f8\u673a\u7684\u4f4d\u7f6e\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>\u5e76\u4e14\u5728\u6709\u9700\u8981\u7684\u65f6\u5019(\u4e5f\u5c31\u662f\u78b0\u5230\u5730\u9762)\u8ba1\u7b97\u76f8\u673a\u7684\u671d\u5411\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\" href=\"#__codelineno-10-1\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"p\">)</span>\n<a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\" href=\"#__codelineno-10-2\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\" href=\"#__codelineno-10-3\"></a><span class=\"w\">    </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">LookAt</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\" href=\"#__codelineno-10-4\"></a><span class=\"p\">}</span>\n<a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\" href=\"#__codelineno-10-5\"></a><span class=\"k\">else</span>\n<a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\" href=\"#__codelineno-10-6\"></a><span class=\"p\">{</span>\n<a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\" href=\"#__codelineno-10-7\"></a><span class=\"w\">    </span><span class=\"n\">desireForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateX</span><span class=\"p\">(</span><span class=\"n\">desireForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">xAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\" href=\"#__codelineno-10-8\"></a><span class=\"w\">    </span><span class=\"n\">desireForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateY</span><span class=\"p\">(</span><span class=\"n\">desireForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\" href=\"#__codelineno-10-9\"></a><span class=\"w\">    </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">desireForward</span><span class=\"p\">;</span>\n<a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\" href=\"#__codelineno-10-10\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u8fd9\u6837\u76f8\u673a\u7684\u884c\u4e3a\u6211\u4eec\u90fd\u5b9e\u73b0\u4e86\u3002</p>\n<p>\u5b8c\u6574\u4ee3\u7801\uff1a</p>\n<div class=\"language-c# highlight\"><pre><span></span><code><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">UnityEngine</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"nn\">System.Collections</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a>\n<a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a><span class=\"c1\">// use a forward vector and distance to describe the camera position</span>\n<a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyThirdPersonCamera</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">MonoBehaviour</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a>\n<a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a><span class=\"w\">    </span><span class=\"k\">private</span><span class=\"w\"> </span><span class=\"n\">Transform</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// reference to player</span>\n<a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a>\n<a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\" href=\"#__codelineno-11-10\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">mouseWheelSensitivity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// control zoom speed</span>\n<a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\" href=\"#__codelineno-11-11\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">mouseWheelZoomMin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// min distance</span>\n<a id=\"__codelineno-11-12\" name=\"__codelineno-11-12\" href=\"#__codelineno-11-12\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">mouseWheelZoomMax</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// max distance</span>\n<a id=\"__codelineno-11-13\" name=\"__codelineno-11-13\" href=\"#__codelineno-11-13\"></a>\n<a id=\"__codelineno-11-14\" name=\"__codelineno-11-14\" href=\"#__codelineno-11-14\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">rotateSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span><span class=\"w\">          </span><span class=\"c1\">// speed of rotate around player    </span>\n<a id=\"__codelineno-11-15\" name=\"__codelineno-11-15\" href=\"#__codelineno-11-15\"></a><span class=\"w\">    </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">autoZoomOutSpeed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10F</span><span class=\"p\">;</span><span class=\"w\">    </span><span class=\"c1\">// speed of auto zoom out, camera will auto zoom out </span>\n<a id=\"__codelineno-11-16\" name=\"__codelineno-11-16\" href=\"#__codelineno-11-16\"></a><span class=\"w\">                                            </span><span class=\"c1\">// to pre distance when stop colliding object</span>\n<a id=\"__codelineno-11-17\" name=\"__codelineno-11-17\" href=\"#__codelineno-11-17\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span><span class=\"w\">                 </span><span class=\"c1\">// distance to player</span>\n<a id=\"__codelineno-11-18\" name=\"__codelineno-11-18\" href=\"#__codelineno-11-18\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5F</span><span class=\"p\">;</span><span class=\"w\">             </span><span class=\"c1\">// distance should be      </span>\n<a id=\"__codelineno-11-19\" name=\"__codelineno-11-19\" href=\"#__codelineno-11-19\"></a><span class=\"w\">    </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">               </span><span class=\"c1\">// hit ground flag</span>\n<a id=\"__codelineno-11-20\" name=\"__codelineno-11-20\" href=\"#__codelineno-11-20\"></a><span class=\"w\">    </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isHitObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span><span class=\"w\">               </span><span class=\"c1\">// hit object(except ground) flag</span>\n<a id=\"__codelineno-11-21\" name=\"__codelineno-11-21\" href=\"#__codelineno-11-21\"></a>\n<a id=\"__codelineno-11-22\" name=\"__codelineno-11-22\" href=\"#__codelineno-11-22\"></a><span class=\"w\">    </span><span class=\"c1\">// Use this for initialization</span>\n<a id=\"__codelineno-11-23\" name=\"__codelineno-11-23\" href=\"#__codelineno-11-23\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Awake</span><span class=\"w\"> </span><span class=\"p\">()</span>\n<a id=\"__codelineno-11-24\" name=\"__codelineno-11-24\" href=\"#__codelineno-11-24\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-25\" name=\"__codelineno-11-25\" href=\"#__codelineno-11-25\"></a><span class=\"w\">        </span><span class=\"n\">playerTransform</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">parent</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-26\" name=\"__codelineno-11-26\" href=\"#__codelineno-11-26\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-27\" name=\"__codelineno-11-27\" href=\"#__codelineno-11-27\"></a>\n<a id=\"__codelineno-11-28\" name=\"__codelineno-11-28\" href=\"#__codelineno-11-28\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Start</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-29\" name=\"__codelineno-11-29\" href=\"#__codelineno-11-29\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-30\" name=\"__codelineno-11-30\" href=\"#__codelineno-11-30\"></a><span class=\"w\">        </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-31\" name=\"__codelineno-11-31\" href=\"#__codelineno-11-31\"></a><span class=\"w\">            </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-32\" name=\"__codelineno-11-32\" href=\"#__codelineno-11-32\"></a><span class=\"w\">        </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">LookAt</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-33\" name=\"__codelineno-11-33\" href=\"#__codelineno-11-33\"></a>\n<a id=\"__codelineno-11-34\" name=\"__codelineno-11-34\" href=\"#__codelineno-11-34\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-35\" name=\"__codelineno-11-35\" href=\"#__codelineno-11-35\"></a>\n<a id=\"__codelineno-11-36\" name=\"__codelineno-11-36\" href=\"#__codelineno-11-36\"></a><span class=\"w\">    </span><span class=\"c1\">// Update is called once per frame</span>\n<a id=\"__codelineno-11-37\" name=\"__codelineno-11-37\" href=\"#__codelineno-11-37\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">Update</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-38\" name=\"__codelineno-11-38\" href=\"#__codelineno-11-38\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-39\" name=\"__codelineno-11-39\" href=\"#__codelineno-11-39\"></a><span class=\"w\">        </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-40\" name=\"__codelineno-11-40\" href=\"#__codelineno-11-40\"></a><span class=\"w\">            </span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">).</span><span class=\"n\">normalized</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-41\" name=\"__codelineno-11-41\" href=\"#__codelineno-11-41\"></a>\n<a id=\"__codelineno-11-42\" name=\"__codelineno-11-42\" href=\"#__codelineno-11-42\"></a><span class=\"w\">        </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">desireForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-43\" name=\"__codelineno-11-43\" href=\"#__codelineno-11-43\"></a>\n<a id=\"__codelineno-11-44\" name=\"__codelineno-11-44\" href=\"#__codelineno-11-44\"></a><span class=\"w\">        </span><span class=\"c1\">// get new distance of zoom</span>\n<a id=\"__codelineno-11-45\" name=\"__codelineno-11-45\" href=\"#__codelineno-11-45\"></a><span class=\"w\">        </span><span class=\"n\">desiredDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ZoomIt</span><span class=\"p\">(</span><span class=\"n\">curDistance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-46\" name=\"__codelineno-11-46\" href=\"#__codelineno-11-46\"></a>\n<a id=\"__codelineno-11-47\" name=\"__codelineno-11-47\" href=\"#__codelineno-11-47\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">xAngle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-48\" name=\"__codelineno-11-48\" href=\"#__codelineno-11-48\"></a><span class=\"w\">        </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isRightDown</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-49\" name=\"__codelineno-11-49\" href=\"#__codelineno-11-49\"></a>\n<a id=\"__codelineno-11-50\" name=\"__codelineno-11-50\" href=\"#__codelineno-11-50\"></a><span class=\"w\">        </span><span class=\"c1\">// get mouse LB, RB status</span>\n<a id=\"__codelineno-11-51\" name=\"__codelineno-11-51\" href=\"#__codelineno-11-51\"></a><span class=\"w\">        </span><span class=\"n\">GetMouseButtonStatus</span><span class=\"p\">(</span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">xAngle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">isRightDown</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-52\" name=\"__codelineno-11-52\" href=\"#__codelineno-11-52\"></a>\n<a id=\"__codelineno-11-53\" name=\"__codelineno-11-53\" href=\"#__codelineno-11-53\"></a><span class=\"w\">        </span><span class=\"c1\">// rotate camera by x-axis movement</span>\n<a id=\"__codelineno-11-54\" name=\"__codelineno-11-54\" href=\"#__codelineno-11-54\"></a><span class=\"w\">        </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateX</span><span class=\"p\">(</span><span class=\"n\">cameraToPlayer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">xAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-55\" name=\"__codelineno-11-55\" href=\"#__codelineno-11-55\"></a>\n<a id=\"__codelineno-11-56\" name=\"__codelineno-11-56\" href=\"#__codelineno-11-56\"></a><span class=\"w\">        </span><span class=\"c1\">// if RB on, change player orientation</span>\n<a id=\"__codelineno-11-57\" name=\"__codelineno-11-57\" href=\"#__codelineno-11-57\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isRightDown</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-58\" name=\"__codelineno-11-58\" href=\"#__codelineno-11-58\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-59\" name=\"__codelineno-11-59\" href=\"#__codelineno-11-59\"></a><span class=\"w\">            </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Normalize</span><span class=\"p\">(</span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">(</span><span class=\"n\">cameraToPlayer</span><span class=\"p\">.</span>\n<a id=\"__codelineno-11-60\" name=\"__codelineno-11-60\" href=\"#__codelineno-11-60\"></a><span class=\"w\">                </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"p\">.</span><span class=\"n\">z</span><span class=\"p\">));</span>\n<a id=\"__codelineno-11-61\" name=\"__codelineno-11-61\" href=\"#__codelineno-11-61\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-62\" name=\"__codelineno-11-62\" href=\"#__codelineno-11-62\"></a>\n<a id=\"__codelineno-11-63\" name=\"__codelineno-11-63\" href=\"#__codelineno-11-63\"></a><span class=\"w\">        </span><span class=\"c1\">// rotate camera by y-axis, if camera is not on ground or camera is going to leave ground</span>\n<a id=\"__codelineno-11-64\" name=\"__codelineno-11-64\" href=\"#__codelineno-11-64\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"p\">)</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-65\" name=\"__codelineno-11-65\" href=\"#__codelineno-11-65\"></a><span class=\"w\">        </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"p\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">))</span>\n<a id=\"__codelineno-11-66\" name=\"__codelineno-11-66\" href=\"#__codelineno-11-66\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-67\" name=\"__codelineno-11-67\" href=\"#__codelineno-11-67\"></a><span class=\"w\">            </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateY</span><span class=\"p\">(</span><span class=\"n\">cameraToPlayer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span>\n<a id=\"__codelineno-11-68\" name=\"__codelineno-11-68\" href=\"#__codelineno-11-68\"></a><span class=\"w\">                </span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-69\" name=\"__codelineno-11-69\" href=\"#__codelineno-11-69\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-70\" name=\"__codelineno-11-70\" href=\"#__codelineno-11-70\"></a>\n<a id=\"__codelineno-11-71\" name=\"__codelineno-11-71\" href=\"#__codelineno-11-71\"></a><span class=\"w\">        </span><span class=\"c1\">// detect collision of camera to rigid body, get the distance camera should be</span>\n<a id=\"__codelineno-11-72\" name=\"__codelineno-11-72\" href=\"#__codelineno-11-72\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">DealWithCollision</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-73\" name=\"__codelineno-11-73\" href=\"#__codelineno-11-73\"></a><span class=\"w\">            </span><span class=\"o\">-</span><span class=\"n\">cameraToPlayer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">,</span><span class=\"k\">ref</span><span class=\"w\"> </span><span class=\"n\">isHitGround</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">ref</span><span class=\"w\"> </span><span class=\"n\">isHitObject</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-74\" name=\"__codelineno-11-74\" href=\"#__codelineno-11-74\"></a>\n<a id=\"__codelineno-11-75\" name=\"__codelineno-11-75\" href=\"#__codelineno-11-75\"></a><span class=\"w\">        </span><span class=\"c1\">// check the distance</span>\n<a id=\"__codelineno-11-76\" name=\"__codelineno-11-76\" href=\"#__codelineno-11-76\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-77\" name=\"__codelineno-11-77\" href=\"#__codelineno-11-77\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-78\" name=\"__codelineno-11-78\" href=\"#__codelineno-11-78\"></a><span class=\"w\">            </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-79\" name=\"__codelineno-11-79\" href=\"#__codelineno-11-79\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-80\" name=\"__codelineno-11-80\" href=\"#__codelineno-11-80\"></a><span class=\"w\">        </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-81\" name=\"__codelineno-11-81\" href=\"#__codelineno-11-81\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-82\" name=\"__codelineno-11-82\" href=\"#__codelineno-11-82\"></a><span class=\"w\">            </span><span class=\"c1\">// now moving to farther position, use a speed to move it</span>\n<a id=\"__codelineno-11-83\" name=\"__codelineno-11-83\" href=\"#__codelineno-11-83\"></a><span class=\"w\">            </span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"n\">curDistance</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"p\">.</span><span class=\"n\">deltaTime</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">autoZoomOutSpeed</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-84\" name=\"__codelineno-11-84\" href=\"#__codelineno-11-84\"></a><span class=\"w\">                </span><span class=\"n\">newDistance</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-85\" name=\"__codelineno-11-85\" href=\"#__codelineno-11-85\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-86\" name=\"__codelineno-11-86\" href=\"#__codelineno-11-86\"></a>\n<a id=\"__codelineno-11-87\" name=\"__codelineno-11-87\" href=\"#__codelineno-11-87\"></a><span class=\"w\">        </span><span class=\"c1\">// now calculate the position</span>\n<a id=\"__codelineno-11-88\" name=\"__codelineno-11-88\" href=\"#__codelineno-11-88\"></a><span class=\"w\">        </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">cameraToPlayer</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-89\" name=\"__codelineno-11-89\" href=\"#__codelineno-11-89\"></a>\n<a id=\"__codelineno-11-90\" name=\"__codelineno-11-90\" href=\"#__codelineno-11-90\"></a><span class=\"w\">        </span><span class=\"c1\">// calculate the camera forward, if on ground, camera will rotate on self.Space</span>\n<a id=\"__codelineno-11-91\" name=\"__codelineno-11-91\" href=\"#__codelineno-11-91\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-92\" name=\"__codelineno-11-92\" href=\"#__codelineno-11-92\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-93\" name=\"__codelineno-11-93\" href=\"#__codelineno-11-93\"></a><span class=\"w\">            </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">LookAt</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-94\" name=\"__codelineno-11-94\" href=\"#__codelineno-11-94\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-95\" name=\"__codelineno-11-95\" href=\"#__codelineno-11-95\"></a><span class=\"w\">        </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-96\" name=\"__codelineno-11-96\" href=\"#__codelineno-11-96\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-97\" name=\"__codelineno-11-97\" href=\"#__codelineno-11-97\"></a><span class=\"w\">            </span><span class=\"n\">desireForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateX</span><span class=\"p\">(</span><span class=\"n\">desireForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">xAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-98\" name=\"__codelineno-11-98\" href=\"#__codelineno-11-98\"></a><span class=\"w\">            </span><span class=\"n\">desireForward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateY</span><span class=\"p\">(</span><span class=\"n\">desireForward</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">transform</span><span class=\"p\">.</span>\n<a id=\"__codelineno-11-99\" name=\"__codelineno-11-99\" href=\"#__codelineno-11-99\"></a><span class=\"w\">                </span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">yAngle</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-100\" name=\"__codelineno-11-100\" href=\"#__codelineno-11-100\"></a><span class=\"w\">            </span><span class=\"n\">transform</span><span class=\"p\">.</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">desireForward</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-101\" name=\"__codelineno-11-101\" href=\"#__codelineno-11-101\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-102\" name=\"__codelineno-11-102\" href=\"#__codelineno-11-102\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-103\" name=\"__codelineno-11-103\" href=\"#__codelineno-11-103\"></a>\n<a id=\"__codelineno-11-104\" name=\"__codelineno-11-104\" href=\"#__codelineno-11-104\"></a><span class=\"w\">    </span><span class=\"c1\">// zoom in and zoom out</span>\n<a id=\"__codelineno-11-105\" name=\"__codelineno-11-105\" href=\"#__codelineno-11-105\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"nf\">ZoomIt</span><span class=\"p\">(</span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-106\" name=\"__codelineno-11-106\" href=\"#__codelineno-11-106\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-107\" name=\"__codelineno-11-107\" href=\"#__codelineno-11-107\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse ScrollWheel&quot;</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-108\" name=\"__codelineno-11-108\" href=\"#__codelineno-11-108\"></a>\n<a id=\"__codelineno-11-109\" name=\"__codelineno-11-109\" href=\"#__codelineno-11-109\"></a><span class=\"w\">        </span><span class=\"c1\">//  zoom when hit rigid body and zoom in, or not on ground</span>\n<a id=\"__codelineno-11-110\" name=\"__codelineno-11-110\" href=\"#__codelineno-11-110\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isHitGround</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isHitObject</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-111\" name=\"__codelineno-11-111\" href=\"#__codelineno-11-111\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-112\" name=\"__codelineno-11-112\" href=\"#__codelineno-11-112\"></a><span class=\"w\">            </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">curDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-113\" name=\"__codelineno-11-113\" href=\"#__codelineno-11-113\"></a>\n<a id=\"__codelineno-11-114\" name=\"__codelineno-11-114\" href=\"#__codelineno-11-114\"></a><span class=\"w\">            </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mouseWheelSensitivity</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-115\" name=\"__codelineno-11-115\" href=\"#__codelineno-11-115\"></a><span class=\"w\">            </span><span class=\"n\">distance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Min</span><span class=\"p\">(</span><span class=\"n\">mouseWheelZoomMax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Math</span><span class=\"p\">.</span><span class=\"n\">Max</span><span class=\"p\">(</span><span class=\"n\">mouseWheelZoomMin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">));</span>\n<a id=\"__codelineno-11-116\" name=\"__codelineno-11-116\" href=\"#__codelineno-11-116\"></a>\n<a id=\"__codelineno-11-117\" name=\"__codelineno-11-117\" href=\"#__codelineno-11-117\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-118\" name=\"__codelineno-11-118\" href=\"#__codelineno-11-118\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-119\" name=\"__codelineno-11-119\" href=\"#__codelineno-11-119\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-120\" name=\"__codelineno-11-120\" href=\"#__codelineno-11-120\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-121\" name=\"__codelineno-11-121\" href=\"#__codelineno-11-121\"></a>\n<a id=\"__codelineno-11-122\" name=\"__codelineno-11-122\" href=\"#__codelineno-11-122\"></a><span class=\"w\">    </span><span class=\"c1\">// rotate oldPosition around a axis starting at axisPosition</span>\n<a id=\"__codelineno-11-123\" name=\"__codelineno-11-123\" href=\"#__codelineno-11-123\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">RotateAroundAxis</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-124\" name=\"__codelineno-11-124\" href=\"#__codelineno-11-124\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-125\" name=\"__codelineno-11-125\" href=\"#__codelineno-11-125\"></a><span class=\"w\">        </span><span class=\"n\">Quaternion</span><span class=\"w\"> </span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Quaternion</span><span class=\"p\">.</span><span class=\"n\">AngleAxis</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-126\" name=\"__codelineno-11-126\" href=\"#__codelineno-11-126\"></a><span class=\"w\">        </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-127\" name=\"__codelineno-11-127\" href=\"#__codelineno-11-127\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">axisPosition</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rotation</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-128\" name=\"__codelineno-11-128\" href=\"#__codelineno-11-128\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-129\" name=\"__codelineno-11-129\" href=\"#__codelineno-11-129\"></a>\n<a id=\"__codelineno-11-130\" name=\"__codelineno-11-130\" href=\"#__codelineno-11-130\"></a><span class=\"w\">    </span><span class=\"k\">void</span><span class=\"w\"> </span><span class=\"nf\">GetMouseButtonStatus</span><span class=\"p\">(</span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">isRightDown</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-131\" name=\"__codelineno-11-131\" href=\"#__codelineno-11-131\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-132\" name=\"__codelineno-11-132\" href=\"#__codelineno-11-132\"></a><span class=\"w\">        </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-133\" name=\"__codelineno-11-133\" href=\"#__codelineno-11-133\"></a><span class=\"w\">        </span><span class=\"n\">isRightDown</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-134\" name=\"__codelineno-11-134\" href=\"#__codelineno-11-134\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-11-135\" name=\"__codelineno-11-135\" href=\"#__codelineno-11-135\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-136\" name=\"__codelineno-11-136\" href=\"#__codelineno-11-136\"></a><span class=\"w\">            </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse X&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">rotateSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-137\" name=\"__codelineno-11-137\" href=\"#__codelineno-11-137\"></a><span class=\"w\">            </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetAxis</span><span class=\"p\">(</span><span class=\"s\">&quot;Mouse Y&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">rotateSpeed</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-138\" name=\"__codelineno-11-138\" href=\"#__codelineno-11-138\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Input</span><span class=\"p\">.</span><span class=\"n\">GetMouseButton</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-11-139\" name=\"__codelineno-11-139\" href=\"#__codelineno-11-139\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-140\" name=\"__codelineno-11-140\" href=\"#__codelineno-11-140\"></a><span class=\"w\">                </span><span class=\"n\">isRightDown</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-141\" name=\"__codelineno-11-141\" href=\"#__codelineno-11-141\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-142\" name=\"__codelineno-11-142\" href=\"#__codelineno-11-142\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-143\" name=\"__codelineno-11-143\" href=\"#__codelineno-11-143\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-144\" name=\"__codelineno-11-144\" href=\"#__codelineno-11-144\"></a>\n<a id=\"__codelineno-11-145\" name=\"__codelineno-11-145\" href=\"#__codelineno-11-145\"></a><span class=\"w\">    </span><span class=\"c1\">// rotate vectorP2C(player to camera) around up while mouse x is on, return true if do rotate</span>\n<a id=\"__codelineno-11-146\" name=\"__codelineno-11-146\" href=\"#__codelineno-11-146\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">RotateX</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">vectorP2C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-147\" name=\"__codelineno-11-147\" href=\"#__codelineno-11-147\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-148\" name=\"__codelineno-11-148\" href=\"#__codelineno-11-148\"></a><span class=\"w\">        </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">newVector</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vectorP2C</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-149\" name=\"__codelineno-11-149\" href=\"#__codelineno-11-149\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-150\" name=\"__codelineno-11-150\" href=\"#__codelineno-11-150\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-151\" name=\"__codelineno-11-151\" href=\"#__codelineno-11-151\"></a><span class=\"w\">            </span><span class=\"n\">newVector</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateAroundAxis</span><span class=\"p\">(</span><span class=\"n\">newVector</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-152\" name=\"__codelineno-11-152\" href=\"#__codelineno-11-152\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-153\" name=\"__codelineno-11-153\" href=\"#__codelineno-11-153\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">newVector</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-154\" name=\"__codelineno-11-154\" href=\"#__codelineno-11-154\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-155\" name=\"__codelineno-11-155\" href=\"#__codelineno-11-155\"></a>\n<a id=\"__codelineno-11-156\" name=\"__codelineno-11-156\" href=\"#__codelineno-11-156\"></a><span class=\"w\">    </span><span class=\"c1\">// rotate vectorP2C(player to camera) around right while mouse y is on, return true is do rotate</span>\n<a id=\"__codelineno-11-157\" name=\"__codelineno-11-157\" href=\"#__codelineno-11-157\"></a><span class=\"w\">    </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"nf\">RotateY</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">vectorP2C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-158\" name=\"__codelineno-11-158\" href=\"#__codelineno-11-158\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-159\" name=\"__codelineno-11-159\" href=\"#__codelineno-11-159\"></a><span class=\"w\">        </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">newVector</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vectorP2C</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-160\" name=\"__codelineno-11-160\" href=\"#__codelineno-11-160\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"m\">0F</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-161\" name=\"__codelineno-11-161\" href=\"#__codelineno-11-161\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-162\" name=\"__codelineno-11-162\" href=\"#__codelineno-11-162\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">vectorP2C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"m\">0.99F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-163\" name=\"__codelineno-11-163\" href=\"#__codelineno-11-163\"></a><span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">Dot</span><span class=\"p\">(</span><span class=\"n\">vectorP2C</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"m\">0.99F</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">))</span>\n<a id=\"__codelineno-11-164\" name=\"__codelineno-11-164\" href=\"#__codelineno-11-164\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-165\" name=\"__codelineno-11-165\" href=\"#__codelineno-11-165\"></a><span class=\"w\">                </span><span class=\"n\">newVector</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RotateAroundAxis</span><span class=\"p\">(</span><span class=\"n\">newVector</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"p\">.</span><span class=\"n\">zero</span><span class=\"p\">);</span>\n<a id=\"__codelineno-11-166\" name=\"__codelineno-11-166\" href=\"#__codelineno-11-166\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-167\" name=\"__codelineno-11-167\" href=\"#__codelineno-11-167\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-168\" name=\"__codelineno-11-168\" href=\"#__codelineno-11-168\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">newVector</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-169\" name=\"__codelineno-11-169\" href=\"#__codelineno-11-169\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-170\" name=\"__codelineno-11-170\" href=\"#__codelineno-11-170\"></a>\n<a id=\"__codelineno-11-171\" name=\"__codelineno-11-171\" href=\"#__codelineno-11-171\"></a><span class=\"w\">    </span><span class=\"c1\">// return distance if no collision, else return distance to rigid body</span>\n<a id=\"__codelineno-11-172\" name=\"__codelineno-11-172\" href=\"#__codelineno-11-172\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"nf\">DealWithCollision</span><span class=\"p\">(</span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Vector3</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">,</span><span class=\"w\"> </span>\n<a id=\"__codelineno-11-173\" name=\"__codelineno-11-173\" href=\"#__codelineno-11-173\"></a><span class=\"w\">        </span><span class=\"k\">ref</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">ishitGround</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">ref</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">ishitObject</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-174\" name=\"__codelineno-11-174\" href=\"#__codelineno-11-174\"></a><span class=\"w\">    </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-175\" name=\"__codelineno-11-175\" href=\"#__codelineno-11-175\"></a><span class=\"w\">        </span><span class=\"c1\">// collision detection</span>\n<a id=\"__codelineno-11-176\" name=\"__codelineno-11-176\" href=\"#__codelineno-11-176\"></a><span class=\"w\">        </span><span class=\"n\">RaycastHit</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-177\" name=\"__codelineno-11-177\" href=\"#__codelineno-11-177\"></a><span class=\"w\">        </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-178\" name=\"__codelineno-11-178\" href=\"#__codelineno-11-178\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Physics</span><span class=\"p\">.</span><span class=\"n\">Raycast</span><span class=\"p\">(</span><span class=\"n\">playerTransform</span><span class=\"p\">.</span><span class=\"n\">position</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">out</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">desiredDistance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span>\n<a id=\"__codelineno-11-179\" name=\"__codelineno-11-179\" href=\"#__codelineno-11-179\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-180\" name=\"__codelineno-11-180\" href=\"#__codelineno-11-180\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">hitInfo</span><span class=\"p\">.</span><span class=\"n\">collider</span><span class=\"w\"> </span><span class=\"k\">is</span><span class=\"w\"> </span><span class=\"n\">TerrainCollider</span><span class=\"p\">)</span>\n<a id=\"__codelineno-11-181\" name=\"__codelineno-11-181\" href=\"#__codelineno-11-181\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-182\" name=\"__codelineno-11-182\" href=\"#__codelineno-11-182\"></a><span class=\"w\">                </span><span class=\"n\">ishitGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-183\" name=\"__codelineno-11-183\" href=\"#__codelineno-11-183\"></a><span class=\"w\">                </span><span class=\"n\">ishitObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-184\" name=\"__codelineno-11-184\" href=\"#__codelineno-11-184\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-185\" name=\"__codelineno-11-185\" href=\"#__codelineno-11-185\"></a><span class=\"w\">            </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-186\" name=\"__codelineno-11-186\" href=\"#__codelineno-11-186\"></a><span class=\"w\">            </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-187\" name=\"__codelineno-11-187\" href=\"#__codelineno-11-187\"></a><span class=\"w\">                </span><span class=\"n\">ishitObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">true</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-188\" name=\"__codelineno-11-188\" href=\"#__codelineno-11-188\"></a><span class=\"w\">                </span><span class=\"n\">ishitGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-189\" name=\"__codelineno-11-189\" href=\"#__codelineno-11-189\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-190\" name=\"__codelineno-11-190\" href=\"#__codelineno-11-190\"></a><span class=\"w\">            </span><span class=\"n\">newDistance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hitInfo</span><span class=\"p\">.</span><span class=\"n\">distance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-191\" name=\"__codelineno-11-191\" href=\"#__codelineno-11-191\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-192\" name=\"__codelineno-11-192\" href=\"#__codelineno-11-192\"></a><span class=\"w\">        </span><span class=\"k\">else</span>\n<a id=\"__codelineno-11-193\" name=\"__codelineno-11-193\" href=\"#__codelineno-11-193\"></a><span class=\"w\">        </span><span class=\"p\">{</span>\n<a id=\"__codelineno-11-194\" name=\"__codelineno-11-194\" href=\"#__codelineno-11-194\"></a><span class=\"w\">            </span><span class=\"n\">ishitGround</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ishitObject</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">false</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-195\" name=\"__codelineno-11-195\" href=\"#__codelineno-11-195\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-196\" name=\"__codelineno-11-196\" href=\"#__codelineno-11-196\"></a>\n<a id=\"__codelineno-11-197\" name=\"__codelineno-11-197\" href=\"#__codelineno-11-197\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">newDistance</span><span class=\"p\">;</span>\n<a id=\"__codelineno-11-198\" name=\"__codelineno-11-198\" href=\"#__codelineno-11-198\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-11-199\" name=\"__codelineno-11-199\" href=\"#__codelineno-11-199\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2023-11-30T20:09:36+00:00",
            "authors": [],
            "tags": null
        },
        {
            "id": "https://wiki.disenone.site/game-%E6%B8%B8%E6%88%8FAOI%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90%E5%92%8C%E6%80%A7%E8%83%BD%E5%AE%9E%E6%B5%8B/",
            "url": "https://wiki.disenone.site/game-%E6%B8%B8%E6%88%8FAOI%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90%E5%92%8C%E6%80%A7%E8%83%BD%E5%AE%9E%E6%B5%8B/?utm_source=documentation&utm_medium=RSS&utm_campaign=feed-syndication",
            "title": "\u6e38\u620f AOI \u7b97\u6cd5\u89e3\u6790\u548c\u6027\u80fd\u5b9e\u6d4b",
            "content_html": "<p><meta property=\"og:title\" content=\"\u6e38\u620f AOI \u7b97\u6cd5\u89e3\u6790\u548c\u6027\u80fd\u5b9e\u6d4b\" /></p>\n<h3 id=\"_1\">\u5f15\u5b50</h3>\n<p><code>AOI</code> (Area Of Interest) \u5728\u591a\u4eba\u5728\u7ebf\u6e38\u620f\u4e2d\u662f\u5f88\u57fa\u672c\u7684\u529f\u80fd\uff0c\u73a9\u5bb6\u9700\u8981\u63a5\u6536\u8fdb\u5165\u89c6\u91ce\u8303\u56f4\u5185\u7684\u5176\u4ed6\u73a9\u5bb6\u6216\u8005\u5b9e\u4f53 (Entity) \u7684\u4fe1\u606f\u3002\u8ba1\u7b97\u73a9\u5bb6\u89c6\u91ce\u8303\u56f4\u5185\u5b58\u5728\u54ea\u4e9b\u5b9e\u4f53\uff0c\u6709\u54ea\u4e9b\u5b9e\u4f53\u8fdb\u5165\u6216\u79bb\u5f00\u89c6\u91ce\u7684\u7b97\u6cd5\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u4e4b\u4e3a <code>AOI</code> \u7b97\u6cd5\u3002</p>\n<p>\u672c\u6587\u8ba8\u8bba\u4e5d\u5bab\u683c\u548c\u5341\u5b57\u94fe\u4e24\u79cd <code>AOI</code> \u7b97\u6cd5\uff0c\u5e76\u7ed9\u51fa\u4e24\u79cd\u7b97\u6cd5\u7684\u5b9e\u6d4b\u6027\u80fd\u5206\u6790\uff0c\u8ba9\u4f60\u7528\u8d77\u6765\u5fc3\u4e2d\u6709\u6570\uff0c\u9047\u4e8b\u4e0d\u614c\u3002</p>\n<p>\u6587\u4e2d\u4f1a\u63d0\u5230\u73a9\u5bb6\u548c\u5b9e\u4f53\u4e24\u79cd\u8bcd\uff0c\u5b9e\u4f53\u662f\u6e38\u620f\u4e2d\u7269\u4f53\u7684\u6982\u5ff5\uff0c\u73a9\u5bb6\u662f\u62e5\u6709 AOI \u7684\u5b9e\u4f53\u3002</p>\n<p>\u6587\u4e2d\u4ee3\u7801\u53ef\u5728\u8fd9\u91cc\u627e\u5230\uff1a<a href=\"https://github.com/disenone/AoiTesting\">AoiTesting</a>\u3002</p>\n<h3 id=\"_2\">\u4e5d\u5bab\u683c</h3>\n<p>\u6240\u8c13\u4e5d\u5bab\u683c\uff0c\u662f\u628a\u573a\u666f\u5185\u6240\u6709\u5b9e\u4f53\u7684\u4f4d\u7f6e\u6309\u7167\u683c\u5b50\u5212\u5206\uff0c\u8b6c\u5982\u5212\u5206\u6210\u8fb9\u957f 200 \u7684\u6b63\u65b9\u5f62\uff0c\u8981\u627e\u51fa\u4e2d\u5fc3\u73a9\u5bb6 AOI \u8303\u56f4\u5185\u7684\u5176\u4ed6\u5b9e\u4f53\uff0c\u5c31\u628a\u8fd9\u4e2a\u8303\u56f4\u5185\u6d89\u53ca\u5230\u7684\u683c\u5b50\u5185\u7684\u73a9\u5bb6\u90fd\u505a\u4e00\u904d\u6bd4\u8f83\u3002</p>\n<p>\u4f8b\u5982\u573a\u666f\u6bcf 100 \u6beb\u79d2\u4f1a Tick \u4e00\u6b21\uff0c\u5728 Tick \u4e2d\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u66f4\u65b0\u73a9\u5bb6\u7684 AOI\uff1a</p>\n<ul>\n<li>\u4ee5\u73a9\u5bb6\u4f4d\u7f6e\u4e3a\u4e2d\u5fc3\uff0cAOI \u534a\u5f84\u8ba1\u7b97\u6d89\u53ca\u5230\u7684\u683c\u5b50\u96c6\u5408</li>\n<li>\u5bf9\u683c\u5b50\u96c6\u5408\u4e2d\u7684\u5b9e\u4f53\u9010\u4e2a\u8ba1\u7b97\u8ddf\u73a9\u5bb6\u7684\u8ddd\u79bb</li>\n<li>\u8ddd\u79bb\u5c0f\u4e8e AOI \u534a\u5f84\u7684\u5b9e\u4f53\u96c6\u5408\u5219\u662f\u73a9\u5bb6\u7684\u65b0\u7684 AOI</li>\n</ul>\n<p>\u4e5d\u5bab\u683c\u7b97\u6cd5\u505a\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u7b97\u6cd5\u7528\u51e0\u53e5\u8bdd\u5c31\u80fd\u63cf\u8ff0\u6e05\u695a\u4e86\uff0c\u5177\u4f53\u7684\u6027\u80fd\u5206\u6790\u6211\u4eec\u7559\u5230\u540e\u9762\uff0c\u5148\u6765\u770b\u770b\u5341\u5b57\u94fe\u8868\u7b97\u6cd5\u3002</p>\n<h3 id=\"_3\">\u5341\u5b57\u94fe\u8868</h3>\n<p>\u5bf9\u4e8e 3D \u6e38\u620f\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u7ed9 X \u8f74\u548c Z \u8f74\u5750\u6807\u5206\u522b\u6784\u5efa\u6709\u5e8f\u7684\u94fe\u8868\uff0c\u6bcf\u4e2a\u5b9e\u4f53\u5728\u94fe\u8868\u4e0a\u90fd\u6709\u4e00\u4e2a\u8282\u70b9\uff0c\u5b58\u653e\u7684\u662f\u8be5\u5750\u6807\u8f74\u503c\uff0c\u6309\u7167\u503c\u9012\u589e\u7684\u987a\u5e8f\u6765\u5b58\u653e\u3002\u4f46\u5982\u679c\u53ea\u662f\u5b58\u653e\u5b9e\u4f53\u672c\u8eab\u7684\u5750\u6807\u70b9\uff0c\u8fd9\u4e24\u4e2a\u94fe\u8868\u505a\u67e5\u8be2\u7684\u6548\u7387\u4f9d\u7136\u5f88\u4f4e\u3002</p>\n<p>\u771f\u6b63\u5173\u952e\u7684\u662f\uff0c\u6211\u4eec\u5728\u94fe\u8868\u4e0a\u8fd8\u4f1a\u7ed9\u62e5\u6709 AOI \u7684\u6bcf\u4e2a\u73a9\u5bb6\u589e\u52a0\u5de6\u53f3\u4e24\u4e2a\u54e8\u5175\u8282\u70b9\u3002\u4e24\u4e2a\u54e8\u5175\u7684\u5750\u6807\u503c\u8ddf\u73a9\u5bb6\u672c\u8eab\u5750\u6807\u6b63\u597d\u76f8\u5dee\u4e86 AOI \u534a\u5f84\uff0c\u8b6c\u5982\u73a9\u5bb6 <code>P</code> \u5750\u6807\u4e3a <code>(a, b, c)</code>\uff0cAOI \u534a\u5f84\u4e3a <code>r</code> \uff0c\u90a3\u4e48\u5728 X \u8f74\u4e0a\u4f1a\u6709\u4e24\u4e2a\u54e8\u5175 <code>left_x, right_x</code>\uff0c\u5750\u6807\u503c\u5206\u522b\u4e3a <code>a - r</code> \u548c <code>a + r</code>\u3002\u7531\u4e8e\u6709\u54e8\u5175\u7684\u5b58\u5728\uff0c\u6211\u4eec\u901a\u8fc7\u8ddf\u8e2a\u54e8\u5175\u8ddf\u5176\u4ed6\u5b9e\u4f53\u8282\u70b9\u7684\u79fb\u52a8\u6765\u66f4\u65b0 AOI\u3002\u7ee7\u7eed\u524d\u9762\u7684\u4f8b\u5b50\uff0c\u4e00\u4e2a\u5b9e\u4f53 <code>E</code> \u79fb\u52a8\u5bfc\u81f4\u5728 X \u8f74\u4e0a\u7684\u8282\u70b9\u4ece <code>left_x</code> \u7684\u53f3\u8fb9\u60f3\u5de6\u8de8\u8fc7 <code>left_x</code> \u6765\u5230 <code>left_x</code> \u7684\u5de6\u8fb9\uff0c\u90a3\u4e48\u8bf4\u660e <code>E</code> \u80af\u5b9a\u662f\u79bb\u5f00\u4e86 <code>P</code> \u7684 AOI\uff1b\u540c\u7406\u5982\u679c\u5411\u53f3\u8de8\u8fc7\u4e86 <code>right_x</code> \u4e5f\u662f\u79bb\u5f00\u4e86 AOI\u3002\u76f8\u53cd\uff0c\u5982\u679c\u662f\u5411\u53f3\u8de8\u8fc7 <code>left_x</code>\uff0c\u6216\u8005\u5411\u5de6\u8de8\u8fc7 <code>right_x</code>\uff0c\u8bf4\u660e\u6709\u53ef\u80fd\u4f1a\u8fdb\u5165\u5230 <code>P</code> \u7684 AOI \u4e2d\u3002</p>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u5341\u5b57\u94fe\u8868\u7b97\u6cd5\u8981\u6bd4\u4e5d\u5bab\u683c\u590d\u6742\u5f97\u591a\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e24\u6761\u6709\u5e8f\u7684\u94fe\u8868\uff0c\u5e76\u4e14\u5728\u6bcf\u4e2a\u5b9e\u4f53\u5750\u6807\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u540c\u6b65\u79fb\u52a8\u94fe\u8868\u4e0a\u7684\u8282\u70b9\uff0c\u5e76\u4e14\u5728\u79fb\u52a8\u8de8\u8fc7\u5176\u4ed6\u8282\u70b9\u65f6\u66f4\u65b0 AOI\u3002</p>\n<h3 id=\"_4\">\u4e5d\u5bab\u683c\u7684\u5b9e\u73b0</h3>\n<p>\u56e0\u4e3a\u6d89\u53ca\u5230\u5b9e\u6d4b\u7684\u6027\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u7a0d\u5fae\u6df1\u5165\u4e00\u70b9\u4e5d\u5bab\u683c\u7b97\u6cd5\u7684\u5b9e\u73b0\u7ec6\u8282\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Sensor</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"w\">  </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"w\">  </span><span class=\"n\">Nuid</span><span class=\"w\"> </span><span class=\"n\">sensor_id</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">radius</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">radius_square</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">  </span><span class=\"n\">PlayerPtrList</span><span class=\"w\"> </span><span class=\"n\">aoi_players</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">];</span>\n<a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"p\">};</span>\n<a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a>\n<a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">PlayerAoi</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">  </span><span class=\"c1\">// ...    </span>\n<a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">  </span><span class=\"n\">Nuid</span><span class=\"w\"> </span><span class=\"n\">nuid</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">  </span><span class=\"n\">SquareId</span><span class=\"w\"> </span><span class=\"n\">square_id</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">  </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">square_index</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a><span class=\"w\">  </span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">  </span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"n\">last_pos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"w\">  </span><span class=\"n\">Uint32</span><span class=\"w\"> </span><span class=\"n\">flags</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"w\">  </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">Sensor</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">sensors</span><span class=\"p\">;</span>\n<a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"p\">};</span>\n</code></pre></div>\n<p><code>PlayerAoi</code> \u5b58\u653e\u73a9\u5bb6\u7684\u6570\u636e\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a <code>sensors</code> \u6570\u7ec4\uff0c<code>sensors</code> \u5c31\u662f\u7528\u6765\u8ba1\u7b97\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u5b9e\u4f53\uff0c\u6bcf\u6b21 <code>Tick</code> \u4e4b\u540e\u628a\u8ba1\u7b97\u51fa\u6765\u7684\u5b9e\u4f53\u8ba1\u5212\u653e\u5728 <code>aoi_players</code>\u3002<code>aoi_players</code> \u662f\u5b58\u653e\u4e86\u4e24\u4e2a\u6570\u7ec4\uff0c\u7528\u4e8e\u4e0a\u4e00\u6b21 <code>Tick</code> \u7ed3\u679c\u505a\u6bd4\u8f83\uff0c\u6c42\u51fa\u8fdb\u5165\u548c\u79bb\u5f00\u73a9\u5bb6\u3002 <code>Tick</code> \u7684\u5927\u81f4\u6d41\u7a0b\u662f\u8fd9\u6837\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"n\">AoiUpdateInfos</span><span class=\"w\"> </span><span class=\"nf\">SquareAoi::Tick</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">  </span><span class=\"n\">AoiUpdateInfos</span><span class=\"w\"> </span><span class=\"n\">update_infos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">  </span><span class=\"n\">PlayerPtrList</span><span class=\"w\"> </span><span class=\"n\">remove_list</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>\n<a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">elem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">player_map_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">player</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">elem</span><span class=\"p\">.</span><span class=\"n\">second</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"c1\">// \u5bf9\u6709 sensors \u7684\u73a9\u5bb6\u8ba1\u7b97 Aoi</span>\n<a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">sensors</span><span class=\"p\">.</span><span class=\"n\">empty</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">      </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">update_info</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_UpdatePlayerAoi</span><span class=\"p\">(</span><span class=\"n\">cur_aoi_map_idx_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">player</span><span class=\"p\">);</span>\n<a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">update_info</span><span class=\"p\">.</span><span class=\"n\">sensor_update_list</span><span class=\"p\">.</span><span class=\"n\">empty</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">        </span><span class=\"n\">update_infos</span><span class=\"p\">.</span><span class=\"n\">emplace</span><span class=\"p\">(</span><span class=\"n\">update_info</span><span class=\"p\">.</span><span class=\"n\">nuid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">move</span><span class=\"p\">(</span><span class=\"n\">update_info</span><span class=\"p\">));</span>\n<a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">      </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a>\n<a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">  </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">  </span><span class=\"c1\">// \u8bb0\u5f55\u73a9\u5bb6\u4e0a\u6b21\u7684\u4f4d\u7f6e</span>\n<a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">elem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">player_map_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">player</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">elem</span><span class=\"p\">.</span><span class=\"n\">second</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">    </span><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">last_pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">player</span><span class=\"p\">.</span><span class=\"n\">pos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n<a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">  </span><span class=\"n\">cur_aoi_map_idx_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">cur_aoi_map_idx_</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">update_infos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>Tick</code> \u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u904d\u5386\u6709 <code>sensors</code> \u7684\u73a9\u5bb6\uff0c\u9010\u4e2a\u8ba1\u7b97 <code>sensor</code> \u8303\u56f4\u5185\u7684\u5b9e\u4f53\uff0c\u5373\u4e3a AOI\u3002<code>last_pos</code> \u662f\u7528\u6765\u53c2\u4e0e\u5224\u65ad\u5b9e\u4f53\u662f\u5426\u6709\u8fdb\u5165\u6216\u8005\u79bb\u5f00 AOI\uff0c<code>_UpdatePlayerAoi</code> \u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"n\">AoiUpdateInfo</span><span class=\"w\"> </span><span class=\"nf\">SquareAoi::_UpdatePlayerAoi</span><span class=\"p\">(</span><span class=\"n\">Uint32</span><span class=\"w\"> </span><span class=\"n\">cur_aoi_map_idx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PlayerAoi</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">pptr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">  </span><span class=\"n\">AoiUpdateInfo</span><span class=\"w\"> </span><span class=\"n\">aoi_update_info</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">  </span><span class=\"n\">aoi_update_info</span><span class=\"p\">.</span><span class=\"n\">nuid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pptr</span><span class=\"o\">-&gt;</span><span class=\"n\">nuid</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">  </span><span class=\"n\">Uint32</span><span class=\"w\"> </span><span class=\"n\">new_aoi_map_idx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">cur_aoi_map_idx</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>\n<a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">pptr</span><span class=\"o\">-&gt;</span><span class=\"n\">sensors</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">old_aoi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">aoi_players</span><span class=\"p\">[</span><span class=\"n\">cur_aoi_map_idx</span><span class=\"p\">];</span>\n<a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">new_aoi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">aoi_players</span><span class=\"p\">[</span><span class=\"n\">new_aoi_map_idx</span><span class=\"p\">];</span>\n<a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;*</span><span class=\"n\">calc_aoi_players_func_</span><span class=\"p\">)(</span><span class=\"o\">*</span><span class=\"n\">pptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">new_aoi</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a>\n<a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">    </span><span class=\"n\">SensorUpdateInfo</span><span class=\"w\"> </span><span class=\"n\">update_info</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a>\n<a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">enters</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">update_info</span><span class=\"p\">.</span><span class=\"n\">enters</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">leaves</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">update_info</span><span class=\"p\">.</span><span class=\"n\">leaves</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">radius_square</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">radius_square</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a>\n<a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">    </span><span class=\"n\">_CheckLeave</span><span class=\"p\">(</span><span class=\"n\">pptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">radius_square</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">old_aoi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">leaves</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">    </span><span class=\"n\">_CheckEnter</span><span class=\"p\">(</span><span class=\"n\">pptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">radius_square</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">new_aoi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">enters</span><span class=\"p\">);</span>\n<a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a>\n<a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">enters</span><span class=\"p\">.</span><span class=\"n\">empty</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">leaves</span><span class=\"p\">.</span><span class=\"n\">empty</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"w\">      </span><span class=\"k\">continue</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a>\n<a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"w\">    </span><span class=\"n\">update_info</span><span class=\"p\">.</span><span class=\"n\">sensor_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">sensor_id</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-25\" name=\"__codelineno-2-25\" href=\"#__codelineno-2-25\"></a><span class=\"w\">    </span><span class=\"n\">aoi_update_info</span><span class=\"p\">.</span><span class=\"n\">sensor_update_list</span><span class=\"p\">.</span><span class=\"n\">push_back</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">move</span><span class=\"p\">(</span><span class=\"n\">update_info</span><span class=\"p\">));</span>\n<a id=\"__codelineno-2-26\" name=\"__codelineno-2-26\" href=\"#__codelineno-2-26\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n<a id=\"__codelineno-2-27\" name=\"__codelineno-2-27\" href=\"#__codelineno-2-27\"></a>\n<a id=\"__codelineno-2-28\" name=\"__codelineno-2-28\" href=\"#__codelineno-2-28\"></a><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">aoi_update_info</span><span class=\"p\">;</span>\n<a id=\"__codelineno-2-29\" name=\"__codelineno-2-29\" href=\"#__codelineno-2-29\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p><code>old_aoi</code> \u662f\u4e0a\u4e00\u4e2a <code>Tick</code> \u8ba1\u7b97\u51fa\u6765\u7684 AOI\uff0c<code>new_aoi</code> \u662f\u672c\u6b21 <code>Tick</code> \u9700\u8981\u8ba1\u7b97\u7684 AOI\u3002<code>new_aoi</code> \u901a\u8fc7\u904d\u5386 AOI \u8303\u56f4\u5185\u7684\u6240\u6709\u683c\u5b50\u7684\u5b9e\u4f53\uff0c\u9009\u51fa\u8ddf\u73a9\u5bb6\u8ddd\u79bb\u5c0f\u4e8e AOI \u534a\u5f84\u6765\u83b7\u5f97\u3002\u4e4b\u540e\u7528 <code>_CheckLeave</code> \u548c <code>_CheckEnter</code> \u4e24\u4e2a\u51fd\u6570\uff0c\u8ba1\u7b97\u672c\u6b21 <code>Tick</code> \u79bb\u5f00\u548c\u8fdb\u5165 AOI \u7684\u5b9e\u4f53\uff0c\u8b6c\u5982\u5982\u679c <code>new_aoi</code> \u4e2d\u7684\u5b9e\u4f53 <code>last_pos</code> \u4e0d\u5728 AOI\u8303\u56f4\u5185\uff0c\u8bf4\u660e\u8be5\u5b9e\u4f53\u662f\u5728\u672c\u6b21 <code>Tick</code> \u8fdb\u5165\u5230\u4e86 AOI \u8303\u56f4\u3002\u5177\u4f53\u7684\u4ee3\u7801\u53ef\u4ee5\u770b\u6e90\u6587\u4ef6\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002</p>\n<h3 id=\"_5\">\u5341\u5b57\u94fe\u8868\u7684\u5b9e\u73b0</h3>\n<p>\u76f8\u6bd4\u8d77\u4e5d\u5bab\u683c\uff0c\u5341\u5b57\u94fe\u8868\u5b9e\u73b0\u8d77\u6765\u66f4\u590d\u6742\uff0c\u5148\u6765\u770b\u57fa\u672c\u7684\u6570\u636e\u7ed3\u6784\uff1a</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">CoordNode</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">  </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">  </span><span class=\"n\">Uint8</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">prev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">  </span><span class=\"n\">PlayerAoi</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">pplayer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">  </span><span class=\"n\">Sensor</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">psensor</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a>\n<a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"p\">};</span>\n<a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a>\n<a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"n\">KHASH_MAP_INIT_INT64</span><span class=\"p\">(</span><span class=\"n\">SensorHashMap</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PlayerAoi</span><span class=\"o\">*</span><span class=\"p\">);</span>\n<a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a>\n<a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Sensor</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">  </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">  </span><span class=\"n\">Nuid</span><span class=\"w\"> </span><span class=\"n\">sensor_id</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">radius</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">radius_square</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">  </span><span class=\"n\">PlayerAoi</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">pplayer</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">left_x</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">right_x</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">left_z</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">right_z</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">  </span><span class=\"n\">PlayerPtrList</span><span class=\"w\"> </span><span class=\"n\">aoi_players</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">];</span>\n<a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a>\n<a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"w\">  </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">khash_t</span><span class=\"p\">(</span><span class=\"n\">SensorHashMap</span><span class=\"p\">)</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">aoi_player_candidates</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a><span class=\"p\">};</span>\n<a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a>\n<a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">PlayerAoi</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a><span class=\"w\">  </span><span class=\"c1\">// ...</span>\n<a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a><span class=\"w\">  </span><span class=\"n\">Nuid</span><span class=\"w\"> </span><span class=\"n\">nuid</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a><span class=\"w\">  </span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\" href=\"#__codelineno-3-33\"></a><span class=\"w\">  </span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"n\">last_pos</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\" href=\"#__codelineno-3-34\"></a><span class=\"w\">  </span><span class=\"n\">Uint32</span><span class=\"w\"> </span><span class=\"n\">flags</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\" href=\"#__codelineno-3-35\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">node_x</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\" href=\"#__codelineno-3-36\"></a><span class=\"w\">  </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"n\">node_z</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\" href=\"#__codelineno-3-37\"></a><span class=\"w\">  </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">Sensor</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">sensors</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-38\" name=\"__codelineno-3-38\" href=\"#__codelineno-3-38\"></a><span class=\"w\">  </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">unordered_map</span><span class=\"o\">&lt;</span><span class=\"n\">Nuid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"n\">Nuid</span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">detected_by</span><span class=\"p\">;</span>\n<a id=\"__codelineno-3-39\" name=\"__codelineno-3-39\" href=\"#__codelineno-3-39\"></a><span class=\"p\">};</span>\n</code></pre></div>\n<p><code>Sensor</code> \u548c <code>PlayerAoi</code> \u8ddf\u4e5d\u5bab\u683c\u6709\u90e8\u5206\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u591a\u4e86\u94fe\u8868\u76f8\u5173\u7684\u8282\u70b9\u7ed3\u6784 <code>CoordNode</code>\u3002<code>CoordNode</code> \u5c31\u662f\u94fe\u8868\u4e0a\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u8bb0\u5f55\u4e86\u672c\u8eab\u8282\u70b9\u7684\u7c7b\u578b\u548c\u6570\u503c\uff0c\u7c7b\u578b\u6709\u4e09\u79cd\uff1a\u73a9\u5bb6\u8282\u70b9\uff0c<code>Sensor</code> \u5de6\u8282\u70b9\uff0c<code>Sensor</code> \u53f3\u8282\u70b9\u3002</p>\n<p>\u5341\u5b57\u94fe\u8868\u7684\u5927\u90e8\u5206\u5de5\u4f5c\u90fd\u662f\u5728\u7ef4\u6301\u94fe\u8868\u7684\u6709\u5e8f\uff1a</p>\n<ul>\n<li>\u73a9\u5bb6\u52a0\u5165\u65f6\u9700\u8981\u628a\u73a9\u5bb6\u8282\u70b9\u79fb\u52a8\u5230\u6709\u5e8f\u7684\u4f4d\u7f6e\u4e0a\uff0c\u5e76\u4e14\u5728\u79fb\u52a8\u73a9\u5bb6\u8282\u70b9\u7684\u540c\u65f6\uff0c\u5904\u7406\u8fdb\u5165\u6216\u8005\u79bb\u5f00\u5176\u4ed6\u73a9\u5bb6 AOI \u4e8b\u4ef6\u3002</li>\n<li>\u73a9\u5bb6\u79fb\u52a8\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u540e\uff0c<code>Sensor</code> \u5de6\u53f3\u8282\u70b9\u4ece\u73a9\u5bb6\u524d\u540e\u4f4d\u7f6e\u51fa\u53d1\uff0c\u79fb\u52a8\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\uff0c\u5e76\u5904\u7406\u8de8\u8fc7\u5176\u4ed6\u73a9\u5bb6\u8282\u70b9\u65f6\u89e6\u53d1\u7684\u8fdb\u5165\u548c\u79bb\u5f00\u4e8b\u4ef6\u3002</li>\n<li>\u73a9\u5bb6\u79fb\u52a8\u65f6\uff0c\u66f4\u65b0\u73a9\u5bb6\u7684\u5750\u6807\uff0c\u5e76\u79fb\u52a8\u73a9\u5bb6\u8282\u70b9\u548c <code>Sensor</code> \u5de6\u53f3\u8282\u70b9\uff0c\u5904\u7406 AOI \u8fdb\u5165\u79bb\u5f00\u3002</li>\n</ul>\n<p>\u79fb\u52a8\u8282\u70b9\u7684\u4ee3\u7801\u5982\u4e0b\uff0c\u6bcf\u8de8\u8fc7\u4e00\u4e2a\u8282\u70b9\uff0c\u90fd\u4f1a\u8c03\u7528\u4e00\u6b21 <code>MoveCross</code> \u51fd\u6570\uff0c\u7531 <code>MoveCross</code> \u51fd\u6570\u6839\u636e\u79fb\u52a8\u65b9\u5411\uff0c\u79fb\u52a8\u8282\u70b9\u548c\u8de8\u8fc7\u8282\u70b9\u7684\u7c7b\u578b\u6765\u51b3\u5b9a\u662f\u8fdb\u5165\u8fd8\u662f\u79bb\u5f00 AOI\u3002</p>\n<div class=\"language-cpp highlight\"><pre><span></span><code><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">ListUpdateNode</span><span class=\"p\">(</span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CoordNode</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">pnode</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">value</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a>\n<a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"o\">-&gt;</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">    </span><span class=\"c1\">// move right</span>\n<a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">      </span><span class=\"n\">MoveCross</span><span class=\"p\">(</span><span class=\"n\">MOVE_DIRECTION_RIGHT</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"o\">-&gt;</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">      </span><span class=\"n\">cur_node</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">next</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a>\n<a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"n\">ListRemove</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">    </span><span class=\"n\">ListInsertAfter</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a>\n<a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"o\">-&gt;</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">    </span><span class=\"c1\">// move left</span>\n<a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">    </span><span class=\"k\">auto</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">      </span><span class=\"n\">MoveCross</span><span class=\"p\">(</span><span class=\"n\">MOVE_DIRECTION_LEFT</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"o\">-&gt;</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">      </span><span class=\"n\">cur_node</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"o\">-&gt;</span><span class=\"n\">prev</span><span class=\"p\">;</span>\n<a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a>\n<a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">    </span><span class=\"n\">ListRemove</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">    </span><span class=\"n\">ListInsertBefore</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cur_node</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pnode</span><span class=\"p\">);</span>\n<a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">  </span><span class=\"p\">}</span>\n<a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"p\">}</span>\n</code></pre></div>\n<p>\u94fe\u8868\u7684\u79fb\u52a8\u5f88\u6162\uff0c\u662f <code>O(n)</code> \u7684\u590d\u6742\u5ea6\uff0c\u7279\u522b\u662f\u5728\u73a9\u5bb6\u65b0\u52a0\u5165\u573a\u666f\u65f6\uff0c\u73a9\u5bb6\u9700\u8981\u4ece\u65e0\u7a77\u8fdc\u7684\u5730\u65b9\uff0c\u9010\u6b65\u79fb\u52a8\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a\uff0c\u4e3a\u6b64\u9700\u8981\u5927\u91cf\u904d\u5386\u7684\u8282\u70b9\uff0c\u6d88\u8017\u5f88\u5927\u3002\u4e3a\u4e86\u4f18\u5316\u6027\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u573a\u666f\u4e2d\u56fa\u5b9a\u4f4d\u7f6e\u653e\u7f6e\u706f\u5854\uff0c\u8fd9\u79cd\u706f\u5854\u5904\u7406\u4e0a\u8ddf\u73a9\u5bb6\u5927\u81f4\u76f8\u540c\uff0c\u53ea\u662f\u6bd4\u73a9\u5bb6\u591a\u8bb0\u5f55\u4e86\u4e00\u4efd <code>detected_by</code> \u6570\u636e\uff0c<code>detected_by</code> \u662f\u7528\u6765\u8bb0\u5f55\u8be5\u54e8\u5175\u5b9e\u4f53\u5904\u5728\u54ea\u4e9b <code>Sensor</code> \u8303\u56f4\u5185\u3002\u73a9\u5bb6\u9996\u6b21\u8fdb\u5165\u573a\u666f\u65f6\uff0c\u4e0d\u518d\u4ece\u6700\u8fdc\u5904\u5f00\u59cb\u79fb\u52a8\uff0c\u800c\u662f\u627e\u5230\u4e00\u4e2a\u6700\u8fd1\u7684\u706f\u5854\uff0c\u628a\u8282\u70b9\u63d2\u5165\u5230\u706f\u5854\u65c1\u8fb9\uff0c\u5e76\u901a\u8fc7\u706f\u5854\u8eab\u4e0a\u7684 <code>detected_by</code> \u6570\u636e\uff0c\u5feb\u901f\u8fdb\u5165\u5230\u8ddf\u706f\u5854\u4e00\u81f4\u7684\u5176\u4ed6\u73a9\u5bb6\u7684 AOI \u8303\u56f4\u5185\uff0c\u7136\u540e\u5f00\u59cb\u79fb\u52a8\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a\uff0c\u5f53\u7136\u79fb\u52a8\u7684\u65f6\u5019\u4e5f\u8981\u5904\u7406\u8fdb\u5165\u548c\u79bb\u5f00\u3002\u540c\u7406\uff0c\u5bf9\u4e8e <code>Sensor</code>\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5148\u7ee7\u627f\u706f\u5854\u7684\u6570\u636e\uff0c\u7136\u540e\u4ece\u706f\u5854\u7684\u4f4d\u7f6e\u4e0a\u79fb\u52a8\u5230\u6b63\u786e\u4f4d\u7f6e\u4e0a\u3002\u901a\u8fc7\u8fd9\u4e24\u79cd\u4f18\u5316\u80fd\u591f\u63d0\u5347\u4e00\u500d\u4ee5\u4e0a\u7684\u63d2\u5165\u73a9\u5bb6\u6027\u80fd\u3002</p>\n<p><code>Sensor</code> \u8eab\u4e0a\u8fd8\u6709\u4e00\u4e2a\u540d\u53eb <code>aoi_player_candidates</code> \u7684 <code>HashMap</code>\uff08\u8fd9\u91cc\u4e3a\u4e86\u6027\u80fd\uff0c\u4f7f\u7528\u4e86<a href=\"https://github.com/attractivechaos/klib/blob/master/khash.h\">khash</a>\uff09\u3002\u8282\u70b9\u79fb\u52a8\u89e6\u53d1\u7684 AOI \u4e8b\u4ef6\uff0c\u5176\u5b9e\u53ea\u80fd\u68c0\u6d4b\u5230 X-Z \u5750\u6807\u8f74\u4e0a\u8fb9\u957f\u4e3a <code>2r</code> \u7684\u6b63\u65b9\u5f62\u533a\u57df\uff0c\u4e0d\u662f\u6211\u4eec\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u5706\u5f62\u533a\u57df\u7684 AOI\uff0c\u8fd9\u4e2a\u6b63\u65b9\u5f62\u7684\u533a\u57df\u5185\u7684\u5b9e\u4f53\u90fd\u88ab\u8bb0\u5f55\u5728 <code>aoi_player_candidates</code> \u4e0a\uff0c\u5e76\u5728 <code>Tick</code> \u4e2d\u904d\u5386\u8ba1\u7b97\u5706\u5f62\u533a\u57df\u5185\u7684 AOI \u8303\u56f4\uff0c\u6240\u4ee5\u79f0\u4e3a <code>candidates</code>\u3002</p>\n<p>\u6240\u6709\u5341\u5b57\u94fe\u8868\u7684\u64cd\u4f5c\u90fd\u662f\u4e3a\u4e86\u4e00\u76f4\u7ef4\u62a4\u6b63\u65b9\u5f62\u533a\u57df\u5185\u7684\u5b9e\u4f53 <code>candidates</code>\uff0c\u5341\u5b57\u94fe\u8868\u4e2d <code>Tick</code> \u505a\u7684\u64cd\u4f5c\u8ddf\u4e5d\u5bab\u683c\u51e0\u4e4e\u4e00\u81f4\uff0c\u53ea\u662f\u904d\u5386\u8ba1\u7b97 AOI \u7684 <code>candidates</code> \u4e0d\u76f8\u540c\u3002\u4e5d\u5bab\u683c\u7684 <code>candidates</code> \u662f AOI \u5706\u5f62\u533a\u57df\u6240\u8986\u76d6\u5230\u7684\u683c\u5b50\u7684\u5b9e\u4f53\uff0c\u800c\u5341\u5b57\u94fe\u8868\u5219\u662f\u7531 <code>Sensor</code> \u5de6\u53f3\u8282\u70b9\u6240\u754c\u5b9a\u7684\u8fb9\u957f\u4e3a <code>2r</code> \u7684\u6b63\u65b9\u5f62\u533a\u57df\u4e2d\u7684\u5b9e\u4f53\u3002\u5b9a\u6027\u7684\u6765\u8bf4\uff0c\u5341\u5b57\u94fe\u8868\u7684 <code>candidates</code> \u4e00\u822c\u90fd\u8981\u6bd4\u4e5d\u5bab\u683c\u5c11\uff0c\u6240\u4ee5\u5728 <code>Tick</code> \u4e2d\u7684\u904d\u5386\u6b21\u6570\u5c11\uff0c\u6027\u80fd\u66f4\u4f18\uff0c\u53ea\u662f\u5341\u5b57\u94fe\u8868\u8fd8\u6709\u5927\u91cf\u989d\u5916\u7684\u6027\u80fd\u6d88\u8017\u5728\u4e86\u7ef4\u62a4\u94fe\u8868\u4e0a\uff0c\u8fd9\u4e24\u8005\u6574\u4f53\u7684\u6027\u80fd\u5230\u5e95\u5b70\u4f18\u5b70\u52a3\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5b9e\u6d4b\u770b\u770b\u3002</p>\n<h3 id=\"_6\">\u6027\u80fd\u5b9e\u6d4b</h3>\n<p>\u6211\u8fd9\u91cc\u5206\u522b\u6d4b\u4e86\u73a9\u5bb6\u52a0\u5165\u573a\u666f\uff08<code>Add Player</code>\uff09\uff0c\u8ba1\u7b97 AOI \u8fdb\u51fa\u4e8b\u4ef6\uff08<code>Tick</code>\uff09\uff0c\u73a9\u5bb6\u66f4\u65b0\u5750\u6807\u4f4d\u7f6e\uff08<code>Update Pos</code>\uff09\u4e09\u79cd\u60c5\u51b5\u7684\u65f6\u95f4\u6d88\u8017\u3002</p>\n<p>\u73a9\u5bb6\u521d\u59cb\u4f4d\u7f6e\u5728\u5730\u56fe\u8303\u56f4\u5185\u968f\u673a\u751f\u6210\uff0c\u7136\u540e\u628a\u73a9\u5bb6\u52a0\u5165\u573a\u666f\u3002<code>player_num</code> \u662f\u73a9\u5bb6\u6570\u91cf\uff0c<code>map_size</code> \u5219\u662f\u5730\u56fe X-Z \u5750\u6807\u8f74\u8303\u56f4\uff0c\u73a9\u5bb6\u7684\u4f4d\u7f6e\u5728\u6b64\u8303\u56f4\u5185\u5747\u5300\u968f\u673a\u751f\u6210\uff0c\u6bcf\u4e2a\u73a9\u5bb6\u90fd\u6709\u4e00\u4e2a\u534a\u5f84 <code>100</code> \u7684 <code>Sensor</code> \u4f5c\u4e3a AOI\uff0c\u8ba1\u7b97\u65f6\u95f4\u7528\u7684\u662f <code>boost::timer::cpu_timer</code>\u3002<code>player_num</code> \u5206\u522b\u9009\u4e86 <code>100, 1000, 10000</code> \u4e09\u79cd\u60c5\u51b5\uff0c\u800c <code>map_size</code> \u5219\u9009\u4e86 <code>[-50, 50], [-100, 100], [-1000, 1000], [-10000, 10000]</code> \u56db\u79cd\u60c5\u51b5\u3002</p>\n<p>\u66f4\u65b0\u73a9\u5bb6\u4f4d\u7f6e\u4f1a\u8ba9\u73a9\u5bb6\u56fa\u5b9a\u968f\u673a\u65b9\u5411\uff0c\u4ee5 <code>6m/s</code> \u7684\u901f\u5ea6\u79fb\u52a8\u3002</p>\n<p>\u672c\u6b21\u6d4b\u8bd5\u73af\u5883\u4e3a\uff1a</p>\n<ul>\n<li>CPU: Intel(R) Core(TM) i5-4590 CPU @ 3.30GHz</li>\n<li>\u7cfb\u7edf: Debian GNU/Linux 10 (buster)</li>\n<li>gcc \u7248\u672c: gcc version 8.3.0 (Debian 8.3.0-6)</li>\n<li>boost \u7248\u672c: boost_1_75_0</li>\n</ul>\n<h4 id=\"_7\">\u4e5d\u5bab\u683c\u5b9e\u6d4b</h4>\n<p>\u4e5d\u5bab\u683c\u7684\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000081</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000452</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000230</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a>\n<a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000070</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000338</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000185</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a>\n<a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000084</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000103</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000187</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a>\n<a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000084</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000080</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000185</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\" href=\"#__codelineno-5-24\"></a>\n<a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\" href=\"#__codelineno-5-25\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\" href=\"#__codelineno-5-26\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000673</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\" href=\"#__codelineno-5-27\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.035298</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.030000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.030000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">85.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\" href=\"#__codelineno-5-28\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001841</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\" href=\"#__codelineno-5-29\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\" href=\"#__codelineno-5-30\"></a>\n<a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\" href=\"#__codelineno-5-31\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\" href=\"#__codelineno-5-32\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000664</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\" href=\"#__codelineno-5-33\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.025806</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.030000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.030000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">116.3</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\" href=\"#__codelineno-5-34\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001842</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\" href=\"#__codelineno-5-35\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-36\" name=\"__codelineno-5-36\" href=\"#__codelineno-5-36\"></a>\n<a id=\"__codelineno-5-37\" name=\"__codelineno-5-37\" href=\"#__codelineno-5-37\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-38\" name=\"__codelineno-5-38\" href=\"#__codelineno-5-38\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000721</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-39\" name=\"__codelineno-5-39\" href=\"#__codelineno-5-39\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001793</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-40\" name=\"__codelineno-5-40\" href=\"#__codelineno-5-40\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001849</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">540.8</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-41\" name=\"__codelineno-5-41\" href=\"#__codelineno-5-41\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-42\" name=\"__codelineno-5-42\" href=\"#__codelineno-5-42\"></a>\n<a id=\"__codelineno-5-43\" name=\"__codelineno-5-43\" href=\"#__codelineno-5-43\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-44\" name=\"__codelineno-5-44\" href=\"#__codelineno-5-44\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000885</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-45\" name=\"__codelineno-5-45\" href=\"#__codelineno-5-45\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000804</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-46\" name=\"__codelineno-5-46\" href=\"#__codelineno-5-46\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001855</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-47\" name=\"__codelineno-5-47\" href=\"#__codelineno-5-47\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-48\" name=\"__codelineno-5-48\" href=\"#__codelineno-5-48\"></a>\n<a id=\"__codelineno-5-49\" name=\"__codelineno-5-49\" href=\"#__codelineno-5-49\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-50\" name=\"__codelineno-5-50\" href=\"#__codelineno-5-50\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.006454</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">154.9</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-51\" name=\"__codelineno-5-51\" href=\"#__codelineno-5-51\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">3.822028</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">3.800000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">3.820000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.9</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-52\" name=\"__codelineno-5-52\" href=\"#__codelineno-5-52\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.018402</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">108.7</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-53\" name=\"__codelineno-5-53\" href=\"#__codelineno-5-53\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-54\" name=\"__codelineno-5-54\" href=\"#__codelineno-5-54\"></a>\n<a id=\"__codelineno-5-55\" name=\"__codelineno-5-55\" href=\"#__codelineno-5-55\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-56\" name=\"__codelineno-5-56\" href=\"#__codelineno-5-56\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.006439</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-57\" name=\"__codelineno-5-57\" href=\"#__codelineno-5-57\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">2.805551</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">2.760000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.040000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">2.800000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.8</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-58\" name=\"__codelineno-5-58\" href=\"#__codelineno-5-58\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.018489</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">54.1</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-59\" name=\"__codelineno-5-59\" href=\"#__codelineno-5-59\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-60\" name=\"__codelineno-5-60\" href=\"#__codelineno-5-60\"></a>\n<a id=\"__codelineno-5-61\" name=\"__codelineno-5-61\" href=\"#__codelineno-5-61\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-62\" name=\"__codelineno-5-62\" href=\"#__codelineno-5-62\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.006698</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">149.3</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-63\" name=\"__codelineno-5-63\" href=\"#__codelineno-5-63\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.093759</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.100000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.100000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">106.7</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-64\" name=\"__codelineno-5-64\" href=\"#__codelineno-5-64\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.018350</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">54.5</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-65\" name=\"__codelineno-5-65\" href=\"#__codelineno-5-65\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-5-66\" name=\"__codelineno-5-66\" href=\"#__codelineno-5-66\"></a>\n<a id=\"__codelineno-5-67\" name=\"__codelineno-5-67\" href=\"#__codelineno-5-67\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-68\" name=\"__codelineno-5-68\" href=\"#__codelineno-5-68\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.009046</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">110.6</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-69\" name=\"__codelineno-5-69\" href=\"#__codelineno-5-69\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.012091</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">82.7</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-70\" name=\"__codelineno-5-70\" href=\"#__codelineno-5-70\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.019033</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">105.1</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-5-71\" name=\"__codelineno-5-71\" href=\"#__codelineno-5-71\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n</code></pre></div>\n<p>\u4e5d\u5bab\u683c\u5728\u73a9\u5bb6\u6570\u91cf <code>100</code> \u65f6\uff0c\u4e09\u79cd\u64cd\u4f5c\u8017\u65f6\u90fd\u5f88\u5c0f\uff0c\u6781\u9650\u60c5\u51b5 <code>map_size = [-50, 50]</code>\uff0c\u6240\u6709\u73a9\u5bb6\u4e92\u76f8\u90fd\u5904\u4e8e AOI \u8303\u56f4\u5185\uff0c<code>Tick</code> \u8017\u65f6\u5927\u6982 <code>0.4ms</code>\u3002\u73a9\u5bb6\u52a0\u5165\u573a\u666f\u548c\u66f4\u65b0\u5750\u6807\u90fd\u662f\u7ebf\u6027\u590d\u6742\u5ea6 <code>O(player_num)</code>\uff0c\u6027\u80fd\u8868\u73b0\u90fd\u4e0d\u9519\u3002\u5728 <code>player_num = 10000, map_size = [-50, 50]</code> \u73a9\u5bb6\u4eba\u6570\u8fbe\u5230 1 \u4e07\u7684\u65f6\u5019\uff0c<code>Add Player</code> \u548c <code>Update Pos</code> \u7531\u4e8e\u90fd\u662f\u7ebf\u6027\uff0c\u51e0\u6beb\u79d2\u5185\u5c31\u80fd\u5b8c\u6210\uff0c\u4f46 <code>Tick</code> \u8017\u65f6\u5c31\u53bb\u5230 <code>3.8s</code>\uff0c\u9700\u8981\u6d88\u8017\u5927\u91cf CPU\uff0c\u5c5e\u4e8e\u4e0d\u53ef\u7528\u4e86\u3002\u4eba\u6570 1 \u4e07\uff0c\u5730\u56fe\u5927\u5c0f <code>[-1000, 1000]</code>\uff0c\u60c5\u51b5\u4e0b\uff0c<code>Tick</code> \u65f6\u95f4\u6d88\u8017\u5927\u6982 <code>94ms</code>\uff0c\u5982\u679c\u80fd\u591f\u964d\u4f4e <code>Tick</code> \u9891\u7387\u7684\u8bdd\uff0c\u8b6c\u5982\u4e00\u79d2\u4e24\u6b21\uff0c\u8fd8\u662f\u52c9\u5f3a\u5c5e\u4e8e\u53ef\u7528\u7684\u8303\u56f4\u5185\u3002</p>\n<h4 id=\"_8\">\u5341\u5b57\u94fe\u8868\u5b9e\u6d4b</h4>\n<p>\u5341\u5b57\u94fe\u8868\u7684\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a</p>\n<div class=\"language-python highlight\"><pre><span></span><code><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.002057</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000330</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000232</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a>\n<a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.001201</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-9\" name=\"__codelineno-6-9\" href=\"#__codelineno-6-9\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000222</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-10\" name=\"__codelineno-6-10\" href=\"#__codelineno-6-10\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000272</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-11\" name=\"__codelineno-6-11\" href=\"#__codelineno-6-11\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-12\" name=\"__codelineno-6-12\" href=\"#__codelineno-6-12\"></a>\n<a id=\"__codelineno-6-13\" name=\"__codelineno-6-13\" href=\"#__codelineno-6-13\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-14\" name=\"__codelineno-6-14\" href=\"#__codelineno-6-14\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000288</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-15\" name=\"__codelineno-6-15\" href=\"#__codelineno-6-15\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000048</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-16\" name=\"__codelineno-6-16\" href=\"#__codelineno-6-16\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000200</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-17\" name=\"__codelineno-6-17\" href=\"#__codelineno-6-17\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-18\" name=\"__codelineno-6-18\" href=\"#__codelineno-6-18\"></a>\n<a id=\"__codelineno-6-19\" name=\"__codelineno-6-19\" href=\"#__codelineno-6-19\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-20\" name=\"__codelineno-6-20\" href=\"#__codelineno-6-20\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000194</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-21\" name=\"__codelineno-6-21\" href=\"#__codelineno-6-21\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000041</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-22\" name=\"__codelineno-6-22\" href=\"#__codelineno-6-22\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000192</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-23\" name=\"__codelineno-6-23\" href=\"#__codelineno-6-23\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-24\" name=\"__codelineno-6-24\" href=\"#__codelineno-6-24\"></a>\n<a id=\"__codelineno-6-25\" name=\"__codelineno-6-25\" href=\"#__codelineno-6-25\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-26\" name=\"__codelineno-6-26\" href=\"#__codelineno-6-26\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.130766</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.130000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.130000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.4</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-27\" name=\"__codelineno-6-27\" href=\"#__codelineno-6-27\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.028091</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">71.2</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-28\" name=\"__codelineno-6-28\" href=\"#__codelineno-6-28\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.005369</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">186.2</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-29\" name=\"__codelineno-6-29\" href=\"#__codelineno-6-29\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-30\" name=\"__codelineno-6-30\" href=\"#__codelineno-6-30\"></a>\n<a id=\"__codelineno-6-31\" name=\"__codelineno-6-31\" href=\"#__codelineno-6-31\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-32\" name=\"__codelineno-6-32\" href=\"#__codelineno-6-32\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.103015</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.100000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.100000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">97.1</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-33\" name=\"__codelineno-6-33\" href=\"#__codelineno-6-33\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.019545</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">102.3</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-34\" name=\"__codelineno-6-34\" href=\"#__codelineno-6-34\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.009208</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">108.6</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-35\" name=\"__codelineno-6-35\" href=\"#__codelineno-6-35\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-36\" name=\"__codelineno-6-36\" href=\"#__codelineno-6-36\"></a>\n<a id=\"__codelineno-6-37\" name=\"__codelineno-6-37\" href=\"#__codelineno-6-37\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-38\" name=\"__codelineno-6-38\" href=\"#__codelineno-6-38\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.010150</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">98.5</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-39\" name=\"__codelineno-6-39\" href=\"#__codelineno-6-39\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000845</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-40\" name=\"__codelineno-6-40\" href=\"#__codelineno-6-40\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.003023</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-41\" name=\"__codelineno-6-41\" href=\"#__codelineno-6-41\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-42\" name=\"__codelineno-6-42\" href=\"#__codelineno-6-42\"></a>\n<a id=\"__codelineno-6-43\" name=\"__codelineno-6-43\" href=\"#__codelineno-6-43\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-44\" name=\"__codelineno-6-44\" href=\"#__codelineno-6-44\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.004950</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">202.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-45\" name=\"__codelineno-6-45\" href=\"#__codelineno-6-45\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.000427</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-46\" name=\"__codelineno-6-46\" href=\"#__codelineno-6-46\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.002234</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-47\" name=\"__codelineno-6-47\" href=\"#__codelineno-6-47\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-48\" name=\"__codelineno-6-48\" href=\"#__codelineno-6-48\"></a>\n<a id=\"__codelineno-6-49\" name=\"__codelineno-6-49\" href=\"#__codelineno-6-49\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">50.000000</span><span class=\"p\">,</span> <span class=\"mf\">50.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-50\" name=\"__codelineno-6-50\" href=\"#__codelineno-6-50\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">21.606402</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">21.040000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.570000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">21.610000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">100.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-51\" name=\"__codelineno-6-51\" href=\"#__codelineno-6-51\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">3.696885</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">3.680000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.030000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">3.710000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">100.4</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-52\" name=\"__codelineno-6-52\" href=\"#__codelineno-6-52\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.434396</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.430000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.430000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-53\" name=\"__codelineno-6-53\" href=\"#__codelineno-6-53\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-54\" name=\"__codelineno-6-54\" href=\"#__codelineno-6-54\"></a>\n<a id=\"__codelineno-6-55\" name=\"__codelineno-6-55\" href=\"#__codelineno-6-55\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">100.000000</span><span class=\"p\">,</span> <span class=\"mf\">100.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-56\" name=\"__codelineno-6-56\" href=\"#__codelineno-6-56\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">18.499235</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">18.470000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.020000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">18.490000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">100.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-57\" name=\"__codelineno-6-57\" href=\"#__codelineno-6-57\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">2.292608</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">2.290000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">2.290000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.9</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-58\" name=\"__codelineno-6-58\" href=\"#__codelineno-6-58\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">1.522617</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">1.530000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">1.530000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">100.5</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-59\" name=\"__codelineno-6-59\" href=\"#__codelineno-6-59\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-60\" name=\"__codelineno-6-60\" href=\"#__codelineno-6-60\"></a>\n<a id=\"__codelineno-6-61\" name=\"__codelineno-6-61\" href=\"#__codelineno-6-61\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">1000.000000</span><span class=\"p\">,</span> <span class=\"mf\">1000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-62\" name=\"__codelineno-6-62\" href=\"#__codelineno-6-62\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">1.642519</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">1.640000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">1.640000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.8</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-63\" name=\"__codelineno-6-63\" href=\"#__codelineno-6-63\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.042767</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.050000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.050000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">116.9</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-64\" name=\"__codelineno-6-64\" href=\"#__codelineno-6-64\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.202949</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.200000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.200000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">98.5</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-65\" name=\"__codelineno-6-65\" href=\"#__codelineno-6-65\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n<a id=\"__codelineno-6-66\" name=\"__codelineno-6-66\" href=\"#__codelineno-6-66\"></a>\n<a id=\"__codelineno-6-67\" name=\"__codelineno-6-67\" href=\"#__codelineno-6-67\"></a><span class=\"o\">===</span><span class=\"n\">Begin</span> <span class=\"n\">Milestore</span><span class=\"p\">:</span> <span class=\"n\">player_num</span> <span class=\"o\">=</span> <span class=\"mi\">10000</span><span class=\"p\">,</span> <span class=\"n\">map_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">10000.000000</span><span class=\"p\">,</span> <span class=\"mf\">10000.000000</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-68\" name=\"__codelineno-6-68\" href=\"#__codelineno-6-68\"></a><span class=\"n\">Add</span> <span class=\"n\">Player</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.571257</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.570000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.570000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">99.8</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-69\" name=\"__codelineno-6-69\" href=\"#__codelineno-6-69\"></a><span class=\"n\">Tick</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.006325</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.010000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">158.1</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-70\" name=\"__codelineno-6-70\" href=\"#__codelineno-6-70\"></a><span class=\"n\">Update</span> <span class=\"n\">Pos</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"n\">times</span><span class=\"p\">)</span> <span class=\"mf\">0.042568</span><span class=\"n\">s</span> <span class=\"n\">wall</span><span class=\"p\">,</span> <span class=\"mf\">0.040000</span><span class=\"n\">s</span> <span class=\"n\">user</span> <span class=\"o\">+</span> <span class=\"mf\">0.000000</span><span class=\"n\">s</span> <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"mf\">0.040000</span><span class=\"n\">s</span> <span class=\"n\">CPU</span> <span class=\"p\">(</span><span class=\"mf\">94.0</span><span class=\"o\">%</span><span class=\"p\">)</span>\n<a id=\"__codelineno-6-71\" name=\"__codelineno-6-71\" href=\"#__codelineno-6-71\"></a><span class=\"o\">===</span><span class=\"n\">End</span> <span class=\"n\">Milestore</span>\n</code></pre></div>\n<p>\u5982\u6211\u4eec\u5206\u6790\u4e00\u81f4\uff0c\u5341\u5b57\u94fe\u8868\u5728 <code>Add Player</code> \u548c <code>Update Pos</code> \u4e0a\u8017\u65f6\u66f4\u957f\uff0c\u7279\u522b\u662f <code>Add Player</code>\uff0c\u76f8\u6bd4\u4e5d\u5bab\u683c\u6027\u80fd\u5dee\u4e86\u51e0\u767e\u751a\u81f3\u4e0a\u4e07\u500d\uff08<code>100, [-50, 50]</code> \u5341\u5b57\u94fe\u8017\u65f6 <code>2ms</code>\uff0c\u800c\u4e5d\u5bab\u683c\u53ea\u6709 <code>0.08ms</code>\uff1b<code>10000, [-50, 50]</code> \u5341\u5b57\u94fe <code>21.6s</code>\uff0c\u4e5d\u5bab\u683c\u53ea\u6709 <code>6ms</code>\u3002<code>Update Pos</code> \u7684\u8017\u65f6\u4e5f\u6700\u591a\u4f1a\u6709\u767e\u500d\u7684\u5dee\u8ddd\uff0c<code>10000, [-100, 100]</code> \u5341\u5b57\u94fe\u66f4\u65b0\u73a9\u5bb6\u4f4d\u7f6e\u8017\u65f6 <code>1.5s</code>\uff0c\u800c\u4e5d\u5bab\u683c\u662f <code>18ms</code>\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5341\u5b57\u94fe\u5728 <code>Add Player</code> \u548c <code>Update Pos</code> \u8017\u65f6\u7684\u4e0a\u4e0b\u9650\u8303\u56f4\u6bd4\u4e5d\u5bab\u683c\u8981\u5927\uff0c\u53d7\u4eba\u6570\u548c\u5730\u56fe\u5927\u5c0f\u5f71\u54cd\u66f4\u5927\uff0c\u5728\u73a9\u5bb6\u5bc6\u96c6\u7684\u533a\u57df\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6027\u80fd\u4f1a\u6025\u901f\u4e0b\u964d\uff0c\u76f4\u81f3\u4e0d\u53ef\u7528\u3002</p>\n<p>\u53cd\u89c2\u5341\u5b57\u94fe\u7684 <code>Tick</code> \u64cd\u4f5c\uff0c\u6574\u4f53\u6027\u80fd\u786e\u5b9e\u662f\u6bd4\u4e5d\u5bab\u683c\u597d\uff0c\u6700\u597d\u7684\u60c5\u51b5\u8017\u65f6\u5927\u6982\u53ea\u6709\u4e5d\u5bab\u683c\u7684\u4e00\u534a\u5de6\u53f3\uff08 <code>1000, [-1000, 1000]</code> \u4e0b\u5341\u5b57\u94fe\u8017\u65f6 <code>0.8ms</code>\uff0c\u4e5d\u5bab\u683c <code>1.8ms</code>\uff09\uff0c\u4f46\u662f\u6700\u5dee\u7684\u60c5\u51b5\u5341\u5b57\u94fe\u4f1a\u9000\u5316\u5230\u8ddf\u4e5d\u5bab\u683c\u7684\u6027\u80fd\u63a5\u8fd1\uff08<code>10000, [-10000, 10000]</code> \u4e0b\u5341\u5b57\u94fe\u8017\u65f6 <code>3.7s</code>\uff0c\u4e5d\u5bab\u683c <code>3.8s</code>\u3002\u8fd9\u662f\u56e0\u4e3a\u7531\u4e8e\u573a\u666f\u5c0f\uff0c\u73a9\u5bb6\u4e92\u76f8\u90fd\u5728\u5f7c\u6b64\u7684 AOI \u8303\u56f4\u5185\uff0c\u5341\u5b57\u94fe <code>Tick</code> \u904d\u5386\u7684 <code>candidates</code> \u6570\u91cf, \u5176\u5b9e\u5df2\u7ecf\u8ddf\u4e5d\u5bab\u683c\u5f88\u63a5\u8fd1\u4e86\u3002</p>\n<p>\u5341\u5b57\u94fe\u4f7f\u7528\u8d77\u6765\u8981\u8fbe\u5230\u6bd4\u4e5d\u5bab\u683c\u6027\u80fd\u66f4\u4f18\uff0c\u9700\u8981\u4e00\u4e9b\u66f4\u5f3a\u7684\u5047\u8bbe\uff0c\u8b6c\u5982 <code>player_num = 1000, map_size = [-1000, 1000]</code> \u60c5\u51b5\u4e0b\uff0c<code>Tick</code> \u8017\u65f6\u5341\u5b57\u94fe\u4e3a <code>0.8ms</code> \u4e5d\u5bab\u683c <code>1.8ms</code>\uff0c<code>Update Pos</code> \u5341\u5b57\u94fe\u4e3a <code>0.3ms</code> \u4e5d\u5bab\u683c <code>0.18ms</code>\uff08\u6ce8\u610f\u6d4b\u8bd5 <code>Update Pos</code> \u65f6\u95f4\u4e3a\u6267\u884c\u4e86 10 \u6b21\u7684\u65f6\u95f4\u603b\u548c\uff09\u3002<code>Tick + Update Pos</code> \u603b\u65f6\u95f4\u4e0b\uff0c\u5341\u5b57\u94fe\u5982\u679c\u8981\u6bd4\u4e5d\u5bab\u683c\u66f4\u5c11\uff0c\u90a3 <code>Update Pos</code> \u7684\u6b21\u6570\u4e0d\u80fd\u8d85\u8fc7 <code>Tick</code> \u7684 <code>8</code> \u500d\uff0c\u6216\u8005\u8bf4\u4e24\u4e2a <code>Tick</code> \u4e4b\u95f4\uff0c<code>Update Pos</code> \u7684\u6b21\u6570\u9700\u8981\u5c0f\u4e8e <code>8</code> \u6b21\u3002\u53e6\u5916\u56e0\u4e3a\u5341\u5b57\u94fe <code>Add Player</code> \u8017\u65f6\u5de8\u5927\uff0c\u4e0d\u9002\u7528\u4e8e\u73a9\u5bb6\u77ed\u65f6\u95f4\u9891\u7e41\u51fa\u5165\u573a\u666f\u6216\u8005\u5728\u573a\u666f\u5185\u5927\u8303\u56f4\u4f20\u9001\u7684\u60c5\u51b5\uff0c\u53e6\u5916\u5982\u679c\u77ed\u65f6\u95f4\u5185\u6709\u5927\u91cf\u73a9\u5bb6\u8fdb\u5165\u573a\u666f\uff0c\u4e5f\u5f88\u5bb9\u6613\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u5927\u91cf\u5360\u7528 CPU\u3002</p>\n<p>\u5bf9\u4e8e\u5341\u5b57\u94fe\u8868\uff0c\u5728\u4e00\u4e2a\u524d\u63d0\u4e4b\u4e0b\u8fd8\u80fd\u505a\u4e00\u4e2a\u4f18\u5316\uff1a\u5e72\u6389 <code>Tick</code>\uff0c\u524d\u63d0\u662f\u6e38\u620f\u80fd\u63a5\u53d7\u6b63\u65b9\u5f62\u7684 AOI\uff0c\u5e76\u4e14\u9700\u8981\u5b9e\u6d4b\u6b63\u65b9\u5f62 AOI \u5e26\u6765\u7684\u5176\u4ed6\u8bf8\u5982\u7f51\u7edc\u7b49\u6d88\u8017\u662f\u80fd\u63a5\u53d7\u7684\u3002\u5176\u5b9e\u524d\u63d0\u662f\u6bd4\u8f83\u82db\u523b\u7684\uff0c\u56e0\u4e3a\u5728\u6e38\u620f\u4e2d AOI \u8ba1\u8d39\u80fd\u5360\u7528\u7684 CPU \u901a\u5e38\u5360\u6bd4\u662f\u4e0d\u5927\u7684\uff0c\u4f46\u628a\u5706\u5f62 AOI \u6539\u6210\u65b9\u5f62 AOI \u5bfc\u81f4 AOI \u8303\u56f4\u9762\u79ef\u589e\u5927\uff0c\u8303\u56f4\u5185\u7684\u73a9\u5bb6\u6570\u91cf\u4e5f\u589e\u591a\uff0c\u5747\u5300\u5206\u5e03\u4e0b\u73a9\u5bb6\u6570\u91cf\u53ef\u80fd\u4f1a\u589e\u591a\u5230\u539f\u6765\u7684 <code>1.27</code> \u500d\u3002\u4f46\u662f\uff0c\u4e00\u65e6\u80fd\u6ee1\u8db3\u524d\u63d0\uff0c\u5341\u5b57\u94fe\u8868\u53ef\u4ee5\u505a\u5230\u4e0d\u9700\u8981 <code>Tick</code> \u6765\u5b9a\u671f\u66f4\u65b0 AOI \u4e8b\u4ef6\uff0c\u56e0\u4e3a\u5b9e\u73b0\u4e0a\u5341\u5b57\u94fe\u8868\u7684 <code>candidates</code> \u5c31\u7ef4\u62a4\u4e86\u4e00\u4efd\u65b9\u5f62\u4e0b AOI\uff0c\u539f\u6765\u53ea\u662f\u4e3a\u4e86\u8ba1\u7b97\u5706\u5f62 AOI\uff0c\u800c\u4e0d\u5f97\u4e0d\u5728 <code>Tick</code> \u4e2d\u518d\u904d\u5386\u8ba1\u7b97\u8ddd\u79bb\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5341\u5b57\u94fe\u662f\u6709\u53ef\u80fd\u80fd\u591f\u8fbe\u5230\u5f88\u597d\u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u5341\u5b57\u94fe\u8868 <code>Update Pos</code> \u7684\u6027\u80fd\u53ef\u4ee5\u8ddf <code>Tick</code> \u76f8\u5dee\u51e0\u500d\u5230\u51e0\u5341\u500d\u3002</p>\n<p>\u6700\u540e\u7ed9\u51fa\u4e24\u8005\u7684\u5bf9\u6bd4\u67f1\u72b6\u56fe\uff1a</p>\n<p><img alt=\"\" src=\"../assets/img/2021-11-18-aoi-tesing/add_player.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2021-11-18-aoi-tesing/tick.png\" /></p>\n<p><img alt=\"\" src=\"../assets/img/2021-11-18-aoi-tesing/update_pos.png\" /></p>\n<h3 id=\"_9\">\u603b\u7ed3</h3>\n<p>\u672c\u6587\u6211\u4eec\u4ecb\u7ecd\u4e86\u4e24\u79cd AOI \u7b97\u6cd5\uff08\u4e5d\u5bab\u683c\u548c\u5341\u5b57\u94fe\uff09\u7684\u539f\u7406\u548c\u57fa\u672c\u5b9e\u73b0\uff0c\u5e76\u901a\u8fc7\u5b9e\u6d4b\u7684\u6570\u636e\u5206\u6790\u4e86\u8fd9\u4e24\u79cd\u7b97\u6cd5\u7684\u6027\u80fd\u4f18\u52a3\uff0c\u5e0c\u671b\u80fd\u591f\u7ed9\u8bfb\u8005\u5e26\u6765\u4e00\u4e9b\u5e2e\u52a9\u6216\u8005\u542f\u53d1\u3002</p>\n<p>\u603b\u7684\u6765\u8bf4\uff0c\u4e5d\u5bab\u683c\u6cd5\u5b9e\u73b0\u7b80\u5355\uff0c\u6027\u80fd\u5747\u8861\u4e0d\u5bb9\u6613\u62c9\u80ef\uff0c\u975e\u5e38\u9002\u5408 AOI \u4e0d\u662f\u6027\u80fd\u74f6\u9888\u7684\u6e38\u620f\u6765\u4f7f\u7528\uff0c\u4e5d\u5bab\u683c\u6cd5\u7684\u6027\u80fd\u6ce2\u52a8\u8303\u56f4\u662f\u5728\u53ef\u9884\u671f\u7684\u8303\u56f4\u5185\uff0c\u6027\u80fd\u4e0b\u9650\u6bd4\u8f83\u9ad8\uff0c\u4e5f\u4e0d\u5bb9\u6613\u5bfc\u81f4\u74f6\u9888\uff0c\u4f46\u53e6\u4e00\u65b9\u9762\u53ef\u4f18\u5316\u7a7a\u95f4\u4e5f\u4e0d\u5927\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u6bd4\u8f83\u56fa\u5b9a\u3002\u53cd\u89c2\u5341\u5b57\u94fe\u6cd5\uff0c\u5b9e\u73b0\u8981\u66f4\u590d\u6742\uff0c\u6027\u80fd\u4e0b\u9650\u6bd4\u4e5d\u5bab\u683c\u6cd5\u4f4e\uff0c\u4f46\u662f\u5982\u679c\u80fd\u591f\u6ee1\u8db3\u4e00\u4e9b\u5047\u8bbe\u548c\u524d\u63d0\uff0c\u5341\u5b57\u94fe\u53ef\u4f18\u5316\u7a7a\u95f4\u66f4\u9ad8\uff0c\u6362\u53e5\u8bdd\u8bf4\u662f\u4e0a\u9650\u662f\u53ef\u4ee5\u66f4\u9ad8\u3002\u8fd9\u4e24\u79cd\u65b9\u6cd5\u5404\u6709\u4f18\u52a3\uff0c\u6e38\u620f\u4e1a\u754c\u5185\u4e5f\u6709\u4e0d\u540c\u7684\u5f15\u64ce\u5206\u522b\u9009\u62e9\u4e86\u4e24\u8005\u4e4b\u4e00\uff0c\u5404\u53d6\u6240\u9700\uff0c\u89c1\u4ec1\u89c1\u667a\u3002</p>\n<p>\u672c\u4eba\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u5185\u5bb9\u4ec5\u4ee3\u8868\u672c\u4eba\u60f3\u6cd5\uff0c\u5982\u6709\u4e0d\u8db3\u4e0d\u59a5\u4e4b\u5904\u6b22\u8fce\u7559\u8a00\u8ba8\u8bba\u3002</p>\n<script async src=\"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"></script>\n\n<!-- \u8f6c\u8f7d\u58f0\u660e && visit -->\n<blockquote>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://wiki.disenone.site\">https://wiki.disenone.site</a></p>\n<p>\u672c\u7bc7\u6587\u7ae0\u53d7 <a href=\"https://creativecommons.org/licenses/by/4.0/deed.zh\">CC BY-NC-SA 4.0</a> \u534f\u8bae\u4fdd\u62a4\uff0c\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>\n</blockquote>\n<!-- \u8f6c\u8f7d -->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\" data-a2a-icon-color=\"#4051b5\">\n    <a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n    <a class=\"a2a_button_copy_link\"></a>\n    <a class=\"a2a_button_wechat\"></a>\n    <a class=\"a2a_button_reddit\"></a>\n    <a class=\"a2a_button_google_gmail\"></a>\n    <a class=\"a2a_button_pocket\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n<!-- visit -->\n<blockquote>\n<p><p class=\"copyright text-muted\"><span id=\"busuanzi_container_site_uv\"> <span id=\"busuanzi_value_site_uv\"></span> Visitors. </span> <span id=\"busuanzi_container_site_pv\"> <span id=\"busuanzi_value_site_pv\"></span> Total Visits. </span> <span id=\"busuanzi_container_page_pv\"> <span id=\"busuanzi_value_page_pv\"></span> Page Visits. </span></p></p>\n</blockquote>",
            "image": null,
            "date_published": "2021-11-18T00:00:00+00:00",
            "authors": [],
            "tags": null
        }
    ]
}